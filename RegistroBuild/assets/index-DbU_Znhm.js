(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function Mc(e){const n=Object.create(null);for(const t of e.split(","))n[t]=1;return t=>t in n}const Ge={},Bo=[],Un=()=>{},Wd=()=>!1,fs=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Oc=e=>e.startsWith("onUpdate:"),yt=Object.assign,Bc=(e,n)=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)},Gg=Object.prototype.hasOwnProperty,Ue=(e,n)=>Gg.call(e,n),Re=Array.isArray,Lo=e=>hs(e)==="[object Map]",Vd=e=>hs(e)==="[object Set]",De=e=>typeof e=="function",ot=e=>typeof e=="string",hr=e=>typeof e=="symbol",je=e=>e!==null&&typeof e=="object",zd=e=>(je(e)||De(e))&&De(e.then)&&De(e.catch),Ud=Object.prototype.toString,hs=e=>Ud.call(e),qg=e=>hs(e).slice(8,-1),Hd=e=>hs(e)==="[object Object]",Lc=e=>ot(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,bi=Mc(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ds=e=>{const n=Object.create(null);return(t=>n[t]||(n[t]=e(t)))},jg=/-\w/g,gn=ds(e=>e.replace(jg,n=>n.slice(1).toUpperCase())),Kg=/\B([A-Z])/g,ho=ds(e=>e.replace(Kg,"-$1").toLowerCase()),ps=ds(e=>e.charAt(0).toUpperCase()+e.slice(1)),Hs=ds(e=>e?`on${ps(e)}`:""),Tr=(e,n)=>!Object.is(e,n),Ra=(e,...n)=>{for(let t=0;t<e.length;t++)e[t](...n)},Gd=(e,n,t,r=!1)=>{Object.defineProperty(e,n,{configurable:!0,enumerable:!1,writable:r,value:t})},Wc=e=>{const n=parseFloat(e);return isNaN(n)?e:n},$g=e=>{const n=ot(e)?Number(e):NaN;return isNaN(n)?e:n};let pf;const vs=()=>pf||(pf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vc(e){if(Re(e)){const n={};for(let t=0;t<e.length;t++){const r=e[t],o=ot(r)?Jg(r):Vc(r);if(o)for(const i in o)n[i]=o[i]}return n}else if(ot(e)||je(e))return e}const Xg=/;(?![^(]*\))/g,Yg=/:([^]+)/,Qg=/\/\*[^]*?\*\//g;function Jg(e){const n={};return e.replace(Qg,"").split(Xg).forEach(t=>{if(t){const r=t.split(Yg);r.length>1&&(n[r[0].trim()]=r[1].trim())}}),n}function ms(e){let n="";if(ot(e))n=e;else if(Re(e))for(let t=0;t<e.length;t++){const r=ms(e[t]);r&&(n+=r+" ")}else if(je(e))for(const t in e)e[t]&&(n+=t+" ");return n.trim()}const Zg="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ey=Mc(Zg);function qd(e){return!!e||e===""}const jd=e=>!!(e&&e.__v_isRef===!0),xn=e=>ot(e)?e:e==null?"":Re(e)||je(e)&&(e.toString===Ud||!De(e.toString))?jd(e)?xn(e.value):JSON.stringify(e,Kd,2):String(e),Kd=(e,n)=>jd(n)?Kd(e,n.value):Lo(n)?{[`Map(${n.size})`]:[...n.entries()].reduce((t,[r,o],i)=>(t[Gs(r,i)+" =>"]=o,t),{})}:Vd(n)?{[`Set(${n.size})`]:[...n.values()].map(t=>Gs(t))}:hr(n)?Gs(n):je(n)&&!Re(n)&&!Hd(n)?String(n):n,Gs=(e,n="")=>{var t;return hr(e)?`Symbol(${(t=e.description)!=null?t:n})`:e};let qt;class ty{constructor(n=!1){this.detached=n,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=qt,!n&&qt&&(this.index=(qt.scopes||(qt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].pause();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].resume();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].resume()}}run(n){if(this._active){const t=qt;try{return qt=this,n()}finally{qt=t}}}on(){++this._on===1&&(this.prevScope=qt,qt=this)}off(){this._on>0&&--this._on===0&&(qt=this.prevScope,this.prevScope=void 0)}stop(n){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!n){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function ny(){return qt}let qe;const qs=new WeakSet;class $d{constructor(n){this.fn=n,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,qt&&qt.active&&qt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,qs.has(this)&&(qs.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Yd(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,vf(this),Qd(this);const n=qe,t=Cn;qe=this,Cn=!0;try{return this.fn()}finally{Jd(this),qe=n,Cn=t,this.flags&=-3}}stop(){if(this.flags&1){for(let n=this.deps;n;n=n.nextDep)Hc(n);this.deps=this.depsTail=void 0,vf(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?qs.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){zu(this)&&this.run()}get dirty(){return zu(this)}}let Xd=0,xi,wi;function Yd(e,n=!1){if(e.flags|=8,n){e.next=wi,wi=e;return}e.next=xi,xi=e}function zc(){Xd++}function Uc(){if(--Xd>0)return;if(wi){let n=wi;for(wi=void 0;n;){const t=n.next;n.next=void 0,n.flags&=-9,n=t}}let e;for(;xi;){let n=xi;for(xi=void 0;n;){const t=n.next;if(n.next=void 0,n.flags&=-9,n.flags&1)try{n.trigger()}catch(r){e||(e=r)}n=t}}if(e)throw e}function Qd(e){for(let n=e.deps;n;n=n.nextDep)n.version=-1,n.prevActiveLink=n.dep.activeLink,n.dep.activeLink=n}function Jd(e){let n,t=e.depsTail,r=t;for(;r;){const o=r.prevDep;r.version===-1?(r===t&&(t=o),Hc(r),ry(r)):n=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=o}e.deps=n,e.depsTail=t}function zu(e){for(let n=e.deps;n;n=n.nextDep)if(n.dep.version!==n.version||n.dep.computed&&(Zd(n.dep.computed)||n.dep.version!==n.version))return!0;return!!e._dirty}function Zd(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Ti)||(e.globalVersion=Ti,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!zu(e))))return;e.flags|=2;const n=e.dep,t=qe,r=Cn;qe=e,Cn=!0;try{Qd(e);const o=e.fn(e._value);(n.version===0||Tr(o,e._value))&&(e.flags|=128,e._value=o,n.version++)}catch(o){throw n.version++,o}finally{qe=t,Cn=r,Jd(e),e.flags&=-3}}function Hc(e,n=!1){const{dep:t,prevSub:r,nextSub:o}=e;if(r&&(r.nextSub=o,e.prevSub=void 0),o&&(o.prevSub=r,e.nextSub=void 0),t.subs===e&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Hc(i,!0)}!n&&!--t.sc&&t.map&&t.map.delete(t.key)}function ry(e){const{prevDep:n,nextDep:t}=e;n&&(n.nextDep=t,e.prevDep=void 0),t&&(t.prevDep=n,e.nextDep=void 0)}let Cn=!0;const ep=[];function cr(){ep.push(Cn),Cn=!1}function lr(){const e=ep.pop();Cn=e===void 0?!0:e}function vf(e){const{cleanup:n}=e;if(e.cleanup=void 0,n){const t=qe;qe=void 0;try{n()}finally{qe=t}}}let Ti=0;class oy{constructor(n,t){this.sub=n,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Gc{constructor(n){this.computed=n,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(n){if(!qe||!Cn||qe===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==qe)t=this.activeLink=new oy(qe,this),qe.deps?(t.prevDep=qe.depsTail,qe.depsTail.nextDep=t,qe.depsTail=t):qe.deps=qe.depsTail=t,tp(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=qe.depsTail,t.nextDep=void 0,qe.depsTail.nextDep=t,qe.depsTail=t,qe.deps===t&&(qe.deps=r)}return t}trigger(n){this.version++,Ti++,this.notify(n)}notify(n){zc();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Uc()}}}function tp(e){if(e.dep.sc++,e.sub.flags&4){const n=e.dep.computed;if(n&&!e.dep.subs){n.flags|=20;for(let r=n.deps;r;r=r.nextDep)tp(r)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}const Uu=new WeakMap,io=Symbol(""),Hu=Symbol(""),Di=Symbol("");function At(e,n,t){if(Cn&&qe){let r=Uu.get(e);r||Uu.set(e,r=new Map);let o=r.get(t);o||(r.set(t,o=new Gc),o.map=r,o.key=t),o.track()}}function ar(e,n,t,r,o,i){const a=Uu.get(e);if(!a){Ti++;return}const s=u=>{u&&u.trigger()};if(zc(),n==="clear")a.forEach(s);else{const u=Re(e),c=u&&Lc(t);if(u&&t==="length"){const l=Number(r);a.forEach((f,h)=>{(h==="length"||h===Di||!hr(h)&&h>=l)&&s(f)})}else switch((t!==void 0||a.has(void 0))&&s(a.get(t)),c&&s(a.get(Di)),n){case"add":u?c&&s(a.get("length")):(s(a.get(io)),Lo(e)&&s(a.get(Hu)));break;case"delete":u||(s(a.get(io)),Lo(e)&&s(a.get(Hu)));break;case"set":Lo(e)&&s(a.get(io));break}}Uc()}function xo(e){const n=We(e);return n===e?n:(At(n,"iterate",Di),vn(e)?n:n.map(Et))}function gs(e){return At(e=We(e),"iterate",Di),e}const iy={__proto__:null,[Symbol.iterator](){return js(this,Symbol.iterator,Et)},concat(...e){return xo(this).concat(...e.map(n=>Re(n)?xo(n):n))},entries(){return js(this,"entries",e=>(e[1]=Et(e[1]),e))},every(e,n){return Zn(this,"every",e,n,void 0,arguments)},filter(e,n){return Zn(this,"filter",e,n,t=>t.map(Et),arguments)},find(e,n){return Zn(this,"find",e,n,Et,arguments)},findIndex(e,n){return Zn(this,"findIndex",e,n,void 0,arguments)},findLast(e,n){return Zn(this,"findLast",e,n,Et,arguments)},findLastIndex(e,n){return Zn(this,"findLastIndex",e,n,void 0,arguments)},forEach(e,n){return Zn(this,"forEach",e,n,void 0,arguments)},includes(...e){return Ks(this,"includes",e)},indexOf(...e){return Ks(this,"indexOf",e)},join(e){return xo(this).join(e)},lastIndexOf(...e){return Ks(this,"lastIndexOf",e)},map(e,n){return Zn(this,"map",e,n,void 0,arguments)},pop(){return ui(this,"pop")},push(...e){return ui(this,"push",e)},reduce(e,...n){return mf(this,"reduce",e,n)},reduceRight(e,...n){return mf(this,"reduceRight",e,n)},shift(){return ui(this,"shift")},some(e,n){return Zn(this,"some",e,n,void 0,arguments)},splice(...e){return ui(this,"splice",e)},toReversed(){return xo(this).toReversed()},toSorted(e){return xo(this).toSorted(e)},toSpliced(...e){return xo(this).toSpliced(...e)},unshift(...e){return ui(this,"unshift",e)},values(){return js(this,"values",Et)}};function js(e,n,t){const r=gs(e),o=r[n]();return r!==e&&!vn(e)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=t(i.value)),i}),o}const ay=Array.prototype;function Zn(e,n,t,r,o,i){const a=gs(e),s=a!==e&&!vn(e),u=a[n];if(u!==ay[n]){const f=u.apply(e,i);return s?Et(f):f}let c=t;a!==e&&(s?c=function(f,h){return t.call(this,Et(f),h,e)}:t.length>2&&(c=function(f,h){return t.call(this,f,h,e)}));const l=u.call(a,c,r);return s&&o?o(l):l}function mf(e,n,t,r){const o=gs(e);let i=t;return o!==e&&(vn(e)?t.length>3&&(i=function(a,s,u){return t.call(this,a,s,u,e)}):i=function(a,s,u){return t.call(this,a,Et(s),u,e)}),o[n](i,...r)}function Ks(e,n,t){const r=We(e);At(r,"iterate",Di);const o=r[n](...t);return(o===-1||o===!1)&&Kc(t[0])?(t[0]=We(t[0]),r[n](...t)):o}function ui(e,n,t=[]){cr(),zc();const r=We(e)[n].apply(e,t);return Uc(),lr(),r}const sy=Mc("__proto__,__v_isRef,__isVue"),np=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(hr));function uy(e){hr(e)||(e=String(e));const n=We(this);return At(n,"has",e),n.hasOwnProperty(e)}class rp{constructor(n=!1,t=!1){this._isReadonly=n,this._isShallow=t}get(n,t,r){if(t==="__v_skip")return n.__v_skip;const o=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!o;if(t==="__v_isReadonly")return o;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(o?i?yy:sp:i?ap:ip).get(n)||Object.getPrototypeOf(n)===Object.getPrototypeOf(r)?n:void 0;const a=Re(n);if(!o){let u;if(a&&(u=iy[t]))return u;if(t==="hasOwnProperty")return uy}const s=Reflect.get(n,t,Wt(n)?n:r);if((hr(t)?np.has(t):sy(t))||(o||At(n,"get",t),i))return s;if(Wt(s)){const u=a&&Lc(t)?s:s.value;return o&&je(u)?qu(u):u}return je(s)?o?qu(s):$t(s):s}}class op extends rp{constructor(n=!1){super(!1,n)}set(n,t,r,o){let i=n[t];if(!this._isShallow){const u=Fr(i);if(!vn(r)&&!Fr(r)&&(i=We(i),r=We(r)),!Re(n)&&Wt(i)&&!Wt(r))return u||(i.value=r),!0}const a=Re(n)&&Lc(t)?Number(t)<n.length:Ue(n,t),s=Reflect.set(n,t,r,Wt(n)?n:o);return n===We(o)&&(a?Tr(r,i)&&ar(n,"set",t,r):ar(n,"add",t,r)),s}deleteProperty(n,t){const r=Ue(n,t);n[t];const o=Reflect.deleteProperty(n,t);return o&&r&&ar(n,"delete",t,void 0),o}has(n,t){const r=Reflect.has(n,t);return(!hr(t)||!np.has(t))&&At(n,"has",t),r}ownKeys(n){return At(n,"iterate",Re(n)?"length":io),Reflect.ownKeys(n)}}class cy extends rp{constructor(n=!1){super(!0,n)}set(n,t){return!0}deleteProperty(n,t){return!0}}const ly=new op,fy=new cy,hy=new op(!0);const Gu=e=>e,aa=e=>Reflect.getPrototypeOf(e);function dy(e,n,t){return function(...r){const o=this.__v_raw,i=We(o),a=Lo(i),s=e==="entries"||e===Symbol.iterator&&a,u=e==="keys"&&a,c=o[e](...r),l=t?Gu:n?Aa:Et;return!n&&At(i,"iterate",u?Hu:io),{next(){const{value:f,done:h}=c.next();return h?{value:f,done:h}:{value:s?[l(f[0]),l(f[1])]:l(f),done:h}},[Symbol.iterator](){return this}}}}function sa(e){return function(...n){return e==="delete"?!1:e==="clear"?void 0:this}}function py(e,n){const t={get(o){const i=this.__v_raw,a=We(i),s=We(o);e||(Tr(o,s)&&At(a,"get",o),At(a,"get",s));const{has:u}=aa(a),c=n?Gu:e?Aa:Et;if(u.call(a,o))return c(i.get(o));if(u.call(a,s))return c(i.get(s));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!e&&At(We(o),"iterate",io),o.size},has(o){const i=this.__v_raw,a=We(i),s=We(o);return e||(Tr(o,s)&&At(a,"has",o),At(a,"has",s)),o===s?i.has(o):i.has(o)||i.has(s)},forEach(o,i){const a=this,s=a.__v_raw,u=We(s),c=n?Gu:e?Aa:Et;return!e&&At(u,"iterate",io),s.forEach((l,f)=>o.call(i,c(l),c(f),a))}};return yt(t,e?{add:sa("add"),set:sa("set"),delete:sa("delete"),clear:sa("clear")}:{add(o){!n&&!vn(o)&&!Fr(o)&&(o=We(o));const i=We(this);return aa(i).has.call(i,o)||(i.add(o),ar(i,"add",o,o)),this},set(o,i){!n&&!vn(i)&&!Fr(i)&&(i=We(i));const a=We(this),{has:s,get:u}=aa(a);let c=s.call(a,o);c||(o=We(o),c=s.call(a,o));const l=u.call(a,o);return a.set(o,i),c?Tr(i,l)&&ar(a,"set",o,i):ar(a,"add",o,i),this},delete(o){const i=We(this),{has:a,get:s}=aa(i);let u=a.call(i,o);u||(o=We(o),u=a.call(i,o)),s&&s.call(i,o);const c=i.delete(o);return u&&ar(i,"delete",o,void 0),c},clear(){const o=We(this),i=o.size!==0,a=o.clear();return i&&ar(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=dy(o,e,n)}),t}function qc(e,n){const t=py(e,n);return(r,o,i)=>o==="__v_isReactive"?!e:o==="__v_isReadonly"?e:o==="__v_raw"?r:Reflect.get(Ue(t,o)&&o in r?t:r,o,i)}const vy={get:qc(!1,!1)},my={get:qc(!1,!0)},gy={get:qc(!0,!1)};const ip=new WeakMap,ap=new WeakMap,sp=new WeakMap,yy=new WeakMap;function by(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function xy(e){return e.__v_skip||!Object.isExtensible(e)?0:by(qg(e))}function $t(e){return Fr(e)?e:jc(e,!1,ly,vy,ip)}function up(e){return jc(e,!1,hy,my,ap)}function qu(e){return jc(e,!0,fy,gy,sp)}function jc(e,n,t,r,o){if(!je(e)||e.__v_raw&&!(n&&e.__v_isReactive))return e;const i=xy(e);if(i===0)return e;const a=o.get(e);if(a)return a;const s=new Proxy(e,i===2?r:t);return o.set(e,s),s}function Wo(e){return Fr(e)?Wo(e.__v_raw):!!(e&&e.__v_isReactive)}function Fr(e){return!!(e&&e.__v_isReadonly)}function vn(e){return!!(e&&e.__v_isShallow)}function Kc(e){return e?!!e.__v_raw:!1}function We(e){const n=e&&e.__v_raw;return n?We(n):e}function $c(e){return!Ue(e,"__v_skip")&&Object.isExtensible(e)&&Gd(e,"__v_skip",!0),e}const Et=e=>je(e)?$t(e):e,Aa=e=>je(e)?qu(e):e;function Wt(e){return e?e.__v_isRef===!0:!1}function Xe(e){return cp(e,!1)}function wy(e){return cp(e,!0)}function cp(e,n){return Wt(e)?e:new _y(e,n)}class _y{constructor(n,t){this.dep=new Gc,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?n:We(n),this._value=t?n:Et(n),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(n){const t=this._rawValue,r=this.__v_isShallow||vn(n)||Fr(n);n=r?n:We(n),Tr(n,t)&&(this._rawValue=n,this._value=r?n:Et(n),this.dep.trigger())}}function En(e){return Wt(e)?e.value:e}const Cy={get:(e,n,t)=>n==="__v_raw"?e:En(Reflect.get(e,n,t)),set:(e,n,t,r)=>{const o=e[n];return Wt(o)&&!Wt(t)?(o.value=t,!0):Reflect.set(e,n,t,r)}};function lp(e){return Wo(e)?e:new Proxy(e,Cy)}class Ey{constructor(n,t,r){this.fn=n,this.setter=t,this._value=void 0,this.dep=new Gc(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ti-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&qe!==this)return Yd(this,!0),!0}get value(){const n=this.dep.track();return Zd(this),n&&(n.version=this.dep.version),this._value}set value(n){this.setter&&this.setter(n)}}function Ry(e,n,t=!1){let r,o;return De(e)?r=e:(r=e.get,o=e.set),new Ey(r,o,t)}const ua={},Ta=new WeakMap;let Xr;function Sy(e,n=!1,t=Xr){if(t){let r=Ta.get(t);r||Ta.set(t,r=[]),r.push(e)}}function Iy(e,n,t=Ge){const{immediate:r,deep:o,once:i,scheduler:a,augmentJob:s,call:u}=t,c=y=>o?y:vn(y)||o===!1||o===0?sr(y,1):sr(y);let l,f,h,d,p=!1,v=!1;if(Wt(e)?(f=()=>e.value,p=vn(e)):Wo(e)?(f=()=>c(e),p=!0):Re(e)?(v=!0,p=e.some(y=>Wo(y)||vn(y)),f=()=>e.map(y=>{if(Wt(y))return y.value;if(Wo(y))return c(y);if(De(y))return u?u(y,2):y()})):De(e)?n?f=u?()=>u(e,2):e:f=()=>{if(h){cr();try{h()}finally{lr()}}const y=Xr;Xr=l;try{return u?u(e,3,[d]):e(d)}finally{Xr=y}}:f=Un,n&&o){const y=f,x=o===!0?1/0:o;f=()=>sr(y(),x)}const m=ny(),g=()=>{l.stop(),m&&m.active&&Bc(m.effects,l)};if(i&&n){const y=n;n=(...x)=>{y(...x),g()}}let b=v?new Array(e.length).fill(ua):ua;const w=y=>{if(!(!(l.flags&1)||!l.dirty&&!y))if(n){const x=l.run();if(o||p||(v?x.some((_,S)=>Tr(_,b[S])):Tr(x,b))){h&&h();const _=Xr;Xr=l;try{const S=[x,b===ua?void 0:v&&b[0]===ua?[]:b,d];b=x,u?u(n,3,S):n(...S)}finally{Xr=_}}}else l.run()};return s&&s(w),l=new $d(f),l.scheduler=a?()=>a(w,!1):w,d=y=>Sy(y,!1,l),h=l.onStop=()=>{const y=Ta.get(l);if(y){if(u)u(y,4);else for(const x of y)x();Ta.delete(l)}},n?r?w(!0):b=l.run():a?a(w.bind(null,!0),!0):l.run(),g.pause=l.pause.bind(l),g.resume=l.resume.bind(l),g.stop=g,g}function sr(e,n=1/0,t){if(n<=0||!je(e)||e.__v_skip||(t=t||new Map,(t.get(e)||0)>=n))return e;if(t.set(e,n),n--,Wt(e))sr(e.value,n,t);else if(Re(e))for(let r=0;r<e.length;r++)sr(e[r],n,t);else if(Vd(e)||Lo(e))e.forEach(r=>{sr(r,n,t)});else if(Hd(e)){for(const r in e)sr(e[r],n,t);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&sr(e[r],n,t)}return e}function Ki(e,n,t,r){try{return r?e(...r):e()}catch(o){ys(o,n,t)}}function Sn(e,n,t,r){if(De(e)){const o=Ki(e,n,t,r);return o&&zd(o)&&o.catch(i=>{ys(i,n,t)}),o}if(Re(e)){const o=[];for(let i=0;i<e.length;i++)o.push(Sn(e[i],n,t,r));return o}}function ys(e,n,t,r=!0){const o=n?n.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=n&&n.appContext.config||Ge;if(n){let s=n.parent;const u=n.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;s;){const l=s.ec;if(l){for(let f=0;f<l.length;f++)if(l[f](e,u,c)===!1)return}s=s.parent}if(i){cr(),Ki(i,null,10,[e,u,c]),lr();return}}ky(e,t,o,r,a)}function ky(e,n,t,r=!0,o=!1){if(o)throw e;console.error(e)}const Gt=[];let Mn=-1;const Vo=[];let Er=null,Ao=0;const fp=Promise.resolve();let Da=null;function so(e){const n=Da||fp;return e?n.then(this?e.bind(this):e):n}function Ay(e){let n=Mn+1,t=Gt.length;for(;n<t;){const r=n+t>>>1,o=Gt[r],i=Ni(o);i<e||i===e&&o.flags&2?n=r+1:t=r}return n}function Xc(e){if(!(e.flags&1)){const n=Ni(e),t=Gt[Gt.length-1];!t||!(e.flags&2)&&n>=Ni(t)?Gt.push(e):Gt.splice(Ay(n),0,e),e.flags|=1,hp()}}function hp(){Da||(Da=fp.then(pp))}function Ty(e){Re(e)?Vo.push(...e):Er&&e.id===-1?Er.splice(Ao+1,0,e):e.flags&1||(Vo.push(e),e.flags|=1),hp()}function gf(e,n,t=Mn+1){for(;t<Gt.length;t++){const r=Gt[t];if(r&&r.flags&2){if(e&&r.id!==e.uid)continue;Gt.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function dp(e){if(Vo.length){const n=[...new Set(Vo)].sort((t,r)=>Ni(t)-Ni(r));if(Vo.length=0,Er){Er.push(...n);return}for(Er=n,Ao=0;Ao<Er.length;Ao++){const t=Er[Ao];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Er=null,Ao=0}}const Ni=e=>e.id==null?e.flags&2?-1:1/0:e.id;function pp(e){try{for(Mn=0;Mn<Gt.length;Mn++){const n=Gt[Mn];n&&!(n.flags&8)&&(n.flags&4&&(n.flags&=-2),Ki(n,n.i,n.i?15:14),n.flags&4||(n.flags&=-2))}}finally{for(;Mn<Gt.length;Mn++){const n=Gt[Mn];n&&(n.flags&=-2)}Mn=-1,Gt.length=0,dp(),Da=null,(Gt.length||Vo.length)&&pp()}}let Rt=null,vp=null;function Na(e){const n=Rt;return Rt=e,vp=e&&e.type.__scopeId||null,n}function bn(e,n=Rt,t){if(!n||e._n)return e;const r=(...o)=>{r._d&&Oa(-1);const i=Na(n);let a;try{a=e(...o)}finally{Na(i),r._d&&Oa(1)}return a};return r._n=!0,r._c=!0,r._d=!0,r}function Pa(e,n){if(Rt===null)return e;const t=Cs(Rt),r=e.dirs||(e.dirs=[]);for(let o=0;o<n.length;o++){let[i,a,s,u=Ge]=n[o];i&&(De(i)&&(i={mounted:i,updated:i}),i.deep&&sr(a),r.push({dir:i,instance:t,value:a,oldValue:void 0,arg:s,modifiers:u}))}return e}function Ur(e,n,t,r){const o=e.dirs,i=n&&n.dirs;for(let a=0;a<o.length;a++){const s=o[a];i&&(s.oldValue=i[a].value);let u=s.dir[r];u&&(cr(),Sn(u,t,8,[e.el,s,e,n]),lr())}}const Dy=Symbol("_vte"),mp=e=>e.__isTeleport,ir=Symbol("_leaveCb"),ca=Symbol("_enterCb");function Ny(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Mr(()=>{e.isMounted=!0}),uo(()=>{e.isUnmounting=!0}),e}const cn=[Function,Array],gp={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:cn,onEnter:cn,onAfterEnter:cn,onEnterCancelled:cn,onBeforeLeave:cn,onLeave:cn,onAfterLeave:cn,onLeaveCancelled:cn,onBeforeAppear:cn,onAppear:cn,onAfterAppear:cn,onAppearCancelled:cn},yp=e=>{const n=e.subTree;return n.component?yp(n.component):n},Py={name:"BaseTransition",props:gp,setup(e,{slots:n}){const t=Kn(),r=Ny();return()=>{const o=n.default&&wp(n.default(),!0);if(!o||!o.length)return;const i=bp(o),a=We(e),{mode:s}=a;if(r.isLeaving)return $s(i);const u=yf(i);if(!u)return $s(i);let c=ju(u,a,r,t,f=>c=f);u.type!==Nt&&Pi(u,c);let l=t.subTree&&yf(t.subTree);if(l&&l.type!==Nt&&!Zr(l,u)&&yp(t).type!==Nt){let f=ju(l,a,r,t);if(Pi(l,f),s==="out-in"&&u.type!==Nt)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,l=void 0},$s(i);s==="in-out"&&u.type!==Nt?f.delayLeave=(h,d,p)=>{const v=xp(r,l);v[String(l.key)]=l,h[ir]=()=>{d(),h[ir]=void 0,delete c.delayedLeave,l=void 0},c.delayedLeave=()=>{p(),delete c.delayedLeave,l=void 0}}:l=void 0}else l&&(l=void 0);return i}}};function bp(e){let n=e[0];if(e.length>1){for(const t of e)if(t.type!==Nt){n=t;break}}return n}const Fy=Py;function xp(e,n){const{leavingVNodes:t}=e;let r=t.get(n.type);return r||(r=Object.create(null),t.set(n.type,r)),r}function ju(e,n,t,r,o){const{appear:i,mode:a,persisted:s=!1,onBeforeEnter:u,onEnter:c,onAfterEnter:l,onEnterCancelled:f,onBeforeLeave:h,onLeave:d,onAfterLeave:p,onLeaveCancelled:v,onBeforeAppear:m,onAppear:g,onAfterAppear:b,onAppearCancelled:w}=n,y=String(e.key),x=xp(t,e),_=(C,E)=>{C&&Sn(C,r,9,E)},S=(C,E)=>{const N=E[1];_(C,E),Re(C)?C.every(T=>T.length<=1)&&N():C.length<=1&&N()},I={mode:a,persisted:s,beforeEnter(C){let E=u;if(!t.isMounted)if(i)E=m||u;else return;C[ir]&&C[ir](!0);const N=x[y];N&&Zr(e,N)&&N.el[ir]&&N.el[ir](),_(E,[C])},enter(C){let E=c,N=l,T=f;if(!t.isMounted)if(i)E=g||c,N=b||l,T=w||f;else return;let B=!1;const F=C[ca]=L=>{B||(B=!0,L?_(T,[C]):_(N,[C]),I.delayedLeave&&I.delayedLeave(),C[ca]=void 0)};E?S(E,[C,F]):F()},leave(C,E){const N=String(e.key);if(C[ca]&&C[ca](!0),t.isUnmounting)return E();_(h,[C]);let T=!1;const B=C[ir]=F=>{T||(T=!0,E(),F?_(v,[C]):_(p,[C]),C[ir]=void 0,x[N]===e&&delete x[N])};x[N]=e,d?S(d,[C,B]):B()},clone(C){const E=ju(C,n,t,r,o);return o&&o(E),E}};return I}function $s(e){if(bs(e))return e=Or(e),e.children=null,e}function yf(e){if(!bs(e))return mp(e.type)&&e.children?bp(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:n,children:t}=e;if(t){if(n&16)return t[0];if(n&32&&De(t.default))return t.default()}}function Pi(e,n){e.shapeFlag&6&&e.component?(e.transition=n,Pi(e.component.subTree,n)):e.shapeFlag&128?(e.ssContent.transition=n.clone(e.ssContent),e.ssFallback.transition=n.clone(e.ssFallback)):e.transition=n}function wp(e,n=!1,t){let r=[],o=0;for(let i=0;i<e.length;i++){let a=e[i];const s=t==null?a.key:String(t)+String(a.key!=null?a.key:i);a.type===Tt?(a.patchFlag&128&&o++,r=r.concat(wp(a.children,n,s))):(n||a.type!==Nt)&&r.push(s!=null?Or(a,{key:s}):a)}if(o>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function Yc(e,n){return De(e)?yt({name:e.name},n,{setup:e}):e}function _p(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const Fa=new WeakMap;function _i(e,n,t,r,o=!1){if(Re(e)){e.forEach((p,v)=>_i(p,n&&(Re(n)?n[v]:n),t,r,o));return}if(zo(r)&&!o){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&_i(e,n,t,r.component.subTree);return}const i=r.shapeFlag&4?Cs(r.component):r.el,a=o?null:i,{i:s,r:u}=e,c=n&&n.r,l=s.refs===Ge?s.refs={}:s.refs,f=s.setupState,h=We(f),d=f===Ge?Wd:p=>Ue(h,p);if(c!=null&&c!==u){if(bf(n),ot(c))l[c]=null,d(c)&&(f[c]=null);else if(Wt(c)){c.value=null;const p=n;p.k&&(l[p.k]=null)}}if(De(u))Ki(u,s,12,[a,l]);else{const p=ot(u),v=Wt(u);if(p||v){const m=()=>{if(e.f){const g=p?d(u)?f[u]:l[u]:u.value;if(o)Re(g)&&Bc(g,i);else if(Re(g))g.includes(i)||g.push(i);else if(p)l[u]=[i],d(u)&&(f[u]=l[u]);else{const b=[i];u.value=b,e.k&&(l[e.k]=b)}}else p?(l[u]=a,d(u)&&(f[u]=a)):v&&(u.value=a,e.k&&(l[e.k]=a))};if(a){const g=()=>{m(),Fa.delete(e)};g.id=-1,Fa.set(e,g),Jt(g,t)}else bf(e),m()}}}function bf(e){const n=Fa.get(e);n&&(n.flags|=8,Fa.delete(e))}vs().requestIdleCallback;vs().cancelIdleCallback;const zo=e=>!!e.type.__asyncLoader,bs=e=>e.type.__isKeepAlive;function My(e,n){Cp(e,"a",n)}function Oy(e,n){Cp(e,"da",n)}function Cp(e,n,t=Pt){const r=e.__wdc||(e.__wdc=()=>{let o=t;for(;o;){if(o.isDeactivated)return;o=o.parent}return e()});if(xs(n,r,t),t){let o=t.parent;for(;o&&o.parent;)bs(o.parent.vnode)&&By(r,n,t,o),o=o.parent}}function By(e,n,t,r){const o=xs(n,e,r,!0);Qc(()=>{Bc(r[n],o)},t)}function xs(e,n,t=Pt,r=!1){if(t){const o=t[e]||(t[e]=[]),i=n.__weh||(n.__weh=(...a)=>{cr();const s=$i(t),u=Sn(n,t,e,a);return s(),lr(),u});return r?o.unshift(i):o.push(i),i}}const dr=e=>(n,t=Pt)=>{(!Bi||e==="sp")&&xs(e,(...r)=>n(...r),t)},Ly=dr("bm"),Mr=dr("m"),Wy=dr("bu"),Vy=dr("u"),uo=dr("bum"),Qc=dr("um"),zy=dr("sp"),Uy=dr("rtg"),Hy=dr("rtc");function Gy(e,n=Pt){xs("ec",e,n)}const qy="components";function jy(e,n){return $y(qy,e,!0,n)||e}const Ky=Symbol.for("v-ndc");function $y(e,n,t=!0,r=!1){const o=Rt||Pt;if(o){const i=o.type;{const s=O0(i,!1);if(s&&(s===n||s===gn(n)||s===ps(gn(n))))return i}const a=xf(o[e]||i[e],n)||xf(o.appContext[e],n);return!a&&r?i:a}}function xf(e,n){return e&&(e[n]||e[gn(n)]||e[ps(gn(n))])}function Ku(e,n,t,r){let o;const i=t,a=Re(e);if(a||ot(e)){const s=a&&Wo(e);let u=!1,c=!1;s&&(u=!vn(e),c=Fr(e),e=gs(e)),o=new Array(e.length);for(let l=0,f=e.length;l<f;l++)o[l]=n(u?c?Aa(Et(e[l])):Et(e[l]):e[l],l,void 0,i)}else if(typeof e=="number"){o=new Array(e);for(let s=0;s<e;s++)o[s]=n(s+1,s,void 0,i)}else if(je(e))if(e[Symbol.iterator])o=Array.from(e,(s,u)=>n(s,u,void 0,i));else{const s=Object.keys(e);o=new Array(s.length);for(let u=0,c=s.length;u<c;u++){const l=s[u];o[u]=n(e[l],l,u,i)}}else o=[];return o}function Xy(e,n,t={},r,o){if(Rt.ce||Rt.parent&&zo(Rt.parent)&&Rt.parent.ce){const c=Object.keys(t).length>0;return Ye(),Mi(Tt,null,[Qe("slot",t,r)],c?-2:64)}let i=e[n];i&&i._c&&(i._d=!1),Ye();const a=i&&Ep(i(t)),s=t.key||a&&a.key,u=Mi(Tt,{key:(s&&!hr(s)?s:`_${n}`)+(!a&&r?"_fb":"")},a||[],a&&e._===1?64:-2);return i&&i._c&&(i._d=!0),u}function Ep(e){return e.some(n=>Oi(n)?!(n.type===Nt||n.type===Tt&&!Ep(n.children)):!0)?e:null}const $u=e=>e?Gp(e)?Cs(e):$u(e.parent):null,Ci=yt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>$u(e.parent),$root:e=>$u(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Sp(e),$forceUpdate:e=>e.f||(e.f=()=>{Xc(e.update)}),$nextTick:e=>e.n||(e.n=so.bind(e.proxy)),$watch:e=>m0.bind(e)}),Xs=(e,n)=>e!==Ge&&!e.__isScriptSetup&&Ue(e,n),Yy={get({_:e},n){if(n==="__v_skip")return!0;const{ctx:t,setupState:r,data:o,props:i,accessCache:a,type:s,appContext:u}=e;let c;if(n[0]!=="$"){const d=a[n];if(d!==void 0)switch(d){case 1:return r[n];case 2:return o[n];case 4:return t[n];case 3:return i[n]}else{if(Xs(r,n))return a[n]=1,r[n];if(o!==Ge&&Ue(o,n))return a[n]=2,o[n];if((c=e.propsOptions[0])&&Ue(c,n))return a[n]=3,i[n];if(t!==Ge&&Ue(t,n))return a[n]=4,t[n];Xu&&(a[n]=0)}}const l=Ci[n];let f,h;if(l)return n==="$attrs"&&At(e.attrs,"get",""),l(e);if((f=s.__cssModules)&&(f=f[n]))return f;if(t!==Ge&&Ue(t,n))return a[n]=4,t[n];if(h=u.config.globalProperties,Ue(h,n))return h[n]},set({_:e},n,t){const{data:r,setupState:o,ctx:i}=e;return Xs(o,n)?(o[n]=t,!0):r!==Ge&&Ue(r,n)?(r[n]=t,!0):Ue(e.props,n)||n[0]==="$"&&n.slice(1)in e?!1:(i[n]=t,!0)},has({_:{data:e,setupState:n,accessCache:t,ctx:r,appContext:o,propsOptions:i,type:a}},s){let u,c;return!!(t[s]||e!==Ge&&s[0]!=="$"&&Ue(e,s)||Xs(n,s)||(u=i[0])&&Ue(u,s)||Ue(r,s)||Ue(Ci,s)||Ue(o.config.globalProperties,s)||(c=a.__cssModules)&&c[s])},defineProperty(e,n,t){return t.get!=null?e._.accessCache[n]=0:Ue(t,"value")&&this.set(e,n,t.value,null),Reflect.defineProperty(e,n,t)}};function wf(e){return Re(e)?e.reduce((n,t)=>(n[t]=null,n),{}):e}let Xu=!0;function Qy(e){const n=Sp(e),t=e.proxy,r=e.ctx;Xu=!1,n.beforeCreate&&_f(n.beforeCreate,e,"bc");const{data:o,computed:i,methods:a,watch:s,provide:u,inject:c,created:l,beforeMount:f,mounted:h,beforeUpdate:d,updated:p,activated:v,deactivated:m,beforeDestroy:g,beforeUnmount:b,destroyed:w,unmounted:y,render:x,renderTracked:_,renderTriggered:S,errorCaptured:I,serverPrefetch:C,expose:E,inheritAttrs:N,components:T,directives:B,filters:F}=n;if(c&&Jy(c,r,null),a)for(const U in a){const W=a[U];De(W)&&(r[U]=W.bind(t))}if(o){const U=o.call(t,t);je(U)&&(e.data=$t(U))}if(Xu=!0,i)for(const U in i){const W=i[U],X=De(W)?W.bind(t,t):De(W.get)?W.get.bind(t,t):Un,Q=!De(W)&&De(W.set)?W.set.bind(t):Un,oe=pe({get:X,set:Q});Object.defineProperty(r,U,{enumerable:!0,configurable:!0,get:()=>oe.value,set:ue=>oe.value=ue})}if(s)for(const U in s)Rp(s[U],r,t,U);if(u){const U=De(u)?u.call(t):u;Reflect.ownKeys(U).forEach(W=>{Ho(W,U[W])})}l&&_f(l,e,"c");function q(U,W){Re(W)?W.forEach(X=>U(X.bind(t))):W&&U(W.bind(t))}if(q(Ly,f),q(Mr,h),q(Wy,d),q(Vy,p),q(My,v),q(Oy,m),q(Gy,I),q(Hy,_),q(Uy,S),q(uo,b),q(Qc,y),q(zy,C),Re(E))if(E.length){const U=e.exposed||(e.exposed={});E.forEach(W=>{Object.defineProperty(U,W,{get:()=>t[W],set:X=>t[W]=X,enumerable:!0})})}else e.exposed||(e.exposed={});x&&e.render===Un&&(e.render=x),N!=null&&(e.inheritAttrs=N),T&&(e.components=T),B&&(e.directives=B),C&&_p(e)}function Jy(e,n,t=Un){Re(e)&&(e=Yu(e));for(const r in e){const o=e[r];let i;je(o)?"default"in o?i=mn(o.from||r,o.default,!0):i=mn(o.from||r):i=mn(o),Wt(i)?Object.defineProperty(n,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):n[r]=i}}function _f(e,n,t){Sn(Re(e)?e.map(r=>r.bind(n.proxy)):e.bind(n.proxy),n,t)}function Rp(e,n,t,r){let o=r.includes(".")?Wp(t,r):()=>t[r];if(ot(e)){const i=n[e];De(i)&&hn(o,i)}else if(De(e))hn(o,e.bind(t));else if(je(e))if(Re(e))e.forEach(i=>Rp(i,n,t,r));else{const i=De(e.handler)?e.handler.bind(t):n[e.handler];De(i)&&hn(o,i,e)}}function Sp(e){const n=e.type,{mixins:t,extends:r}=n,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=e.appContext,s=i.get(n);let u;return s?u=s:!o.length&&!t&&!r?u=n:(u={},o.length&&o.forEach(c=>Ma(u,c,a,!0)),Ma(u,n,a)),je(n)&&i.set(n,u),u}function Ma(e,n,t,r=!1){const{mixins:o,extends:i}=n;i&&Ma(e,i,t,!0),o&&o.forEach(a=>Ma(e,a,t,!0));for(const a in n)if(!(r&&a==="expose")){const s=Zy[a]||t&&t[a];e[a]=s?s(e[a],n[a]):n[a]}return e}const Zy={data:Cf,props:Ef,emits:Ef,methods:mi,computed:mi,beforeCreate:zt,created:zt,beforeMount:zt,mounted:zt,beforeUpdate:zt,updated:zt,beforeDestroy:zt,beforeUnmount:zt,destroyed:zt,unmounted:zt,activated:zt,deactivated:zt,errorCaptured:zt,serverPrefetch:zt,components:mi,directives:mi,watch:t0,provide:Cf,inject:e0};function Cf(e,n){return n?e?function(){return yt(De(e)?e.call(this,this):e,De(n)?n.call(this,this):n)}:n:e}function e0(e,n){return mi(Yu(e),Yu(n))}function Yu(e){if(Re(e)){const n={};for(let t=0;t<e.length;t++)n[e[t]]=e[t];return n}return e}function zt(e,n){return e?[...new Set([].concat(e,n))]:n}function mi(e,n){return e?yt(Object.create(null),e,n):n}function Ef(e,n){return e?Re(e)&&Re(n)?[...new Set([...e,...n])]:yt(Object.create(null),wf(e),wf(n??{})):n}function t0(e,n){if(!e)return n;if(!n)return e;const t=yt(Object.create(null),e);for(const r in n)t[r]=zt(e[r],n[r]);return t}function Ip(){return{app:null,config:{isNativeTag:Wd,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let n0=0;function r0(e,n){return function(r,o=null){De(r)||(r=yt({},r)),o!=null&&!je(o)&&(o=null);const i=Ip(),a=new WeakSet,s=[];let u=!1;const c=i.app={_uid:n0++,_component:r,_props:o,_container:null,_context:i,_instance:null,version:L0,get config(){return i.config},set config(l){},use(l,...f){return a.has(l)||(l&&De(l.install)?(a.add(l),l.install(c,...f)):De(l)&&(a.add(l),l(c,...f))),c},mixin(l){return i.mixins.includes(l)||i.mixins.push(l),c},component(l,f){return f?(i.components[l]=f,c):i.components[l]},directive(l,f){return f?(i.directives[l]=f,c):i.directives[l]},mount(l,f,h){if(!u){const d=c._ceVNode||Qe(r,o);return d.appContext=i,h===!0?h="svg":h===!1&&(h=void 0),e(d,l,h),u=!0,c._container=l,l.__vue_app__=c,Cs(d.component)}},onUnmount(l){s.push(l)},unmount(){u&&(Sn(s,c._instance,16),e(null,c._container),delete c._container.__vue_app__)},provide(l,f){return i.provides[l]=f,c},runWithContext(l){const f=Uo;Uo=c;try{return l()}finally{Uo=f}}};return c}}let Uo=null;function Ho(e,n){if(Pt){let t=Pt.provides;const r=Pt.parent&&Pt.parent.provides;r===t&&(t=Pt.provides=Object.create(r)),t[e]=n}}function mn(e,n,t=!1){const r=Kn();if(r||Uo){let o=Uo?Uo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return t&&De(n)?n.call(r&&r.proxy):n}}const kp={},Ap=()=>Object.create(kp),Tp=e=>Object.getPrototypeOf(e)===kp;function o0(e,n,t,r=!1){const o={},i=Ap();e.propsDefaults=Object.create(null),Dp(e,n,o,i);for(const a in e.propsOptions[0])a in o||(o[a]=void 0);t?e.props=r?o:up(o):e.type.props?e.props=o:e.props=i,e.attrs=i}function i0(e,n,t,r){const{props:o,attrs:i,vnode:{patchFlag:a}}=e,s=We(o),[u]=e.propsOptions;let c=!1;if((r||a>0)&&!(a&16)){if(a&8){const l=e.vnode.dynamicProps;for(let f=0;f<l.length;f++){let h=l[f];if(ws(e.emitsOptions,h))continue;const d=n[h];if(u)if(Ue(i,h))d!==i[h]&&(i[h]=d,c=!0);else{const p=gn(h);o[p]=Qu(u,s,p,d,e,!1)}else d!==i[h]&&(i[h]=d,c=!0)}}}else{Dp(e,n,o,i)&&(c=!0);let l;for(const f in s)(!n||!Ue(n,f)&&((l=ho(f))===f||!Ue(n,l)))&&(u?t&&(t[f]!==void 0||t[l]!==void 0)&&(o[f]=Qu(u,s,f,void 0,e,!0)):delete o[f]);if(i!==s)for(const f in i)(!n||!Ue(n,f))&&(delete i[f],c=!0)}c&&ar(e.attrs,"set","")}function Dp(e,n,t,r){const[o,i]=e.propsOptions;let a=!1,s;if(n)for(let u in n){if(bi(u))continue;const c=n[u];let l;o&&Ue(o,l=gn(u))?!i||!i.includes(l)?t[l]=c:(s||(s={}))[l]=c:ws(e.emitsOptions,u)||(!(u in r)||c!==r[u])&&(r[u]=c,a=!0)}if(i){const u=We(t),c=s||Ge;for(let l=0;l<i.length;l++){const f=i[l];t[f]=Qu(o,u,f,c[f],e,!Ue(c,f))}}return a}function Qu(e,n,t,r,o,i){const a=e[t];if(a!=null){const s=Ue(a,"default");if(s&&r===void 0){const u=a.default;if(a.type!==Function&&!a.skipFactory&&De(u)){const{propsDefaults:c}=o;if(t in c)r=c[t];else{const l=$i(o);r=c[t]=u.call(null,n),l()}}else r=u;o.ce&&o.ce._setProp(t,r)}a[0]&&(i&&!s?r=!1:a[1]&&(r===""||r===ho(t))&&(r=!0))}return r}const a0=new WeakMap;function Np(e,n,t=!1){const r=t?a0:n.propsCache,o=r.get(e);if(o)return o;const i=e.props,a={},s=[];let u=!1;if(!De(e)){const l=f=>{u=!0;const[h,d]=Np(f,n,!0);yt(a,h),d&&s.push(...d)};!t&&n.mixins.length&&n.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}if(!i&&!u)return je(e)&&r.set(e,Bo),Bo;if(Re(i))for(let l=0;l<i.length;l++){const f=gn(i[l]);Rf(f)&&(a[f]=Ge)}else if(i)for(const l in i){const f=gn(l);if(Rf(f)){const h=i[l],d=a[f]=Re(h)||De(h)?{type:h}:yt({},h),p=d.type;let v=!1,m=!0;if(Re(p))for(let g=0;g<p.length;++g){const b=p[g],w=De(b)&&b.name;if(w==="Boolean"){v=!0;break}else w==="String"&&(m=!1)}else v=De(p)&&p.name==="Boolean";d[0]=v,d[1]=m,(v||Ue(d,"default"))&&s.push(f)}}const c=[a,s];return je(e)&&r.set(e,c),c}function Rf(e){return e[0]!=="$"&&!bi(e)}const Jc=e=>e==="_"||e==="_ctx"||e==="$stable",Zc=e=>Re(e)?e.map(Bn):[Bn(e)],s0=(e,n,t)=>{if(n._n)return n;const r=bn((...o)=>Zc(n(...o)),t);return r._c=!1,r},Pp=(e,n,t)=>{const r=e._ctx;for(const o in e){if(Jc(o))continue;const i=e[o];if(De(i))n[o]=s0(o,i,r);else if(i!=null){const a=Zc(i);n[o]=()=>a}}},Fp=(e,n)=>{const t=Zc(n);e.slots.default=()=>t},Mp=(e,n,t)=>{for(const r in n)(t||!Jc(r))&&(e[r]=n[r])},u0=(e,n,t)=>{const r=e.slots=Ap();if(e.vnode.shapeFlag&32){const o=n._;o?(Mp(r,n,t),t&&Gd(r,"_",o,!0)):Pp(n,r)}else n&&Fp(e,n)},c0=(e,n,t)=>{const{vnode:r,slots:o}=e;let i=!0,a=Ge;if(r.shapeFlag&32){const s=n._;s?t&&s===1?i=!1:Mp(o,n,t):(i=!n.$stable,Pp(n,o)),a=n}else n&&(Fp(e,n),a={default:1});if(i)for(const s in o)!Jc(s)&&a[s]==null&&delete o[s]},Jt=E0;function l0(e){return f0(e)}function f0(e,n){const t=vs();t.__VUE__=!0;const{insert:r,remove:o,patchProp:i,createElement:a,createText:s,createComment:u,setText:c,setElementText:l,parentNode:f,nextSibling:h,setScopeId:d=Un,insertStaticContent:p}=e,v=(A,D,O,G=null,j=null,$=null,re=void 0,te=null,ne=!!D.dynamicChildren)=>{if(A===D)return;A&&!Zr(A,D)&&(G=z(A),ue(A,j,$,!0),A=null),D.patchFlag===-2&&(ne=!1,D.dynamicChildren=null);const{type:J,ref:xe,shapeFlag:ie}=D;switch(J){case _s:m(A,D,O,G);break;case Nt:g(A,D,O,G);break;case Qs:A==null&&b(D,O,G,re);break;case Tt:T(A,D,O,G,j,$,re,te,ne);break;default:ie&1?x(A,D,O,G,j,$,re,te,ne):ie&6?B(A,D,O,G,j,$,re,te,ne):(ie&64||ie&128)&&J.process(A,D,O,G,j,$,re,te,ne,se)}xe!=null&&j?_i(xe,A&&A.ref,$,D||A,!D):xe==null&&A&&A.ref!=null&&_i(A.ref,null,$,A,!0)},m=(A,D,O,G)=>{if(A==null)r(D.el=s(D.children),O,G);else{const j=D.el=A.el;D.children!==A.children&&c(j,D.children)}},g=(A,D,O,G)=>{A==null?r(D.el=u(D.children||""),O,G):D.el=A.el},b=(A,D,O,G)=>{[A.el,A.anchor]=p(A.children,D,O,G,A.el,A.anchor)},w=({el:A,anchor:D},O,G)=>{let j;for(;A&&A!==D;)j=h(A),r(A,O,G),A=j;r(D,O,G)},y=({el:A,anchor:D})=>{let O;for(;A&&A!==D;)O=h(A),o(A),A=O;o(D)},x=(A,D,O,G,j,$,re,te,ne)=>{if(D.type==="svg"?re="svg":D.type==="math"&&(re="mathml"),A==null)_(D,O,G,j,$,re,te,ne);else{const J=A.el&&A.el._isVueCE?A.el:null;try{J&&J._beginPatch(),C(A,D,j,$,re,te,ne)}finally{J&&J._endPatch()}}},_=(A,D,O,G,j,$,re,te)=>{let ne,J;const{props:xe,shapeFlag:ie,transition:we,dirs:_e}=A;if(ne=A.el=a(A.type,$,xe&&xe.is,xe),ie&8?l(ne,A.children):ie&16&&I(A.children,ne,null,G,j,Ys(A,$),re,te),_e&&Ur(A,null,G,"created"),S(ne,A,A.scopeId,re,G),xe){for(const Le in xe)Le!=="value"&&!bi(Le)&&i(ne,Le,null,xe[Le],$,G);"value"in xe&&i(ne,"value",null,xe.value,$),(J=xe.onVnodeBeforeMount)&&Nn(J,G,A)}_e&&Ur(A,null,G,"beforeMount");const Fe=h0(j,we);Fe&&we.beforeEnter(ne),r(ne,D,O),((J=xe&&xe.onVnodeMounted)||Fe||_e)&&Jt(()=>{J&&Nn(J,G,A),Fe&&we.enter(ne),_e&&Ur(A,null,G,"mounted")},j)},S=(A,D,O,G,j)=>{if(O&&d(A,O),G)for(let $=0;$<G.length;$++)d(A,G[$]);if(j){let $=j.subTree;if(D===$||zp($.type)&&($.ssContent===D||$.ssFallback===D)){const re=j.vnode;S(A,re,re.scopeId,re.slotScopeIds,j.parent)}}},I=(A,D,O,G,j,$,re,te,ne=0)=>{for(let J=ne;J<A.length;J++){const xe=A[J]=te?Rr(A[J]):Bn(A[J]);v(null,xe,D,O,G,j,$,re,te)}},C=(A,D,O,G,j,$,re)=>{const te=D.el=A.el;let{patchFlag:ne,dynamicChildren:J,dirs:xe}=D;ne|=A.patchFlag&16;const ie=A.props||Ge,we=D.props||Ge;let _e;if(O&&Hr(O,!1),(_e=we.onVnodeBeforeUpdate)&&Nn(_e,O,D,A),xe&&Ur(D,A,O,"beforeUpdate"),O&&Hr(O,!0),(ie.innerHTML&&we.innerHTML==null||ie.textContent&&we.textContent==null)&&l(te,""),J?E(A.dynamicChildren,J,te,O,G,Ys(D,j),$):re||W(A,D,te,null,O,G,Ys(D,j),$,!1),ne>0){if(ne&16)N(te,ie,we,O,j);else if(ne&2&&ie.class!==we.class&&i(te,"class",null,we.class,j),ne&4&&i(te,"style",ie.style,we.style,j),ne&8){const Fe=D.dynamicProps;for(let Le=0;Le<Fe.length;Le++){const Pe=Fe[Le],pt=ie[Pe],St=we[Pe];(St!==pt||Pe==="value")&&i(te,Pe,pt,St,j,O)}}ne&1&&A.children!==D.children&&l(te,D.children)}else!re&&J==null&&N(te,ie,we,O,j);((_e=we.onVnodeUpdated)||xe)&&Jt(()=>{_e&&Nn(_e,O,D,A),xe&&Ur(D,A,O,"updated")},G)},E=(A,D,O,G,j,$,re)=>{for(let te=0;te<D.length;te++){const ne=A[te],J=D[te],xe=ne.el&&(ne.type===Tt||!Zr(ne,J)||ne.shapeFlag&198)?f(ne.el):O;v(ne,J,xe,null,G,j,$,re,!0)}},N=(A,D,O,G,j)=>{if(D!==O){if(D!==Ge)for(const $ in D)!bi($)&&!($ in O)&&i(A,$,D[$],null,j,G);for(const $ in O){if(bi($))continue;const re=O[$],te=D[$];re!==te&&$!=="value"&&i(A,$,te,re,j,G)}"value"in O&&i(A,"value",D.value,O.value,j)}},T=(A,D,O,G,j,$,re,te,ne)=>{const J=D.el=A?A.el:s(""),xe=D.anchor=A?A.anchor:s("");let{patchFlag:ie,dynamicChildren:we,slotScopeIds:_e}=D;_e&&(te=te?te.concat(_e):_e),A==null?(r(J,O,G),r(xe,O,G),I(D.children||[],O,xe,j,$,re,te,ne)):ie>0&&ie&64&&we&&A.dynamicChildren?(E(A.dynamicChildren,we,O,j,$,re,te),(D.key!=null||j&&D===j.subTree)&&Op(A,D,!0)):W(A,D,O,xe,j,$,re,te,ne)},B=(A,D,O,G,j,$,re,te,ne)=>{D.slotScopeIds=te,A==null?D.shapeFlag&512?j.ctx.activate(D,O,G,re,ne):F(D,O,G,j,$,re,ne):L(A,D,ne)},F=(A,D,O,G,j,$,re)=>{const te=A.component=D0(A,G,j);if(bs(A)&&(te.ctx.renderer=se),N0(te,!1,re),te.asyncDep){if(j&&j.registerDep(te,q,re),!A.el){const ne=te.subTree=Qe(Nt);g(null,ne,D,O),A.placeholder=ne.el}}else q(te,A,D,O,j,$,re)},L=(A,D,O)=>{const G=D.component=A.component;if(_0(A,D,O))if(G.asyncDep&&!G.asyncResolved){U(G,D,O);return}else G.next=D,G.update();else D.el=A.el,G.vnode=D},q=(A,D,O,G,j,$,re)=>{const te=()=>{if(A.isMounted){let{next:ie,bu:we,u:_e,parent:Fe,vnode:Le}=A;{const un=Bp(A);if(un){ie&&(ie.el=Le.el,U(A,ie,re)),un.asyncDep.then(()=>{A.isUnmounted||te()});return}}let Pe=ie,pt;Hr(A,!1),ie?(ie.el=Le.el,U(A,ie,re)):ie=Le,we&&Ra(we),(pt=ie.props&&ie.props.onVnodeBeforeUpdate)&&Nn(pt,Fe,ie,Le),Hr(A,!0);const St=If(A),sn=A.subTree;A.subTree=St,v(sn,St,f(sn.el),z(sn),A,j,$),ie.el=St.el,Pe===null&&C0(A,St.el),_e&&Jt(_e,j),(pt=ie.props&&ie.props.onVnodeUpdated)&&Jt(()=>Nn(pt,Fe,ie,Le),j)}else{let ie;const{el:we,props:_e}=D,{bm:Fe,m:Le,parent:Pe,root:pt,type:St}=A,sn=zo(D);Hr(A,!1),Fe&&Ra(Fe),!sn&&(ie=_e&&_e.onVnodeBeforeMount)&&Nn(ie,Pe,D),Hr(A,!0);{pt.ce&&pt.ce._def.shadowRoot!==!1&&pt.ce._injectChildStyle(St);const un=A.subTree=If(A);v(null,un,O,G,A,j,$),D.el=un.el}if(Le&&Jt(Le,j),!sn&&(ie=_e&&_e.onVnodeMounted)){const un=D;Jt(()=>Nn(ie,Pe,un),j)}(D.shapeFlag&256||Pe&&zo(Pe.vnode)&&Pe.vnode.shapeFlag&256)&&A.a&&Jt(A.a,j),A.isMounted=!0,D=O=G=null}};A.scope.on();const ne=A.effect=new $d(te);A.scope.off();const J=A.update=ne.run.bind(ne),xe=A.job=ne.runIfDirty.bind(ne);xe.i=A,xe.id=A.uid,ne.scheduler=()=>Xc(xe),Hr(A,!0),J()},U=(A,D,O)=>{D.component=A;const G=A.vnode.props;A.vnode=D,A.next=null,i0(A,D.props,G,O),c0(A,D.children,O),cr(),gf(A),lr()},W=(A,D,O,G,j,$,re,te,ne=!1)=>{const J=A&&A.children,xe=A?A.shapeFlag:0,ie=D.children,{patchFlag:we,shapeFlag:_e}=D;if(we>0){if(we&128){Q(J,ie,O,G,j,$,re,te,ne);return}else if(we&256){X(J,ie,O,G,j,$,re,te,ne);return}}_e&8?(xe&16&&Ce(J,j,$),ie!==J&&l(O,ie)):xe&16?_e&16?Q(J,ie,O,G,j,$,re,te,ne):Ce(J,j,$,!0):(xe&8&&l(O,""),_e&16&&I(ie,O,G,j,$,re,te,ne))},X=(A,D,O,G,j,$,re,te,ne)=>{A=A||Bo,D=D||Bo;const J=A.length,xe=D.length,ie=Math.min(J,xe);let we;for(we=0;we<ie;we++){const _e=D[we]=ne?Rr(D[we]):Bn(D[we]);v(A[we],_e,O,null,j,$,re,te,ne)}J>xe?Ce(A,j,$,!0,!1,ie):I(D,O,G,j,$,re,te,ne,ie)},Q=(A,D,O,G,j,$,re,te,ne)=>{let J=0;const xe=D.length;let ie=A.length-1,we=xe-1;for(;J<=ie&&J<=we;){const _e=A[J],Fe=D[J]=ne?Rr(D[J]):Bn(D[J]);if(Zr(_e,Fe))v(_e,Fe,O,null,j,$,re,te,ne);else break;J++}for(;J<=ie&&J<=we;){const _e=A[ie],Fe=D[we]=ne?Rr(D[we]):Bn(D[we]);if(Zr(_e,Fe))v(_e,Fe,O,null,j,$,re,te,ne);else break;ie--,we--}if(J>ie){if(J<=we){const _e=we+1,Fe=_e<xe?D[_e].el:G;for(;J<=we;)v(null,D[J]=ne?Rr(D[J]):Bn(D[J]),O,Fe,j,$,re,te,ne),J++}}else if(J>we)for(;J<=ie;)ue(A[J],j,$,!0),J++;else{const _e=J,Fe=J,Le=new Map;for(J=Fe;J<=we;J++){const xt=D[J]=ne?Rr(D[J]):Bn(D[J]);xt.key!=null&&Le.set(xt.key,J)}let Pe,pt=0;const St=we-Fe+1;let sn=!1,un=0;const Jn=new Array(St);for(J=0;J<St;J++)Jn[J]=0;for(J=_e;J<=ie;J++){const xt=A[J];if(pt>=St){ue(xt,j,$,!0);continue}let Dn;if(xt.key!=null)Dn=Le.get(xt.key);else for(Pe=Fe;Pe<=we;Pe++)if(Jn[Pe-Fe]===0&&Zr(xt,D[Pe])){Dn=Pe;break}Dn===void 0?ue(xt,j,$,!0):(Jn[Dn-Fe]=J+1,Dn>=un?un=Dn:sn=!0,v(xt,D[Dn],O,null,j,$,re,te,ne),pt++)}const bo=sn?d0(Jn):Bo;for(Pe=bo.length-1,J=St-1;J>=0;J--){const xt=Fe+J,Dn=D[xt],hf=D[xt+1],df=xt+1<xe?hf.el||hf.placeholder:G;Jn[J]===0?v(null,Dn,O,df,j,$,re,te,ne):sn&&(Pe<0||J!==bo[Pe]?oe(Dn,O,df,2):Pe--)}}},oe=(A,D,O,G,j=null)=>{const{el:$,type:re,transition:te,children:ne,shapeFlag:J}=A;if(J&6){oe(A.component.subTree,D,O,G);return}if(J&128){A.suspense.move(D,O,G);return}if(J&64){re.move(A,D,O,se);return}if(re===Tt){r($,D,O);for(let ie=0;ie<ne.length;ie++)oe(ne[ie],D,O,G);r(A.anchor,D,O);return}if(re===Qs){w(A,D,O);return}if(G!==2&&J&1&&te)if(G===0)te.beforeEnter($),r($,D,O),Jt(()=>te.enter($),j);else{const{leave:ie,delayLeave:we,afterLeave:_e}=te,Fe=()=>{A.ctx.isUnmounted?o($):r($,D,O)},Le=()=>{$._isLeaving&&$[ir](!0),ie($,()=>{Fe(),_e&&_e()})};we?we($,Fe,Le):Le()}else r($,D,O)},ue=(A,D,O,G=!1,j=!1)=>{const{type:$,props:re,ref:te,children:ne,dynamicChildren:J,shapeFlag:xe,patchFlag:ie,dirs:we,cacheIndex:_e}=A;if(ie===-2&&(j=!1),te!=null&&(cr(),_i(te,null,O,A,!0),lr()),_e!=null&&(D.renderCache[_e]=void 0),xe&256){D.ctx.deactivate(A);return}const Fe=xe&1&&we,Le=!zo(A);let Pe;if(Le&&(Pe=re&&re.onVnodeBeforeUnmount)&&Nn(Pe,D,A),xe&6)Se(A.component,O,G);else{if(xe&128){A.suspense.unmount(O,G);return}Fe&&Ur(A,null,D,"beforeUnmount"),xe&64?A.type.remove(A,D,O,se,G):J&&!J.hasOnce&&($!==Tt||ie>0&&ie&64)?Ce(J,D,O,!1,!0):($===Tt&&ie&384||!j&&xe&16)&&Ce(ne,D,O),G&&me(A)}(Le&&(Pe=re&&re.onVnodeUnmounted)||Fe)&&Jt(()=>{Pe&&Nn(Pe,D,A),Fe&&Ur(A,null,D,"unmounted")},O)},me=A=>{const{type:D,el:O,anchor:G,transition:j}=A;if(D===Tt){ke(O,G);return}if(D===Qs){y(A);return}const $=()=>{o(O),j&&!j.persisted&&j.afterLeave&&j.afterLeave()};if(A.shapeFlag&1&&j&&!j.persisted){const{leave:re,delayLeave:te}=j,ne=()=>re(O,$);te?te(A.el,$,ne):ne()}else $()},ke=(A,D)=>{let O;for(;A!==D;)O=h(A),o(A),A=O;o(D)},Se=(A,D,O)=>{const{bum:G,scope:j,job:$,subTree:re,um:te,m:ne,a:J}=A;Sf(ne),Sf(J),G&&Ra(G),j.stop(),$&&($.flags|=8,ue(re,A,D,O)),te&&Jt(te,D),Jt(()=>{A.isUnmounted=!0},D)},Ce=(A,D,O,G=!1,j=!1,$=0)=>{for(let re=$;re<A.length;re++)ue(A[re],D,O,G,j)},z=A=>{if(A.shapeFlag&6)return z(A.component.subTree);if(A.shapeFlag&128)return A.suspense.next();const D=h(A.anchor||A.el),O=D&&D[Dy];return O?h(O):D};let ee=!1;const Z=(A,D,O)=>{A==null?D._vnode&&ue(D._vnode,null,null,!0):v(D._vnode||null,A,D,null,null,null,O),D._vnode=A,ee||(ee=!0,gf(),dp(),ee=!1)},se={p:v,um:ue,m:oe,r:me,mt:F,mc:I,pc:W,pbc:E,n:z,o:e};return{render:Z,hydrate:void 0,createApp:r0(Z)}}function Ys({type:e,props:n},t){return t==="svg"&&e==="foreignObject"||t==="mathml"&&e==="annotation-xml"&&n&&n.encoding&&n.encoding.includes("html")?void 0:t}function Hr({effect:e,job:n},t){t?(e.flags|=32,n.flags|=4):(e.flags&=-33,n.flags&=-5)}function h0(e,n){return(!e||e&&!e.pendingBranch)&&n&&!n.persisted}function Op(e,n,t=!1){const r=e.children,o=n.children;if(Re(r)&&Re(o))for(let i=0;i<r.length;i++){const a=r[i];let s=o[i];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=o[i]=Rr(o[i]),s.el=a.el),!t&&s.patchFlag!==-2&&Op(a,s)),s.type===_s&&s.patchFlag!==-1&&(s.el=a.el),s.type===Nt&&!s.el&&(s.el=a.el)}}function d0(e){const n=e.slice(),t=[0];let r,o,i,a,s;const u=e.length;for(r=0;r<u;r++){const c=e[r];if(c!==0){if(o=t[t.length-1],e[o]<c){n[r]=o,t.push(r);continue}for(i=0,a=t.length-1;i<a;)s=i+a>>1,e[t[s]]<c?i=s+1:a=s;c<e[t[i]]&&(i>0&&(n[r]=t[i-1]),t[i]=r)}}for(i=t.length,a=t[i-1];i-- >0;)t[i]=a,a=n[a];return t}function Bp(e){const n=e.subTree.component;if(n)return n.asyncDep&&!n.asyncResolved?n:Bp(n)}function Sf(e){if(e)for(let n=0;n<e.length;n++)e[n].flags|=8}const p0=Symbol.for("v-scx"),v0=()=>mn(p0);function hn(e,n,t){return Lp(e,n,t)}function Lp(e,n,t=Ge){const{immediate:r,deep:o,flush:i,once:a}=t,s=yt({},t),u=n&&r||!n&&i!=="post";let c;if(Bi){if(i==="sync"){const d=v0();c=d.__watcherHandles||(d.__watcherHandles=[])}else if(!u){const d=()=>{};return d.stop=Un,d.resume=Un,d.pause=Un,d}}const l=Pt;s.call=(d,p,v)=>Sn(d,l,p,v);let f=!1;i==="post"?s.scheduler=d=>{Jt(d,l&&l.suspense)}:i!=="sync"&&(f=!0,s.scheduler=(d,p)=>{p?d():Xc(d)}),s.augmentJob=d=>{n&&(d.flags|=4),f&&(d.flags|=2,l&&(d.id=l.uid,d.i=l))};const h=Iy(e,n,s);return Bi&&(c?c.push(h):u&&h()),h}function m0(e,n,t){const r=this.proxy,o=ot(e)?e.includes(".")?Wp(r,e):()=>r[e]:e.bind(r,r);let i;De(n)?i=n:(i=n.handler,t=n);const a=$i(this),s=Lp(o,i.bind(r),t);return a(),s}function Wp(e,n){const t=n.split(".");return()=>{let r=e;for(let o=0;o<t.length&&r;o++)r=r[t[o]];return r}}const g0=(e,n)=>n==="modelValue"||n==="model-value"?e.modelModifiers:e[`${n}Modifiers`]||e[`${gn(n)}Modifiers`]||e[`${ho(n)}Modifiers`];function y0(e,n,...t){if(e.isUnmounted)return;const r=e.vnode.props||Ge;let o=t;const i=n.startsWith("update:"),a=i&&g0(r,n.slice(7));a&&(a.trim&&(o=t.map(l=>ot(l)?l.trim():l)),a.number&&(o=t.map(Wc)));let s,u=r[s=Hs(n)]||r[s=Hs(gn(n))];!u&&i&&(u=r[s=Hs(ho(n))]),u&&Sn(u,e,6,o);const c=r[s+"Once"];if(c){if(!e.emitted)e.emitted={};else if(e.emitted[s])return;e.emitted[s]=!0,Sn(c,e,6,o)}}const b0=new WeakMap;function Vp(e,n,t=!1){const r=t?b0:n.emitsCache,o=r.get(e);if(o!==void 0)return o;const i=e.emits;let a={},s=!1;if(!De(e)){const u=c=>{const l=Vp(c,n,!0);l&&(s=!0,yt(a,l))};!t&&n.mixins.length&&n.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}return!i&&!s?(je(e)&&r.set(e,null),null):(Re(i)?i.forEach(u=>a[u]=null):yt(a,i),je(e)&&r.set(e,a),a)}function ws(e,n){return!e||!fs(n)?!1:(n=n.slice(2).replace(/Once$/,""),Ue(e,n[0].toLowerCase()+n.slice(1))||Ue(e,ho(n))||Ue(e,n))}function If(e){const{type:n,vnode:t,proxy:r,withProxy:o,propsOptions:[i],slots:a,attrs:s,emit:u,render:c,renderCache:l,props:f,data:h,setupState:d,ctx:p,inheritAttrs:v}=e,m=Na(e);let g,b;try{if(t.shapeFlag&4){const y=o||r,x=y;g=Bn(c.call(x,y,l,f,d,h,p)),b=s}else{const y=n;g=Bn(y.length>1?y(f,{attrs:s,slots:a,emit:u}):y(f,null)),b=n.props?s:x0(s)}}catch(y){Ei.length=0,ys(y,e,1),g=Qe(Nt)}let w=g;if(b&&v!==!1){const y=Object.keys(b),{shapeFlag:x}=w;y.length&&x&7&&(i&&y.some(Oc)&&(b=w0(b,i)),w=Or(w,b,!1,!0))}return t.dirs&&(w=Or(w,null,!1,!0),w.dirs=w.dirs?w.dirs.concat(t.dirs):t.dirs),t.transition&&Pi(w,t.transition),g=w,Na(m),g}const x0=e=>{let n;for(const t in e)(t==="class"||t==="style"||fs(t))&&((n||(n={}))[t]=e[t]);return n},w0=(e,n)=>{const t={};for(const r in e)(!Oc(r)||!(r.slice(9)in n))&&(t[r]=e[r]);return t};function _0(e,n,t){const{props:r,children:o,component:i}=e,{props:a,children:s,patchFlag:u}=n,c=i.emitsOptions;if(n.dirs||n.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return r?kf(r,a,c):!!a;if(u&8){const l=n.dynamicProps;for(let f=0;f<l.length;f++){const h=l[f];if(a[h]!==r[h]&&!ws(c,h))return!0}}}else return(o||s)&&(!s||!s.$stable)?!0:r===a?!1:r?a?kf(r,a,c):!0:!!a;return!1}function kf(e,n,t){const r=Object.keys(n);if(r.length!==Object.keys(e).length)return!0;for(let o=0;o<r.length;o++){const i=r[o];if(n[i]!==e[i]&&!ws(t,i))return!0}return!1}function C0({vnode:e,parent:n},t){for(;n;){const r=n.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r===e)(e=n.vnode).el=t,n=n.parent;else break}}const zp=e=>e.__isSuspense;function E0(e,n){n&&n.pendingBranch?Re(e)?n.effects.push(...e):n.effects.push(e):Ty(e)}const Tt=Symbol.for("v-fgt"),_s=Symbol.for("v-txt"),Nt=Symbol.for("v-cmt"),Qs=Symbol.for("v-stc"),Ei=[];let tn=null;function Ye(e=!1){Ei.push(tn=e?null:[])}function R0(){Ei.pop(),tn=Ei[Ei.length-1]||null}let Fi=1;function Oa(e,n=!1){Fi+=e,e<0&&tn&&n&&(tn.hasOnce=!0)}function Up(e){return e.dynamicChildren=Fi>0?tn||Bo:null,R0(),Fi>0&&tn&&tn.push(e),e}function ut(e,n,t,r,o,i){return Up(fe(e,n,t,r,o,i,!0))}function Mi(e,n,t,r,o){return Up(Qe(e,n,t,r,o,!0))}function Oi(e){return e?e.__v_isVNode===!0:!1}function Zr(e,n){return e.type===n.type&&e.key===n.key}const Hp=({key:e})=>e??null,Sa=({ref:e,ref_key:n,ref_for:t})=>(typeof e=="number"&&(e=""+e),e!=null?ot(e)||Wt(e)||De(e)?{i:Rt,r:e,k:n,f:!!t}:e:null);function fe(e,n=null,t=null,r=0,o=null,i=e===Tt?0:1,a=!1,s=!1){const u={__v_isVNode:!0,__v_skip:!0,type:e,props:n,key:n&&Hp(n),ref:n&&Sa(n),scopeId:vp,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Rt};return s?(el(u,t),i&128&&e.normalize(u)):t&&(u.shapeFlag|=ot(t)?8:16),Fi>0&&!a&&tn&&(u.patchFlag>0||i&6)&&u.patchFlag!==32&&tn.push(u),u}const Qe=S0;function S0(e,n=null,t=null,r=0,o=null,i=!1){if((!e||e===Ky)&&(e=Nt),Oi(e)){const s=Or(e,n,!0);return t&&el(s,t),Fi>0&&!i&&tn&&(s.shapeFlag&6?tn[tn.indexOf(e)]=s:tn.push(s)),s.patchFlag=-2,s}if(B0(e)&&(e=e.__vccOpts),n){n=I0(n);let{class:s,style:u}=n;s&&!ot(s)&&(n.class=ms(s)),je(u)&&(Kc(u)&&!Re(u)&&(u=yt({},u)),n.style=Vc(u))}const a=ot(e)?1:zp(e)?128:mp(e)?64:je(e)?4:De(e)?2:0;return fe(e,n,t,r,o,a,i,!0)}function I0(e){return e?Kc(e)||Tp(e)?yt({},e):e:null}function Or(e,n,t=!1,r=!1){const{props:o,ref:i,patchFlag:a,children:s,transition:u}=e,c=n?k0(o||{},n):o,l={__v_isVNode:!0,__v_skip:!0,type:e.type,props:c,key:c&&Hp(c),ref:n&&n.ref?t&&i?Re(i)?i.concat(Sa(n)):[i,Sa(n)]:Sa(n):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:s,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:n&&e.type!==Tt?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:u,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Or(e.ssContent),ssFallback:e.ssFallback&&Or(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return u&&r&&Pi(l,u.clone(l)),l}function Go(e=" ",n=0){return Qe(_s,null,e,n)}function Ri(e="",n=!1){return n?(Ye(),Mi(Nt,null,e)):Qe(Nt,null,e)}function Bn(e){return e==null||typeof e=="boolean"?Qe(Nt):Re(e)?Qe(Tt,null,e.slice()):Oi(e)?Rr(e):Qe(_s,null,String(e))}function Rr(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Or(e)}function el(e,n){let t=0;const{shapeFlag:r}=e;if(n==null)n=null;else if(Re(n))t=16;else if(typeof n=="object")if(r&65){const o=n.default;o&&(o._c&&(o._d=!1),el(e,o()),o._c&&(o._d=!0));return}else{t=32;const o=n._;!o&&!Tp(n)?n._ctx=Rt:o===3&&Rt&&(Rt.slots._===1?n._=1:(n._=2,e.patchFlag|=1024))}else De(n)?(n={default:n,_ctx:Rt},t=32):(n=String(n),r&64?(t=16,n=[Go(n)]):t=8);e.children=n,e.shapeFlag|=t}function k0(...e){const n={};for(let t=0;t<e.length;t++){const r=e[t];for(const o in r)if(o==="class")n.class!==r.class&&(n.class=ms([n.class,r.class]));else if(o==="style")n.style=Vc([n.style,r.style]);else if(fs(o)){const i=n[o],a=r[o];a&&i!==a&&!(Re(i)&&i.includes(a))&&(n[o]=i?[].concat(i,a):a)}else o!==""&&(n[o]=r[o])}return n}function Nn(e,n,t,r=null){Sn(e,n,7,[t,r])}const A0=Ip();let T0=0;function D0(e,n,t){const r=e.type,o=(n?n.appContext:e.appContext)||A0,i={uid:T0++,vnode:e,type:r,parent:n,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new ty(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(o.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Np(r,o),emitsOptions:Vp(r,o),emit:null,emitted:null,propsDefaults:Ge,inheritAttrs:r.inheritAttrs,ctx:Ge,data:Ge,props:Ge,attrs:Ge,slots:Ge,refs:Ge,setupState:Ge,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=n?n.root:i,i.emit=y0.bind(null,i),e.ce&&e.ce(i),i}let Pt=null;const Kn=()=>Pt||Rt;let Ba,Ju;{const e=vs(),n=(t,r)=>{let o;return(o=e[t])||(o=e[t]=[]),o.push(r),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};Ba=n("__VUE_INSTANCE_SETTERS__",t=>Pt=t),Ju=n("__VUE_SSR_SETTERS__",t=>Bi=t)}const $i=e=>{const n=Pt;return Ba(e),e.scope.on(),()=>{e.scope.off(),Ba(n)}},Af=()=>{Pt&&Pt.scope.off(),Ba(null)};function Gp(e){return e.vnode.shapeFlag&4}let Bi=!1;function N0(e,n=!1,t=!1){n&&Ju(n);const{props:r,children:o}=e.vnode,i=Gp(e);o0(e,r,i,n),u0(e,o,t||n);const a=i?P0(e,n):void 0;return n&&Ju(!1),a}function P0(e,n){const t=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Yy);const{setup:r}=t;if(r){cr();const o=e.setupContext=r.length>1?M0(e):null,i=$i(e),a=Ki(r,e,0,[e.props,o]),s=zd(a);if(lr(),i(),(s||e.sp)&&!zo(e)&&_p(e),s){if(a.then(Af,Af),n)return a.then(u=>{Tf(e,u)}).catch(u=>{ys(u,e,0)});e.asyncDep=a}else Tf(e,a)}else qp(e)}function Tf(e,n,t){De(n)?e.type.__ssrInlineRender?e.ssrRender=n:e.render=n:je(n)&&(e.setupState=lp(n)),qp(e)}function qp(e,n,t){const r=e.type;e.render||(e.render=r.render||Un);{const o=$i(e);cr();try{Qy(e)}finally{lr(),o()}}}const F0={get(e,n){return At(e,"get",""),e[n]}};function M0(e){const n=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,F0),slots:e.slots,emit:e.emit,expose:n}}function Cs(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(lp($c(e.exposed)),{get(n,t){if(t in n)return n[t];if(t in Ci)return Ci[t](e)},has(n,t){return t in n||t in Ci}})):e.proxy}function O0(e,n=!0){return De(e)?e.displayName||e.name:e.name||n&&e.__name}function B0(e){return De(e)&&"__vccOpts"in e}const pe=(e,n)=>Ry(e,n,Bi);function Ee(e,n,t){try{Oa(-1);const r=arguments.length;return r===2?je(n)&&!Re(n)?Oi(n)?Qe(e,null,[n]):Qe(e,n):Qe(e,null,n):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Oi(t)&&(t=[t]),Qe(e,n,t))}finally{Oa(1)}}const L0="3.5.24";let Zu;const Df=typeof window<"u"&&window.trustedTypes;if(Df)try{Zu=Df.createPolicy("vue",{createHTML:e=>e})}catch{}const jp=Zu?e=>Zu.createHTML(e):e=>e,W0="http://www.w3.org/2000/svg",V0="http://www.w3.org/1998/Math/MathML",or=typeof document<"u"?document:null,Nf=or&&or.createElement("template"),z0={insert:(e,n,t)=>{n.insertBefore(e,t||null)},remove:e=>{const n=e.parentNode;n&&n.removeChild(e)},createElement:(e,n,t,r)=>{const o=n==="svg"?or.createElementNS(W0,e):n==="mathml"?or.createElementNS(V0,e):t?or.createElement(e,{is:t}):or.createElement(e);return e==="select"&&r&&r.multiple!=null&&o.setAttribute("multiple",r.multiple),o},createText:e=>or.createTextNode(e),createComment:e=>or.createComment(e),setText:(e,n)=>{e.nodeValue=n},setElementText:(e,n)=>{e.textContent=n},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>or.querySelector(e),setScopeId(e,n){e.setAttribute(n,"")},insertStaticContent(e,n,t,r,o,i){const a=t?t.previousSibling:n.lastChild;if(o&&(o===i||o.nextSibling))for(;n.insertBefore(o.cloneNode(!0),t),!(o===i||!(o=o.nextSibling)););else{Nf.innerHTML=jp(r==="svg"?`<svg>${e}</svg>`:r==="mathml"?`<math>${e}</math>`:e);const s=Nf.content;if(r==="svg"||r==="mathml"){const u=s.firstChild;for(;u.firstChild;)s.appendChild(u.firstChild);s.removeChild(u)}n.insertBefore(s,t)}return[a?a.nextSibling:n.firstChild,t?t.previousSibling:n.lastChild]}},xr="transition",ci="animation",Li=Symbol("_vtc"),Kp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},U0=yt({},gp,Kp),H0=e=>(e.displayName="Transition",e.props=U0,e),$p=H0((e,{slots:n})=>Ee(Fy,G0(e),n)),Gr=(e,n=[])=>{Re(e)?e.forEach(t=>t(...n)):e&&e(...n)},Pf=e=>e?Re(e)?e.some(n=>n.length>1):e.length>1:!1;function G0(e){const n={};for(const T in e)T in Kp||(n[T]=e[T]);if(e.css===!1)return n;const{name:t="v",type:r,duration:o,enterFromClass:i=`${t}-enter-from`,enterActiveClass:a=`${t}-enter-active`,enterToClass:s=`${t}-enter-to`,appearFromClass:u=i,appearActiveClass:c=a,appearToClass:l=s,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:h=`${t}-leave-active`,leaveToClass:d=`${t}-leave-to`}=e,p=q0(o),v=p&&p[0],m=p&&p[1],{onBeforeEnter:g,onEnter:b,onEnterCancelled:w,onLeave:y,onLeaveCancelled:x,onBeforeAppear:_=g,onAppear:S=b,onAppearCancelled:I=w}=n,C=(T,B,F,L)=>{T._enterCancelled=L,qr(T,B?l:s),qr(T,B?c:a),F&&F()},E=(T,B)=>{T._isLeaving=!1,qr(T,f),qr(T,d),qr(T,h),B&&B()},N=T=>(B,F)=>{const L=T?S:b,q=()=>C(B,T,F);Gr(L,[B,q]),Ff(()=>{qr(B,T?u:i),er(B,T?l:s),Pf(L)||Mf(B,r,v,q)})};return yt(n,{onBeforeEnter(T){Gr(g,[T]),er(T,i),er(T,a)},onBeforeAppear(T){Gr(_,[T]),er(T,u),er(T,c)},onEnter:N(!1),onAppear:N(!0),onLeave(T,B){T._isLeaving=!0;const F=()=>E(T,B);er(T,f),T._enterCancelled?(er(T,h),Lf(T)):(Lf(T),er(T,h)),Ff(()=>{T._isLeaving&&(qr(T,f),er(T,d),Pf(y)||Mf(T,r,m,F))}),Gr(y,[T,F])},onEnterCancelled(T){C(T,!1,void 0,!0),Gr(w,[T])},onAppearCancelled(T){C(T,!0,void 0,!0),Gr(I,[T])},onLeaveCancelled(T){E(T),Gr(x,[T])}})}function q0(e){if(e==null)return null;if(je(e))return[Js(e.enter),Js(e.leave)];{const n=Js(e);return[n,n]}}function Js(e){return $g(e)}function er(e,n){n.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[Li]||(e[Li]=new Set)).add(n)}function qr(e,n){n.split(/\s+/).forEach(r=>r&&e.classList.remove(r));const t=e[Li];t&&(t.delete(n),t.size||(e[Li]=void 0))}function Ff(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let j0=0;function Mf(e,n,t,r){const o=e._endId=++j0,i=()=>{o===e._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:a,timeout:s,propCount:u}=K0(e,n);if(!a)return r();const c=a+"end";let l=0;const f=()=>{e.removeEventListener(c,h),i()},h=d=>{d.target===e&&++l>=u&&f()};setTimeout(()=>{l<u&&f()},s+1),e.addEventListener(c,h)}function K0(e,n){const t=window.getComputedStyle(e),r=p=>(t[p]||"").split(", "),o=r(`${xr}Delay`),i=r(`${xr}Duration`),a=Of(o,i),s=r(`${ci}Delay`),u=r(`${ci}Duration`),c=Of(s,u);let l=null,f=0,h=0;n===xr?a>0&&(l=xr,f=a,h=i.length):n===ci?c>0&&(l=ci,f=c,h=u.length):(f=Math.max(a,c),l=f>0?a>c?xr:ci:null,h=l?l===xr?i.length:u.length:0);const d=l===xr&&/\b(?:transform|all)(?:,|$)/.test(r(`${xr}Property`).toString());return{type:l,timeout:f,propCount:h,hasTransform:d}}function Of(e,n){for(;e.length<n.length;)e=e.concat(e);return Math.max(...n.map((t,r)=>Bf(t)+Bf(e[r])))}function Bf(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function Lf(e){return(e?e.ownerDocument:document).body.offsetHeight}function $0(e,n,t){const r=e[Li];r&&(n=(n?[n,...r]:[...r]).join(" ")),n==null?e.removeAttribute("class"):t?e.setAttribute("class",n):e.className=n}const Wf=Symbol("_vod"),X0=Symbol("_vsh"),Y0=Symbol(""),Q0=/(?:^|;)\s*display\s*:/;function J0(e,n,t){const r=e.style,o=ot(t);let i=!1;if(t&&!o){if(n)if(ot(n))for(const a of n.split(";")){const s=a.slice(0,a.indexOf(":")).trim();t[s]==null&&Ia(r,s,"")}else for(const a in n)t[a]==null&&Ia(r,a,"");for(const a in t)a==="display"&&(i=!0),Ia(r,a,t[a])}else if(o){if(n!==t){const a=r[Y0];a&&(t+=";"+a),r.cssText=t,i=Q0.test(t)}}else n&&e.removeAttribute("style");Wf in e&&(e[Wf]=i?r.display:"",e[X0]&&(r.display="none"))}const Vf=/\s*!important$/;function Ia(e,n,t){if(Re(t))t.forEach(r=>Ia(e,n,r));else if(t==null&&(t=""),n.startsWith("--"))e.setProperty(n,t);else{const r=Z0(e,n);Vf.test(t)?e.setProperty(ho(r),t.replace(Vf,""),"important"):e[r]=t}}const zf=["Webkit","Moz","ms"],Zs={};function Z0(e,n){const t=Zs[n];if(t)return t;let r=gn(n);if(r!=="filter"&&r in e)return Zs[n]=r;r=ps(r);for(let o=0;o<zf.length;o++){const i=zf[o]+r;if(i in e)return Zs[n]=i}return n}const Uf="http://www.w3.org/1999/xlink";function Hf(e,n,t,r,o,i=ey(n)){r&&n.startsWith("xlink:")?t==null?e.removeAttributeNS(Uf,n.slice(6,n.length)):e.setAttributeNS(Uf,n,t):t==null||i&&!qd(t)?e.removeAttribute(n):e.setAttribute(n,i?"":hr(t)?String(t):t)}function Gf(e,n,t,r,o){if(n==="innerHTML"||n==="textContent"){t!=null&&(e[n]=n==="innerHTML"?jp(t):t);return}const i=e.tagName;if(n==="value"&&i!=="PROGRESS"&&!i.includes("-")){const s=i==="OPTION"?e.getAttribute("value")||"":e.value,u=t==null?e.type==="checkbox"?"on":"":String(t);(s!==u||!("_value"in e))&&(e.value=u),t==null&&e.removeAttribute(n),e._value=t;return}let a=!1;if(t===""||t==null){const s=typeof e[n];s==="boolean"?t=qd(t):t==null&&s==="string"?(t="",a=!0):s==="number"&&(t=0,a=!0)}try{e[n]=t}catch{}a&&e.removeAttribute(o||n)}function To(e,n,t,r){e.addEventListener(n,t,r)}function eb(e,n,t,r){e.removeEventListener(n,t,r)}const qf=Symbol("_vei");function tb(e,n,t,r,o=null){const i=e[qf]||(e[qf]={}),a=i[n];if(r&&a)a.value=r;else{const[s,u]=nb(n);if(r){const c=i[n]=ib(r,o);To(e,s,c,u)}else a&&(eb(e,s,a,u),i[n]=void 0)}}const jf=/(?:Once|Passive|Capture)$/;function nb(e){let n;if(jf.test(e)){n={};let r;for(;r=e.match(jf);)e=e.slice(0,e.length-r[0].length),n[r[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):ho(e.slice(2)),n]}let eu=0;const rb=Promise.resolve(),ob=()=>eu||(rb.then(()=>eu=0),eu=Date.now());function ib(e,n){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Sn(ab(r,t.value),n,5,[r])};return t.value=e,t.attached=ob(),t}function ab(e,n){if(Re(n)){const t=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{t.call(e),e._stopped=!0},n.map(r=>o=>!o._stopped&&r&&r(o))}else return n}const Kf=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,sb=(e,n,t,r,o,i)=>{const a=o==="svg";n==="class"?$0(e,r,a):n==="style"?J0(e,t,r):fs(n)?Oc(n)||tb(e,n,t,r,i):(n[0]==="."?(n=n.slice(1),!0):n[0]==="^"?(n=n.slice(1),!1):ub(e,n,r,a))?(Gf(e,n,r),!e.tagName.includes("-")&&(n==="value"||n==="checked"||n==="selected")&&Hf(e,n,r,a,i,n!=="value")):e._isVueCE&&(/[A-Z]/.test(n)||!ot(r))?Gf(e,gn(n),r,i,n):(n==="true-value"?e._trueValue=r:n==="false-value"&&(e._falseValue=r),Hf(e,n,r,a))};function ub(e,n,t,r){if(r)return!!(n==="innerHTML"||n==="textContent"||n in e&&Kf(n)&&De(t));if(n==="spellcheck"||n==="draggable"||n==="translate"||n==="autocorrect"||n==="sandbox"&&e.tagName==="IFRAME"||n==="form"||n==="list"&&e.tagName==="INPUT"||n==="type"&&e.tagName==="TEXTAREA")return!1;if(n==="width"||n==="height"){const o=e.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return Kf(n)&&ot(t)?!1:n in e}const $f=e=>{const n=e.props["onUpdate:modelValue"]||!1;return Re(n)?t=>Ra(n,t):n};function cb(e){e.target.composing=!0}function Xf(e){const n=e.target;n.composing&&(n.composing=!1,n.dispatchEvent(new Event("input")))}const tu=Symbol("_assign");function Yf(e,n,t){return n&&(e=e.trim()),t&&(e=Wc(e)),e}const ec={created(e,{modifiers:{lazy:n,trim:t,number:r}},o){e[tu]=$f(o);const i=r||o.props&&o.props.type==="number";To(e,n?"change":"input",a=>{a.target.composing||e[tu](Yf(e.value,t,i))}),(t||i)&&To(e,"change",()=>{e.value=Yf(e.value,t,i)}),n||(To(e,"compositionstart",cb),To(e,"compositionend",Xf),To(e,"change",Xf))},mounted(e,{value:n}){e.value=n??""},beforeUpdate(e,{value:n,oldValue:t,modifiers:{lazy:r,trim:o,number:i}},a){if(e[tu]=$f(a),e.composing)return;const s=(i||e.type==="number")&&!/^0\d/.test(e.value)?Wc(e.value):e.value,u=n??"";s!==u&&(document.activeElement===e&&e.type!=="range"&&(r&&n===t||o&&e.value.trim()===u)||(e.value=u))}},lb=yt({patchProp:sb},z0);let Qf;function fb(){return Qf||(Qf=l0(lb))}const Xp=((...e)=>{const n=fb().createApp(...e),{mount:t}=n;return n.mount=r=>{const o=db(r);if(!o)return;const i=n._component;!De(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=t(o,!1,hb(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},n});function hb(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function db(e){return ot(e)?document.querySelector(e):e}const tl=(e,n)=>{const t=e.__vccOpts||e;for(const[r,o]of n)t[r]=o;return t},pb={};function vb(e,n){const t=jy("router-view");return Ye(),Mi(t)}const mb=tl(pb,[["render",vb]]);function nl(e,n,t,r){return Object.defineProperty(e,n,{get:t,set:r,enumerable:!0}),e}const fr=Xe(!1);let tc;function gb(e,n){const t=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(vivaldi)[\/]([\w.]+)/.exec(e)||/(chrome|crios)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(firefox|fxios)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(e)||[];return{browser:t[5]||t[3]||t[1]||"",version:t[4]||t[2]||"0",platform:n[0]||""}}function yb(e){return/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(silk)/.exec(e)||/(android)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||/(playbook)/.exec(e)||/(bb)/.exec(e)||/(blackberry)/.exec(e)||[]}const Yp="ontouchstart"in window||window.navigator.maxTouchPoints>0;function bb(e){const n=e.toLowerCase(),t=yb(n),r=gb(n,t),o={mobile:!1,desktop:!1,cordova:!1,capacitor:!1,nativeMobile:!1,electron:!1,bex:!1,linux:!1,mac:!1,win:!1,cros:!1,chrome:!1,firefox:!1,opera:!1,safari:!1,vivaldi:!1,edge:!1,edgeChromium:!1,ie:!1,webkit:!1,android:!1,ios:!1,ipad:!1,iphone:!1,ipod:!1,kindle:!1,winphone:!1,blackberry:!1,playbook:!1,silk:!1};r.browser&&(o[r.browser]=!0,o.version=r.version,o.versionNumber=parseInt(r.version,10)),r.platform&&(o[r.platform]=!0);const i=o.android||o.ios||o.bb||o.blackberry||o.ipad||o.iphone||o.ipod||o.kindle||o.playbook||o.silk||o["windows phone"];if(i===!0||n.indexOf("mobile")!==-1?o.mobile=!0:o.desktop=!0,o["windows phone"]&&(o.winphone=!0,delete o["windows phone"]),o.edga||o.edgios||o.edg?(o.edge=!0,r.browser="edge"):o.crios?(o.chrome=!0,r.browser="chrome"):o.fxios&&(o.firefox=!0,r.browser="firefox"),(o.ipod||o.ipad||o.iphone)&&(o.ios=!0),o.vivaldi&&(r.browser="vivaldi",o.vivaldi=!0),(o.chrome||o.opr||o.safari||o.vivaldi||o.mobile===!0&&o.ios!==!0&&i!==!0)&&(o.webkit=!0),o.opr&&(r.browser="opera",o.opera=!0),o.safari&&(o.blackberry||o.bb?(r.browser="blackberry",o.blackberry=!0):o.playbook?(r.browser="playbook",o.playbook=!0):o.android?(r.browser="android",o.android=!0):o.kindle?(r.browser="kindle",o.kindle=!0):o.silk&&(r.browser="silk",o.silk=!0)),o.name=r.browser,o.platform=r.platform,n.indexOf("electron")!==-1)o.electron=!0;else if(document.location.href.indexOf("-extension://")!==-1)o.bex=!0;else{if(window.Capacitor!==void 0?(o.capacitor=!0,o.nativeMobile=!0,o.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(o.cordova=!0,o.nativeMobile=!0,o.nativeMobileWrapper="cordova"),fr.value===!0&&(tc={is:{...o}}),Yp===!0&&o.mac===!0&&(o.desktop===!0&&o.safari===!0||o.nativeMobile===!0&&o.android!==!0&&o.ios!==!0&&o.ipad!==!0)){delete o.mac,delete o.desktop;const a=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(o,{mobile:!0,ios:!0,platform:a,[a]:!0})}o.mobile!==!0&&window.navigator.userAgentData&&window.navigator.userAgentData.mobile&&(delete o.desktop,o.mobile=!0)}return o}const Jf=navigator.userAgent||navigator.vendor||window.opera,xb={has:{touch:!1,webStorage:!1},within:{iframe:!1}},Ot={userAgent:Jf,is:bb(Jf),has:{touch:Yp},within:{iframe:window.self!==window.top}},nc={install(e){const{$q:n}=e;fr.value===!0?(e.onSSRHydrated.push(()=>{Object.assign(n.platform,Ot),fr.value=!1}),n.platform=$t(this)):n.platform=this}};{let e;nl(Ot.has,"webStorage",()=>{if(e!==void 0)return e;try{if(window.localStorage)return e=!0,!0}catch{}return e=!1,!1}),Object.assign(nc,Ot),fr.value===!0&&(Object.assign(nc,tc,xb),tc=null)}function kn(e){return $c(Yc(e))}function wb(e){return $c(e)}const Xi=(e,n)=>{const t=$t(e);for(const r in e)nl(n,r,()=>t[r],o=>{t[r]=o});return n},Ht={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const e=Object.defineProperty({},"passive",{get(){Object.assign(Ht,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,e),window.removeEventListener("qtest",null,e)}catch{}function co(){}function _b(e){return e.touches&&e.touches[0]?e=e.touches[0]:e.changedTouches&&e.changedTouches[0]?e=e.changedTouches[0]:e.targetTouches&&e.targetTouches[0]&&(e=e.targetTouches[0]),{top:e.clientY,left:e.clientX}}function Cb(e){if(e.path)return e.path;if(e.composedPath)return e.composedPath();const n=[];let t=e.target;for(;t;){if(n.push(t),t.tagName==="HTML")return n.push(document),n.push(window),n;t=t.parentElement}}function Qp(e){e.stopPropagation()}function Eb(e){e.cancelable!==!1&&e.preventDefault()}function Yr(e){e.cancelable!==!1&&e.preventDefault(),e.stopPropagation()}function Rb(e,n,t){const r=`__q_${n}_evt`;e[r]=e[r]!==void 0?e[r].concat(t):t,t.forEach(o=>{o[0].addEventListener(o[1],e[o[2]],Ht[o[3]])})}function Sb(e,n){const t=`__q_${n}_evt`;e[t]!==void 0&&(e[t].forEach(r=>{r[0].removeEventListener(r[1],e[r[2]],Ht[r[3]])}),e[t]=void 0)}function Ib(e,n=250,t){let r=null;function o(){const i=arguments,a=()=>{r=null,e.apply(this,i)};r!==null&&clearTimeout(r),r=setTimeout(a,n)}return o.cancel=()=>{r!==null&&clearTimeout(r)},o}const nu=["sm","md","lg","xl"],{passive:Zf}=Ht,kb=Xi({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:co,setDebounce:co,install({$q:e,onSSRHydrated:n}){if(e.screen=this,this.__installed===!0){e.config.screen!==void 0&&(e.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:t}=window,r=t||window,o=document.scrollingElement||document.documentElement,i=t===void 0||Ot.is.mobile===!0?()=>[Math.max(window.innerWidth,o.clientWidth),Math.max(window.innerHeight,o.clientHeight)]:()=>[t.width*t.scale+window.innerWidth-o.clientWidth,t.height*t.scale+window.innerHeight-o.clientHeight],a=e.config.screen?.bodyClasses===!0;this.__update=f=>{const[h,d]=i();if(d!==this.height&&(this.height=d),h!==this.width)this.width=h;else if(f!==!0)return;let p=this.sizes;this.gt.xs=h>=p.sm,this.gt.sm=h>=p.md,this.gt.md=h>=p.lg,this.gt.lg=h>=p.xl,this.lt.sm=h<p.sm,this.lt.md=h<p.md,this.lt.lg=h<p.lg,this.lt.xl=h<p.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,p=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",p!==this.name&&(a===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${p}`)),this.name=p)};let s,u={},c=16;this.setSizes=f=>{nu.forEach(h=>{f[h]!==void 0&&(u[h]=f[h])})},this.setDebounce=f=>{c=f};const l=()=>{const f=getComputedStyle(document.body);f.getPropertyValue("--q-size-sm")&&nu.forEach(h=>{this.sizes[h]=parseInt(f.getPropertyValue(`--q-size-${h}`),10)}),this.setSizes=h=>{nu.forEach(d=>{h[d]&&(this.sizes[d]=h[d])}),this.__update(!0)},this.setDebounce=h=>{s!==void 0&&r.removeEventListener("resize",s,Zf),s=h>0?Ib(this.__update,h):this.__update,r.addEventListener("resize",s,Zf)},this.setDebounce(c),Object.keys(u).length!==0?(this.setSizes(u),u=void 0):this.__update(),a===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};fr.value===!0?n.push(l):l()}}),It=Xi({isActive:!1,mode:!1},{__media:void 0,set(e){It.mode=e,e==="auto"?(It.__media===void 0&&(It.__media=window.matchMedia("(prefers-color-scheme: dark)"),It.__updateMedia=()=>{It.set("auto")},It.__media.addListener(It.__updateMedia)),e=It.__media.matches):It.__media!==void 0&&(It.__media.removeListener(It.__updateMedia),It.__media=void 0),It.isActive=e===!0,document.body.classList.remove(`body--${e===!0?"light":"dark"}`),document.body.classList.add(`body--${e===!0?"dark":"light"}`)},toggle(){It.set(It.isActive===!1)},install({$q:e,ssrContext:n}){const t=e.config.dark;e.dark=this,this.__installed!==!0&&this.set(t!==void 0?t:!1)}});function Ab(e,n,t=document.body){if(typeof e!="string")throw new TypeError("Expected a string as propName");if(typeof n!="string")throw new TypeError("Expected a string as value");if(!(t instanceof Element))throw new TypeError("Expected a DOM element");t.style.setProperty(`--q-${e}`,n)}let Jp=!1;function Tb(e){Jp=e.isComposing===!0}function Db(e){return Jp===!0||e!==Object(e)||e.isComposing===!0||e.qKeyEvent===!0}function rc(e,n){return Db(e)===!0?!1:[].concat(n).includes(e.keyCode)}function Zp(e){if(e.ios===!0)return"ios";if(e.android===!0)return"android"}function Nb({is:e,has:n,within:t},r){const o=[e.desktop===!0?"desktop":"mobile",`${n.touch===!1?"no-":""}touch`];if(e.mobile===!0){const i=Zp(e);i!==void 0&&o.push("platform-"+i)}if(e.nativeMobile===!0){const i=e.nativeMobileWrapper;o.push(i),o.push("native-mobile"),e.ios===!0&&(r[i]===void 0||r[i].iosStatusBarPadding!==!1)&&o.push("q-ios-padding")}else e.electron===!0?o.push("electron"):e.bex===!0&&o.push("bex");return t.iframe===!0&&o.push("within-iframe"),o}function Pb(){const{is:e}=Ot,n=document.body.className,t=new Set(n.replace(/ {2}/g," ").split(" "));if(e.nativeMobile!==!0&&e.electron!==!0&&e.bex!==!0){if(e.desktop===!0)t.delete("mobile"),t.delete("platform-ios"),t.delete("platform-android"),t.add("desktop");else if(e.mobile===!0){t.delete("desktop"),t.add("mobile"),t.delete("platform-ios"),t.delete("platform-android");const o=Zp(e);o!==void 0&&t.add(`platform-${o}`)}}Ot.has.touch===!0&&(t.delete("no-touch"),t.add("touch")),Ot.within.iframe===!0&&t.add("within-iframe");const r=Array.from(t).join(" ");n!==r&&(document.body.className=r)}function Fb(e){for(const n in e)Ab(n,e[n])}const Mb={install(e){if(this.__installed!==!0){if(fr.value===!0)Pb();else{const{$q:n}=e;n.config.brand!==void 0&&Fb(n.config.brand);const t=Nb(Ot,n.config);document.body.classList.add.apply(document.body.classList,t)}Ot.is.ios===!0&&document.body.addEventListener("touchstart",co),window.addEventListener("keydown",Tb,!0)}}},ev=()=>!0;function Ob(e){return typeof e=="string"&&e!==""&&e!=="/"&&e!=="#/"}function Bb(e){return e.startsWith("#")===!0&&(e=e.substring(1)),e.startsWith("/")===!1&&(e="/"+e),e.endsWith("/")===!0&&(e=e.substring(0,e.length-1)),"#"+e}function Lb(e){if(e.backButtonExit===!1)return()=>!1;if(e.backButtonExit==="*")return ev;const n=["#/"];return Array.isArray(e.backButtonExit)===!0&&n.push(...e.backButtonExit.filter(Ob).map(Bb)),()=>n.includes(window.location.hash)}const Wb={__history:[],add:co,remove:co,install({$q:e}){if(this.__installed===!0)return;const{cordova:n,capacitor:t}=Ot.is;if(n!==!0&&t!==!0)return;const r=e.config[n===!0?"cordova":"capacitor"];if(r?.backButton===!1||t===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=a=>{a.condition===void 0&&(a.condition=ev),this.__history.push(a)},this.remove=a=>{const s=this.__history.indexOf(a);s>=0&&this.__history.splice(s,1)};const o=Lb(Object.assign({backButtonExit:!0},r)),i=()=>{if(this.__history.length){const a=this.__history[this.__history.length-1];a.condition()===!0&&(this.__history.pop(),a.handler())}else o()===!0?navigator.app.exitApp():window.history.back()};n===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",i,!1)}):window.Capacitor.Plugins.App.addListener("backButton",i)}},eh={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:e=>e?`Expand "${e}"`:"Expand",collapse:e=>e?`Collapse "${e}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days",prevMonth:"Previous month",nextMonth:"Next month",prevYear:"Previous year",nextYear:"Next year",today:"Today",prevRangeYears:e=>`Previous ${e} years`,nextRangeYears:e=>`Next ${e} years`},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:e=>e===1?"1 record selected.":(e===0?"No":e)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(e,n,t)=>e+"-"+n+" of "+t,columns:"Columns"},pagination:{first:"First page",prev:"Previous page",next:"Next page",last:"Last page"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function th(){const e=Array.isArray(navigator.languages)===!0&&navigator.languages.length!==0?navigator.languages[0]:navigator.language;if(typeof e=="string")return e.split(/[-_]/).map((n,t)=>t===0?n.toLowerCase():t>1||n.length<4?n.toUpperCase():n[0].toUpperCase()+n.slice(1).toLowerCase()).join("-")}const Sr=Xi({__qLang:{}},{getLocale:th,set(e=eh,n){const t={...e,rtl:e.rtl===!0,getLocale:th};{if(t.set=Sr.set,Sr.__langConfig===void 0||Sr.__langConfig.noHtmlAttrs!==!0){const r=document.documentElement;r.setAttribute("dir",t.rtl===!0?"rtl":"ltr"),r.setAttribute("lang",t.isoName)}Object.assign(Sr.__qLang,t)}},install({$q:e,lang:n,ssrContext:t}){e.lang=Sr.__qLang,Sr.__langConfig=e.config.lang,this.__installed===!0?n!==void 0&&this.set(n):(this.props=new Proxy(this.__qLang,{get(){return Reflect.get(...arguments)},ownKeys(r){return Reflect.ownKeys(r).filter(o=>o!=="set"&&o!=="getLocale")}}),this.set(n||eh))}}),Vb={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},La=Xi({iconMapFn:null,__qIconSet:{}},{set(e,n){const t={...e};t.set=La.set,Object.assign(La.__qIconSet,t)},install({$q:e,iconSet:n,ssrContext:t}){e.config.iconMapFn!==void 0&&(this.iconMapFn=e.config.iconMapFn),e.iconSet=this.__qIconSet,nl(e,"iconMapFn",()=>this.iconMapFn,r=>{this.iconMapFn=r}),this.__installed===!0?n!==void 0&&this.set(n):(this.props=new Proxy(this.__qIconSet,{get(){return Reflect.get(...arguments)},ownKeys(r){return Reflect.ownKeys(r).filter(o=>o!=="set")}}),this.set(n||Vb))}}),zb="_q_",rl="_q_l_",Ub="_q_pc_";function qo(){}const Wa={};let tv=!1;function Hb(){tv=!0}function Va(e){return e!==null&&typeof e=="object"&&Array.isArray(e)!==!0}const nh=[nc,Mb,It,kb,Wb,Sr,La];function Gb(e,n){const t=Xp(e);t.config.globalProperties=n.config.globalProperties;const{reload:r,...o}=n._context;return Object.assign(t._context,o),t}function rh(e,n){n.forEach(t=>{t.install(e),t.__installed=!0})}function qb(e,n,t){e.config.globalProperties.$q=t.$q,e.provide(zb,t.$q),rh(t,nh),n.components!==void 0&&Object.values(n.components).forEach(r=>{Va(r)===!0&&r.name!==void 0&&e.component(r.name,r)}),n.directives!==void 0&&Object.values(n.directives).forEach(r=>{Va(r)===!0&&r.name!==void 0&&e.directive(r.name,r)}),n.plugins!==void 0&&rh(t,Object.values(n.plugins).filter(r=>typeof r.install=="function"&&nh.includes(r)===!1)),fr.value===!0&&(t.$q.onSSRHydrated=()=>{t.onSSRHydrated.forEach(r=>{r()}),t.$q.onSSRHydrated=()=>{}})}const jb=function(e,n={}){const t={version:"2.18.5"};tv===!1?(n.config!==void 0&&Object.assign(Wa,n.config),t.config={...Wa},Hb()):t.config=n.config||{},qb(e,n,{parentApp:e,$q:t,lang:n.lang,iconSet:n.iconSet,onSSRHydrated:[]})},Kb={name:"Quasar",version:"2.18.5",install:jb,lang:Sr,iconSet:La},oc={xs:18,sm:24,md:32,lg:38,xl:46},ol={size:String};function il(e,n=oc){return pe(()=>e.size!==void 0?{fontSize:e.size in n?`${n[e.size]}px`:e.size}:null)}function Es(e,n){return e!==void 0&&e()||n}function $b(e,n){if(e!==void 0){const t=e();if(t!=null)return t.slice()}return n}function Oo(e,n){return e!==void 0?n.concat(e()):n}function Xb(e,n){return e===void 0?n:n!==void 0?n.concat(e()):e()}const oh="0 0 24 24",ru=e=>e,ou=e=>`ionicons ${e}`,nv={"mdi-":e=>`mdi ${e}`,"icon-":ru,"bt-":e=>`bt ${e}`,"eva-":e=>`eva ${e}`,"ion-md":ou,"ion-ios":ou,"ion-logo":ou,"iconfont ":ru,"ti-":e=>`themify-icon ${e}`,"bi-":e=>`bootstrap-icons ${e}`,"i-":ru},rv={o_:"-outlined",r_:"-round",s_:"-sharp"},ov={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},Yb=new RegExp("^("+Object.keys(nv).join("|")+")"),Qb=new RegExp("^("+Object.keys(rv).join("|")+")"),ih=new RegExp("^("+Object.keys(ov).join("|")+")"),Jb=/^[Mm]\s?[-+]?\.?\d/,Zb=/^img:/,ex=/^svguse:/,tx=/^ion-/,nx=/^(fa-(classic|sharp|solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,ic=kn({name:"QIcon",props:{...ol,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(e,{slots:n}){const{proxy:{$q:t}}=Kn(),r=il(e),o=pe(()=>"q-icon"+(e.left===!0?" on-left":"")+(e.right===!0?" on-right":"")+(e.color!==void 0?` text-${e.color}`:"")),i=pe(()=>{let a,s=e.name;if(s==="none"||!s)return{none:!0};if(t.iconMapFn!==null){const l=t.iconMapFn(s);if(l!==void 0)if(l.icon!==void 0){if(s=l.icon,s==="none"||!s)return{none:!0}}else return{cls:l.cls,content:l.content!==void 0?l.content:" "}}if(Jb.test(s)===!0){const[l,f=oh]=s.split("|");return{svg:!0,viewBox:f,nodes:l.split("&&").map(h=>{const[d,p,v]=h.split("@@");return Ee("path",{style:p,d,transform:v})})}}if(Zb.test(s)===!0)return{img:!0,src:s.substring(4)};if(ex.test(s)===!0){const[l,f=oh]=s.split("|");return{svguse:!0,src:l.substring(7),viewBox:f}}let u=" ";const c=s.match(Yb);if(c!==null)a=nv[c[1]](s);else if(nx.test(s)===!0)a=s;else if(tx.test(s)===!0)a=`ionicons ion-${t.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(ih.test(s)===!0){a="notranslate material-symbols";const l=s.match(ih);l!==null&&(s=s.substring(6),a+=ov[l[1]]),u=s}else{a="notranslate material-icons";const l=s.match(Qb);l!==null&&(s=s.substring(2),a+=rv[l[1]]),u=s}return{cls:a,content:u}});return()=>{const a={class:o.value,style:r.value,"aria-hidden":"true"};return i.value.none===!0?Ee(e.tag,a,Es(n.default)):i.value.img===!0?Ee(e.tag,a,Oo(n.default,[Ee("img",{src:i.value.src})])):i.value.svg===!0?Ee(e.tag,a,Oo(n.default,[Ee("svg",{viewBox:i.value.viewBox||"0 0 24 24"},i.value.nodes)])):i.value.svguse===!0?Ee(e.tag,a,Oo(n.default,[Ee("svg",{viewBox:i.value.viewBox},[Ee("use",{"xlink:href":i.value.src})])])):(i.value.cls!==void 0&&(a.class+=" "+i.value.cls),Ee(e.tag,a,Oo(n.default,[i.value.content])))}}}),rx=kn({name:"QAvatar",props:{...ol,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(e,{slots:n}){const t=il(e),r=pe(()=>"q-avatar"+(e.color?` bg-${e.color}`:"")+(e.textColor?` text-${e.textColor} q-chip--colored`:"")+(e.square===!0?" q-avatar--square":e.rounded===!0?" rounded-borders":"")),o=pe(()=>e.fontSize?{fontSize:e.fontSize}:null);return()=>{const i=e.icon!==void 0?[Ee(ic,{name:e.icon})]:void 0;return Ee("div",{class:r.value,style:t.value},[Ee("div",{class:"q-avatar__content row flex-center overflow-hidden",style:o.value},Xb(n.default,i))])}}}),ox={size:{type:[String,Number],default:"1em"},color:String};function ix(e){return{cSize:pe(()=>e.size in oc?`${oc[e.size]}px`:e.size),classes:pe(()=>"q-spinner"+(e.color?` text-${e.color}`:""))}}const iv=kn({name:"QSpinner",props:{...ox,thickness:{type:Number,default:5}},setup(e){const{cSize:n,classes:t}=ix(e);return()=>Ee("svg",{class:t.value+" q-spinner-mat",width:n.value,height:n.value,viewBox:"25 25 50 50"},[Ee("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":e.thickness,"stroke-miterlimit":"10"})])}});function ac(e,n){const t=e.style;for(const r in n)t[r]=n[r]}function ax(e){if(e==null)return;if(typeof e=="string")try{return document.querySelector(e)||void 0}catch{return}const n=En(e);if(n)return n.$el||n}function sx(e,n=250){let t=!1,r;return function(){return t===!1&&(t=!0,setTimeout(()=>{t=!1},n),r=e.apply(this,arguments)),r}}function ah(e,n,t,r){t.modifiers.stop===!0&&Qp(e);const o=t.modifiers.color;let i=t.modifiers.center;i=i===!0||r===!0;const a=document.createElement("span"),s=document.createElement("span"),u=_b(e),{left:c,top:l,width:f,height:h}=n.getBoundingClientRect(),d=Math.sqrt(f*f+h*h),p=d/2,v=`${(f-d)/2}px`,m=i?v:`${u.left-c-p}px`,g=`${(h-d)/2}px`,b=i?g:`${u.top-l-p}px`;s.className="q-ripple__inner",ac(s,{height:`${d}px`,width:`${d}px`,transform:`translate3d(${m},${b},0) scale3d(.2,.2,1)`,opacity:0}),a.className=`q-ripple${o?" text-"+o:""}`,a.setAttribute("dir","ltr"),a.appendChild(s),n.appendChild(a);const w=()=>{a.remove(),clearTimeout(y)};t.abort.push(w);let y=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${v},${g},0) scale3d(1,1,1)`,s.style.opacity=.2,y=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,y=setTimeout(()=>{a.remove(),t.abort.splice(t.abort.indexOf(w),1)},275)},250)},50)}function sh(e,{modifiers:n,value:t,arg:r}){const o=Object.assign({},e.cfg.ripple,n,t);e.modifiers={early:o.early===!0,stop:o.stop===!0,center:o.center===!0,color:o.color||r,keyCodes:[].concat(o.keyCodes||13)}}const ux=wb({name:"ripple",beforeMount(e,n){const t=n.instance.$.appContext.config.globalProperties.$q.config||{};if(t.ripple===!1)return;const r={cfg:t,enabled:n.value!==!1,modifiers:{},abort:[],start(o){r.enabled===!0&&o.qSkipRipple!==!0&&o.type===(r.modifiers.early===!0?"pointerdown":"click")&&ah(o,e,r,o.qKeyEvent===!0)},keystart:sx(o=>{r.enabled===!0&&o.qSkipRipple!==!0&&rc(o,r.modifiers.keyCodes)===!0&&o.type===`key${r.modifiers.early===!0?"down":"up"}`&&ah(o,e,r,!0)},300)};sh(r,n),e.__qripple=r,Rb(r,"main",[[e,"pointerdown","start","passive"],[e,"click","start","passive"],[e,"keydown","keystart","passive"],[e,"keyup","keystart","passive"]])},updated(e,n){if(n.oldValue!==n.value){const t=e.__qripple;t!==void 0&&(t.enabled=n.value!==!1,t.enabled===!0&&Object(n.value)===n.value&&sh(t,n))}},beforeUnmount(e){const n=e.__qripple;n!==void 0&&(n.abort.forEach(t=>{t()}),Sb(n,"main"),delete e._qripple)}}),av={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},cx=Object.keys(av),lx={align:{type:String,validator:e=>cx.includes(e)}};function fx(e){return pe(()=>{const n=e.align===void 0?e.vertical===!0?"stretch":"left":e.align;return`${e.vertical===!0?"items":"justify"}-${av[n]}`})}function hx(e){return e.appContext.config.globalProperties.$router!==void 0}function uh(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}function ch(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function dx(e,n){for(const t in n){const r=n[t],o=e[t];if(typeof r=="string"){if(r!==o)return!1}else if(Array.isArray(o)===!1||o.length!==r.length||r.some((i,a)=>i!==o[a]))return!1}return!0}function lh(e,n){return Array.isArray(n)===!0?e.length===n.length&&e.every((t,r)=>t===n[r]):e.length===1&&e[0]===n}function px(e,n){return Array.isArray(e)===!0?lh(e,n):Array.isArray(n)===!0?lh(n,e):e===n}function vx(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const t in e)if(px(e[t],n[t])===!1)return!1;return!0}const mx={to:[String,Object],replace:Boolean,href:String,target:String,disable:Boolean};function gx({fallbackTag:e,useDisableForRouterLinkProps:n=!0}={}){const t=Kn(),{props:r,proxy:o,emit:i}=t,a=hx(t),s=pe(()=>r.disable!==!0&&r.href!==void 0),u=pe(n===!0?()=>a===!0&&r.disable!==!0&&s.value!==!0&&r.to!==void 0&&r.to!==null&&r.to!=="":()=>a===!0&&s.value!==!0&&r.to!==void 0&&r.to!==null&&r.to!==""),c=pe(()=>u.value===!0?b(r.to):null),l=pe(()=>c.value!==null),f=pe(()=>s.value===!0||l.value===!0),h=pe(()=>r.type==="a"||f.value===!0?"a":r.tag||e||"div"),d=pe(()=>s.value===!0?{href:r.href,target:r.target}:l.value===!0?{href:c.value.href,target:r.target}:{}),p=pe(()=>{if(l.value===!1)return-1;const{matched:x}=c.value,{length:_}=x,S=x[_-1];if(S===void 0)return-1;const I=o.$route.matched;if(I.length===0)return-1;const C=I.findIndex(ch.bind(null,S));if(C!==-1)return C;const E=uh(x[_-2]);return _>1&&uh(S)===E&&I[I.length-1].path!==E?I.findIndex(ch.bind(null,x[_-2])):C}),v=pe(()=>l.value===!0&&p.value!==-1&&dx(o.$route.params,c.value.params)),m=pe(()=>v.value===!0&&p.value===o.$route.matched.length-1&&vx(o.$route.params,c.value.params)),g=pe(()=>l.value===!0?m.value===!0?` ${r.exactActiveClass} ${r.activeClass}`:r.exact===!0?"":v.value===!0?` ${r.activeClass}`:"":"");function b(x){try{return o.$router.resolve(x)}catch{}return null}function w(x,{returnRouterError:_,to:S=r.to,replace:I=r.replace}={}){if(r.disable===!0)return x.preventDefault(),Promise.resolve(!1);if(x.metaKey||x.altKey||x.ctrlKey||x.shiftKey||x.button!==void 0&&x.button!==0||r.target==="_blank")return Promise.resolve(!1);x.preventDefault();const C=o.$router[I===!0?"replace":"push"](S);return _===!0?C:C.then(()=>{}).catch(()=>{})}function y(x){if(l.value===!0){const _=S=>w(x,S);i("click",x,_),x.defaultPrevented!==!0&&_()}else i("click",x)}return{hasRouterLink:l,hasHrefLink:s,hasLink:f,linkTag:h,resolvedLink:c,linkIsActive:v,linkIsExactActive:m,linkClass:g,linkAttrs:d,getLink:b,navigateToRouterLink:w,navigateOnClick:y}}const fh={none:0,xs:4,sm:8,md:16,lg:24,xl:32},yx={xs:8,sm:10,md:14,lg:20,xl:24},bx=["button","submit","reset"],xx=/[^\s]\/[^\s]/,wx=["flat","outline","push","unelevated"];function _x(e,n){return e.flat===!0?"flat":e.outline===!0?"outline":e.push===!0?"push":e.unelevated===!0?"unelevated":n}const Cx={...ol,...mx,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,...wx.reduce((e,n)=>(e[n]=Boolean)&&e,{}),square:Boolean,rounded:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...lx.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean},Ex={...Cx,round:Boolean};function Rx(e){const n=il(e,yx),t=fx(e),{hasRouterLink:r,hasLink:o,linkTag:i,linkAttrs:a,navigateOnClick:s}=gx({fallbackTag:"button"}),u=pe(()=>{const m=e.fab===!1&&e.fabMini===!1?n.value:{};return e.padding!==void 0?Object.assign({},m,{padding:e.padding.split(/\s+/).map(g=>g in fh?fh[g]+"px":g).join(" "),minWidth:"0",minHeight:"0"}):m}),c=pe(()=>e.rounded===!0||e.fab===!0||e.fabMini===!0),l=pe(()=>e.disable!==!0&&e.loading!==!0),f=pe(()=>l.value===!0?e.tabindex||0:-1),h=pe(()=>_x(e,"standard")),d=pe(()=>{const m={tabindex:f.value};return o.value===!0?Object.assign(m,a.value):bx.includes(e.type)===!0&&(m.type=e.type),i.value==="a"?(e.disable===!0?m["aria-disabled"]="true":m.href===void 0&&(m.role="button"),r.value!==!0&&xx.test(e.type)===!0&&(m.type=e.type)):e.disable===!0&&(m.disabled="",m["aria-disabled"]="true"),e.loading===!0&&e.percentage!==void 0&&Object.assign(m,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e.percentage}),m}),p=pe(()=>{let m;e.color!==void 0?e.flat===!0||e.outline===!0?m=`text-${e.textColor||e.color}`:m=`bg-${e.color} text-${e.textColor||"white"}`:e.textColor&&(m=`text-${e.textColor}`);const g=e.round===!0?"round":`rectangle${c.value===!0?" q-btn--rounded":e.square===!0?" q-btn--square":""}`;return`q-btn--${h.value} q-btn--${g}`+(m!==void 0?" "+m:"")+(l.value===!0?" q-btn--actionable q-focusable q-hoverable":e.disable===!0?" disabled":"")+(e.fab===!0?" q-btn--fab":e.fabMini===!0?" q-btn--fab-mini":"")+(e.noCaps===!0?" q-btn--no-uppercase":"")+(e.dense===!0?" q-btn--dense":"")+(e.stretch===!0?" no-border-radius self-stretch":"")+(e.glossy===!0?" glossy":"")+(e.square?" q-btn--square":"")}),v=pe(()=>t.value+(e.stack===!0?" column":" row")+(e.noWrap===!0?" no-wrap text-no-wrap":"")+(e.loading===!0?" q-btn__content--hidden":""));return{classes:p,style:u,innerClasses:v,attributes:d,hasLink:o,linkTag:i,navigateOnClick:s,isActionable:l}}const{passiveCapture:ln}=Ht;let wo=null,_o=null,Co=null;kn({name:"QBtn",props:{...Ex,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(e,{slots:n,emit:t}){const{proxy:r}=Kn(),{classes:o,style:i,innerClasses:a,attributes:s,hasLink:u,linkTag:c,navigateOnClick:l,isActionable:f}=Rx(e),h=Xe(null),d=Xe(null);let p=null,v,m=null;const g=pe(()=>e.label!==void 0&&e.label!==null&&e.label!==""),b=pe(()=>e.disable===!0||e.ripple===!1?!1:{keyCodes:u.value===!0?[13,32]:[13],...e.ripple===!0?{}:e.ripple}),w=pe(()=>({center:e.round})),y=pe(()=>{const F=Math.max(0,Math.min(100,e.percentage));return F>0?{transition:"transform 0.6s",transform:`translateX(${F-100}%)`}:{}}),x=pe(()=>{if(e.loading===!0)return{onMousedown:B,onTouchstart:B,onClick:B,onKeydown:B,onKeyup:B};if(f.value===!0){const F={onClick:S,onKeydown:I,onMousedown:E};if(r.$q.platform.has.touch===!0){const L=e.onTouchstart!==void 0?"":"Passive";F[`onTouchstart${L}`]=C}return F}return{onClick:Yr}}),_=pe(()=>({ref:h,class:"q-btn q-btn-item non-selectable no-outline "+o.value,style:i.value,...s.value,...x.value}));function S(F){if(h.value!==null){if(F!==void 0){if(F.defaultPrevented===!0)return;const L=document.activeElement;if(e.type==="submit"&&L!==document.body&&h.value.contains(L)===!1&&L.contains(h.value)===!1){F.qAvoidFocus!==!0&&h.value.focus();const q=()=>{document.removeEventListener("keydown",Yr,!0),document.removeEventListener("keyup",q,ln),h.value?.removeEventListener("blur",q,ln)};document.addEventListener("keydown",Yr,!0),document.addEventListener("keyup",q,ln),h.value.addEventListener("blur",q,ln)}}l(F)}}function I(F){h.value!==null&&(t("keydown",F),rc(F,[13,32])===!0&&_o!==h.value&&(_o!==null&&T(),F.defaultPrevented!==!0&&(F.qAvoidFocus!==!0&&h.value.focus(),_o=h.value,h.value.classList.add("q-btn--active"),document.addEventListener("keyup",N,!0),h.value.addEventListener("blur",N,ln)),Yr(F)))}function C(F){h.value!==null&&(t("touchstart",F),F.defaultPrevented!==!0&&(wo!==h.value&&(wo!==null&&T(),wo=h.value,p=F.target,p.addEventListener("touchcancel",N,ln),p.addEventListener("touchend",N,ln)),v=!0,m!==null&&clearTimeout(m),m=setTimeout(()=>{m=null,v=!1},200)))}function E(F){h.value!==null&&(F.qSkipRipple=v===!0,t("mousedown",F),F.defaultPrevented!==!0&&Co!==h.value&&(Co!==null&&T(),Co=h.value,h.value.classList.add("q-btn--active"),document.addEventListener("mouseup",N,ln)))}function N(F){if(h.value!==null&&!(F?.type==="blur"&&document.activeElement===h.value)){if(F?.type==="keyup"){if(_o===h.value&&rc(F,[13,32])===!0){const L=new MouseEvent("click",F);L.qKeyEvent=!0,F.defaultPrevented===!0&&Eb(L),F.cancelBubble===!0&&Qp(L),h.value.dispatchEvent(L),Yr(F),F.qKeyEvent=!0}t("keyup",F)}T()}}function T(F){const L=d.value;F!==!0&&(wo===h.value||Co===h.value)&&L!==null&&L!==document.activeElement&&(L.setAttribute("tabindex",-1),L.focus()),wo===h.value&&(p!==null&&(p.removeEventListener("touchcancel",N,ln),p.removeEventListener("touchend",N,ln)),wo=p=null),Co===h.value&&(document.removeEventListener("mouseup",N,ln),Co=null),_o===h.value&&(document.removeEventListener("keyup",N,!0),h.value?.removeEventListener("blur",N,ln),_o=null),h.value?.classList.remove("q-btn--active")}function B(F){Yr(F),F.qSkipRipple=!0}return uo(()=>{T(!0)}),Object.assign(r,{click:F=>{f.value===!0&&S(F)}}),()=>{let F=[];e.icon!==void 0&&F.push(Ee(ic,{name:e.icon,left:e.stack!==!0&&g.value===!0,role:"img"})),g.value===!0&&F.push(Ee("span",{class:"block"},[e.label])),F=Oo(n.default,F),e.iconRight!==void 0&&e.round===!1&&F.push(Ee(ic,{name:e.iconRight,right:e.stack!==!0&&g.value===!0,role:"img"}));const L=[Ee("span",{class:"q-focus-helper",ref:d})];return e.loading===!0&&e.percentage!==void 0&&L.push(Ee("span",{class:"q-btn__progress absolute-full overflow-hidden"+(e.darkPercentage===!0?" q-btn__progress--dark":"")},[Ee("span",{class:"q-btn__progress-indicator fit block",style:y.value})])),L.push(Ee("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+a.value},F)),e.loading!==null&&L.push(Ee($p,{name:"q-transition--fade"},()=>e.loading===!0?[Ee("span",{key:"loading",class:"absolute-full flex flex-center"},n.loading!==void 0?n.loading():[Ee(iv)])]:null)),Pa(Ee(c.value,_.value,L),[[ux,b.value,void 0,w.value]])}}});let Sx=document.body;function Ix(e,n){const t=document.createElement("div");if(t.id=e,Wa.globalNodes!==void 0){const r=Wa.globalNodes.class;r!==void 0&&(t.className=r)}return Sx.appendChild(t),t}function kx(e){e.remove()}const Ax=[Element,String],Tx=[null,document,document.body,document.scrollingElement,document.documentElement];function Dx(e,n){let t=ax(n);if(t===void 0){if(e==null)return window;t=e.closest(".scroll,.scroll-y,.overflow-auto")}return Tx.includes(t)?window:t}function sv(e){return e===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:e.scrollTop}function uv(e){return e===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:e.scrollLeft}let la;function iu(){if(la!==void 0)return la;const e=document.createElement("p"),n=document.createElement("div");ac(e,{width:"100%",height:"200px"}),ac(n,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),n.appendChild(e),document.body.appendChild(n);const t=e.offsetWidth;n.style.overflow="scroll";let r=e.offsetWidth;return t===r&&(r=n.clientWidth),n.remove(),la=t-r,la}function Nx(e,n=!0){return!e||e.nodeType!==Node.ELEMENT_NODE?!1:n?e.scrollHeight>e.clientHeight&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-y"])):e.scrollWidth>e.clientWidth&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-x"]))}let li=0,au,su,gi,uu=!1,hh,dh,ph,jr=null;function Px(e){Fx(e)&&Yr(e)}function Fx(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const n=Cb(e),t=e.shiftKey&&!e.deltaX,r=!t&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),o=t||r?e.deltaY:e.deltaX;for(let i=0;i<n.length;i++){const a=n[i];if(Nx(a,r))return r?o<0&&a.scrollTop===0?!0:o>0&&a.scrollTop+a.clientHeight===a.scrollHeight:o<0&&a.scrollLeft===0?!0:o>0&&a.scrollLeft+a.clientWidth===a.scrollWidth}return!0}function vh(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function fa(e){uu!==!0&&(uu=!0,requestAnimationFrame(()=>{uu=!1;const{height:n}=e.target,{clientHeight:t,scrollTop:r}=document.scrollingElement;(gi===void 0||n!==window.innerHeight)&&(gi=t-n,document.scrollingElement.scrollTop=r),r>gi&&(document.scrollingElement.scrollTop-=Math.ceil((r-gi)/8))}))}function mh(e){const n=document.body,t=window.visualViewport!==void 0;if(e==="add"){const{overflowY:r,overflowX:o}=window.getComputedStyle(n);au=uv(window),su=sv(window),hh=n.style.left,dh=n.style.top,ph=window.location.href,n.style.left=`-${au}px`,n.style.top=`-${su}px`,o!=="hidden"&&(o==="scroll"||n.scrollWidth>window.innerWidth)&&n.classList.add("q-body--force-scrollbar-x"),r!=="hidden"&&(r==="scroll"||n.scrollHeight>window.innerHeight)&&n.classList.add("q-body--force-scrollbar-y"),n.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,Ot.is.ios===!0&&(t===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",fa,Ht.passiveCapture),window.visualViewport.addEventListener("scroll",fa,Ht.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",vh,Ht.passiveCapture))}Ot.is.desktop===!0&&Ot.is.mac===!0&&window[`${e}EventListener`]("wheel",Px,Ht.notPassive),e==="remove"&&(Ot.is.ios===!0&&(t===!0?(window.visualViewport.removeEventListener("resize",fa,Ht.passiveCapture),window.visualViewport.removeEventListener("scroll",fa,Ht.passiveCapture)):window.removeEventListener("scroll",vh,Ht.passiveCapture)),n.classList.remove("q-body--prevent-scroll"),n.classList.remove("q-body--force-scrollbar-x"),n.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,n.style.left=hh,n.style.top=dh,window.location.href===ph&&window.scrollTo(au,su),gi=void 0)}function gh(e){let n="add";if(e===!0){if(li++,jr!==null){clearTimeout(jr),jr=null;return}if(li>1)return}else{if(li===0||(li--,li>0))return;if(n="remove",Ot.is.ios===!0&&Ot.is.nativeMobile===!0){jr!==null&&clearTimeout(jr),jr=setTimeout(()=>{mh(n),jr=null},100);return}}mh(n)}let Eo,cu,yh=0,Kr=null,vt={},to={};const cv={group:"__default_quasar_group__",delay:0,message:!1,html:!1,spinnerSize:80,spinnerColor:"",messageColor:"",backgroundColor:"",boxClass:"",spinner:iv,customClass:""},lv={...cv};function Mx(e){if(e?.group!==void 0&&to[e.group]!==void 0)return Object.assign(to[e.group],e);const n=Va(e)===!0&&e.ignoreDefaults===!0?{...cv,...e}:{...lv,...e};return to[n.group]=n,n}const Pn=Xi({isActive:!1},{show(e){vt=Mx(e);const{group:n}=vt;return Pn.isActive=!0,Eo!==void 0?(vt.uid=yh,cu.$forceUpdate()):(vt.uid=++yh,Kr!==null&&clearTimeout(Kr),Kr=setTimeout(()=>{Kr=null;const t=Ix("q-loading");Eo=Gb({name:"QLoading",setup(){Mr(()=>{gh(!0)});function r(){Pn.isActive!==!0&&Eo!==void 0&&(gh(!1),Eo.unmount(t),kx(t),Eo=void 0,cu=void 0)}function o(){if(Pn.isActive!==!0)return null;const i=[Ee(vt.spinner,{class:"q-loading__spinner",color:vt.spinnerColor,size:vt.spinnerSize})];return vt.message&&i.push(Ee("div",{class:"q-loading__message"+(vt.messageColor?` text-${vt.messageColor}`:""),[vt.html===!0?"innerHTML":"textContent"]:vt.message})),Ee("div",{class:"q-loading fullscreen flex flex-center z-max "+vt.customClass.trim(),key:vt.uid},[Ee("div",{class:"q-loading__backdrop"+(vt.backgroundColor?` bg-${vt.backgroundColor}`:"")}),Ee("div",{class:"q-loading__box column items-center "+vt.boxClass},i)])}return()=>Ee($p,{name:"q-transition--fade",appear:!0,onAfterLeave:r},o)}},Pn.__parentApp),cu=Eo.mount(t)},vt.delay)),t=>{if(t===void 0||Object(t)!==t){Pn.hide(n);return}Pn.show({...t,group:n})}},hide(e){if(Pn.isActive===!0){if(e===void 0)to={};else{if(to[e]===void 0)return;{delete to[e];const n=Object.keys(to);if(n.length!==0){const t=n[n.length-1];Pn.show({group:t});return}}}Kr!==null&&(clearTimeout(Kr),Kr=null),Pn.isActive=!1}},setDefaults(e){Va(e)===!0&&Object.assign(lv,e)},install({$q:e,parentApp:n}){e.loading=this,Pn.__parentApp=n,e.config.loading!==void 0&&this.setDefaults(e.config.loading)}}),Ox=kn({name:"QToolbarTitle",props:{shrink:Boolean},setup(e,{slots:n}){const t=pe(()=>"q-toolbar__title ellipsis"+(e.shrink===!0?" col-shrink":""));return()=>Ee("div",{class:t.value},Es(n.default))}}),Bx=kn({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:n}){const t=pe(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>Ee("div",{class:t.value,role:"toolbar"},Es(n.default))}});function Lx(){const e=Xe(!fr.value);return e.value===!1&&Mr(()=>{e.value=!0}),{isHydrated:e}}const fv=typeof ResizeObserver<"u",bh=fv===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},sc=kn({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:n}){let t=null,r,o={width:-1,height:-1};function i(u){u===!0||e.debounce===0||e.debounce==="0"?a():t===null&&(t=setTimeout(a,e.debounce))}function a(){if(t!==null&&(clearTimeout(t),t=null),r){const{offsetWidth:u,offsetHeight:c}=r;(u!==o.width||c!==o.height)&&(o={width:u,height:c},n("resize",o))}}const{proxy:s}=Kn();if(s.trigger=i,fv===!0){let u;const c=l=>{r=s.$el.parentNode,r?(u=new ResizeObserver(i),u.observe(r),a()):l!==!0&&so(()=>{c(!0)})};return Mr(()=>{c()}),uo(()=>{t!==null&&clearTimeout(t),u!==void 0&&(u.disconnect!==void 0?u.disconnect():r&&u.unobserve(r))}),co}else{let u=function(){t!==null&&(clearTimeout(t),t=null),f!==void 0&&(f.removeEventListener!==void 0&&f.removeEventListener("resize",i,Ht.passive),f=void 0)},c=function(){u(),r?.contentDocument&&(f=r.contentDocument.defaultView,f.addEventListener("resize",i,Ht.passive),a())};const{isHydrated:l}=Lx();let f;return Mr(()=>{so(()=>{r=s.$el,r&&c()})}),uo(u),()=>{if(l.value===!0)return Ee("object",{class:"q--avoid-card-border",style:bh.style,tabindex:-1,type:"text/html",data:bh.url,"aria-hidden":"true",onLoad:c})}}}}),Wx=kn({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:n,emit:t}){const{proxy:{$q:r}}=Kn(),o=mn(rl,qo);if(o===qo)return console.error("QHeader needs to be child of QLayout"),qo;const i=Xe(parseInt(e.heightHint,10)),a=Xe(!0),s=pe(()=>e.reveal===!0||o.view.value.indexOf("H")!==-1||r.platform.is.ios&&o.isContainer.value===!0),u=pe(()=>{if(e.modelValue!==!0)return 0;if(s.value===!0)return a.value===!0?i.value:0;const b=i.value-o.scroll.value.position;return b>0?b:0}),c=pe(()=>e.modelValue!==!0||s.value===!0&&a.value!==!0),l=pe(()=>e.modelValue===!0&&c.value===!0&&e.reveal===!0),f=pe(()=>"q-header q-layout__section--marginal "+(s.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(c.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),h=pe(()=>{const b=o.rows.value.top,w={};return b[0]==="l"&&o.left.space===!0&&(w[r.lang.rtl===!0?"right":"left"]=`${o.left.size}px`),b[2]==="r"&&o.right.space===!0&&(w[r.lang.rtl===!0?"left":"right"]=`${o.right.size}px`),w});function d(b,w){o.update("header",b,w)}function p(b,w){b.value!==w&&(b.value=w)}function v({height:b}){p(i,b),d("size",b)}function m(b){l.value===!0&&p(a,!0),t("focusin",b)}hn(()=>e.modelValue,b=>{d("space",b),p(a,!0),o.animate()}),hn(u,b=>{d("offset",b)}),hn(()=>e.reveal,b=>{b===!1&&p(a,e.modelValue)}),hn(a,b=>{o.animate(),t("reveal",b)}),hn(o.scroll,b=>{e.reveal===!0&&p(a,b.direction==="up"||b.position<=e.revealOffset||b.position-b.inflectionPoint<100)});const g={};return o.instances.header=g,e.modelValue===!0&&d("size",i.value),d("space",e.modelValue),d("offset",u.value),uo(()=>{o.instances.header===g&&(o.instances.header=void 0,d("size",0),d("offset",0),d("space",!1))}),()=>{const b=$b(n.default,[]);return e.elevated===!0&&b.push(Ee("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),b.push(Ee(sc,{debounce:0,onResize:v})),Ee("header",{class:f.value,style:h.value,onFocusin:m},b)}}}),Vx=kn({name:"QPageContainer",setup(e,{slots:n}){const{proxy:{$q:t}}=Kn(),r=mn(rl,qo);if(r===qo)return console.error("QPageContainer needs to be child of QLayout"),qo;Ho(Ub,!0);const o=pe(()=>{const i={};return r.header.space===!0&&(i.paddingTop=`${r.header.size}px`),r.right.space===!0&&(i[`padding${t.lang.rtl===!0?"Left":"Right"}`]=`${r.right.size}px`),r.footer.space===!0&&(i.paddingBottom=`${r.footer.size}px`),r.left.space===!0&&(i[`padding${t.lang.rtl===!0?"Right":"Left"}`]=`${r.left.size}px`),i});return()=>Ee("div",{class:"q-page-container",style:o.value},Es(n.default))}}),{passive:xh}=Ht,zx=["both","horizontal","vertical"],Ux=kn({name:"QScrollObserver",props:{axis:{type:String,validator:e=>zx.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:Ax},emits:["scroll"],setup(e,{emit:n}){const t={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let r=null,o,i;hn(()=>e.scrollTarget,()=>{u(),s()});function a(){r?.();const f=Math.max(0,sv(o)),h=uv(o),d={top:f-t.position.top,left:h-t.position.left};if(e.axis==="vertical"&&d.top===0||e.axis==="horizontal"&&d.left===0)return;const p=Math.abs(d.top)>=Math.abs(d.left)?d.top<0?"up":"down":d.left<0?"left":"right";t.position={top:f,left:h},t.directionChanged=t.direction!==p,t.delta=d,t.directionChanged===!0&&(t.direction=p,t.inflectionPoint=t.position),n("scroll",{...t})}function s(){o=Dx(i,e.scrollTarget),o.addEventListener("scroll",c,xh),c(!0)}function u(){o!==void 0&&(o.removeEventListener("scroll",c,xh),o=void 0)}function c(f){if(f===!0||e.debounce===0||e.debounce==="0")a();else if(r===null){const[h,d]=e.debounce?[setTimeout(a,e.debounce),clearTimeout]:[requestAnimationFrame(a),cancelAnimationFrame];r=()=>{d(h),r=null}}}const{proxy:l}=Kn();return hn(()=>l.$q.lang.rtl,a),Mr(()=>{i=l.$el.parentNode,s()}),uo(()=>{r?.(),u()}),Object.assign(l,{trigger:c,getPosition:()=>t}),co}}),Hx=kn({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:n,emit:t}){const{proxy:{$q:r}}=Kn(),o=Xe(null),i=Xe(r.screen.height),a=Xe(e.container===!0?0:r.screen.width),s=Xe({position:0,direction:"down",inflectionPoint:0}),u=Xe(0),c=Xe(fr.value===!0?0:iu()),l=pe(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),f=pe(()=>e.container===!1?{minHeight:r.screen.height+"px"}:null),h=pe(()=>c.value!==0?{[r.lang.rtl===!0?"left":"right"]:`${c.value}px`}:null),d=pe(()=>c.value!==0?{[r.lang.rtl===!0?"right":"left"]:0,[r.lang.rtl===!0?"left":"right"]:`-${c.value}px`,width:`calc(100% + ${c.value}px)`}:null);function p(y){if(e.container===!0||document.qScrollPrevented!==!0){const x={position:y.position.top,direction:y.direction,directionChanged:y.directionChanged,inflectionPoint:y.inflectionPoint.top,delta:y.delta.top};s.value=x,e.onScroll!==void 0&&t("scroll",x)}}function v(y){const{height:x,width:_}=y;let S=!1;i.value!==x&&(S=!0,i.value=x,e.onScrollHeight!==void 0&&t("scrollHeight",x),g()),a.value!==_&&(S=!0,a.value=_),S===!0&&e.onResize!==void 0&&t("resize",y)}function m({height:y}){u.value!==y&&(u.value=y,g())}function g(){if(e.container===!0){const y=i.value>u.value?iu():0;c.value!==y&&(c.value=y)}}let b=null;const w={instances:{},view:pe(()=>e.view),isContainer:pe(()=>e.container),rootRef:o,height:i,containerHeight:u,scrollbarWidth:c,totalWidth:pe(()=>a.value+c.value),rows:pe(()=>{const y=e.view.toLowerCase().split(" ");return{top:y[0].split(""),middle:y[1].split(""),bottom:y[2].split("")}}),header:$t({size:0,offset:0,space:!1}),right:$t({size:300,offset:0,space:!1}),footer:$t({size:0,offset:0,space:!1}),left:$t({size:300,offset:0,space:!1}),scroll:s,animate(){b!==null?clearTimeout(b):document.body.classList.add("q-body--layout-animate"),b=setTimeout(()=>{b=null,document.body.classList.remove("q-body--layout-animate")},155)},update(y,x,_){w[y][x]=_}};if(Ho(rl,w),iu()>0){let y=function(){S=null,I.classList.remove("hide-scrollbar")},x=function(){if(S===null){if(I.scrollHeight>r.screen.height)return;I.classList.add("hide-scrollbar")}else clearTimeout(S);S=setTimeout(y,300)},_=function(C){S!==null&&C==="remove"&&(clearTimeout(S),y()),window[`${C}EventListener`]("resize",x)},S=null;const I=document.body;hn(()=>e.container!==!0?"add":"remove",_),e.container!==!0&&_("add"),Qc(()=>{_("remove")})}return()=>{const y=Oo(n.default,[Ee(Ux,{onScroll:p}),Ee(sc,{onResize:v})]),x=Ee("div",{class:l.value,style:f.value,ref:e.container===!0?void 0:o,tabindex:-1},y);return e.container===!0?Ee("div",{class:"q-layout-container overflow-hidden",ref:o},[Ee(sc,{onResize:m}),Ee("div",{class:"absolute-full",style:h.value},[Ee("div",{class:"scroll",style:d.value},[x])])]):x}}}),Gx=""+new URL("Uni-CPaR0lW3.png",import.meta.url).href;const Do=typeof document<"u";function hv(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function qx(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&hv(e.default)}const ze=Object.assign;function lu(e,n){const t={};for(const r in n){const o=n[r];t[r]=In(o)?o.map(e):e(o)}return t}const Si=()=>{},In=Array.isArray;function wh(e,n){const t={};for(const r in e)t[r]=r in n?n[r]:e[r];return t}const dv=/#/g,jx=/&/g,Kx=/\//g,$x=/=/g,Xx=/\?/g,pv=/\+/g,Yx=/%5B/g,Qx=/%5D/g,vv=/%5E/g,Jx=/%60/g,mv=/%7B/g,Zx=/%7C/g,gv=/%7D/g,e1=/%20/g;function al(e){return e==null?"":encodeURI(""+e).replace(Zx,"|").replace(Yx,"[").replace(Qx,"]")}function t1(e){return al(e).replace(mv,"{").replace(gv,"}").replace(vv,"^")}function uc(e){return al(e).replace(pv,"%2B").replace(e1,"+").replace(dv,"%23").replace(jx,"%26").replace(Jx,"`").replace(mv,"{").replace(gv,"}").replace(vv,"^")}function n1(e){return uc(e).replace($x,"%3D")}function r1(e){return al(e).replace(dv,"%23").replace(Xx,"%3F")}function o1(e){return r1(e).replace(Kx,"%2F")}function Wi(e){if(e==null)return null;try{return decodeURIComponent(""+e)}catch{}return""+e}const i1=/\/$/,a1=e=>e.replace(i1,"");function fu(e,n,t="/"){let r,o={},i="",a="";const s=n.indexOf("#");let u=n.indexOf("?");return u=s>=0&&u>s?-1:u,u>=0&&(r=n.slice(0,u),i=n.slice(u,s>0?s:n.length),o=e(i.slice(1))),s>=0&&(r=r||n.slice(0,s),a=n.slice(s,n.length)),r=l1(r??n,t),{fullPath:r+i+a,path:r,query:o,hash:Wi(a)}}function s1(e,n){const t=n.query?e(n.query):"";return n.path+(t&&"?")+t+(n.hash||"")}function _h(e,n){return!n||!e.toLowerCase().startsWith(n.toLowerCase())?e:e.slice(n.length)||"/"}function u1(e,n,t){const r=n.matched.length-1,o=t.matched.length-1;return r>-1&&r===o&&ei(n.matched[r],t.matched[o])&&yv(n.params,t.params)&&e(n.query)===e(t.query)&&n.hash===t.hash}function ei(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function yv(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const t in e)if(!c1(e[t],n[t]))return!1;return!0}function c1(e,n){return In(e)?Ch(e,n):In(n)?Ch(n,e):e===n}function Ch(e,n){return In(n)?e.length===n.length&&e.every((t,r)=>t===n[r]):e.length===1&&e[0]===n}function l1(e,n){if(e.startsWith("/"))return e;if(!e)return n;const t=n.split("/"),r=e.split("/"),o=r[r.length-1];(o===".."||o===".")&&r.push("");let i=t.length-1,a,s;for(a=0;a<r.length;a++)if(s=r[a],s!==".")if(s==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(a).join("/")}const wr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let cc=(function(e){return e.pop="pop",e.push="push",e})({}),hu=(function(e){return e.back="back",e.forward="forward",e.unknown="",e})({});function f1(e){if(!e)if(Do){const n=document.querySelector("base");e=n&&n.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),a1(e)}const h1=/^[^#]+#/;function d1(e,n){return e.replace(h1,"#")+n}function p1(e,n){const t=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect();return{behavior:n.behavior,left:r.left-t.left-(n.left||0),top:r.top-t.top-(n.top||0)}}const Rs=()=>({left:window.scrollX,top:window.scrollY});function v1(e){let n;if("el"in e){const t=e.el,r=typeof t=="string"&&t.startsWith("#"),o=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!o)return;n=p1(o,e)}else n=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(n):window.scrollTo(n.left!=null?n.left:window.scrollX,n.top!=null?n.top:window.scrollY)}function Eh(e,n){return(history.state?history.state.position-n:-1)+e}const lc=new Map;function m1(e,n){lc.set(e,n)}function g1(e){const n=lc.get(e);return lc.delete(e),n}function y1(e){return typeof e=="string"||e&&typeof e=="object"}function bv(e){return typeof e=="string"||typeof e=="symbol"}let nt=(function(e){return e[e.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",e[e.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",e[e.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",e[e.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",e[e.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",e})({});const xv=Symbol("");nt.MATCHER_NOT_FOUND+"",nt.NAVIGATION_GUARD_REDIRECT+"",nt.NAVIGATION_ABORTED+"",nt.NAVIGATION_CANCELLED+"",nt.NAVIGATION_DUPLICATED+"";function ti(e,n){return ze(new Error,{type:e,[xv]:!0},n)}function tr(e,n){return e instanceof Error&&xv in e&&(n==null||!!(e.type&n))}const b1=["params","query","hash"];function x1(e){if(typeof e=="string")return e;if(e.path!=null)return e.path;const n={};for(const t of b1)t in e&&(n[t]=e[t]);return JSON.stringify(n,null,2)}function w1(e){const n={};if(e===""||e==="?")return n;const t=(e[0]==="?"?e.slice(1):e).split("&");for(let r=0;r<t.length;++r){const o=t[r].replace(pv," "),i=o.indexOf("="),a=Wi(i<0?o:o.slice(0,i)),s=i<0?null:Wi(o.slice(i+1));if(a in n){let u=n[a];In(u)||(u=n[a]=[u]),u.push(s)}else n[a]=s}return n}function Rh(e){let n="";for(let t in e){const r=e[t];if(t=n1(t),r==null){r!==void 0&&(n+=(n.length?"&":"")+t);continue}(In(r)?r.map(o=>o&&uc(o)):[r&&uc(r)]).forEach(o=>{o!==void 0&&(n+=(n.length?"&":"")+t,o!=null&&(n+="="+o))})}return n}function _1(e){const n={};for(const t in e){const r=e[t];r!==void 0&&(n[t]=In(r)?r.map(o=>o==null?null:""+o):r==null?r:""+r)}return n}const C1=Symbol(""),Sh=Symbol(""),Ss=Symbol(""),wv=Symbol(""),fc=Symbol("");function fi(){let e=[];function n(r){return e.push(r),()=>{const o=e.indexOf(r);o>-1&&e.splice(o,1)}}function t(){e=[]}return{add:n,list:()=>e.slice(),reset:t}}function Ir(e,n,t,r,o,i=a=>a()){const a=r&&(r.enterCallbacks[o]=r.enterCallbacks[o]||[]);return()=>new Promise((s,u)=>{const c=h=>{h===!1?u(ti(nt.NAVIGATION_ABORTED,{from:t,to:n})):h instanceof Error?u(h):y1(h)?u(ti(nt.NAVIGATION_GUARD_REDIRECT,{from:n,to:h})):(a&&r.enterCallbacks[o]===a&&typeof h=="function"&&a.push(h),s())},l=i(()=>e.call(r&&r.instances[o],n,t,c));let f=Promise.resolve(l);e.length<3&&(f=f.then(c)),f.catch(h=>u(h))})}function du(e,n,t,r,o=i=>i()){const i=[];for(const a of e)for(const s in a.components){let u=a.components[s];if(!(n!=="beforeRouteEnter"&&!a.instances[s]))if(hv(u)){const c=(u.__vccOpts||u)[n];c&&i.push(Ir(c,t,r,a,s,o))}else{let c=u();i.push(()=>c.then(l=>{if(!l)throw new Error(`Couldn't resolve component "${s}" at "${a.path}"`);const f=qx(l)?l.default:l;a.mods[s]=l,a.components[s]=f;const h=(f.__vccOpts||f)[n];return h&&Ir(h,t,r,a,s,o)()}))}}return i}function E1(e,n){const t=[],r=[],o=[],i=Math.max(n.matched.length,e.matched.length);for(let a=0;a<i;a++){const s=n.matched[a];s&&(e.matched.find(c=>ei(c,s))?r.push(s):t.push(s));const u=e.matched[a];u&&(n.matched.find(c=>ei(c,u))||o.push(u))}return[t,r,o]}let R1=()=>location.protocol+"//"+location.host;function _v(e,n){const{pathname:t,search:r,hash:o}=n,i=e.indexOf("#");if(i>-1){let a=o.includes(e.slice(i))?e.slice(i).length:1,s=o.slice(a);return s[0]!=="/"&&(s="/"+s),_h(s,"")}return _h(t,e)+r+o}function S1(e,n,t,r){let o=[],i=[],a=null;const s=({state:h})=>{const d=_v(e,location),p=t.value,v=n.value;let m=0;if(h){if(t.value=d,n.value=h,a&&a===p){a=null;return}m=v?h.position-v.position:0}else r(d);o.forEach(g=>{g(t.value,p,{delta:m,type:cc.pop,direction:m?m>0?hu.forward:hu.back:hu.unknown})})};function u(){a=t.value}function c(h){o.push(h);const d=()=>{const p=o.indexOf(h);p>-1&&o.splice(p,1)};return i.push(d),d}function l(){if(document.visibilityState==="hidden"){const{history:h}=window;if(!h.state)return;h.replaceState(ze({},h.state,{scroll:Rs()}),"")}}function f(){for(const h of i)h();i=[],window.removeEventListener("popstate",s),window.removeEventListener("pagehide",l),document.removeEventListener("visibilitychange",l)}return window.addEventListener("popstate",s),window.addEventListener("pagehide",l),document.addEventListener("visibilitychange",l),{pauseListeners:u,listen:c,destroy:f}}function Ih(e,n,t,r=!1,o=!1){return{back:e,current:n,forward:t,replaced:r,position:window.history.length,scroll:o?Rs():null}}function I1(e){const{history:n,location:t}=window,r={value:_v(e,t)},o={value:n.state};o.value||i(r.value,{back:null,current:r.value,forward:null,position:n.length-1,replaced:!0,scroll:null},!0);function i(u,c,l){const f=e.indexOf("#"),h=f>-1?(t.host&&document.querySelector("base")?e:e.slice(f))+u:R1()+e+u;try{n[l?"replaceState":"pushState"](c,"",h),o.value=c}catch(d){console.error(d),t[l?"replace":"assign"](h)}}function a(u,c){i(u,ze({},n.state,Ih(o.value.back,u,o.value.forward,!0),c,{position:o.value.position}),!0),r.value=u}function s(u,c){const l=ze({},o.value,n.state,{forward:u,scroll:Rs()});i(l.current,l,!0),i(u,ze({},Ih(r.value,u,null),{position:l.position+1},c),!1),r.value=u}return{location:r,state:o,push:s,replace:a}}function k1(e){e=f1(e);const n=I1(e),t=S1(e,n.state,n.location,n.replace);function r(i,a=!0){a||t.pauseListeners(),history.go(i)}const o=ze({location:"",base:e,go:r,createHref:d1.bind(null,e)},n,t);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>n.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>n.state.value}),o}function A1(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),k1(e)}let no=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.Group=2]="Group",e})({});var at=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.ParamRegExp=2]="ParamRegExp",e[e.ParamRegExpEnd=3]="ParamRegExpEnd",e[e.EscapeNext=4]="EscapeNext",e})(at||{});const T1={type:no.Static,value:""},D1=/[a-zA-Z0-9_]/;function N1(e){if(!e)return[[]];if(e==="/")return[[T1]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function n(d){throw new Error(`ERR (${t})/"${c}": ${d}`)}let t=at.Static,r=t;const o=[];let i;function a(){i&&o.push(i),i=[]}let s=0,u,c="",l="";function f(){c&&(t===at.Static?i.push({type:no.Static,value:c}):t===at.Param||t===at.ParamRegExp||t===at.ParamRegExpEnd?(i.length>1&&(u==="*"||u==="+")&&n(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:no.Param,value:c,regexp:l,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):n("Invalid state to consume buffer"),c="")}function h(){c+=u}for(;s<e.length;){if(u=e[s++],u==="\\"&&t!==at.ParamRegExp){r=t,t=at.EscapeNext;continue}switch(t){case at.Static:u==="/"?(c&&f(),a()):u===":"?(f(),t=at.Param):h();break;case at.EscapeNext:h(),t=r;break;case at.Param:u==="("?t=at.ParamRegExp:D1.test(u)?h():(f(),t=at.Static,u!=="*"&&u!=="?"&&u!=="+"&&s--);break;case at.ParamRegExp:u===")"?l[l.length-1]=="\\"?l=l.slice(0,-1)+u:t=at.ParamRegExpEnd:l+=u;break;case at.ParamRegExpEnd:f(),t=at.Static,u!=="*"&&u!=="?"&&u!=="+"&&s--,l="";break;default:n("Unknown state");break}}return t===at.ParamRegExp&&n(`Unfinished custom RegExp for param "${c}"`),f(),a(),o}const kh="[^/]+?",P1={sensitive:!1,strict:!1,start:!0,end:!0};var Ut=(function(e){return e[e._multiplier=10]="_multiplier",e[e.Root=90]="Root",e[e.Segment=40]="Segment",e[e.SubSegment=30]="SubSegment",e[e.Static=40]="Static",e[e.Dynamic=20]="Dynamic",e[e.BonusCustomRegExp=10]="BonusCustomRegExp",e[e.BonusWildcard=-50]="BonusWildcard",e[e.BonusRepeatable=-20]="BonusRepeatable",e[e.BonusOptional=-8]="BonusOptional",e[e.BonusStrict=.7000000000000001]="BonusStrict",e[e.BonusCaseSensitive=.25]="BonusCaseSensitive",e})(Ut||{});const F1=/[.+*?^${}()[\]/\\]/g;function M1(e,n){const t=ze({},P1,n),r=[];let o=t.start?"^":"";const i=[];for(const c of e){const l=c.length?[]:[Ut.Root];t.strict&&!c.length&&(o+="/");for(let f=0;f<c.length;f++){const h=c[f];let d=Ut.Segment+(t.sensitive?Ut.BonusCaseSensitive:0);if(h.type===no.Static)f||(o+="/"),o+=h.value.replace(F1,"\\$&"),d+=Ut.Static;else if(h.type===no.Param){const{value:p,repeatable:v,optional:m,regexp:g}=h;i.push({name:p,repeatable:v,optional:m});const b=g||kh;if(b!==kh){d+=Ut.BonusCustomRegExp;try{`${b}`}catch(y){throw new Error(`Invalid custom RegExp for param "${p}" (${b}): `+y.message)}}let w=v?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;f||(w=m&&c.length<2?`(?:/${w})`:"/"+w),m&&(w+="?"),o+=w,d+=Ut.Dynamic,m&&(d+=Ut.BonusOptional),v&&(d+=Ut.BonusRepeatable),b===".*"&&(d+=Ut.BonusWildcard)}l.push(d)}r.push(l)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=Ut.BonusStrict}t.strict||(o+="/?"),t.end?o+="$":t.strict&&!o.endsWith("/")&&(o+="(?:/|$)");const a=new RegExp(o,t.sensitive?"":"i");function s(c){const l=c.match(a),f={};if(!l)return null;for(let h=1;h<l.length;h++){const d=l[h]||"",p=i[h-1];f[p.name]=d&&p.repeatable?d.split("/"):d}return f}function u(c){let l="",f=!1;for(const h of e){(!f||!l.endsWith("/"))&&(l+="/"),f=!1;for(const d of h)if(d.type===no.Static)l+=d.value;else if(d.type===no.Param){const{value:p,repeatable:v,optional:m}=d,g=p in c?c[p]:"";if(In(g)&&!v)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const b=In(g)?g.join("/"):g;if(!b)if(m)h.length<2&&(l.endsWith("/")?l=l.slice(0,-1):f=!0);else throw new Error(`Missing required param "${p}"`);l+=b}}return l||"/"}return{re:a,score:r,keys:i,parse:s,stringify:u}}function O1(e,n){let t=0;for(;t<e.length&&t<n.length;){const r=n[t]-e[t];if(r)return r;t++}return e.length<n.length?e.length===1&&e[0]===Ut.Static+Ut.Segment?-1:1:e.length>n.length?n.length===1&&n[0]===Ut.Static+Ut.Segment?1:-1:0}function Cv(e,n){let t=0;const r=e.score,o=n.score;for(;t<r.length&&t<o.length;){const i=O1(r[t],o[t]);if(i)return i;t++}if(Math.abs(o.length-r.length)===1){if(Ah(r))return 1;if(Ah(o))return-1}return o.length-r.length}function Ah(e){const n=e[e.length-1];return e.length>0&&n[n.length-1]<0}const B1={strict:!1,end:!0,sensitive:!1};function L1(e,n,t){const r=M1(N1(e.path),t),o=ze(r,{record:e,parent:n,children:[],alias:[]});return n&&!o.record.aliasOf==!n.record.aliasOf&&n.children.push(o),o}function W1(e,n){const t=[],r=new Map;n=wh(B1,n);function o(f){return r.get(f)}function i(f,h,d){const p=!d,v=Dh(f);v.aliasOf=d&&d.record;const m=wh(n,f),g=[v];if("alias"in f){const y=typeof f.alias=="string"?[f.alias]:f.alias;for(const x of y)g.push(Dh(ze({},v,{components:d?d.record.components:v.components,path:x,aliasOf:d?d.record:v})))}let b,w;for(const y of g){const{path:x}=y;if(h&&x[0]!=="/"){const _=h.record.path,S=_[_.length-1]==="/"?"":"/";y.path=h.record.path+(x&&S+x)}if(b=L1(y,h,m),d?d.alias.push(b):(w=w||b,w!==b&&w.alias.push(b),p&&f.name&&!Nh(b)&&a(f.name)),Ev(b)&&u(b),v.children){const _=v.children;for(let S=0;S<_.length;S++)i(_[S],b,d&&d.children[S])}d=d||b}return w?()=>{a(w)}:Si}function a(f){if(bv(f)){const h=r.get(f);h&&(r.delete(f),t.splice(t.indexOf(h),1),h.children.forEach(a),h.alias.forEach(a))}else{const h=t.indexOf(f);h>-1&&(t.splice(h,1),f.record.name&&r.delete(f.record.name),f.children.forEach(a),f.alias.forEach(a))}}function s(){return t}function u(f){const h=U1(f,t);t.splice(h,0,f),f.record.name&&!Nh(f)&&r.set(f.record.name,f)}function c(f,h){let d,p={},v,m;if("name"in f&&f.name){if(d=r.get(f.name),!d)throw ti(nt.MATCHER_NOT_FOUND,{location:f});m=d.record.name,p=ze(Th(h.params,d.keys.filter(w=>!w.optional).concat(d.parent?d.parent.keys.filter(w=>w.optional):[]).map(w=>w.name)),f.params&&Th(f.params,d.keys.map(w=>w.name))),v=d.stringify(p)}else if(f.path!=null)v=f.path,d=t.find(w=>w.re.test(v)),d&&(p=d.parse(v),m=d.record.name);else{if(d=h.name?r.get(h.name):t.find(w=>w.re.test(h.path)),!d)throw ti(nt.MATCHER_NOT_FOUND,{location:f,currentLocation:h});m=d.record.name,p=ze({},h.params,f.params),v=d.stringify(p)}const g=[];let b=d;for(;b;)g.unshift(b.record),b=b.parent;return{name:m,path:v,params:p,matched:g,meta:z1(g)}}e.forEach(f=>i(f));function l(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:a,clearRoutes:l,getRoutes:s,getRecordMatcher:o}}function Th(e,n){const t={};for(const r of n)r in e&&(t[r]=e[r]);return t}function Dh(e){const n={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:V1(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(n,"mods",{value:{}}),n}function V1(e){const n={},t=e.props||!1;if("component"in e)n.default=t;else for(const r in e.components)n[r]=typeof t=="object"?t[r]:t;return n}function Nh(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function z1(e){return e.reduce((n,t)=>ze(n,t.meta),{})}function U1(e,n){let t=0,r=n.length;for(;t!==r;){const i=t+r>>1;Cv(e,n[i])<0?r=i:t=i+1}const o=H1(e);return o&&(r=n.lastIndexOf(o,r-1)),r}function H1(e){let n=e;for(;n=n.parent;)if(Ev(n)&&Cv(e,n)===0)return n}function Ev({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Ph(e){const n=mn(Ss),t=mn(wv),r=pe(()=>{const u=En(e.to);return n.resolve(u)}),o=pe(()=>{const{matched:u}=r.value,{length:c}=u,l=u[c-1],f=t.matched;if(!l||!f.length)return-1;const h=f.findIndex(ei.bind(null,l));if(h>-1)return h;const d=Fh(u[c-2]);return c>1&&Fh(l)===d&&f[f.length-1].path!==d?f.findIndex(ei.bind(null,u[c-2])):h}),i=pe(()=>o.value>-1&&$1(t.params,r.value.params)),a=pe(()=>o.value>-1&&o.value===t.matched.length-1&&yv(t.params,r.value.params));function s(u={}){if(K1(u)){const c=n[En(e.replace)?"replace":"push"](En(e.to)).catch(Si);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:pe(()=>r.value.href),isActive:i,isExactActive:a,navigate:s}}function G1(e){return e.length===1?e[0]:e}const q1=Yc({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Ph,setup(e,{slots:n}){const t=$t(Ph(e)),{options:r}=mn(Ss),o=pe(()=>({[Mh(e.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Mh(e.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=n.default&&G1(n.default(t));return e.custom?i:Ee("a",{"aria-current":t.isExactActive?e.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:o.value},i)}}}),j1=q1;function K1(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const n=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(n))return}return e.preventDefault&&e.preventDefault(),!0}}function $1(e,n){for(const t in n){const r=n[t],o=e[t];if(typeof r=="string"){if(r!==o)return!1}else if(!In(o)||o.length!==r.length||r.some((i,a)=>i!==o[a]))return!1}return!0}function Fh(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Mh=(e,n,t)=>e??n??t,X1=Yc({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:n,slots:t}){const r=mn(fc),o=pe(()=>e.route||r.value),i=mn(Sh,0),a=pe(()=>{let c=En(i);const{matched:l}=o.value;let f;for(;(f=l[c])&&!f.components;)c++;return c}),s=pe(()=>o.value.matched[a.value]);Ho(Sh,pe(()=>a.value+1)),Ho(C1,s),Ho(fc,o);const u=Xe();return hn(()=>[u.value,s.value,e.name],([c,l,f],[h,d,p])=>{l&&(l.instances[f]=c,d&&d!==l&&c&&c===h&&(l.leaveGuards.size||(l.leaveGuards=d.leaveGuards),l.updateGuards.size||(l.updateGuards=d.updateGuards))),c&&l&&(!d||!ei(l,d)||!h)&&(l.enterCallbacks[f]||[]).forEach(v=>v(c))},{flush:"post"}),()=>{const c=o.value,l=e.name,f=s.value,h=f&&f.components[l];if(!h)return Oh(t.default,{Component:h,route:c});const d=f.props[l],p=d?d===!0?c.params:typeof d=="function"?d(c):d:null,m=Ee(h,ze({},p,n,{onVnodeUnmounted:g=>{g.component.isUnmounted&&(f.instances[l]=null)},ref:u}));return Oh(t.default,{Component:m,route:c})||m}}});function Oh(e,n){if(!e)return null;const t=e(n);return t.length===1?t[0]:t}const Y1=X1;function Q1(e){const n=W1(e.routes,e),t=e.parseQuery||w1,r=e.stringifyQuery||Rh,o=e.history,i=fi(),a=fi(),s=fi(),u=wy(wr);let c=wr;Do&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const l=lu.bind(null,z=>""+z),f=lu.bind(null,o1),h=lu.bind(null,Wi);function d(z,ee){let Z,se;return bv(z)?(Z=n.getRecordMatcher(z),se=ee):se=z,n.addRoute(se,Z)}function p(z){const ee=n.getRecordMatcher(z);ee&&n.removeRoute(ee)}function v(){return n.getRoutes().map(z=>z.record)}function m(z){return!!n.getRecordMatcher(z)}function g(z,ee){if(ee=ze({},ee||u.value),typeof z=="string"){const O=fu(t,z,ee.path),G=n.resolve({path:O.path},ee),j=o.createHref(O.fullPath);return ze(O,G,{params:h(G.params),hash:Wi(O.hash),redirectedFrom:void 0,href:j})}let Z;if(z.path!=null)Z=ze({},z,{path:fu(t,z.path,ee.path).path});else{const O=ze({},z.params);for(const G in O)O[G]==null&&delete O[G];Z=ze({},z,{params:f(O)}),ee.params=f(ee.params)}const se=n.resolve(Z,ee),ce=z.hash||"";se.params=l(h(se.params));const A=s1(r,ze({},z,{hash:t1(ce),path:se.path})),D=o.createHref(A);return ze({fullPath:A,hash:ce,query:r===Rh?_1(z.query):z.query||{}},se,{redirectedFrom:void 0,href:D})}function b(z){return typeof z=="string"?fu(t,z,u.value.path):ze({},z)}function w(z,ee){if(c!==z)return ti(nt.NAVIGATION_CANCELLED,{from:ee,to:z})}function y(z){return S(z)}function x(z){return y(ze(b(z),{replace:!0}))}function _(z,ee){const Z=z.matched[z.matched.length-1];if(Z&&Z.redirect){const{redirect:se}=Z;let ce=typeof se=="function"?se(z,ee):se;return typeof ce=="string"&&(ce=ce.includes("?")||ce.includes("#")?ce=b(ce):{path:ce},ce.params={}),ze({query:z.query,hash:z.hash,params:ce.path!=null?{}:z.params},ce)}}function S(z,ee){const Z=c=g(z),se=u.value,ce=z.state,A=z.force,D=z.replace===!0,O=_(Z,se);if(O)return S(ze(b(O),{state:typeof O=="object"?ze({},ce,O.state):ce,force:A,replace:D}),ee||Z);const G=Z;G.redirectedFrom=ee;let j;return!A&&u1(r,se,Z)&&(j=ti(nt.NAVIGATION_DUPLICATED,{to:G,from:se}),oe(se,se,!0,!1)),(j?Promise.resolve(j):E(G,se)).catch($=>tr($)?tr($,nt.NAVIGATION_GUARD_REDIRECT)?$:Q($):W($,G,se)).then($=>{if($){if(tr($,nt.NAVIGATION_GUARD_REDIRECT))return S(ze({replace:D},b($.to),{state:typeof $.to=="object"?ze({},ce,$.to.state):ce,force:A}),ee||G)}else $=T(G,se,!0,D,ce);return N(G,se,$),$})}function I(z,ee){const Z=w(z,ee);return Z?Promise.reject(Z):Promise.resolve()}function C(z){const ee=ke.values().next().value;return ee&&typeof ee.runWithContext=="function"?ee.runWithContext(z):z()}function E(z,ee){let Z;const[se,ce,A]=E1(z,ee);Z=du(se.reverse(),"beforeRouteLeave",z,ee);for(const O of se)O.leaveGuards.forEach(G=>{Z.push(Ir(G,z,ee))});const D=I.bind(null,z,ee);return Z.push(D),Ce(Z).then(()=>{Z=[];for(const O of i.list())Z.push(Ir(O,z,ee));return Z.push(D),Ce(Z)}).then(()=>{Z=du(ce,"beforeRouteUpdate",z,ee);for(const O of ce)O.updateGuards.forEach(G=>{Z.push(Ir(G,z,ee))});return Z.push(D),Ce(Z)}).then(()=>{Z=[];for(const O of A)if(O.beforeEnter)if(In(O.beforeEnter))for(const G of O.beforeEnter)Z.push(Ir(G,z,ee));else Z.push(Ir(O.beforeEnter,z,ee));return Z.push(D),Ce(Z)}).then(()=>(z.matched.forEach(O=>O.enterCallbacks={}),Z=du(A,"beforeRouteEnter",z,ee,C),Z.push(D),Ce(Z))).then(()=>{Z=[];for(const O of a.list())Z.push(Ir(O,z,ee));return Z.push(D),Ce(Z)}).catch(O=>tr(O,nt.NAVIGATION_CANCELLED)?O:Promise.reject(O))}function N(z,ee,Z){s.list().forEach(se=>C(()=>se(z,ee,Z)))}function T(z,ee,Z,se,ce){const A=w(z,ee);if(A)return A;const D=ee===wr,O=Do?history.state:{};Z&&(se||D?o.replace(z.fullPath,ze({scroll:D&&O&&O.scroll},ce)):o.push(z.fullPath,ce)),u.value=z,oe(z,ee,Z,D),Q()}let B;function F(){B||(B=o.listen((z,ee,Z)=>{if(!Se.listening)return;const se=g(z),ce=_(se,Se.currentRoute.value);if(ce){S(ze(ce,{replace:!0,force:!0}),se).catch(Si);return}c=se;const A=u.value;Do&&m1(Eh(A.fullPath,Z.delta),Rs()),E(se,A).catch(D=>tr(D,nt.NAVIGATION_ABORTED|nt.NAVIGATION_CANCELLED)?D:tr(D,nt.NAVIGATION_GUARD_REDIRECT)?(S(ze(b(D.to),{force:!0}),se).then(O=>{tr(O,nt.NAVIGATION_ABORTED|nt.NAVIGATION_DUPLICATED)&&!Z.delta&&Z.type===cc.pop&&o.go(-1,!1)}).catch(Si),Promise.reject()):(Z.delta&&o.go(-Z.delta,!1),W(D,se,A))).then(D=>{D=D||T(se,A,!1),D&&(Z.delta&&!tr(D,nt.NAVIGATION_CANCELLED)?o.go(-Z.delta,!1):Z.type===cc.pop&&tr(D,nt.NAVIGATION_ABORTED|nt.NAVIGATION_DUPLICATED)&&o.go(-1,!1)),N(se,A,D)}).catch(Si)}))}let L=fi(),q=fi(),U;function W(z,ee,Z){Q(z);const se=q.list();return se.length?se.forEach(ce=>ce(z,ee,Z)):console.error(z),Promise.reject(z)}function X(){return U&&u.value!==wr?Promise.resolve():new Promise((z,ee)=>{L.add([z,ee])})}function Q(z){return U||(U=!z,F(),L.list().forEach(([ee,Z])=>z?Z(z):ee()),L.reset()),z}function oe(z,ee,Z,se){const{scrollBehavior:ce}=e;if(!Do||!ce)return Promise.resolve();const A=!Z&&g1(Eh(z.fullPath,0))||(se||!Z)&&history.state&&history.state.scroll||null;return so().then(()=>ce(z,ee,A)).then(D=>D&&v1(D)).catch(D=>W(D,z,ee))}const ue=z=>o.go(z);let me;const ke=new Set,Se={currentRoute:u,listening:!0,addRoute:d,removeRoute:p,clearRoutes:n.clearRoutes,hasRoute:m,getRoutes:v,resolve:g,options:e,push:y,replace:x,go:ue,back:()=>ue(-1),forward:()=>ue(1),beforeEach:i.add,beforeResolve:a.add,afterEach:s.add,onError:q.add,isReady:X,install(z){z.component("RouterLink",j1),z.component("RouterView",Y1),z.config.globalProperties.$router=Se,Object.defineProperty(z.config.globalProperties,"$route",{enumerable:!0,get:()=>En(u)}),Do&&!me&&u.value===wr&&(me=!0,y(o.location).catch(se=>{}));const ee={};for(const se in wr)Object.defineProperty(ee,se,{get:()=>u.value[se],enumerable:!0});z.provide(Ss,Se),z.provide(wv,up(ee)),z.provide(fc,u);const Z=z.unmount;ke.add(z),z.unmount=function(){ke.delete(z),ke.size<1&&(c=wr,B&&B(),B=null,u.value=wr,me=!1,U=!1),Z()}}};function Ce(z){return z.reduce((ee,Z)=>ee.then(()=>C(Z)),Promise.resolve())}return Se}function J1(){return mn(Ss)}const Z1=["disabled"],ew={__name:"BotonIniciar",props:{to:String,disabled:Boolean},emits:["click"],setup(e,{emit:n}){const t=J1(),r=e,o=n;function i(a){r.disabled||(r.to?t.push(r.to):o("click",a))}return(a,s)=>(Ye(),ut("button",{class:"boton",onClick:i,disabled:e.disabled},[Xy(a.$slots,"default",{},void 0)],8,Z1))}},za=tl(ew,[["__scopeId","data-v-63c7da2a"]]),tw=["src"],nw={__name:"Home",setup(e){return(n,t)=>(Ye(),Mi(Hx,{class:"fondo",view:"hHh lpR fFf"},{default:bn(()=>[t[3]||(t[3]=fe("div",{class:"blur-overlay"},null,-1)),Qe(Wx,{class:"bg-transparent q-pt-xl no-shadow no-border"},{default:bn(()=>[Qe(Bx,{class:"justify-center"},{default:bn(()=>[Qe(Ox,{class:"text-center text-h3"},{default:bn(()=>[Qe(rx,{class:"img",size:"8rem"},{default:bn(()=>[fe("img",{src:En(Gx)},null,8,tw)]),_:1}),t[0]||(t[0]=Go(" Centro de Asistencia Estudiantil ",-1))]),_:1})]),_:1})]),_:1}),Qe(Vx,{class:"contenido flex justify-around items-center"},{default:bn(()=>[fe("div",null,[Qe(za,{to:"/registro"},{default:bn(()=>[...t[1]||(t[1]=[Go("Registro",-1)])]),_:1})]),fe("div",null,[Qe(za,{to:"/consulta"},{default:bn(()=>[...t[2]||(t[2]=[Go("Consulta",-1)])]),_:1})])]),_:1})]),_:1}))}};var Rv=function(e,n){return(Rv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(e,n)};function An(e,n){function t(){this.constructor=e}Rv(e,n),e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function he(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new t((function(l){l(c.value)})).then(a,s)}u((r=r.apply(e,[])).next())}))}function de(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return(function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(l[0]===6&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(f){l=[6,f],r=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}})([u,c])}}}var rw=(function(){function e(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(n,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},e.prototype.registerFlag=function(n,t,r){if(this.flagRegistry[n]={evaluationFn:t,setHook:r},this.urlFlags[n]!=null){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},e.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},e.prototype.getNumber=function(n){return this.get(n)},e.prototype.getBool=function(n){return this.get(n)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(n,t){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(t)},e.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},e.prototype.setFlags=function(n){this.flags=Object.assign({},n)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,o=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return ow(r,a[0],a[1]),a.join("=")})),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach((function(i){var a=i.split(":"),s=a[0],u=a[1];n.urlFlags[s]=(function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")})(s,u)}))}},e})();function ow(e,n,t){e[decodeURIComponent(n)]=decodeURIComponent(t||"")}function K(){return Sv}var Sv=null,Ua=new Map,hc=new Map;function Iv(e,n){var t=Av(e,n);return Ua.get(t)}function iw(e){return hc.get(e)}function Bh(e){for(var n=Ua.entries(),t=[];;){var r=n.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&t.push(s)}return t}function kv(e){var n=e.kernelName,t=e.backendName,r=Av(n,t);if(Ua.has(r))throw new Error("The kernel '"+n+"' for backend '"+t+"' is already registered");Ua.set(r,e)}function aw(e){var n=e.kernelName;hc.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),hc.set(n,e)}function Av(e,n){return n+"_"+e}function dc(e,n,t){return Math.max(e,Math.min(n,t))}function Tv(e){return e%2==0?e:e+1}function sw(e){for(var n=0,t=0;t<e.length;t++)n+=e[t];return n}function k(e,n){if(!e)throw new Error(typeof n=="string"?n:n())}function He(e,n,t){t===void 0&&(t=""),k(gt(e,n),(function(){return t+" Shapes "+e+" and "+n+" must match"}))}function ai(e){k(e!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ni(e,n,t){if(n===void 0&&(n=[]),t===void 0&&(t=!1),n==null&&(n=[]),Array.isArray(e)||Hn(e)&&!t)for(var r=0;r<e.length;++r)ni(e[r],n,t);else n.push(e);return n}function ve(e){if(e.length===0)return 1;for(var n=e[0],t=1;t<e.length;t++)n*=e[t];return n}function gt(e,n){if(e===n)return!0;if(e==null||n==null||e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function rt(e){return e%1==0}function uw(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var n=Math.exp(2*e);return(n-1)/(n+1)}function pc(e){var n=Math.ceil(Math.sqrt(e));return[n,Math.ceil(e/n)]}function jo(e,n){return n<=e.length?e:e+" ".repeat(n-e.length)}function Lh(e,n,t){return n===void 0&&(n=function(r){return 0}),new Promise((function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=n(i);t!=null&&i>=t?o():setTimeout(a,s)}};a()}))}function cw(e,n){for(var t=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)t*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(n>0&&n!==t)throw Error("Size("+n+") must match the product of shape "+e);return e}if(t===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(n%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+t);var i=e.slice();return i[r]=n/t,i}function dt(e,n){var t=n.length;return k((e=e==null?n.map((function(r,o){return o})):[].concat(e)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+e})),k(e.every((function(r){return rt(r)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(r){return r<0?t+r:r}))}function eo(e,n){for(var t=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:dt(n,e).sort(),a=0,s=0;s<e.length;++s){if(i!=null){if(i[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(i[a]==null||i[a]>s)&&e[s]===1&&(t.push(e[s]),r.push(s)),i[a]<=s&&a++}e[s]!==1&&(t.push(e[s]),r.push(s))}return{newShape:t,keptDims:r}}function Vi(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);t=new Uint8Array(n)}return t}function Ha(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else if(e==="bool")t=new Uint8Array(n);else{if(e!=="string")throw new Error("Unknown data type "+e);t=new Array(n)}return t}function lw(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function fw(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function hw(e,n){return n!=="complex64"&&(n!=="float32"||e==="complex64")&&(n!=="int32"||e==="float32"||e==="complex64")&&(n!=="bool"||e!=="bool")}function Hn(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Dv(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function dw(e){if(e==null)return 0;var n=0;return e.forEach((function(t){return n+=t.length})),n}function sl(e){return typeof e=="string"||e instanceof String}function pw(e){return typeof e=="boolean"}function vw(e){return typeof e=="number"}function Yi(e){return Array.isArray(e)?Yi(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":vw(e)?"float32":sl(e)?"string":pw(e)?"bool":"float32"}function vc(e){return!!(e&&e.constructor&&e.call&&e.apply)}function mc(e,n){for(var t=n;t<e;++t)if(e%t==0)return t;return e}function Gn(e){var n=e.length;if(n<2)return[];var t=new Array(n-1);t[n-2]=e[n-1];for(var r=n-3;r>=0;--r)t[r]=t[r+1]*e[r+1];return t}function Nv(e,n,t){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ni(e)),t&&lw(e,n),(function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"})(e,n))return e;if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function Wh(e,n){if(e.length===0)return n[0];var t=e.reduce((function(r,o){return r*o}));if(t===0)return[];if(t!==n.length)throw new Error("["+e+"] does not match the input size.");return(function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),f=l.reduce((function(h,d){return h*d}));for(c=0;c<u;c++)s[c]=r(o+c*f,l,a)}return s})(0,e,n)}function Pv(e,n){for(var t=Qi(e,n),r=0;r<t.length;r++)t[r]=1;return t}function Qi(e,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+n)}function Ln(){return K().platform.now()}function Fv(e){e.forEach((function(n){k(Number.isInteger(n)&&n>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function mw(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",K().platform.encode(e,n)}function Ga(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",K().platform.decode(e,n)}function Vh(e,n,t){if(n===0)return 0;if(n===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=t[o]*e[o];return r}function gw(e,n,t){if(n===0)return[];if(n===1)return[e];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(e/t[o]),e-=r[o]*t[o];return r[r.length-1]=e,r}var yw=(function(){function e(n,t){this.backendTimer=n,this.logger=t,t==null&&(this.logger=new bw)}return e.prototype.profileKernel=function(n,t,r){var o,i=this,a=this.backendTimer.time((function(){o=r()}));return o.forEach((function(s){s.data().then((function(u){(function(c,l,f){if(l!=="float32")return!1;for(var h=0;h<c.length;h++){var d=c[h];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+f+"'"),!0}})(u,s.dtype,n),a.then((function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,t,l)}))}))})),o},e})(),bw=(function(){function e(){}return e.prototype.logKernelProfile=function(n,t,r,o,i,a){var s=typeof o=="number"?jo(o+"ms",9):o.error,u=jo(n,25),c=t.rank,l=t.size,f=jo(t.shape.toString(),14),h="";for(var d in i){var p=i[d].shape||t.shape,v=p.length;h+=d+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+f+"	%c"+l+"	%c"+h+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e})(),zh=20,hi=3,pu=7;function xw(e,n,t,r){var o=Gn(n),i=(function(c,l,f,h){var d=ve(l),p=h[h.length-1],v=new Array(p).fill(0),m=l.length,g=f==="complex64"?pi(c):c;if(m>1)for(var b=0;b<d/p;b++)for(var w=b*p,y=0;y<p;y++)v[y]=Math.max(v[y],di(g[w+y],0,f).length);return v})(e,n,t,o),a=n.length,s=(function c(l,f,h,d,p,v){v===void 0&&(v=!0);var m=h==="complex64"?2:1,g=f[0],b=f.length;if(b===0)return h==="complex64"?[di(pi(l)[0],0,h)]:h==="bool"?[Mv(l[0])]:[l[0].toString()];if(b===1){if(g>zh){var w=hi*m,y=Array.from(l.slice(0,w)),x=Array.from(l.slice((g-hi)*m,g*m));return h==="complex64"&&(y=pi(y),x=pi(x)),["["+y.map((function(L,q){return di(L,p[q],h)})).join(", ")+", ..., "+x.map((function(L,q){return di(L,p[g-hi+q],h)})).join(", ")+"]"]}return["["+(h==="complex64"?pi(l):Array.from(l)).map((function(L,q){return di(L,p[q],h)})).join(", ")+"]"]}var _=f.slice(1),S=d.slice(1),I=d[0]*m,C=[];if(g>zh){for(var E=0;E<hi;E++){var N=(T=E*I)+I;C.push.apply(C,c(l.slice(T,N),_,h,S,p,!1))}for(C.push("..."),E=g-hi;E<g;E++)N=(T=E*I)+I,C.push.apply(C,c(l.slice(T,N),_,h,S,p,E===g-1))}else for(E=0;E<g;E++){var T;N=(T=E*I)+I,C.push.apply(C,c(l.slice(T,N),_,h,S,p,E===g-1))}var B=b===2?",":"";for(C[0]="["+C[0]+B,E=1;E<C.length-1;E++)C[E]=" "+C[E]+B;var F=`,
`;for(E=2;E<b;E++)F+=`
`;return C[C.length-1]=" "+C[C.length-1]+"]"+(v?"":F),C})(e,n,t,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map((function(c){return"    "+c})).join(`
`)),u.join(`
`)}function di(e,n,t){return jo(Array.isArray(e)?parseFloat(e[0].toFixed(pu))+" + "+parseFloat(e[1].toFixed(pu))+"j":sl(e)?"'"+e+"'":t==="bool"?Mv(e):parseFloat(e.toFixed(pu)).toString(),n)}function Mv(e){return e===0?"false":"true"}function pi(e){for(var n=[],t=0;t<e.length;t+=2)n.push([e[t],e[t+1]]);return n}var zi=(function(){function e(n,t,r){var o=this;if(this.dtype=t,this.shape=n.slice(),this.size=ve(n),r!=null){var i=r.length;k(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ha(t,this.size),this.strides=Gn(n)}return e.prototype.set=function(n){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),k(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(r);this.values[i]=n},e.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length===0&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},e.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var t=n[n.length-1],r=0;r<n.length-1;++r)t+=this.strides[r]*n[r];return t},e.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(n/this.strides[r]),n-=t[r]*this.strides[r];return t[t.length-1]=n,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Wn().makeTensor(this.values,this.shape,this.dtype)},e})(),Wn=null,H=null,Ov=null,Je=(function(){function e(n,t,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=ve(n),this.strides=Gn(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),k(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},e.prototype.as3D=function(n,t,r){return this.throwIfDisposed(),this.reshape([n,t,r])},e.prototype.as4D=function(n,t,r,o){return this.throwIfDisposed(),this.reshape([n,t,r,o])},e.prototype.as5D=function(n,t,r,o,i){return this.throwIfDisposed(),this.reshape([n,t,r,o,i])},e.prototype.asType=function(n){return this.throwIfDisposed(),H.cast(this,n)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return he(this,void 0,void 0,(function(){var n;return de(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,H.buffer(this.shape,this.dtype,n)]}}))}))},e.prototype.bufferSync=function(){return H.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return he(this,void 0,void 0,(function(){var n;return de(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,Wh(this.shape,n)]}}))}))},e.prototype.arraySync=function(){return Wh(this.shape,this.dataSync())},e.prototype.data=function(){return he(this,void 0,void 0,(function(){var n,t;return de(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=Wn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:t=r.sent();try{return[2,t.map((function(o){return Ga(o)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var n=Wn().readSync(this.dataId);if(this.dtype==="string")try{return n.map((function(t){return Ga(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},e.prototype.bytes=function(){return he(this,void 0,void 0,(function(){var n;return de(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Wn().read(this.dataId)];case 1:return n=t.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(Wn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(n){return n===void 0&&(n=!1),H.print(this,n)},e.prototype.reshape=function(n){return this.throwIfDisposed(),H.reshape(this,n)},e.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},e.prototype.expandDims=function(n){return n===void 0&&(n=0),H.expandDims(this,n)},e.prototype.cumsum=function(n,t,r){return n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1),H.cumsum(this,n,t,r)},e.prototype.squeeze=function(n){return this.throwIfDisposed(),H.squeeze(this,n)},e.prototype.clone=function(){return this.throwIfDisposed(),H.clone(this)},e.prototype.oneHot=function(n,t,r){return this.throwIfDisposed(),H.oneHot(this,n,t,r)},e.prototype.toString=function(n){return n===void 0&&(n=!1),xw(this.dataSync(),this.shape,this.dtype,n)},e.prototype.tile=function(n){return this.throwIfDisposed(),H.tile(this,n)},e.prototype.gather=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),H.gather(this,n,t)},e.prototype.matMul=function(n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),H.matMul(this,n,t,r)},e.prototype.dot=function(n){return this.throwIfDisposed(),H.dot(this,n)},e.prototype.norm=function(n,t,r){return n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),H.norm(this,n,t,r)},e.prototype.slice=function(n,t){return this.throwIfDisposed(),H.slice(this,n,t)},e.prototype.reverse=function(n){return this.throwIfDisposed(),H.reverse(this,n)},e.prototype.concat=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),n instanceof e&&(n=[n]),H.concat([this].concat(n),t)},e.prototype.split=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),H.split(this,n,t)},e.prototype.stack=function(n,t){return t===void 0&&(t=0),H.stack([this,n],t)},e.prototype.unstack=function(n){return n===void 0&&(n=0),H.unstack(this,n)},e.prototype.pad=function(n,t){return t===void 0&&(t=0),H.pad(this,n,t)},e.prototype.batchNormalization=function(n,t,r,o,i){return r===void 0&&(r=.001),Ov("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,i,o,r)},e.prototype.batchNorm=function(n,t,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),H.batchNorm(this,n,t,r,o,i)},e.prototype.all=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.all(this,n,t)},e.prototype.any=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.any(this,n,t)},e.prototype.logSumExp=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.logSumExp(this,n,t)},e.prototype.sum=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.sum(this,n,t)},e.prototype.prod=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.prod(this,n,t)},e.prototype.mean=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.mean(this,n,t)},e.prototype.min=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.min(this,n,t)},e.prototype.max=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),H.max(this,n,t)},e.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),H.argMin(this,n)},e.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),H.argMax(this,n)},e.prototype.cast=function(n){return this.throwIfDisposed(),H.cast(this,n)},e.prototype.add=function(n){return this.throwIfDisposed(),H.add(this,n)},e.prototype.addStrict=function(n){return this.throwIfDisposed(),H.addStrict(this,n)},e.prototype.atan2=function(n){return this.throwIfDisposed(),H.atan2(this,n)},e.prototype.sub=function(n){return this.throwIfDisposed(),H.sub(this,n)},e.prototype.subStrict=function(n){return this.throwIfDisposed(),H.subStrict(this,n)},e.prototype.pow=function(n){return this.throwIfDisposed(),H.pow(this,n)},e.prototype.powStrict=function(n){return this.throwIfDisposed(),H.powStrict(this,n)},e.prototype.mul=function(n){return this.throwIfDisposed(),H.mul(this,n)},e.prototype.mulStrict=function(n){return this.throwIfDisposed(),H.mulStrict(this,n)},e.prototype.div=function(n){return this.throwIfDisposed(),H.div(this,n)},e.prototype.divNoNan=function(n){return this.throwIfDisposed(),H.divNoNan(this,n)},e.prototype.floorDiv=function(n){return this.throwIfDisposed(),H.floorDiv(this,n)},e.prototype.divStrict=function(n){return this.throwIfDisposed(),H.divStrict(this,n)},e.prototype.minimum=function(n){return this.throwIfDisposed(),H.minimum(this,n)},e.prototype.minimumStrict=function(n){return this.throwIfDisposed(),H.minimumStrict(this,n)},e.prototype.maximum=function(n){return this.throwIfDisposed(),H.maximum(this,n)},e.prototype.maximumStrict=function(n){return this.throwIfDisposed(),H.maximumStrict(this,n)},e.prototype.mod=function(n){return this.throwIfDisposed(),H.mod(this,n)},e.prototype.modStrict=function(n){return this.throwIfDisposed(),H.modStrict(this,n)},e.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),H.squaredDifferenceStrict(this,n)},e.prototype.transpose=function(n){return this.throwIfDisposed(),H.transpose(this,n)},e.prototype.notEqual=function(n){return this.throwIfDisposed(),H.notEqual(this,n)},e.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),H.notEqualStrict(this,n)},e.prototype.less=function(n){return this.throwIfDisposed(),H.less(this,n)},e.prototype.lessStrict=function(n){return this.throwIfDisposed(),H.lessStrict(this,n)},e.prototype.equal=function(n){return this.throwIfDisposed(),H.equal(this,n)},e.prototype.equalStrict=function(n){return this.throwIfDisposed(),H.equalStrict(this,n)},e.prototype.lessEqual=function(n){return this.throwIfDisposed(),H.lessEqual(this,n)},e.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),H.lessEqualStrict(this,n)},e.prototype.greater=function(n){return this.throwIfDisposed(),H.greater(this,n)},e.prototype.greaterStrict=function(n){return this.throwIfDisposed(),H.greaterStrict(this,n)},e.prototype.greaterEqual=function(n){return this.throwIfDisposed(),H.greaterEqual(this,n)},e.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),H.greaterEqualStrict(this,n)},e.prototype.logicalAnd=function(n){return this.throwIfDisposed(),H.logicalAnd(this,n)},e.prototype.logicalOr=function(n){return this.throwIfDisposed(),H.logicalOr(this,n)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),H.logicalNot(this)},e.prototype.logicalXor=function(n){return this.throwIfDisposed(),H.logicalXor(this,n)},e.prototype.where=function(n,t){return this.throwIfDisposed(),H.where(n,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),H.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),H.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),H.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),H.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),H.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),H.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),H.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),H.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),H.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),H.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),H.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),H.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),H.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),H.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),H.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),H.abs(this)},e.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),H.clipByValue(this,n,t)},e.prototype.relu=function(){return this.throwIfDisposed(),H.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),H.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),H.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),H.selu(this)},e.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),H.leakyRelu(this,n)},e.prototype.prelu=function(n){return this.throwIfDisposed(),H.prelu(this,n)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),H.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),H.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),H.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),H.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),H.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),H.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),H.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),H.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),H.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),H.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),H.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),H.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),H.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),H.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),H.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),H.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),H.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),H.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),H.round(this)},e.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),H.step(this,n)},e.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),H.softmax(this,n)},e.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),H.logSoftmax(this,n)},e.prototype.resizeBilinear=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),H.image.resizeBilinear(this,n,t)},e.prototype.resizeNearestNeighbor=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),H.image.resizeNearestNeighbor(this,n,t)},e.prototype.conv1d=function(n,t,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),H.conv1d(this,n,t,r,o,i,a)},e.prototype.conv2d=function(n,t,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),H.conv2d(this,n,t,r,o,i,a)},e.prototype.conv2dTranspose=function(n,t,r,o,i){return this.throwIfDisposed(),H.conv2dTranspose(this,n,t,r,o,i)},e.prototype.depthwiseConv2D=function(n,t,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),H.depthwiseConv2d(this,n,t,r,o,i,a)},e.prototype.separableConv2d=function(n,t,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),H.separableConv2d(this,n,t,r,o,i,a)},e.prototype.avgPool=function(n,t,r,o){return this.throwIfDisposed(),H.avgPool(this,n,t,r,o)},e.prototype.maxPool=function(n,t,r,o){return this.throwIfDisposed(),H.maxPool(this,n,t,r,o)},e.prototype.localResponseNormalization=function(n,t,r,o){return n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5),H.localResponseNormalization(this,n,t,r,o)},e.prototype.pool=function(n,t,r,o,i){return this.throwIfDisposed(),H.pool(this,n,t,r,o,i)},e.prototype.variable=function(n,t,r){return n===void 0&&(n=!0),this.throwIfDisposed(),Wn().makeVariable(this,n,t,r)},e.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),H.unsortedSegmentSum(this,n,t)},e.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),H.batchToSpaceND(this,n,t)},e.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),H.spaceToBatchND(this,n,t)},e.prototype.topk=function(n,t){return n===void 0&&(n=1),t===void 0&&(t=!0),this.throwIfDisposed(),H.topk(this,n,t)},e.prototype.stridedSlice=function(n,t,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),H.stridedSlice(this,n,t,r,o,i,a,s,u)},e.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),H.depthToSpace(this,n,t)},e.prototype.fft=function(){return this.throwIfDisposed(),H.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),H.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),H.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),H.spectral.irfft(this)},e})();Object.defineProperty(Je,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var Uh,gc,yc,bc,xc,ri=(function(e){function n(t,r,o,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=r,a.name=o,a}return An(n,e),n.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!gt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Wn().disposeTensor(this),this.dataId=t.dataId,Wn().incRef(this,null)},n.prototype.dispose=function(){Wn().disposeVariable(this),this.isDisposedInternal=!0},n})(Je);Object.defineProperty(ri,Symbol.hasInstance,{value:function(e){return e instanceof Je&&e.assign!=null&&e.assign instanceof Function}}),(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(Uh||(Uh={})),(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(gc||(gc={})),(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(yc||(yc={})),(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(bc||(bc={})),(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(xc||(xc={}));var ww={float32:bc,int32:gc,bool:yc,complex64:xc};function _t(e,n){if(e==="string"||n==="string"){if(e==="string"&&n==="string")return"string";throw new Error("Can not upcast "+e+" with "+n)}return ww[e][n]}function vu(e){return _t(e,"int32")}function et(e,n){if(e.dtype===n.dtype)return[e,n];var t=_t(e.dtype,n.dtype);return[e.cast(t),n.cast(t)]}function _w(e,n){k(e.dtype===n.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+n.dtype+") input must match"}))}function Bv(e){var n=[];return(function t(r,o,i){if(r!=null){if(r instanceof Je)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),t(c,o,i))}}}})(e,n,new Set),n}var mu,Hh=(function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},e})(),Cw=(function(){function e(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Hh}return e.prototype.ready=function(){return he(this,void 0,void 0,(function(){var n,t,r;return de(this,(function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),t=0,o.label=1;case 1:return t<n.length?(r=n[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},e.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},e.prototype.registerBackend=function(n,t,r){return r===void 0&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:r},!0)},e.prototype.setBackend=function(n){return he(this,void 0,void 0,(function(){var t,r,o;return de(this,(function(i){switch(i.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new yw(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var n=this;Bh(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(n.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(n){var t=this;Bh(n).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[n])}))},e.prototype.initializeBackend=function(n){var t=this,r=this.registryFactory[n];if(r==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then((function(s){return!(i<t.pendingBackendInitId)&&(t.registry[n]=s,t.pendingBackendInit=null,!0)})).catch((function(s){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return n.registryFactory[r].priority-n.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var r=n[t],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(n,t){var r=this.state.tensorInfo.get(t),o=r.backend,i=this.readSync(t);o.disposeData(t),r.backend=n,n.move(t,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(n,t){var r,o=this,i=null;if(t==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");t=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun((function(){return o.startScope(i)}),(function(){return o.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},e.prototype.scopedRun=function(n,t,r){n();try{var o=r();return t(),o}catch(i){throw t(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),r={x:n};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(o){return{x:function(){return o.toFloat()}}}),[]),t},e.prototype.runKernel=function(n,t,r,o,i){return this.runKernelFunc(null,t,null,n,r,o,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(n,t,r){var o=this.backend.numDataIds(),i=0;r.forEach((function(u){i+=u.dtype==="complex64"?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-t-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},e.prototype.runKernelFunc=function(n,t,r,o,i,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],f=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var h,d=function(b){f&&(l=b.map((function(w){return c.keep(c.clone(w))})))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=Iv(o,this.backendName);return h=g!=null?function(){var b=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:c.backend});var w=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,w);var y=w.map((function(_){var S=_.dataId,I=_.shape,C=_.dtype;return c.makeTensorFromDataId(S,I,C)})),x=y.filter((function(_,S){return s[S]}));return d((a||[]).slice().concat(x)),y}:function(){var b=c.backend.numDataIds();m=c.tidy((function(){return n(c.backend,d)}));var w=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,w),w},this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,t,(function(){return h()})):h()})),f&&this.addTapeNode(o,t,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(b){return t[b].shape})),outputShapes:u.map((function(b){return b.shape}))}),Array.isArray(m)?u:u[0]},e.prototype.makeTensor=function(n,t,r,o){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=n;r==="string"&&sl(n[0])&&(i=n.map((function(l){return mw(l)})));var a=o.write(i,t,r),s=new Je(t,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),c=dw(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},e.prototype.makeTensorFromDataId=function(n,t,r,o){var i=new Je(t,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},e.prototype.makeVariable=function(n,t,r,o){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==n.dtype&&(n=n.asType(o));var i=new ri(n,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(n,t){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(o=n.size*Dv(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof ri||this.track(n)},e.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var t=this.state.registeredVariables[n];this.disposeVariable(t)}},e.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},e.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},e.prototype.profile=function(n){return he(this,void 0,void 0,(function(){var t,r;return de(this,(function(o){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(i){return i.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(n,t,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:r,saved:i},u=iw(n);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(c){return c=c.map((function(l,f){if(l==null){var h=r[f],d=Qi(h.size,h.dtype);return a.makeTensor(d,h.shape,h.dtype)}return l})),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},e.prototype.keep=function(n){return n.kept=!0,n},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(n){for(var t=this,r=Bv(n),o=new Set(r.map((function(u){return u.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(u){u.kept||u.scopeId!==s.id||t.track(u)}))},e.prototype.gradients=function(n,t,r,o){var i=this;if(o===void 0&&(o=!1),k(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",n)}));k(a instanceof Je,(function(){return"The result y returned by f() must be a tensor."}));var s=(function(u,c,l){for(var f={},h={},d=0;d<c.length;d++)f[c[d].id]=!0;for(d=0;d<u.length;d++){var p=(_=u[d]).inputs;for(var v in p){for(var m=p[v],g=!1,b=0;b<c.length;b++)if(f[m.id]){_.outputs.forEach((function(E){return f[E.id]=!0})),g=!0,h[_.id]=!0;break}if(g)break}}var w={};w[l.id]=!0;var y={};for(d=u.length-1;d>=0;d--)for(p=(_=u[d]).inputs,b=0;b<_.outputs.length;b++)if(w[_.outputs[b].id]){for(var v in p)w[p[v].id]=!0,y[_.id]=!0;break}var x=[];for(d=0;d<u.length;d++){var _;if(h[(_=u[d]).id]&&y[_.id]){var S={};for(var v in _.inputs){var I=_.inputs[v];f[I.id]&&(S[v]=I)}var C=Object.assign({},_);C.inputs=S,C.outputs=_.outputs,x.push(C)}}return x})(this.state.activeTape,t,a);if(!o&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var u,c,l={};l[a.id]=r??(u=a.shape,c=Pv(ve(u),"float32"),M.makeTensor(c,u,"float32")),(function(h,d,p){for(var v=function(g){var b=d[g],w=[];if(b.outputs.forEach((function(S){var I=h[S.id];I!=null?w.push(I):w.push(null)})),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var y=b.gradient(w),x=function(S){if(!(S in y))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(y)+".");var I=p((function(){return y[S]()}));if(I.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+I.dtype+"'");var C=b.inputs[S];if(!gt(I.shape,C.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+S+"' has shape '"+I.shape+"', which does not match the shape of the input '"+C.shape+"'");if(h[C.id]==null)h[C.id]=I;else{var E=h[C.id];h[C.id]=E.add(I),E.dispose()}};for(var _ in b.inputs)x(_)},m=d.length-1;m>=0;m--)v(m)})(l,s,(function(h){return i.tidy(h)}));var f=t.map((function(h){return l[h.id]}));return i.state.gradientDepth===0&&(i.state.activeTape.forEach((function(h){for(var d=0,p=h.saved;d<p.length;d++)p[d].dispose()})),i.state.activeTape=null),{value:a,grads:f}}))},e.prototype.customGrad=function(n){var t=this;return k(vc(n),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];k(o.every((function(s){return s instanceof Je})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return o.forEach((function(s,u){a[u]=s})),t.runKernelFunc((function(s,u){return k((r=n.apply(void 0,o.concat([u]))).value instanceof Je,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),k(vc(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),a,(function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];k(l.length===o.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),k(l.every((function(h){return h instanceof Je})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var f={};return l.forEach((function(h,d){f[d]=function(){return h}})),f}))}},e.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},e.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},e.prototype.time=function(n){return he(this,void 0,void 0,(function(){var t,r;return de(this,(function(o){switch(o.label){case 0:return t=Ln(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=Ln()-t,[2,r]}}))}))},e.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Hh,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e})(),M=(function(){var e=(function(){if(mu==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}mu=t}return mu})();if(e._tfengine==null){var n=new rw(e);e._tfengine=new Cw(n)}return(function(t){Sv=t})(e._tfengine.ENV),Wn=function(){return e._tfengine},e._tfengine})();function Lv(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var nr=K();nr.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),nr.registerFlag("IS_BROWSER",(function(){return Lv()})),nr.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),nr.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),nr.registerFlag("PROD",(function(){return!1})),nr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return nr.getBool("DEBUG")})),nr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),nr.registerFlag("IS_TEST",(function(){return!1}));var Ui,nn,en,Qr={},gu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ew(e,n){Qr[e]=n}function $n(e){e in Qr||(Qr[e]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(o){o.preventDefault(),delete Qr[t]}),!1),t===1?r.getContext("webgl",gu)||r.getContext("experimental-webgl",gu):r.getContext("webgl2",gu)})(e));var n=Qr[e];return n.isContextLost()?(delete Qr[e],$n(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Qr[e])}function Is(e,n){return[n,e]}function Ii(e){var n=ve(e);return pc(Math.ceil(n/4))}function Ji(e,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(e/2))]}function ul(e,n){var t,r,o,i,a,s,u,c,l,f=e;return K().getNumber("WEBGL_VERSION")===2?(t=f.R32F,r=f.R16F,o=f.RGBA16F,i=f.RGBA32F,a=f.RED,s=4,u=1,c=f.HALF_FLOAT,l=f.FLOAT):(t=e.RGBA,r=e.RGBA,o=e.RGBA,i=f.RGBA,a=e.RGBA,s=4,u=4,c=n!=null?n.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function ge(e,n,t){var r=t();return n&&(function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+kw(o,i))})(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Ui||(Ui={})),(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(nn||(nn={})),(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(en||(en={}));var Rw=596e-10,Sw=65504;function Iw(e){return!!(K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||Rw<Math.abs(e)&&Math.abs(e)<Sw)}function kw(e,n){switch(n){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function ha(e,n,t){return pr(e,n,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function Aw(e,n,t){var r=pr(e,n,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(ge(e,n,(function(){return e.shaderSource(r,t)})),ge(e,n,(function(){return e.compileShader(r)})),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Tw(e,n,t){var r=pr(e,n,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(ge(e,n,(function(){return e.shaderSource(r,t)})),ge(e,n,(function(){return e.compileShader(r)})),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw(function(o,i){var a=Dw.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),c=u.length.toString().length+2,l=u.map((function(m,g){return jo((g+1).toString(),c)+m})),f=0,h=0;h<l.length;h++)f=Math.max(l[h].length,f);var d=l.slice(0,s-1),p=l.slice(s-1,s),v=l.slice(s);console.log(d.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+jo(p[0],f),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))})(t,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var yu,bu,Dw=/ERROR: [0-9]+:([0-9]+):/g;function Nw(e,n){return pr(e,n,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function Pw(e,n,t){if(ge(e,n,(function(){return e.linkProgram(t)})),e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function xu(e,n,t){if(ge(e,n,(function(){return e.validateProgram(t)})),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Fw(e,n,t){var r=pr(e,n,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return ge(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),ge(e,n,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),r}function Mw(e,n,t){var r=pr(e,n,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return ge(e,n,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),ge(e,n,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),r}function Ow(e,n){return pr(e,n,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function Bw(e,n){var t=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||n<=0){var r="["+e+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>t||n>t)throw r="["+e+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function Lw(e,n){return pr(e,n,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Gh(e,n,t,r,o,i,a,s){var u=e.getAttribLocation(t,r);return u!==-1&&(ge(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,o)})),ge(e,n,(function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)})),ge(e,n,(function(){return e.enableVertexAttribArray(u)})),!0)}function Ww(e,n,t,r){Gw(e,r),ge(e,n,(function(){return e.activeTexture(e.TEXTURE0+r)})),ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function Vw(e,n,t,r){return pr(e,n,(function(){return e.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function zw(e,n,t){return e.getUniformLocation(n,t)}function Uw(e,n,t,r,o,i){ge(e,n,(function(){return Ww(e,n,r,i)})),ge(e,n,(function(){return e.uniform1i(o,i)}))}function wu(e,n,t,r){ge(e,n,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),ge(e,n,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function qh(e,n,t){ge(e,n,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),ge(e,n,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function da(e){var n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Hw(e,n))}function Hw(e,n){switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function pr(e,n,t,r){var o=ge(e,n,(function(){return t()}));if(o==null)throw new Error(r);return o}function Gw(e,n){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+e.TEXTURE0;if(r<e.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function qa(e,n){return n===void 0&&(n=2),ve(e.slice(0,e.length-n))}function ja(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function _u(e){var n=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(n=[qa(e)].concat(ja(e))),n}function qw(e,n){var t;n===void 0&&(n=!1);var r=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,(e=e.map((function(c,l){return l>=e.length-2?Tv(e[l]):e[l]}))).length===1&&(e=[2,e[0]])),e.length!==2){var o=eo(e);e=o.newShape}var i=ve(e);if(e.length<=1&&i<=r)return[1,i];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(n){var a=qa(e),s=2,u=2;return e.length&&(s=(t=ja(e))[0],u=t[1]),pc(i=a*(s/2)*(u/2)).map((function(c){return 2*c}))}return pc(i)}function pa(e){return e%2==0}function va(e,n){if(gt(e=e.slice(-2),n=n.slice(-2))||!e.length||!n.length||e[0]===0||e[1]===0||n[0]===0||n[1]===0)return!0;if(e.length!==n.length){var t=e.slice(-1)[0],r=n.slice(-1)[0];if(t===r||pa(t)&&pa(r)&&(e[0]===1||n[0]===1))return!0}return e[1]===n[1]&&pa(e[0])&&pa(n[0])}function jw(e){if(yu==null){var n=$n(e);yu=n.getParameter(n.MAX_TEXTURE_SIZE)}return yu}function Kw(e){if(bu==null){var n=$n(e);bu=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,bu)}function $w(e){if(e===0)return 0;var n=$n(e);return pn(n,"EXT_disjoint_timer_query_webgl2")&&e===2?2:pn(n,"EXT_disjoint_timer_query")?1:0}function pn(e,n){return e.getExtension(n)!=null}function jh(e){try{if($n(e)!=null)return!0}catch{return!1}return!1}function Xw(e){if(e===0)return!1;var n=$n(e);if(e===1){if(!pn(n,"OES_texture_float"))return!1}else if(!pn(n,"EXT_color_buffer_float"))return!1;return wc(n)}function Yw(e){if(e===0)return!1;var n=$n(e);if(e!==1){if(pn(n,"EXT_color_buffer_float"))return wc(n);if(pn(n,"EXT_color_buffer_half_float")){var t=n.getExtension("EXT_color_buffer_half_float");return(function(r,o){var i=ul(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u})(n,t)}return!1}return!!pn(n,"OES_texture_float")&&!!pn(n,"WEBGL_color_buffer_float")&&wc(n)}function wc(e){var n=ul(e),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(r),o}function Qw(e){return e===2&&$n(e).fenceSync!=null}var Ie=K();function Wv(e){K().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function le(e,n){return M.tidy(e,n)}function Xt(e){Bv(e).forEach((function(n){return n.dispose()}))}function Jw(e){return M.keep(e)}function Ka(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];K().getBool("IS_TEST")||console.warn.apply(console,e)}function Wr(e,n){var t=e;if(Hn(e))return n==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(t)||Hn(t)&&n!=="string";)r.push(t.length),t=t[0];return Array.isArray(e)&&K().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Hn(i))return void k(a.length===0,(function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"}));k(a.length>0,(function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"})),k(i.length===a[0],(function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"}));for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))})(e,r,[]),r}function Kh(e,n,t,r){if(e!=null&&(e!=="numeric"&&e!==n||e==="numeric"&&n==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+e+" tensor, but got "+n+" tensor")}function R(e,n,t,r){if(r===void 0&&(r="numeric"),e instanceof Je)return Kh(r,e.dtype,n,t),e;var o=Yi(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Kh(r,o,n,t),e==null||!Hn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var i=e==null?"null":e.constructor.name;throw new Error("Argument '"+n+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Wr(e,o);Hn(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?Nv(e,o,K().getBool("DEBUG")):ni(e,[],!0);return M.makeTensor(s,a,o)}function $a(e,n,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+n+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(o,i){return R(o,n+"["+i+"]",t)}),r)}function Vv(e,n){for(var t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0}function Zw(e,n,t){for(var r=e.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?o.push(e[i++]):o.push(n[a++]);return o}function kt(e,n){for(var t=[],r=e.length,o=0;o<r;o++)n.indexOf(o)===-1&&t.push(e[o]);return[t,n.map((function(i){return e[i]}))]}function Yt(e,n){return Zw(e,n.map((function(t){return 1})),n)}function Zt(e,n,t){k(Vv(n,t),(function(){return e+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."}))}function Xn(e,n){if(Vv(e,n))return null;for(var t=[],r=0;r<n;++r)e.indexOf(r)===-1&&t.push(r);return e.forEach((function(o){return t.push(o)})),t}function cl(e){return e.map((function(n,t){return[t,n]})).sort((function(n,t){return n[1]-t[1]})).map((function(n){return n[0]}))}function Yn(e,n){for(var t=[],r=n-e;r<n;++r)t.push(r);return t}function e_(e,n){var t=e[0].length;e.forEach((function(o,i){k(o.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"}))})),k(n>=0&&n<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=e[0];e.forEach((function(o,i){for(var a=0;a<t;a++)k(a===n||o[a]===r[a],(function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function oi(e,n){for(var t=e[0].slice(),r=1;r<e.length;r++)t[n]+=e[r][n];return t}function P(e){var n=Object.keys(e);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var t=n[0],r=e[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];M.startScope(t);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),M.endScope(s),s}catch(u){throw M.endScope(null),u}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}Ie.registerFlag("HAS_WEBGL",(function(){return Ie.getNumber("WEBGL_VERSION")>0})),Ie.registerFlag("WEBGL_VERSION",(function(){return jh(2)?2:jh(1)?1:0})),Ie.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Ie.get("WEBGL_VERSION")===2})),Ie.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Ie.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Ie.registerFlag("WEBGL_PACK",(function(){return Ie.getBool("HAS_WEBGL")})),Ie.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_CLIP",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Ie.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_PACK_REDUCE",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_CONV_IM2COL",(function(){return Ie.getBool("WEBGL_PACK")})),Ie.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return jw(Ie.getNumber("WEBGL_VERSION"))})),Ie.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Kw(Ie.getNumber("WEBGL_VERSION"))})),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Ie.getNumber("WEBGL_VERSION");return e===0?0:$w(e)})),Ie.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Ie.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Ie.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Xw(Ie.getNumber("WEBGL_VERSION"))})),Ie.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Ie.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ie.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Ie.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Yw(Ie.getNumber("WEBGL_VERSION"))})),Ie.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Qw(Ie.getNumber("WEBGL_VERSION"))})),Ie.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Ie.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Ov=Wv;var wt=P({complex_:function(e,n){var t=R(e,"real","complex"),r=R(n,"imag","complex");return He(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),M.runKernelFunc((function(o){return o.complex(t,r)}),{$real:t,$imag:r})}}),dn=P({real_:function(e){var n=R(e,"input","real");return M.runKernelFunc((function(t){return t.real(n)}),{$input:n})}}),Vn=P({imag_:function(e){var n=R(e,"input","imag");return M.runKernelFunc((function(t){return t.imag(n)}),{$input:n})}});function Ct(e,n,t){return Vr(e,n,Wr(e,t),t)}function Vr(e,n,t,r){if(r==null&&(r=Yi(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Hn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Fv(n);var o=ve(n),i=ve(t);k(o===i,(function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i}));for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==ve(n.slice(a));k(t[a]===n[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+n+"). "}))}}return Hn(e)||Array.isArray(e)||(e=[e]),n=n||t,e=r!=="string"?Nv(e,r,K().getBool("DEBUG")):ni(e,[],!0),M.makeTensor(e,n,r)}function ae(e,n){if((Hn(e)&&n!=="string"||Array.isArray(e))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Hn(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Vr(e,[],[],n)}function it(e,n){ai(e);var t=Wr(e,n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Vr(e,null,t,n)}function Dr(e,n,t){if(ai(e),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Wr(e,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Vr(e,n,r,t)}function ll(e,n,t){if(ai(e),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Wr(e,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Vr(e,n,r,t)}function jt(e,n,t){if(ai(e),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Wr(e,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Vr(e,n,r,t)}function t_(e,n,t){if(ai(e),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Wr(e,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Vr(e,n,r,t)}function n_(e,n,t){if(ai(e),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Wr(e,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Vr(e,n=n||r,r,t)}function r_(e,n,t,r){return n===void 0&&(n=!0),M.makeVariable(e,n,t,r)}function si(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=si(e,"float32"),r=$e(e,"float32");return wt(t,r)}var o=Pv(ve(e),n);return M.makeTensor(o,e,n)}function $e(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=$e(e,"float32"),r=$e(e,"float32");return wt(t,r)}var o=Qi(ve(e),n);return M.makeTensor(o,e,n)}function qn(e,n,t){return M.runKernelFunc((function(r){return r.fill(e,n,t)}),{})}function o_(e,n,t){if(t<=0)throw new Error("The number of values should be positive.");return M.runKernelFunc((function(r){return r.linspace(e,n,t)}),{})}function Xa(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(e===n||e<n&&t<0||n<e&&t>1)return $e([0],r);var o=Qi(Math.abs(Math.ceil((n-e)/t)),r);n<e&&t===1&&(t=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+t;return it(o,r)}var zv=P({onesLike_:function(e){var n=R(e,"x","onesLike");if(n.dtype==="complex64"){var t=zv(dn(n)),r=Be(Vn(n));return wt(t,r)}return M.runKernelFunc((function(o){return o.onesLike(n)}),{$x:n},(function(o,i){return{$x:function(){return Be(o)}}}))}}),Be=P({zerosLike_:function(e){var n=R(e,"x","zerosLike");return M.runKernelFunc((function(t){return t.zerosLike(n)}),{$x:n},(function(t,r){return{$x:function(){return Be(t)}}}))}}),ct=P({concat_:function(e,n){n===void 0&&(n=0),k(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=$a(e,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")})),n=dt(n,t[0].shape)[0];var r=oi(t.map((function(s){return s.shape})),n);if(ve(r)===0)return Ct([],r);if((t=t.filter((function(s){return s.size>0}))).length===1)return t[0];var o=t.map((function(s){return s.shape}));e_(o,n);var i=t,a={axis:n};return M.runKernelFunc((function(s){return s.concat(t,n)}),i,(function(s){var u=o.map((function(c){return c[n]}));return fl(s,u,n).map((function(c){return function(){return c}}))}),"Concat",a)}}),i_=P({concat1d_:function(e){return ct(e,0)}}),a_=P({concat2d_:function(e,n){return ct(e,n)}}),s_=P({concat3d_:function(e,n){return ct(e,n)}}),u_=P({concat4d_:function(e,n){return ct(e,n)}}),fl=P({split_:function(e,n,t){t===void 0&&(t=0);var r,o=R(e,"x","split");return t=dt(t,o.shape)[0],typeof n=="number"?(k(o.shape[t]%n==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(n).fill(o.shape[t]/n)):(k(o.shape[t]===n.reduce((function(i,a){return i+a})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=n),M.runKernelFunc((function(i){return i.split(o,r,t)}),{$x:o},(function(i){return{$x:function(){return ct(i,t)}}}))}});function po(e,n){return e(n={exports:{}},n.exports),n.exports}var c_=po((function(e){(function(n,t,r){function o(s){var u,c=this,l=(u=4022871197,function(f){f=f.toString();for(var h=0;h<f.length;h++){var d=.02519603282416938*(u+=f.charCodeAt(h));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var f=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=0|f)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,f=c.next;return f.int32=function(){return 4294967296*c.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.alea=a})(0,e)})),l_=po((function(e){(function(n,t,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor128=a})(0,e)})),f_=po((function(e){(function(n,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^f^f<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorwow=a})(0,e)})),h_=po((function(e){(function(n,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.x,h=u.i;return c=f[h],l=(c^=c>>>7)^c<<24,l^=(c=f[h+1&7])^c>>>10,l^=(c=f[h+3&7])^c>>>3,l^=(c=f[h+4&7])^c<<7,c=f[h+7&7],l^=(c^=c<<13)^c<<9,f[h]=l,u.i=h+1&7,l},(function(c,l){var f,h=[];if(l===(0|l))h[0]=l;else for(l=""+l,f=0;f<l.length;++f)h[7&f]=h[7&f]<<15^l.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],c.x=h,c.i=0,f=256;f>0;--f)c.next()})(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorshift7=a})(0,e)})),d_=po((function(e){(function(n,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.w,h=u.X,d=u.i;return u.w=f=f+1640531527|0,l=h[d+34&127],c=h[d=d+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=h[d]=l^c,u.i=d,l+(f^f>>>16)|0},(function(c,l){var f,h,d,p,v,m=[],g=128;for(l===(0|l)?(h=l,l=null):(l+="\0",h=0,g=Math.max(g,l.length)),d=0,p=-32;p<g;++p)l&&(h^=l.charCodeAt((p+32)%l.length)),p===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(v=v+1640531527|0,d=(f=m[127&p]^=h+v)==0?d+1:0);for(d>=128&&(m[127&(l&&l.length||0)]=-1),d=127,p=512;p>0;--p)h=m[d+34&127],f=m[d=d+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,m[d]=h^f;c.w=v,c.X=m,c.i=d})(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor4096=a})(0,e)})),p_=po((function(e){(function(n,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(h===0);return h},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.tychei=a})(0,e)})),Jr=po((function(e){(function(n,t){var r,o=this,i=256,a=6,s="random",u=t.pow(i,a),c=t.pow(2,52),l=2*c,f=i-1;function h(g,b,w){var y=[],x=v((function I(C,E){var N,T=[],B=typeof C;if(E&&B=="object")for(N in C)try{T.push(I(C[N],E-1))}catch{}return T.length?T:B=="string"?C:C+"\0"})((b=b==1?{entropy:!0}:b||{}).entropy?[g,m(n)]:g??(function(){try{var I;return r&&(I=r.randomBytes)?I=I(i):(I=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(I)),m(I)}catch{var C=o.navigator,E=C&&C.plugins;return[+new Date,o,E,o.screen,m(n)]}})(),3),y),_=new d(y),S=function(){for(var I=_.g(a),C=u,E=0;I<c;)I=(I+E)*i,C*=i,E=_.g(1);for(;I>=l;)I/=2,C/=2,E>>>=1;return(I+E)/C};return S.int32=function(){return 0|_.g(4)},S.quick=function(){return _.g(4)/4294967296},S.double=S,v(m(_.S),n),(b.pass||w||function(I,C,E,N){return N&&(N.S&&p(N,_),I.state=function(){return p(_,{})}),E?(t[s]=I,C):I})(S,x,"global"in b?b.global:this==t,b.state)}function d(g){var b,w=g.length,y=this,x=0,_=y.i=y.j=0,S=y.S=[];for(w||(g=[w++]);x<i;)S[x]=x++;for(x=0;x<i;x++)S[x]=S[_=f&_+g[x%w]+(b=S[x])],S[_]=b;(y.g=function(I){for(var C,E=0,N=y.i,T=y.j,B=y.S;I--;)C=B[N=f&N+1],E=E*i+B[f&(B[N]=B[T=f&T+C])+(B[T]=C)];return y.i=N,y.j=T,E})(i)}function p(g,b){return b.i=g.i,b.j=g.j,b.S=g.S.slice(),b}function v(g,b){for(var w,y=g+"",x=0;x<y.length;)b[f&x]=f&(w^=19*b[f&x])+y.charCodeAt(x++);return m(b)}function m(g){return String.fromCharCode.apply(0,g)}if(t["seed"+s]=h,v(t.random(),n),e.exports){e.exports=h;try{r=require("crypto")}catch{}}})([],Math)}));Jr.alea=c_,Jr.xor128=l_,Jr.xorwow=f_,Jr.xorshift7=h_,Jr.xor4096=d_,Jr.tychei=p_;var ks=Jr.alea,hl=(function(){function e(n,t,r,o,i){this.mean=n,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=ks(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},e.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},e.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},e})(),v_=(function(){function e(n,t,r,o){this.alpha=n,this.beta=1/t,this.dtype=r;var i=o||Math.random();this.randu=ks(i.toString()),this.randn=new hl(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var n,t,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,t=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},e})(),m_=(function(){function e(n,t,r,o){var i=this;if(n===void 0&&(n=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=n,this.range=t-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=ks(o)}return e.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e})();function Te(e,n,t){return n===void 0&&(n="float32"),n=n||"float32",Fv(e),new zi(e,n,t)}function g_(e,n){n===void 0&&(n=!1),console.log(e.toString(n))}var Uv=P({batchToSpaceND_:function(e,n,t){var r=R(e,"x","batchToSpaceND"),o=n.reduce((function(i,a){return i*a}));return k(r.rank>=1+n.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length})),k(t.length===n.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length})),k(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o})),M.runKernelFunc((function(i){return i.batchToSpaceND(r,n,t)}),{$x:r},(function(i){return{$x:function(){return i.spaceToBatchND(n,t)}}}))}}),y_=P({broadcastTo_:function(e,n){var t=R(e,"broadcastTo","x"),r=t.shape;if(n.some((function(u){return!(u>0)||u%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<t.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+t.rank+".");if(n.length>t.rank){for(var o=t.shape.slice();o.length<n.length;)o.unshift(1);t=t.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(t.shape[a]===n[a])i[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map((function(u,c){return u>1?c:-1})).filter((function(u){return u>=0}));return s.length===0?t.clone():M.runKernelFunc((function(u){return u.tile(t,i)}),{input:t},(function(u){return{input:function(){return u.sum(s,!0)}}}))}}),b_=P({cast_:function(e,n){var t=R(e,"x","cast");if(!fw(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&t.dtype!=="string"||n!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:n};return M.runKernelFunc((function(o){return o.cast(t,n)}),{x:t},(function(o){return{x:function(){return o.clone()}}}),"Cast",r)}}),x_=P({clone_:function(e){var n=R(e,"x","clone",null);return M.runKernelFunc((function(){return M.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}),{$x:n},(function(t){return{$x:function(){return t.toFloat()}}}))}}),w_=P({cumsum_:function(e,n,t,r){n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var o=R(e,"x","cumsum"),i=Xn([n|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=Yn(1,o.rank)[0],u=M.runKernelFunc((function(c){return c.cumsum(a,s,t,r)}),{permutedX:a},(function(c){return{permutedX:function(){return c.cumsum(n,t,!r)}}}));return i!=null&&(u=u.transpose(i)),u}}),__=P({depthToSpace_:function(e,n,t){t===void 0&&(t="NHWC");var r=R(e,"x","depthToSpace"),o=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return k(o*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+n+`  for depthToSpace with input shape
      `+r.shape})),k(i*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+n+` for depthToSpace with input shape
          `+r.shape})),k(a%(n*n)==0,(function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape})),M.runKernelFunc((function(s){return s.depthToSpace(r,n,t)}),{$x:r})}}),fn=P({expandDims_:function(e,n){n===void 0&&(n=0);var t=R(e,"x","expandDims",null);k(n<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return n<0&&(k(-(t.rank+1)<=n,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),n=t.rank+n+1),r.splice(n,0,1),_n(t,r)}}),Hv=P({eye_:function(e,n,t,r){r===void 0&&(r="float32"),n==null&&(n=e);for(var o=Te([e,n],r),i=e<=n?e:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,n);if(t==null)return s;if(t.length===1)return Ko(fn(s,0),[t[0],1,1]);if(t.length===2)return Ko(fn(fn(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ko(fn(fn(fn(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),C_=P({multinomial_:function(e,n,t,r){r===void 0&&(r=!1);var o=R(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?o.as2D(1,-1):o,u=M.runKernelFunc((function(c){return c.multinomial(s,r,n,t)}),{logits2D:s});return a===1?u.as1D():u}}),_c=P({oneHot_:function(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=R(e,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),M.runKernelFunc((function(a){return a.oneHot(o,n,t,r)}),{$indices:o},(function(a){return{$indices:function(){return $e(o.shape,"float32")}}})).reshape(i)}}),vo=P({pad_:function(e,n,t){t===void 0&&(t=0);var r=R(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:n,constantValue:t};return M.runKernelFunc((function(i){return i.pad(r,n,t)}),{x:r},(function(i){var a=n.map((function(s){return s[0]}));return{x:function(){return i.slice(a,r.shape)}}}),"PadV2",o)}}),E_=P({pad1d_:function(e,n,t){return t===void 0&&(t=0),k(n.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),vo(e,[n],t)}}),R_=P({pad2d_:function(e,n,t){return t===void 0&&(t=0),k(n.length===2&&n[0].length===2&&n[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),vo(e,n,t)}}),S_=P({pad3d_:function(e,n,t){return t===void 0&&(t=0),k(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),vo(e,n,t)}}),I_=P({pad4d_:function(e,n,t){return t===void 0&&(t=0),k(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),vo(e,n,t)}}),k_=P({rand_:function(e,n,t){var r=ve(e),o=null;if(t==null||t==="float32")o=new Float32Array(r);else if(t==="int32")o=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return M.makeTensor(o,e,t)}}),A_=P({randomNormal_:function(e,n,t,r,o){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new hl(n,t,r,!1,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),T_=P({randomGamma_:function(e,n,t,r,o){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new v_(n,t,r,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Gv=P({randomUniform_:function(e,n,t,r,o){n===void 0&&(n=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var i=Te(e,r),a=new m_(n,t,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),_n=P({reshape_:function(e,n){var t=R(e,"x","reshape",null);n=cw(n,t.size),k(t.size===ve(n),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:n};return M.runKernelFunc((function(o){return o.reshape(t,n)}),{x:t},(function(o){return{x:function(){return o.reshape(t.shape)}}}),"Reshape",r)}}),qv=P({spaceToBatchND_:function(e,n,t){var r=R(e,"x","spaceToBatchND");return k(r.rank>=1+n.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length})),k(t.length===n.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length})),k(r.shape.reduce((function(o,i,a){return a>0&&a<=n.length?o&&(i+t[a-1][0]+t[a-1][1])%n[a-1]==0:o}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()})),M.runKernelFunc((function(o){return o.spaceToBatchND(r,n,t)}),{$x:r},(function(o){return{$x:function(){return o.batchToSpaceND(n,t)}}}))}}),jv=P({squeeze_:function(e,n){var t=R(e,"x","squeeze");return _n(t,eo(t.shape,n).newShape)}}),an=P({stack_:function(e,n){n===void 0&&(n=0);var t=$a(e,"tensors","stack");if(k(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(n);var r=t[0].rank,o=t[0].shape,i=t[0].dtype;k(n<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(s){He(o,s.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(s){k(i===s.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var a=t.map((function(s){return s.expandDims(n)}));return ct(a,n)}}),Ko=P({tile_:function(e,n){var t=R(e,"x","tile",null);k(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+n+"."}));var r=[t],o={reps:n};return M.runKernelFunc((function(i,a){var s=i.tile(t,n);return a([t]),s}),{x:t},(function(i,a){var s=a[0];return{x:function(){var u=Be(s);if(s.rank===1)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var f=0;f<n[2];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],f*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(f=0;f<n[2];++f)for(var h=0;h<n[3];++h)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],f*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}}),"Tile",o,r)}}),D_=P({truncatedNormal_:function(e,n,t,r,o){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new hl(n,t,r,!0,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),lt=P({unstack_:function(e,n){n===void 0&&(n=0),n=n||0;var t=R(e,"x","unstack");k(n>=-t.shape.length&&n<t.shape.length,(function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),n<0&&(n+=t.shape.length);var r={axis:n};return M.runKernelFunc((function(o){return o.unstack(t,n)}),{x:t},(function(o){return{x:function(){return an(o,n)}}}),"Unpack",r)}}),N_=function(e,n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f;return de(this,(function(h){switch(h.label){case 0:return t=R(e,"x","setdiff1d"),r=R(n,"y","setdiff1d"),k(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),k(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),k(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return o=h.sent(),[4,r.data()];case 2:for(i=h.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new zi([s],t.dtype),c=new zi([s],"int32"),l=0,f=0;l<o.length;l++)a.has(o[l])||(u.values[f]=o[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}}))}))};function Ya(e,n,t,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(e[0]/t),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([e[a+1]/n[a],n[a]]);o=o.concat(e.slice(i+1))}return o}function Qa(e,n,t){t===void 0&&(t=!0);var r=[];if(t){r.push(n);for(var o=n+1;o<e;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Ja(e,n,t,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/t):o.push(e[0]*t);for(var i=1;i<e.length;++i)i<=n.length?r?o.push(n[i-1]*e[i]):o.push(e[i]/n[i-1]):o.push(e[i]);return o}function Kv(e,n){for(var t=[0],r=0;r<n;++r)t.push(e[r][0]);return t}function $v(e,n,t){for(var r=e.slice(0,1),o=0;o<t;++o)r.push(e[o+1]-n[o][0]-n[o][1]);return r}function Xv(e,n){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var t=n.shape,r=t[t.length-1],o=1,i=0;i<t.length-1;++i)o*=t[i];var a=e.shape,s=t.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var c=Gn(e.shape).map((function(l){return l/u})).concat([1]).slice(0,r);return[s,o,u,c]}var Yv=30;function Cu(e){return e<=Yv?e:mc(e,Math.floor(Math.sqrt(e)))}function P_(e,n,t){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+n.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(t.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(t.rank-o))throw new Error(i+" Output shape length < "+(r+(t.rank-o)));if(t.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(t.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<t.rank-o;++a)if(t.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+t.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function F_(e,n,t){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}P_(t,n,e)}function Za(e,n,t){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=t.length,a=1,s=o;s<i;++s)a*=t[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ve(n.shape)/u,sliceSize:a,strides:Gn(t.slice(0,o)).concat([1]),outputSize:ve(t)}}function M_(e,n,t){k(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+n+" must match the rank of the array ("+e.rank+")."})),k(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+t+" must match the rank of the array ("+e.rank+")."}));for(var r=function(i){k(n[i]+t[i]<=e.shape[i],(function(){return"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+t[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")"}))},o=0;o<e.rank;++o)r(o)}function $h(e){for(var n=[],t=0;e>0;)1&e&&n.push(t),e/=2,t++;return n}function dl(e,n,t){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((n[o]-e[o])/t[o]);return r}function O_(e,n,t,r,o){var i=n[o],a=t[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=dc(0,i,s-1)}function B_(e,n,t,r,o){var i=n[o],a=t[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?dc(0,i,s):dc(-1,i,s-1)}function Qv(e,n,t){for(var r=t.length,o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(o=r+1;o<t.length;o++)if(n[o]>0||t[o]!==e[o])return!1;return!0}function Jv(e,n){for(var t=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)t+=e[r]*n[r];return t}function L_(e,n){k(vc(e),(function(){return"The f passed in variableGrads(f) must be a function"})),k(n==null||Array.isArray(n)&&n.every((function(l){return l instanceof ri})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=n!=null;if(!t)for(var r in n=[],M.registeredVariables)n.push(M.registeredVariables[r]);var o=t?n.filter((function(l){return!l.trainable})):null,i=n.length;k((n=n.filter((function(l){return l.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var a=M.gradients(e,n,null,!0),s=a.value,u=a.grads;k(u.some((function(l){return l!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),k(s.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return n.forEach((function(l,f){u[f]!=null&&(c[l.name]=u[f])})),o?.forEach((function(l){return c[l.name]=null})),{value:s,grads:c}}function As(e){return M.customGrad(e)}var vr=P({softmax_:function(e,n){n===void 0&&(n=-1);var t=R(e,"logits","softmax","float32");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+n);return M.runKernelFunc((function(r,o){var i=r.softmax(t,n);return o([i]),i}),{logits:t},(function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}}),"Softmax",{dim:n},[],[!0])}}),W_=P({logSoftmax_:function(e,n){n===void 0&&(n=-1);var t=R(e,"logits","logSoftmax");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+n);return As((function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}}))(t)}}),Zv=(function(){function e(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},e.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},e.prototype.has=function(n){return this.data.has(n)},e.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},e.prototype.numDataIds=function(){return this.dataIdsCount},e})(),em=(function(){function e(){}return e.prototype.time=function(n){return V("time")},e.prototype.read=function(n){return V("read")},e.prototype.readSync=function(n){return V("readSync")},e.prototype.numDataIds=function(){return V("numDataIds")},e.prototype.disposeData=function(n){return V("disposeData")},e.prototype.write=function(n,t,r){return V("write")},e.prototype.move=function(n,t,r,o){return V("move")},e.prototype.memory=function(){return V("memory")},e.prototype.floatPrecision=function(){return V("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(n,t,r,o){return V("batchMatMul")},e.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,V("fusedBatchMatMul")},e.prototype.slice=function(n,t,r){return V("slice")},e.prototype.stridedSlice=function(n,t,r,o){return V("stridedSlice")},e.prototype.unstack=function(n,t){return V("unstack")},e.prototype.reverse=function(n,t){return V("reverse")},e.prototype.concat=function(n,t){return V("concat")},e.prototype.neg=function(n){return V("neg")},e.prototype.add=function(n,t){return V("add")},e.prototype.addN=function(n){return V("addN")},e.prototype.subtract=function(n,t){return V("subtract")},e.prototype.multiply=function(n,t){return V("multiply")},e.prototype.realDivide=function(n,t){return V("realDivide")},e.prototype.floorDiv=function(n,t){return V("floorDiv")},e.prototype.sum=function(n,t){return V("sum")},e.prototype.prod=function(n,t){return V("prod")},e.prototype.unsortedSegmentSum=function(n,t,r){return V("unsortedSegmentSum")},e.prototype.argMin=function(n,t){return V("argMin")},e.prototype.argMax=function(n,t){return V("argMax")},e.prototype.equal=function(n,t){return V("equal")},e.prototype.notEqual=function(n,t){return V("notEqual")},e.prototype.less=function(n,t){return V("less")},e.prototype.lessEqual=function(n,t){return V("lessEqual")},e.prototype.greater=function(n,t){return V("greater")},e.prototype.greaterEqual=function(n,t){return V("greaterEqual")},e.prototype.logicalNot=function(n){return V("logicalNot")},e.prototype.logicalAnd=function(n,t){return V("logicalAnd")},e.prototype.logicalOr=function(n,t){return V("logicalOr")},e.prototype.where=function(n){return V("where")},e.prototype.select=function(n,t,r){return V("select")},e.prototype.topk=function(n,t,r){return V("topk")},e.prototype.min=function(n,t){return V("min")},e.prototype.minimum=function(n,t){return V("minimum")},e.prototype.mod=function(n,t){return V("mod")},e.prototype.max=function(n,t){return V("max")},e.prototype.maximum=function(n,t){return V("maximum")},e.prototype.all=function(n,t){return V("all")},e.prototype.any=function(n,t){return V("any")},e.prototype.squaredDifference=function(n,t){return V("squaredDifference")},e.prototype.ceil=function(n){return V("ceil")},e.prototype.floor=function(n){return V("floor")},e.prototype.round=function(n){return V("round")},e.prototype.sign=function(n){return V("sign")},e.prototype.isNaN=function(n){return V("isNaN")},e.prototype.isInf=function(n){return V("isInf")},e.prototype.isFinite=function(n){return V("isFinite")},e.prototype.pow=function(n,t){return V("pow")},e.prototype.exp=function(n){return V("exp")},e.prototype.expm1=function(n){return V("expm1")},e.prototype.softmax=function(n,t){return V("softmax")},e.prototype.log=function(n){return V("log")},e.prototype.log1p=function(n){return V("log1p")},e.prototype.sqrt=function(n){return V("sqrt")},e.prototype.rsqrt=function(n){return V("rsqrt")},e.prototype.square=function(n){return V("square")},e.prototype.reciprocal=function(n){return V("reciprocal")},e.prototype.relu=function(n){return V("relu")},e.prototype.relu6=function(n){return V("relu6")},e.prototype.prelu=function(n,t){return V("prelu")},e.prototype.elu=function(n){return V("elu")},e.prototype.eluDer=function(n,t){return V("eluDer")},e.prototype.selu=function(n){return V("selu")},e.prototype.int=function(n){return V("int")},e.prototype.clip=function(n,t,r){return V("clip")},e.prototype.abs=function(n){return V("abs")},e.prototype.complexAbs=function(n){return V("complexAbs")},e.prototype.sigmoid=function(n){return V("sigmoid")},e.prototype.softplus=function(n){return V("softplus")},e.prototype.sin=function(n){return V("sin")},e.prototype.cos=function(n){return V("cos")},e.prototype.tan=function(n){return V("tan")},e.prototype.asin=function(n){return V("asin")},e.prototype.acos=function(n){return V("acos")},e.prototype.atan=function(n){return V("atan")},e.prototype.atan2=function(n,t){return V("atan2")},e.prototype.sinh=function(n){return V("sinh")},e.prototype.cosh=function(n){return V("cosh")},e.prototype.tanh=function(n){return V("tanh")},e.prototype.asinh=function(n){return V("asinh")},e.prototype.acosh=function(n){return V("acosh")},e.prototype.atanh=function(n){return V("atanh")},e.prototype.erf=function(n){return V("erf")},e.prototype.step=function(n,t){return V("step")},e.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,V("fusedConv2d")},e.prototype.conv2d=function(n,t,r){return V("conv2d")},e.prototype.conv2dDerInput=function(n,t,r){return V("conv2dDerInput")},e.prototype.conv2dDerFilter=function(n,t,r){return V("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,V("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(n,t,r){return V("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(n,t,r){return V("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(n,t,r){return V("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(n,t,r){return V("conv3d")},e.prototype.conv3dDerInput=function(n,t,r){return V("conv3dDerInput")},e.prototype.conv3dDerFilter=function(n,t,r){return V("conv3dDerFilter")},e.prototype.maxPool=function(n,t){return V("maxPool")},e.prototype.maxPoolBackprop=function(n,t,r,o){return V("maxPoolBackprop")},e.prototype.avgPool=function(n,t){return V("avgPool")},e.prototype.avgPoolBackprop=function(n,t,r){return V("avgPoolBackprop")},e.prototype.avgPool3d=function(n,t){return V("avgPool3d")},e.prototype.avgPool3dBackprop=function(n,t,r){return V("avgPool3dBackprop")},e.prototype.maxPool3d=function(n,t){return V("maxPool3d")},e.prototype.maxPool3dBackprop=function(n,t,r,o){return V("maxPool3dBackprop")},e.prototype.reshape=function(n,t){return V("reshape")},e.prototype.cast=function(n,t){return V("cast")},e.prototype.tile=function(n,t){return V("tile")},e.prototype.pad=function(n,t,r){return V("pad")},e.prototype.transpose=function(n,t){return V("transpose")},e.prototype.gather=function(n,t,r){return V("gather")},e.prototype.gatherND=function(n,t){return V("gatherND")},e.prototype.scatterND=function(n,t,r){return V("scatterND")},e.prototype.batchToSpaceND=function(n,t,r){return V("batchToSpaceND")},e.prototype.spaceToBatchND=function(n,t,r){return V("spaceToBatchND")},e.prototype.resizeBilinear=function(n,t,r,o){return V("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(n,t,r){return V("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(n,t,r,o){return V("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(n,t,r){return V("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(n,t,r,o,i,a){return V("batchNormalization")},e.prototype.localResponseNormalization4D=function(n,t,r,o,i){return V("localResponseNormalization4D")},e.prototype.LRNGrad=function(n,t,r,o,i,a,s){return V("LRNGrad")},e.prototype.multinomial=function(n,t,r,o){return V("multinomial")},e.prototype.oneHot=function(n,t,r,o){return V("oneHot")},e.prototype.cumsum=function(n,t,r,o){return V("cumsum")},e.prototype.nonMaxSuppression=function(n,t,r,o,i){return V("nonMaxSuppression")},e.prototype.fft=function(n){return V("fft")},e.prototype.ifft=function(n){return V("ifft")},e.prototype.complex=function(n,t){return V("complex")},e.prototype.real=function(n){return V("real")},e.prototype.imag=function(n){return V("imag")},e.prototype.cropAndResize=function(n,t,r,o,i,a){return V("cropAndResize")},e.prototype.depthToSpace=function(n,t,r){return V("depthToSpace")},e.prototype.split=function(n,t,r){return V("split")},e.prototype.sparseToDense=function(n,t,r,o){return V("sparseToDense")},e.prototype.diag=function(n){return V("diag")},e.prototype.fill=function(n,t,r){return V("fill")},e.prototype.onesLike=function(n){return V("onesLike")},e.prototype.zerosLike=function(n){return V("zerosLike")},e.prototype.linspace=function(n,t,r){return V("linspace")},e.prototype.dispose=function(){return V("dispose")},e})();function V(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function kr(e,n){for(var t=e.length,r=[],o=0;o<t;o++){var i=t-1-o,a=e[i]||1;(n[n.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function ft(e,n){for(var t=[],r=0;r<n.length;r++){var o=e[e.length-r-1],i=n.length-r-1,a=n[i];(o==null||o===1&&a>1)&&t.unshift(i)}return t}function Oe(e,n){for(var t=[],r=Math.max(e.length,n.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var a=n[n.length-o-1];if(a==null&&(a=1),i===1)t.unshift(a);else if(a===1)t.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+n+".");t.unshift(i)}}return t}function Hi(e,n,t,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=ns(n),c=u[0],l=u[1];if(a==="channelsLast")s=[c,l,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,l,e[1],e[1]]}return mo(e,s,t,r,o,i,!1,a)}function es(e,n,t,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,c=Cc(n),l=c[0],f=c[1],h=c[2];if(a==="NDHWC")u="channelsLast",s=[l,f,h,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,f,h,e[1],e[1]]}return ts(e,s,t,r,o,!1,u,i)}function mo(e,n,t,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],h=u[3];if(s==="channelsLast")c=e[0],l=e[1],f=e[2],h=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=e[0],h=e[1],l=e[2],f=e[3]}var d,p=n[0],v=n[1],m=n[3],g=ns(t),b=g[0],w=g[1],y=ns(r),x=y[0],_=y[1],S=$o(p,x),I=$o(v,_),C=(function(F,L,q,U,W,X,Q,oe){var ue,me,ke;if(typeof F=="number"){ue={top:F,bottom:F,left:F,right:F,type:F===0?"VALID":"NUMBER"};var Se=(function(ce,A,D,O,G){O==null&&(O=tm(ce,A,D));var j=ce[0],$=ce[1],re=ki((j-A+2*O)/D+1,G);k(rt(re),(function(){return"The output # of rows ("+re+") must be an integer. Change the stride and/or zero pad parameters"}));var te=ki(($-A+2*O)/D+1,G);return k(rt(te),(function(){return"The output # of columns ("+te+") must be an integer. Change the stride and/or zero pad parameters"})),[re,te]})([L,q],X,U,F,oe);me=Se[0],ke=Se[1]}else if(F==="same"){me=Math.ceil(L/U),ke=Math.ceil(q/W);var Ce=Math.max(0,(me-1)*U+X-L),z=Math.max(0,(ke-1)*W+Q-q),ee=Math.floor(Ce/2),Z=Ce-ee,se=Math.floor(z/2);ue={top:ee,bottom:Z,left:se,right:z-se,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);ue={top:0,bottom:0,left:0,right:0,type:"VALID"},me=Math.ceil((L-X+1)/U),ke=Math.ceil((q-Q+1)/W)}return{padInfo:ue,outHeight:me,outWidth:ke}})(o,l,f,b,w,S,I,i),E=C.padInfo,N=C.outHeight,T=C.outWidth,B=a?m*h:m;return s==="channelsFirst"?d=[c,B,N,T]:s==="channelsLast"&&(d=[c,N,T,B]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:h,outHeight:N,outWidth:T,outChannels:B,padInfo:E,strideHeight:b,strideWidth:w,filterHeight:p,filterWidth:v,effectiveFilterHeight:S,effectiveFilterWidth:I,dilationHeight:x,dilationWidth:_,inShape:e,outShape:d,filterShape:n}}function ts(e,n,t,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],h=u[3],d=u[4];if(a==="channelsLast")c=e[0],l=e[1],f=e[2],h=e[3],d=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=e[0],d=e[1],l=e[2],f=e[3],h=e[4]}var p,v=n[0],m=n[1],g=n[2],b=n[4],w=Cc(t),y=w[0],x=w[1],_=w[2],S=Cc(r),I=S[0],C=S[1],E=S[2],N=$o(v,I),T=$o(m,C),B=$o(g,E),F=(function(Q,oe,ue,me,ke,Se,Ce,z,ee,Z,se){var ce,A,D,O;if(typeof Q=="number"){ce={top:Q,bottom:Q,left:Q,right:Q,front:Q,back:Q,type:Q===0?"VALID":"NUMBER"};var G=(function(we,_e,Fe,Le,Pe,pt){Pe==null&&(Pe=tm(we,_e,Le));var St=we[0],sn=we[1],un=we[2],Jn=ki((St-_e+2*Pe)/Le+1,pt);k(rt(Jn),(function(){return"The output # of depths ("+Jn+") must be an integer. Change the stride and/or zero pad parameters"}));var bo=ki((sn-_e+2*Pe)/Le+1,pt);k(rt(bo),(function(){return"The output # of rows ("+bo+") must be an integer. Change the stride and/or zero pad parameters"}));var xt=ki((un-_e+2*Pe)/Le+1,pt);return k(rt(xt),(function(){return"The output # of columns ("+xt+") must be an integer. Change the stride and/or zero pad parameters"})),[Jn,bo,xt,Fe]})([oe,ue,me,1],z,1,ke,Q,se);A=G[0],D=G[1],O=G[2]}else if(Q==="same"){A=Math.ceil(oe/ke),D=Math.ceil(ue/Se),O=Math.ceil(me/Ce);var j=(A-1)*ke+z-oe,$=(D-1)*Se+ee-ue,re=(O-1)*Ce+Z-me,te=Math.floor(j/2),ne=j-te,J=Math.floor($/2),xe=$-J,ie=Math.floor(re/2);ce={top:J,bottom:xe,left:ie,right:re-ie,front:te,back:ne,type:"SAME"}}else{if(Q!=="valid")throw Error("Unknown padding parameter: "+Q);ce={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},A=Math.ceil((oe-z+1)/ke),D=Math.ceil((ue-ee+1)/Se),O=Math.ceil((me-Z+1)/Ce)}return{padInfo:ce,outDepth:A,outHeight:D,outWidth:O}})(o,l,f,h,y,x,_,N,T,B,s),L=F.padInfo,q=F.outDepth,U=F.outHeight,W=F.outWidth,X=i?b*d:b;return a==="channelsFirst"?p=[c,X,q,U,W]:a==="channelsLast"&&(p=[c,q,U,W,X]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:f,inWidth:h,inChannels:d,outDepth:q,outHeight:U,outWidth:W,outChannels:X,padInfo:L,strideDepth:y,strideHeight:x,strideWidth:_,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:N,effectiveFilterHeight:T,effectiveFilterWidth:B,dilationDepth:I,dilationHeight:C,dilationWidth:E,inShape:e,outShape:p,filterShape:n}}function tm(e,n,t,r){r===void 0&&(r=1);var o=$o(n,r);return Math.floor((e[0]*(t-1)-t+o)/2)}function ns(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Cc(e){return typeof e=="number"?[e,e,e]:e}function $o(e,n){return n<=1?e:e+(e-1)*(n-1)}function ki(e,n){if(!n)return e;switch(n){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+n)}}function ii(e){var n=ns(e),t=n[0],r=n[1],o=n[2];return t===1&&r===1&&o===1}function Qt(e,n){return ii(e)||ii(n)}function pl(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function nm(e,n,t){if(n==="complex64"){if(e.dtype==="complex64")return e.clone();var r=$e(e.shape),o=e.toFloat(),i=t.complex(o,r);return r.dispose(),o.dispose(),i}if(!hw(e.dtype,n))return M.makeTensorFromDataId(e.dataId,e.shape,n);if(e.dtype==="complex64"){var a=t.real(e);return i=a.cast(n),a.dispose(),i}if(n==="int32")return t.int(e);if(n==="bool"){var s=ae(0,e.dtype);return i=t.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+n)}function Ec(e,n){return M.makeTensorFromDataId(e.dataId,n,e.dtype)}function rm(e,n,t){var r=(n-e)/(t-1),o=Qi(t,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return it(o,"float32")}function Rc(e,n){if(e.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+n.length+".");for(var t=new Float32Array(2*e.length),r=0;r<t.length;r+=2)t[r]=e[r/2],t[r+1]=n[r/2];return t}function Xh(e,n){return{real:e[2*n],imag:e[2*n+1]}}function V_(e,n,t,r){e[2*r]=n,e[2*r+1]=t}function z_(e,n,t){var r=(t?2:-2)*Math.PI*(e/n);return{real:Math.cos(r),imag:Math.sin(r)}}function U_(e,n,t){var r=(function(i,a,s){return(function(u,c,l){for(var f=0,h=u.length,d=0,p=!1;f<h;){var v=l(c,u[d=f+(h-f>>>1)]);v>0?f=d+1:(h=d,p=!v)}return p?f:-f-1})(i,a,s||H_)})(e,n,t),o=r<0?-(r+1):r;e.splice(o,0,n)}function H_(e,n){return e>n?1:e<n?-1:0}function vl(e,n,t,r,o){return om(e,n,t,r,o,0).selectedIndices}function ml(e,n,t,r,o,i){var a=om(e,n,t,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function om(e,n,t,r,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(n).map((function(y,x){return{score:y,boxIndex:x,suppressBeginIndex:0}})).filter((function(y){return y.score>o})).sort(Yh),c=i>0?-.5/i:0,l=[],f=[];l.length<t&&u.length>0;){var h=u.pop(),d=h.score,p=h.boxIndex,v=h.suppressBeginIndex;if(d<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var b=G_(e,p,l[g]);if(b>=r){m=!0;break}if(h.score=h.score*q_(r,c,b),h.score<=o)break}h.suppressBeginIndex=l.length,m||(h.score===d?(l.push(p),f.push(h.score)):h.score>o&&U_(u,h,Yh))}var w=l.length;return s&&(l.fill(0,w),f.fill(0,w)),{selectedIndices:it(l,"int32"),selectedScores:it(f,"float32"),numValidOutputs:ae(w,"int32")}}function G_(e,n,t){var r=e.subarray(4*n,4*n+4),o=e.subarray(4*t,4*t+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),d=(s-i)*(u-a),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(a,l),g=Math.min(s,f),b=Math.min(u,h),w=Math.max(g-v,0)*Math.max(b-m,0);return w/(d+p-w)}function q_(e,n,t){var r=Math.exp(n*t*t);return t<=e?r:0}function Yh(e,n){return e.score-n.score||e.score===n.score&&n.boxIndex-e.boxIndex}function im(e,n,t){var r=new Array(e.rank).fill(0),o=e.shape.slice();return n.map((function(i){o[t]=i;var a=e.slice(r,o);return r[t]+=i,a}))}function am(e,n){for(var t=new Array(e.rank),r=0;r<t.length;r++)t[r]=e.shape[r]*n[r];var o=Te(t,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function sm(e,n,t,r,o){for(var i=n[n.length-1],a=[e.length/i,i],s=a[0],u=a[1],c=Vi(t,s*r),l=Vi("int32",s*r),f=0;f<s;f++){for(var h=f*u,d=e.subarray(h,h+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort((function(y,x){return x.value-y.value}));var m=f*r,g=c.subarray(m,m+r),b=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,b[v]=p[v].index}var w=n.slice();return w[w.length-1]=r,[Ct(c,w,t),Ct(l,w,"int32")]}function gl(e,n){for(var t=[],r=0;r<n.length;r++)n[r]&&t.push(r);var o=Te(e,"int32"),i=Te([t.length,e.length],"int32");for(r=0;r<t.length;r++){var a=o.indexToLoc(t[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var j_=function(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((function(o,i){return"T"+i}));var t=[];this.variableNames.forEach((function(o){t.push("float v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},K_=function(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((function(o,i){return"T"+i}));var t=[];this.variableNames.forEach((function(o){t.push("vec4 v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},$_=function(e,n,t){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=n==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function um(e,n){return["x","y","z","w","u","v"].slice(0,n).map((function(t){return e+"."+t}))}function Kt(e,n){return n===1?[e]:um(e,n)}function Ft(){var e,n,t,r,o,i,a,s,u,c;return K().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",n="in",t="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",n="attribute",t="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:n,varyingVs:t,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ro(e,n,t){t===void 0&&(t="index");var r=Gn(n);return r.map((function(o,i){return"int "+e[i]+" = "+t+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+t+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"})).join("")}function yl(e){var n=Gn(e).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var cm=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function X_(e,n,t,r){var o=[];e.forEach((function(d){var p=ve(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?o.push("uniform float "+d.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+d.name+";"),o.push("uniform int offset"+d.name+";"))}));var i,a,s=o.join(`
`),u=e.map((function(d){return(function(p,v,m){m===void 0&&(m=!1);var g="";g+=m?lm(p):No(p);var b=p.shapeInfo.logicalShape,w=v.logicalShape;return b.length<=w.length&&(g+=m?(function(y,x){var _,S=y.name,I=S.charAt(0).toUpperCase()+S.slice(1),C="get"+I+"AtOutCoords",E=y.shapeInfo.logicalShape.length,N=x.logicalShape.length,T=kr(y.shapeInfo.logicalShape,x.logicalShape),B=Ke(N),F=N-E,L=["x","y","z","w","u","v"];_=E===0?"":N<2&&T.length>=1?"coords = 0;":T.map((function(ue){return"coords."+L[ue+F]+" = 0;"})).join(`
`);var q="";q=N<2&&E>0?"coords":y.shapeInfo.logicalShape.map((function(ue,me){return"coords."+L[me+F]})).join(", ");var U="return outputValue;",W=ve(y.shapeInfo.logicalShape)===1,X=ve(x.logicalShape)===1;if(E!==1||W||X){if(W&&!X)U=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(T.length){var Q=E-2,oe=E-1;T.indexOf(Q)>-1&&T.indexOf(oe)>-1?U="return vec4(outputValue.x);":T.indexOf(Q)>-1?U="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":T.indexOf(oe)>-1&&(U="return vec4(outputValue.xx, outputValue.zz);")}}else U=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+C+`() {
      `+B+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+I+"("+q+`);
      `+U+`
    }
  `})(p,v):(function(y,x){var _=y.name,S=_.charAt(0).toUpperCase()+_.slice(1),I="get"+S+"AtOutCoords",C=x.texShape,E=y.shapeInfo.texShape,N=y.shapeInfo.logicalShape.length,T=x.logicalShape.length;if(!y.shapeInfo.isUniform&&N===T&&y.shapeInfo.flatOffset==null&&gt(E,C))return`
      float `+I+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var B,F=Ke(T),L=kr(y.shapeInfo.logicalShape,x.logicalShape),q=T-N,U=["x","y","z","w","u","v"];B=N===0?"":T<2&&L.length>=1?"coords = 0;":L.map((function(X){return"coords."+U[X+q]+" = 0;"})).join(`
`);var W="";return W=T<2&&N>0?"coords":y.shapeInfo.logicalShape.map((function(X,Q){return"coords."+U[Q+q]})).join(", "),`
    float `+I+`() {
      `+F+` coords = getOutputCoords();
      `+B+`
      return get`+S+"("+W+`);
    }
  `})(p,v)),g})(d,n,r)})).join(`
`),c=n.texShape,l=Ft(),f=(function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `})(l),h=(function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Y_+`
    `+Q_+`
    `+J_+`
  `})(l);return n.isPacked?(i=(function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `})(0,p);case 2:return(function(y,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(gt(y,x))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var S=Math.ceil(y[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `})(d,p);case 3:return v=d,m=p,g=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],b=Math.ceil(v[2]/2),w=b*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+w+`;
      index -= b * `+w+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(y,x){for(var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],S=Math.ceil(y[y.length-1]/2),I=S*Math.ceil(y[y.length-2]/2),C=I,E="",N="b, r, c",T=2;T<y.length-1;T++)C*=y[y.length-T-1],E=`
      int b`+T+" = index / "+C+`;
      index -= b`+T+" * "+C+`;
    `+E,N="b"+T+", "+N;return`
    ivec`+y.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+E+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+y.length+"("+N+`);
    }
  `})(d,p)}var v,m,g,b,w})(n.logicalShape,c),a=(function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `})(l)):(i=(function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(g,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `})(0,p);case 2:return(function(g,b){return gt(g,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `})(d,p);case 3:return v=p,m=ro(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(g,b){var w=ro(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+w+`
      return ivec4(r, c, d, d2);
    }
  `})(d,p);case 5:return(function(g,b){var w=ro(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+w+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(d,p);case 6:return(function(g,b){var w=ro(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+w+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(d,p);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,m})(n.logicalShape,c),a=(function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `})(l)),r&&(h+=Z_),[h,f,a,s,i,u,t].join(`
`)}function No(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,c=u[0],l=u[1],f=$r(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+f+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(e);case 1:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Ro(t)+`
      }
    `;var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=$r(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(e);case 2:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=t.shapeInfo.texShape;if(a!=null&&gt(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var c=eo(r),l=c.newShape,f=c.keptDims,h=l;if(h.length<r.length){var d=Po(t,h);return`
      `+No(d)+`
      float `+i+`(int row, int col) {
        return `+i+"("+Fo(["row","col"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ro(t)+`
      }
    `;var p=a[0],v=a[1],m=$r(o);return v===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+o+`, uv);
  }
`})(e);case 3:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=eo(r),c=u.newShape,l=u.keptDims,f=c;if(f.length<r.length){var h=Po(t,f);return`
        `+No(h)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+Fo(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Ro(t)+`
      }
    `;var d=t.shapeInfo.texShape,p=d[0],v=d[1],m=t.shapeInfo.flatOffset;if(v===a&&m==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(v===s&&m==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var g=$r(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `})(e);case 4:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=eo(r),l=c.newShape,f=c.keptDims;if(l.length<r.length){var h=Po(t,l);return`
      `+No(h)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+Fo(["row","col","depth","depth2"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Ro(t)+`
      }
    `;var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],m=p[1];if(m===u&&d==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===a&&d==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=$r(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+g+`);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);case 5:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=eo(r),f=l.newShape,h=l.keptDims;if(f.length<r.length){var d=Po(t,f);return`
      `+No(d)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+Fo(["row","col","depth","depth2","depth3"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Ro(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],g=v[1];if(g===c&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=$r(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);case 6:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=eo(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var c=Po(t,s);return`
      `+No(c)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+Fo(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=r[5],f=r[4]*l,h=r[3]*f,d=r[2]*h,p=r[1]*d;if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+h+", "+f+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Ro(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],b=m[1];if(b===p&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+h+", "+f+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===l&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var w=$r(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+d+" + depth * "+h+` +
          depth2 * `+f+" + depth3 * "+l+" + depth4 + "+w+`;
      vec2 uv = uvFromFlat(`+g+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function lm(e){var n,t,r;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Ft(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return(function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Ft();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+i+`, uv);
    }
  `})(e);case 2:return(function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],f=Ft();if(u!=null&&gt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+f.texture2D+"("+a+`, uv);
      }
    `;var h=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+h[0]+", "+h[1]+`, row, col);
      return `+f.texture2D+"("+a+`, uv);
    }
  `})(e);case 3:return(function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var l=i.slice(1),f=Po(o,l);return`
        `+lm(f)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+Fo(["b","row","col"],[1,2])+`);
        }
      `}var h=c[0],d=c[1],p=Math.ceil(i[2]/2),v=p*Math.ceil(i[1]/2),m=Ft();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+d+", "+v+", "+p+`, b, row, col);
      return `+m.texture2D+"("+a+`, uv);
    }
  `})(e);default:return(function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],f=l[0],h=l[1],d=Math.ceil(i[a-1]/2),p=d*Math.ceil(i[a-2]/2),v="int b, int row, int col",m="b * "+p+" + (row / 2) * "+d+" + (col / 2)",g=2;g<a-1;g++)v="int b"+g+", "+v,p*=i[a-g-1],m="b"+g+" * "+p+" + "+m;var b=Ft();return`
    vec4 `+u+"("+v+`) {
      int index = `+m+`;
      int texR = index / `+h+`;
      int texC = index - texR * `+h+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+h+", "+f+`);
      return `+b.texture2D+"("+s+`, uv);
    }
  `})(e)}}var Y_=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Q_=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,J_=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Z_=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function $r(e){return"offset"+e}function Ro(e){var n=e.name,t=ve(e.shapeInfo.logicalShape);return t<2?"return "+n+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function Ke(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Po(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function Fo(e,n){return n.map((function(t){return e[t]})).join(", ")}var e2=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k(e.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var o=e[e.length-1],i=Math.ceil(o/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Ke(c),f=Kt("coords",c);if(i===1){var h=Ke(s=c+1);a=`
        `+h+" sourceLocR = "+h+"("+f.join()+`, 0);
        ++`+f[c-1]+`;
        `+h+" sourceLocG = "+h+"("+f.join()+`, 0);
        ++`+f[c-2]+`;
        `+h+" sourceLocA = "+h+"("+f.join()+`, 0);
        --`+f[c-1]+`;
        `+h+" sourceLocB = "+h+"("+f.join()+`, 0);
        --`+f[c-2]+";"}else s=c,a=`
        `+l+` sourceLocR = coords;
        ++`+f[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+f[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+f[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+f[c-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),p="."+d[s-1],v=d.map((function(I){return"int "+I})),m=Kt("sourceLocR",s-1).concat("inIdx.r"),g=Kt("sourceLocG",s-1).concat("inIdx.g"),b=Kt("sourceLocB",s-1).concat("inIdx.b"),w=Kt("sourceLocA",s-1).concat("inIdx.a"),y=t==="max"?"greaterThan":"lessThan",x=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",_=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",S=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+f[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+f[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+x+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+y+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},t2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(n*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+f+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},n2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=l-1-e.padInfo.front,p=f-1-e.padInfo.top,v=h-1-e.padInfo.left,m=1/(n*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+f+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},r2=function(e,n,t,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Oe(e,n),Oe(e,t);var a="0.0";r!=null&&(Oe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Oe(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},o2=function(e,n,t,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Oe(e,n),Oe(e,t);var a="vec4(0.0)";r!=null&&(Oe(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Oe(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},i2="return areal * breal - aimag * bimag;",a2="return areal * bimag + aimag * breal;",Qh=function(e,n,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Oe(n,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Eu="return a + b;",Ru="return a - b;",Jh="return a * b;",fm="return (a < 0.) ? b * a : a;",tt=function(e,n,t){this.variableNames=["A","B"],this.outputShape=Oe(n,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},hm=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,rr=function(e,n,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Oe(n,t);var o=this.outputShape.length,i="";if(r)if(o===0||ve(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Ke(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Kt("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},s2=(function(){function e(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,t)}},e})(),u2=(function(){function e(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,t)}},e})(),c2=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},l2=function(e){this.outputShape=[],this.outputShape=oi(e,1),this.variableNames=e.map((function(s,u){return"T"+u}));var n=new Array(e.length-1);n[0]=e[0][1];for(var t=1;t<n.length;t++)n[t]=n[t-1]+e[t][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<n.length;t++){var o=n[t-1];r.push("else if (yC < "+n[t]+") setOutput(getT"+t+"(yR, yC-"+o+"));")}var i=n.length,a=n[n.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},f2=function(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=oi(e,n);var t=this.outputShape,r=t.length,o=Ke(r),i=Kt("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(m,g){return"T"+g}));var s=new Array(e.length-1);s[0]=e[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][n];var c=a[n],l=a.slice(-2),f=a.join(),h="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+f+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var d=s[u-1];h+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+ma(a,c,d)+`),
            vec2(`+ma(l,c,d)+`));
        }`}var p=s.length,v=s[s.length-1];h+=`
        return getChannel(
          getT`+p+"("+ma(a,c,v)+`),
          vec2(`+ma(l,c,v)+"));",this.userCode=`
      float getValue(`+a.map((function(m){return"int "+m}))+`) {
        `+h+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+t[r-2]+` &&
            `+i[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function ma(e,n,t){var r=e.indexOf(n);return e.map((function(o,i){return i===r?o+" - "+t:o})).join()}var h2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},d2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,s=t-1-e.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},p2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},v2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=n-1-e.padInfo.front,u=t-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},m2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},g2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=n-1-e.padInfo.top,a=t-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Zh=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),d=e.inChannels%4,p=e.dataFormat==="channelsLast",v=p?1:2,m=p?2:3,g=p?3:1,b="",w="";t&&(b=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,w="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+h+`) *
                    getW(wR, wC, `+h+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+h+`, xR, xC) *
                    getW(wR, wC, `+h+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1),
                  getX(batch, xR, xC, `+h+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC),
                  getX(batch, `+h+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+y+`
        `+w+`
        setOutput(result);
      }
    `},y2=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var n=e.padInfo.front,t=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+n+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},ed=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=e.outChannels/e.inChannels,v="",m="";t&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,m="result = activation(result);");var g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+m+`
        setOutput(result);
      }
    `},td=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<h;m++)for(var g=0;g<d;g++)v+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<h;m++)for(var b=0;b<p;b++){if(v+=`
          xR = xRCorner + `+m*l+`;
          xC = xCCorner + `+(g=2*b)*f+`;
        `,c===1){if(g<d&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+m+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<d)){var w=s%2==0?Tv(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+w+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,f>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+w+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<d&&(v+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<d&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<d&&(v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),v+="}");g<d&&(v+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<d&&(v+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<h;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var y="",x="";t&&(y=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,x="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+_+`
        `+x+`
        setOutput(result);
      }
    `},b2=function(e,n,t,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],c=n[0],l=t[0],f=t[1];this.outputShape=[c,l,f,u];var h=r==="bilinear"?1:0,d=[a-1+".0",s-1+".0"],p=d[0],v=d[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],b=m[1],w=m[2],y=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],x=y[0],_=y[1],S=y[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+x+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+_+`;

        float in_y = `+w+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+h+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},x2=function(e,n,t){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ke(r)+` coords = getOutputCoords();
        int end = `+nd(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+nd(r,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function nd(e,n){if(e===1)return""+n;if(e===2)return n+".y";if(e===3)return n+".z";if(e===4)return n+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var w2=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ui.DENSE;var n=Ii(e),t=Ft();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ro(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},_2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ui.DENSE;var n=Ii(e),t=Ft();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ro(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},C2=(function(){function e(n,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e})(),E2=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},R2=function(e){this.variableNames=["A"],this.outTexUsage=nn.DOWNLOAD;var n=Ft();this.outputShape=e,this.userCode=`
      `+cm+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},S2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=nn.DOWNLOAD;var n=Ft();this.outputShape=e,this.userCode=`
      `+cm+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},I2=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Ft(),o=n[0],i=n[1];this.outputShape=e;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+yl(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},k2=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ft(),o=n[0],i=n[1];this.outputShape=e;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+e[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+yl(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},A2="return real * expR - imag * expI;",T2="return real * expI + imag * expR;",rd=function(e,n,t){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},D2=(function(){function e(n,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,o){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(t.valueLoc,n)}},e})(),N2=function(e,n,t){this.variableNames=["A","indices"];var r=e.slice();r[t]=n,this.outputShape=r,this.rank=r.length;var o=Ke(this.rank),i=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],f=0;f<a.length;f++)f===s?l.push("int(getIndices("+c[f]+"))"):l.push(""+c[f]);return l.join()})(e,t);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},P2=function(e,n,t){this.sliceDim=e,this.strides=n,this.variableNames=["x","indices"],this.outputShape=t;var r=Ke(n.length),o=Ke(t.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function F2(e,n){var t=Ft();return Aw(e,n,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function M2(e,n){return Fw(e,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function O2(e,n){return Mw(e,n,new Uint16Array([0,1,2,2,1,3]))}function Zi(e,n,t,r,o,i,a){Bw(t,r);var s=Ow(e,n),u=e.TEXTURE_2D;return ge(e,n,(function(){return e.bindTexture(u,s)})),ge(e,n,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),ge(e,n,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),ge(e,n,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),ge(e,n,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),ge(e,n,(function(){return e.texImage2D(u,0,o,t,r,0,i,a,null)})),ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function B2(e,n,t,r,o){var i=Is(t,r);return Zi(e,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function L2(e,n,t,r,o){var i=Is(t,r);return Zi(e,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function W2(e,n,t,r,o){var i=Is(t,r);return Zi(e,n,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function V2(e,n,t,r,o){var i=Ji(t,r);return Zi(e,n,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function z2(e,n,t,r,o){var i=Ji(t,r);return Zi(e,n,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function U2(e,n,t,r){return ge(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Gh(e,n,t,"clipSpacePos",r,3,20,0)&&Gh(e,n,t,"uv",r,2,20,12)}function H2(e,n,t,r,o,i,a){var s,u,c;ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,c=a.internalFormatPackedFloat),s.set(i),ge(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,o,0,e.RGBA,u,s)})),ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function G2(e,n,t,r){ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),r.data instanceof Uint8Array?ge(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):ge(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),ge(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function q2(e,n,t,r,o){var i=e.createBuffer();ge(e,n,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)}));var a=16*t*r;return ge(e,n,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)})),ge(e,n,(function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,0)})),ge(e,n,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),i}function j2(e,n,t){var r=e,o=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function K2(e,n,t,r,o){var i=Is(t,r),a=i[0],s=i[1],u=new Uint8Array(t*r*4);return ge(e,n,(function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function $2(e,n,t,r,o,i,a,s){var u=e,c=new Float32Array((function(l,f){var h=Ji(l,f);return h[0]*h[1]*4})(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function X2(e,n,t,r){var o=new Float32Array(t*r*4);return ge(e,n,(function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,o)})),o}var Y2=(function(){function e(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=K().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,Ew(t,n)):this.gl=$n(t);var r="WEBGL_color_buffer_float";if(K().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=ha(this.gl,this.debug,"OES_texture_float"),pn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ha(this.gl,this.debug,"OES_texture_half_float");else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),pn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ha(this.gl,this.debug,"EXT_color_buffer_half_float");else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",pn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!pn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=M2(this.gl,this.debug),this.indexBuffer=O2(this.gl,this.debug),this.framebuffer=Lw(this.gl,this.debug),this.textureConfig=ul(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return K().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ge(t,this.debug,(function(){return t.finish()})),ge(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),ge(t,this.debug,(function(){return t.deleteFramebuffer(n.framebuffer)})),ge(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),ge(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),ge(t,this.debug,(function(){return t.deleteBuffer(n.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),B2(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),L2(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),W2(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),G2(this.gl,this.debug,n,t)},e.prototype.uploadDenseMatrixToTexture=function(n,t,r,o){this.throwIfDisposed(),H2(this.gl,this.debug,n,t,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),z2(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),V2(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(qh(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ge(this.gl,this.debug,(function(){return t.gl.deleteTexture(n)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,r){var o=this;return this.downloadMatrixDriver(n,(function(){return K2(o.gl,o.debug,t,r,o.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(n,t,r,o,i,a){return $2(this.gl,n,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return j2(this.gl,n,t)},e.prototype.createBufferFromTexture=function(n,t,r){this.bindTextureToFrameBuffer(n);var o=q2(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},e.prototype.createFence=function(n){var t,r,o=this;if(K().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},t=a}else K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(n,t,r){var o=this;return this.downloadMatrixDriver(n,(function(){return X2(o.gl,o.debug,t,r)}))},e.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,r=Tw(t,this.debug,n),o=F2(t,this.debug),i=Nw(t,this.debug);return ge(t,this.debug,(function(){return t.attachShader(i,o)})),ge(t,this.debug,(function(){return t.attachShader(i,r)})),Pw(t,this.debug,i),this.debug&&xu(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=U2(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&ge(this.gl,this.debug,(function(){return t.gl.deleteProgram(n)}))},e.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&xu(this.gl,this.debug,this.program),ge(this.gl,this.debug,(function(){return t.gl.useProgram(n)}))},e.prototype.getUniformLocation=function(n,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Vw(this.gl,this.debug,n,t):zw(this.gl,n,t)},e.prototype.getAttributeLocation=function(n,t){var r=this;return this.throwIfDisposed(),ge(this.gl,this.debug,(function(){return r.gl.getAttribLocation(n,t)}))},e.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},e.prototype.setInputMatrixTexture=function(n,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),Uw(this.gl,this.debug,this.program,n,t,r)},e.prototype.setOutputMatrixTexture=function(n,t,r){this.setOutputMatrixTextureDriver(n,r,t)},e.prototype.setOutputPackedMatrixTexture=function(n,t,r){this.throwIfDisposed();var o=Ji(t,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(n,i,a)},e.prototype.setOutputMatrixWriteRegion=function(n,t,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(n,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&xu(this.gl,this.debug,this.program),da(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),ge(n,this.debug,(function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),ge(this.gl,this.debug,(function(){return n.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ha(this.gl,this.debug,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(n){return he(this,void 0,void 0,(function(){var t=this;return de(this,(function(r){switch(r.label){case 0:return[4,Lh((function(){return t.disposed||t.isQueryAvailable(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(n,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(n,t){if(t===0)return!0;if(t===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(n){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return n.isFencePassed()}),(function(){return r()}))}))},e.prototype.pollItems=function(){for(var n=(function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},e.prototype.addItemToPoll=function(n,t){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||Lh((function(){return r.pollItems(),r.itemsToPoll.length===0}))},e.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),wu(this.gl,this.debug,n,this.framebuffer),this.debug&&da(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wu(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&da(this.gl)):qh(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var r=t();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(n,t,r){this.throwIfDisposed();var o=this.gl;wu(o,this.debug,n,this.framebuffer),this.debug&&da(o),this.outputTexture=n,ge(o,this.debug,(function(){return o.viewport(0,0,t,r)})),ge(o,this.debug,(function(){return o.scissor(0,0,t,r)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(n,t,r,o){var i=this;this.throwIfDisposed(),ge(this.gl,this.debug,(function(){return i.gl.scissor(n,t,r,o)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e})();function od(e,n){if(e.length!==n.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+n.length+" inputs");e.forEach((function(t,r){var o=t.logicalShape,i=n[r],a=i.shape;if(!gt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!t.isUniform||!i.isUniform){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!gt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}}))}var Q2=function(e,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=t.filterWidth,o=t.inChannels,i=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,f=t.dataFormat,h=s.left,d=s.top,p=o*r,v=Ft(),m=f==="channelsLast",g=m?0:1,b=m?1:2,w="",y=0;y<=1;y++)for(var x=0;x<=1;x++)w+=`
          blockIndex = rc.y + `+x+`;
          pos = rc.x + `+y+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+d+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+n[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+h+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+n[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*y+x)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*y+x)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+w+`

        `+v.output+` = result;
      }
    `},J2=function(e,n,t,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=n,s=e[3]-1;this.outputShape=e;var u="float("+t+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},Z2=function(e,n,t,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=t,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},eC=function(e,n,t,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=n,s=e[3]-1;this.outputShape=e;var u="float("+t+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},tC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideHeight,t=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},nC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,h=c-1-e.padInfo.left,d=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+f+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Su=function(e,n,t,r,o,i,a){t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=t?e[1]:e[2],u=Math.ceil(s/2),c=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";i&&(d=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+f[0]+" * "+h[0]+`);
          result += (`+f[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},rC=(function(){function e(n,t,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,o){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(t.seedLoc,n)}},e})(),oC=function(e,n,t,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},iC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var n=e.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Kt("rc",n),r=Ke(n),o=(function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",f=s-2;f<s;f++)l+=c[f]+" >= "+u[f],f<s-1&&(l+="||");return l})(n,e,t),i=(function(s,u,c,l){if(s===1)return"";var f=l.slice(-2);return`
    int r = `+f[0]+`;
    int c = `+f[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `})(n,e[e.length-1],e[e.length-2],t),a=(function(s,u){var c=s.length,l=(function(f,h){for(var d=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var m=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<f;g++)m=h[h.length-1-g]+","+m;d.push(m)}return d})(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"})(e,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},aC=function(e,n,t){this.variableNames=["x"],this.outputShape=n.map((function(u,c){return u[0]+e[c]+u[1]}));var r=e.length,o=Ke(r),i=n.map((function(u){return u[0]})).join(","),a=n.map((function(u,c){return u[0]+e[c]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},sC=function(e,n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(m,g){return m[0]+e[g]+m[1]}));for(var r=e.length,o=Ke(r),i=n.map((function(m){return m[0]})).join(","),a=n.map((function(m,g){return m[0]+e[g]})).join(","),s=Kt("rc",r),u=Kt("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=r===1?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+c+") {"],h=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=r===1?2:4;p<v;p++)d+=`
        `+f[p]+`
        if (`+h+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},Iu=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var h=n==="avg",d="0.0";if(h||(d="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+l+", "+f+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g=`
      if (`+h+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+l+", "+f+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+p+`);
      }
    `}},ku=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var m=n==="avg",g="0.0";if(m||(g="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+f+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+h+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+f+" * "+h+` +
                      wR * `+h+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(b="avgValue / count");var w=4*Math.floor(r/4),y=r%4,x=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+w+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+x+`
            }

            int xC = xCCorner + `+w+`;
            if (`+(y===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(y===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(y===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+x+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},uC=function(e,n){this.variableNames=["x"];var t=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/t);this.outputShape=[r,i];var a="0.0",s="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",s="min"):n==="max"&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,f=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,h="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");var d="";o%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+f+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(l===2)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(l===3)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+f+`
        }
        setOutput(`+u+`);
      }
    `},cC=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var t="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),t+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+ro(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+yl(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+t+`

        setOutput(result);
      }
    `},lC=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},fC=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},hC=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},dC=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],h=c[1]/l[1],d=1/f,p=1/h,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},pC=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t],l=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},vC=function(e,n){this.variableNames=["x"];var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=e,t!==1){var r=e.map((function(i,a){return(function(s){return n.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)})).join(","),o=Ke(t);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},mC=function(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=e;var r=Kt("rc",t),o=r[t-1]+" + 1 < "+this.outputShape[t-1],i=r[t-2]+" + 1 < "+this.outputShape[t-2],a=Ke(t);function s(u){var c=e.map((function(l,f){return(function(h,d){return n.indexOf(h)!==-1&&e[h]!==1?e[h]+" - "+d[h]+" - 1":""+d[h]})(f,u)}));return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(r.slice())+`;
          if(`+o+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            if(`+o+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},id=function(e,n,t,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Ke(o.length),u=Ke(i.length),c="";t===1?c="i":t===2&&(c="i, j");var l="getIndices("+c+")",f="";r===1?f="i":r===2&&(f="i, coords[1]");var h="getUpdates("+f+")",d=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+h+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},gC=function(e,n){this.variableNames=["x","segmentIds"];var t=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";o%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var f="";o%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+f+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},yC=function(e,n,t){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Ke(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},bC=(function(){function e(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,r=Ke(this.rank),o="uniform int start["+this.rank+"];",i=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Au.slice(0,a).map((function(s){return"sourceLoc."+s})).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+n.map((function(a,s){return"sourceLoc."+Au[s]+" = start["+s+"] + coords."+Au[s]+";"})).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+t+`
        setOutput(getSource(`+i+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e})(),Au=["x","y","z","w","u","v"],xC=(function(){function e(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=Ke(this.rank),r=Kt("coords",this.rank),o=Kt("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+n.map((function(l,f){return"start["+f+"]"})).join()+");":n.map((function(l,f){return o[f]+" = "+r[f]+" + start["+f+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e})(),wC=function(e,n,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=Ke(t.length),i=Ke(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map((function(u,c){return s++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"})).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+n+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},_C=(function(){function e(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(n,t,r){var o,i=ad(t,r),a=sd(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===en.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===en.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===en.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===en.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===en.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},e.prototype.releaseTexture=function(n,t,r,o){if(this.freeTextures!=null){var i=sd(t,ad(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){n.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(o){n.gpgpu.deleteMatrixTexture(o)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e})();function ad(e,n){if(e===nn.UPLOAD)return en.PACKED_2X2_FLOAT32;if(e===nn.RENDER||e==null)return(function(t){return K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?en.PACKED_2X2_FLOAT32:en.UNPACKED_FLOAT32:t?en.PACKED_2X2_FLOAT16:en.UNPACKED_FLOAT16})(n);if(e===nn.DOWNLOAD||e===nn.PIXELS)return en.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function sd(e,n,t){return e[0]+"_"+e[1]+"_"+n+"_"+t}var CC=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[r]*n[r];this.outputShape=t,this.rank=t.length;var o=Ke(this.rank),i=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()})(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},EC=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];this.outputShape=t,this.rank=t.length;var o=Ke(this.rank),i=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()})(n);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},RC=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Ke(this.rank),i=um("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},bl=1.7580993408473768,xl=1.0507009873554805,Ne=function(e,n){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Tn="if (isnan(x)) return x;",SC="return x;",ud="return abs(x);",dm=Tn+`
  return (x < 0.0) ? 0.0 : x;
`,pm=Tn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,vm="return (x >= 0.0) ? x : (exp(x) - 1.0);",IC=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+bl+`;
  float scale = `+xl+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,cd="return -x;",ld="return ceil(x);",fd="return floor(x);",hd="return exp(x);",dd="return exp(x) - 1.0;",kC=Tn+`
  return sin(x);
`,AC=Tn+`
  return cos(x);
`,TC=Tn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,DC=Tn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,NC=Tn+`
  return atan(x);
`,PC=Tn+"return log(x + sqrt(x * x + 1.0));",FC=Tn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,MC=Tn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ga="return x;",OC="return x;",mm=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,gm=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ym=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,vi=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},BC=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var n=e.length,t=Kt("rc",n),r=Ke(n),o=(function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c})(n,t),i=t.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},ya={};function ba(e,n){if(n===void 0&&(n=!1),e==="linear")return n?OC:SC;if(e==="relu")return n?mm:dm;if(e==="elu")return n?ym:vm;if(e==="relu6")return n?gm:pm;if(e==="prelu")return n?hm:fm;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var LC=600,WC=(function(e){function n(t){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!K().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var i=$n(K().getNumber("WEBGL_VERSION"));o.binaryCache=((r=K().getNumber("WEBGL_VERSION"))in ya||(ya[r]={}),ya[r]),o.gpgpu=new Y2(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=t,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=t.gl.canvas;return o.textureManager=new _C(o.gpgpu),o.numMBBeforeWarning=K().global.screen==null?1024:K().global.screen.height*K().global.screen.width*window.devicePixelRatio*LC/1024/1024,o.texData=new Zv(o,M),o}return An(n,e),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(t,r,o){if(K().getBool("DEBUG")&&this.checkNumericalProblems(t),o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:t,usage:nn.UPLOAD}),i},n.prototype.move=function(t,r,o,i){if(K().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:i,values:r,usage:nn.UPLOAD})},n.prototype.readSync=function(t){var r=this.texData.get(t),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;l=c?new vi(u,ga):new Ne(u,ga);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeData(f.dataId),h}if(o!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return o;var d,p,v=this.activeTimers!=null;return v&&(d=Ln()),i==="complex64"?p=Rc(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(t),v&&(this.downloadWaitMs+=Ln()-d),this.convertAndCacheOnCPU(t,p)},n.prototype.read=function(t){return he(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,b,w,y,x,_,S,I;return de(this,(function(C){switch(C.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(E){return r.push(E)}))];if(o=this.texData.get(t),i=o.values,a=o.shape,s=o.slice,u=o.dtype,c=o.complexTensors,l=o.isPacked,s!=null)return f=void 0,f=l?new vi(a,ga):new Ne(a,ga),h=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:u}],u),d=this.read(h.dataId),this.disposeData(h.dataId),[2,d];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(!K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&K().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&K().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(I=this.gpgpu).createBufferFromTexture.apply(I,[m.texture].concat(Ii(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=C.sent(),w=b[0],y=b[1],g=Rc(w,y),[3,5];case 4:p==null?g=this.getValuesFromTexture(t):(x=ve(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),C.label=5;case 5:return v!=null&&this.disposeData(v.dataId),_=this.convertAndCacheOnCPU(t,g),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach((function(E){return E(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}}))}))},n.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var o=t[r];if(!Iw(o))throw K().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.isPacked,u=ve(i);if(K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(Ii(i))).subarray(0,u);return this.disposeData(c.dataId),f}var h=K().getBool("WEBGL_PACK")&&s===!0,d=h?_u(i):i,p=h?new S2(d):new R2(d),v=this.runWebGLProgram(p,[{shape:d,dtype:a,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),g},n.prototype.time=function(t){return he(this,void 0,void 0,(function(){var r,o,i,a,s,u,c;return de(this,(function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,t(),a=ni(this.activeTimers.map((function(f){return f.query}))).filter((function(f){return f!=null})),s=ni(this.activeTimers.map((function(f){return f.name}))).filter((function(f){return f!=null})),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=sw(c),u.getExtraProfileInfo=function(){return c.map((function(f,h){return{name:s[h],ms:f}})).map((function(f){return f.name+": "+f.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ln(),endMs:null}},n.prototype.endTimer=function(t){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ln(),t)},n.prototype.getQueryTime=function(t){return he(this,void 0,void 0,(function(){var r;return de(this,(function(o){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},n.prototype.releaseGPUData=function(t){var r=this.texData.get(t),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getDataInfo=function(t){return this.texData.get(t)},n.prototype.getCPUBackend=function(){return K().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=M.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(i){return o.texData.get(i.dataId).texture==null&&i.size<r}))},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(t,r){var o=this.makeOutput(t.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:M.keep(t.clone()),imag:M.keep(r.clone())},o},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,o);if(ve(o)===0)return Ct([],o,t.dtype);var i=this.texData.get(t.dataId).isPacked,a=Qv(t.shape,r,o);if(i||!a){var s=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xC(o):new bC(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,o)},n.prototype.shallowSlice=function(t,r,o){var i=this.texData.get(t.dataId),a=this.makeOutput(o,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=t.dtype;var u=Jv(r,t.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||t.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(t,r,o,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,o,i);var a=dl(r,o,i);if(a.some((function(u){return u===0})))return Ct([],a);var s=new wC(r,i,a);return this.compileAndRun(s,[t])},n.prototype.reverse=function(t,r){var o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mC(t.shape,r):new vC(t.shape,r);return this.compileAndRun(o,[t])},n.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var o=t.map((function(d){return dn(d)})),i=t.map((function(d){return Vn(d)}));return wt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new f2(t.map((function(d){return d.shape})),r);return this.compileAndRun(c,t)}var l=oi(t.map((function(d){return d.shape})),r),f=t.map((function(d){return d.as2D(-1,ve(d.shape.slice(r)))})),h=new l2(f.map((function(d){return d.shape})));return this.compileAndRun(h,f).reshape(l)},n.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,cd,t.dtype);var r=new Ne(t.shape,cd);return this.compileAndRun(r,[t])},n.prototype.batchMatMul=function(t,r,o,i){var a=o?t.shape[2]:t.shape[1],s=i?r.shape[1]:r.shape[2],u=o?t.shape[1]:t.shape[2],c=t.shape[0];if((a===1||s===1)&&u>1e3){o&&(t=t.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=s===1?t:t.as3D(c,u,1),f=s===1?2:1,h=s===1?r.as3D(c,1,u):r;return this.multiply(l,h).sum(f,!0)}var d=_t(t.dtype,r.dtype),p=new Su(t.shape,[c,a,s],o,i);return this.compileAndRun(p,[t,r],d)},n.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=i?r.shape[2]:r.shape[1],f=a?o.shape[1]:o.shape[2],h=r.shape[0],d=_t(r.dtype,o.dtype),p=s!=null,v=c!=null,m=u?ba(u,!0):null,g=new Su(r.shape,[h,l,f],i,a,p,m,v),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(g,b,d)},n.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var o=this.texData.get(t.dataId),i=this.texData.get(r.dataId),a=new Qh(i2,t.shape,r.shape),s=new Qh(a2,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),f=this.complex(c,l);return c.dispose(),l.dispose(),f}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Jh,t.dtype);var h=new tt(Jh,t.shape,r.shape);return this.compileAndRun(h,[t,r],t.dtype)},n.prototype.batchNormalization=function(t,r,o,i,a,s){var u=[t,r,o],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(a!=null&&(l=a.shape,u.push(a)),K().getBool("WEBGL_PACK_NORMALIZATION")){var f=new o2(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)}var h=new r2(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(h,u)},n.prototype.localResponseNormalization4D=function(t,r,o,i,a){var s=K().getBool("WEBGL_PACK_NORMALIZATION")?new eC(t.shape,r,o,i,a):new J2(t.shape,r,o,i,a);return this.compileAndRun(s,[t])},n.prototype.LRNGrad=function(t,r,o,i,a,s,u){var c=new Z2(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,t])},n.prototype.tile=function(t,r){if(t.dtype==="string"){var o=this.readSync(t.dataId).map((function(a){return Ga(a)}));return am(Te(t.shape,t.dtype,o),r)}var i=new CC(t.shape,r);return this.compileAndRun(i,[t])},n.prototype.pad=function(t,r,o){var i=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sC(t.shape,r,o):new aC(t.shape,r,o);return this.compileAndRun(i,[t])},n.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RC(t.shape,r):new EC(t.shape,r);return this.compileAndRun(o,[t])},n.prototype.gather=function(t,r,o){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,o);var i=new N2(t.shape,r.size,o);return this.compileAndRun(i,[t,r])},n.prototype.batchToSpaceND=function(t,r,o){k(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var i=r.reduce((function(f,h){return f*h})),a=Ya(t.shape,r,i),s=Qa(a.length,r.length),u=Ja(t.shape,r,i),c=Kv(o,r.length),l=$v(u,o,r.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(t,r,o){k(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var i=r.reduce((function(h,d){return h*d})),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=Ya(u.shape,r,i,!1),l=Qa(c.length,r.length,!1),f=Ja(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(f)},n.prototype.reduce=function(t,r,o){var i=t.shape[0],a=t.shape[1],s=Cu(a),u=new uC({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[t],o);return c.shape[1]===1?c:this.reduce(c,r,o)},n.prototype.argReduce=function(t,r,o){o===void 0&&(o=null);var i=t.shape[0],a=t.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=Cu(a),u=new $_({windowSize:s,inSize:a,batchSize:i},r,o==null),c=[t];o!=null&&c.push(o);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(t,r,l)},n.prototype.argReducePacked=function(t,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:t.shape,a=Cu(i[i.length-1]),s=new e2(i,a,r,o==null),u=o==null?[t]:[t,o],c=this.compileAndRun(s,u,"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},n.prototype.sum=function(t,r){Zt("sum",r,t.rank);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a),u=vu(t.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a),u=vu(t.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(t,r,o){var i=0,a=Xn([i],t.rank),s=t;a!=null&&(s=t.transpose(a),i=Yn(1,t.rank)[0]);var u=(function(d,p,v){for(var m=[],g=d.length,b=0;b<g;b++)b!==p?m.push(d[b]):m.push(v);return m})(s.shape,i,o),c=ve([s.shape[i]]),l=s.as2D(-1,c),f=vu(t.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",r,f,o).reshape(u);return a!=null&&(h=h.transpose(cl(a))),h},n.prototype.segOpCompute=function(t,r,o,i,a){var s=t.shape[0],u=t.shape[1],c=(function(h,d){var p,v=!1;for(h<=Yv?(p=h,v=!0):p=mc(h,Math.floor(Math.sqrt(h)));!v;)p>d||p===h?v=!0:p=mc(h,p+1);return p})(u,a),l=new gC({windowSize:c,inSize:u,batchSize:s,numSegments:a}),f=this.compileAndRun(l,[t,o],i);return f.shape[1]===a?f:(o=Xa(0,a).tile([u/c]),this.segOpCompute(f,r,o,i,a))},n.prototype.argMinMaxReduce=function(t,r,o){var i=[r];if(Zt("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,t.rank),!K().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=kt(t.shape,i),s=a[0],u=ve(a[1]),c=t.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(t,o)},n.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},n.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},n.prototype.cumsum=function(t,r,o,i){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new x2(t.shape,o,i);return this.compileAndRun(a,[t])},n.prototype.equal=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var o=new tt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.notEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new tt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new tt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.lessEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new tt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new tt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.greaterEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new tt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.logicalNot=function(t){var r=new Ne(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},n.prototype.logicalAnd=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new tt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.logicalOr=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new tt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.select=function(t,r,o){var i=new yC(t.rank,r.shape,r.rank);return this.compileAndRun(i,[t,r,o],_t(r.dtype,o.dtype))},n.prototype.where=function(t){Ka("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return gl(t.shape,r)},n.prototype.topk=function(t,r,o){return sm(t.dataSync(),t.shape,t.dtype,r)},n.prototype.min=function(t,r){Zt("min",r,t.rank);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.mod=function(t,r){var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Zt("max",r,t.rank);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.all=function(t,r){Zt("all",r,t.rank);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(t,r){Zt("any",r,t.rank);var o=kt(t.shape,r),i=o[0],a=ve(o[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new tt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"float32")},n.prototype.floorDiv=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new tt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"int32")},n.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Eu);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var o=_t(t.dtype,r.dtype);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Eu,o);var i=new tt(Eu,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},n.prototype.packedUnaryOp=function(t,r,o){var i=new vi(t.shape,r);return this.compileAndRun(i,[t],o)},n.prototype.packedBinaryOp=function(t,r,o,i,a){a===void 0&&(a=!1);var s=new rr(o,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],i)},n.prototype.complexSeparableBinaryOp=function(t,r,o){var i=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map((function(h){var d=h[0],p=h[1],v=i.makeComplexComponentTensorInfo(t,d),m=i.makeComplexComponentTensorInfo(r,p),g=new tt(o,t.shape,r.shape);return i.compileAndRun(g,[v,m],_t(d.dtype,p.dtype))})),c=u[0],l=u[1],f=this.complex(c,l);return c.dispose(),l.dispose(),f},n.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},n.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>K().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),o=this.addN(t.slice(0,r)),i=this.addN(t.slice(r));return this.addN([o,i])}var a=t.map((function(c){return c.dtype})).reduce((function(c,l){return _t(c,l)})),s=t.map((function(c){return c.shape})),u=K().getBool("WEBGL_PACK")?new K_(t[0].shape,s):new j_(t[0].shape,s);return this.compileAndRun(u,t,a)},n.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Ru);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var o=_t(t.dtype,r.dtype);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Ru,t.dtype);var i=new tt(Ru,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},n.prototype.pow=function(t,r){var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),i=_t(t.dtype,r.dtype);return this.compileAndRun(o,[t,r],i)},n.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ld,t.dtype);var r=new Ne(t.shape,ld);return this.compileAndRun(r,[t])},n.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,fd,t.dtype);var r=new Ne(t.shape,fd);return this.compileAndRun(r,[t])},n.prototype.sign=function(t){var r=new Ne(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},n.prototype.isNaN=function(t){var r=new Ne(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isInf=function(t){var r=new Ne(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isFinite=function(t){var r=new Ne(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.round=function(t){var r=new Ne(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},n.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,hd,t.dtype);var r=new Ne(t.shape,hd);return this.compileAndRun(r,[t])},n.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,dd,t.dtype);var r=new Ne(t.shape,dd);return this.compileAndRun(r,[t])},n.prototype.softmax=function(t,r){var o=dt([r],t.shape),i=this.max(t,o),a=Yt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Ne(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},n.prototype.log1p=function(t){var r=new Ne(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},n.prototype.sqrt=function(t){var r=new Ne(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Ne(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},n.prototype.reciprocal=function(t){var r=new Ne(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},n.prototype.relu=function(t){var r;return r=K().getBool("WEBGL_PACK")?new vi(t.shape,mm):new Ne(t.shape,dm),this.compileAndRun(r,[t])},n.prototype.relu6=function(t){var r;return r=K().getBool("WEBGL_PACK")?new vi(t.shape,gm):new Ne(t.shape,pm),this.compileAndRun(r,[t])},n.prototype.prelu=function(t,r){var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(hm,t.shape,r.shape):new tt(fm,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.elu=function(t){if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ym,t.dtype);var r=new Ne(t.shape,vm);return this.compileAndRun(r,[t])},n.prototype.eluDer=function(t,r){var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new tt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.selu=function(t){var r=new Ne(t.shape,IC);return this.compileAndRun(r,[t])},n.prototype.int=function(t){var r=new Ne(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},n.prototype.clip=function(t,r,o){var i,a=(i=K().getBool("WEBGL_PACK_CLIP")?new u2(t.shape):new s2(t.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[t],null,a)},n.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ud,t.dtype);var r=new Ne(t.shape,ud);return this.compileAndRun(r,[t])},n.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),o=new c2(t.shape),i=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(t){var r=new Ne(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},n.prototype.softplus=function(t){var r=new Ne(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},n.prototype.sin=function(t){var r=new Ne(t.shape,kC);return this.compileAndRun(r,[t])},n.prototype.cos=function(t){var r=new Ne(t.shape,AC);return this.compileAndRun(r,[t])},n.prototype.tan=function(t){var r=new Ne(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},n.prototype.asin=function(t){var r=new Ne(t.shape,TC);return this.compileAndRun(r,[t])},n.prototype.acos=function(t){var r=new Ne(t.shape,DC);return this.compileAndRun(r,[t])},n.prototype.atan=function(t){var r=new Ne(t.shape,NC);return this.compileAndRun(r,[t])},n.prototype.atan2=function(t,r){var o=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.sinh=function(t){var r=new Ne(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.cosh=function(t){var r=new Ne(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.tanh=function(t){var r=new Ne(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},n.prototype.asinh=function(t){var r=new Ne(t.shape,PC);return this.compileAndRun(r,[t])},n.prototype.acosh=function(t){var r=new Ne(t.shape,FC);return this.compileAndRun(r,[t])},n.prototype.atanh=function(t){var r=new Ne(t.shape,MC);return this.compileAndRun(r,[t])},n.prototype.erf=function(t){var r=new Ne(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},n.prototype.step=function(t,r){var o=new Ne(t.shape,(function(i){return i===void 0&&(i=0),Tn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `})(r));return this.compileAndRun(o,[t])},n.prototype.conv2dByMatMul=function(t,r,o,i,a,s){var u=t.shape,c=this.texData.get(t.dataId),l=o.inChannels,f=u[0]*u[1]*u[2],h=o.outChannels,d=o.dataFormat==="channelsLast",p=(f===1||h===1)&&l>1e3,v=u[2]%2!=0&&!!c.isPacked;if(p||!K().getBool("WEBGL_LAZILY_UNPACK")||!K().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(t,[1,m,o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var w=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),y={dataId:t.dataId,shape:[1,w,o.inChannels],dtype:t.dtype},x=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,k(va(c.shape,y.shape),(function(){return"packed reshape "+c.shape+" to "+y.shape+" isn't free"}));var _=this.reshape(r,[1,o.inChannels,o.outChannels]),S=this.fusedBatchMatMul({a:y,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),I=this.texData.get(S.dataId);return k(I.isPacked,(function(){return"batchMatMul result is expected to be packed"})),c.shape=x,I.shape=o.outShape,M.makeTensorFromDataId(S.dataId,o.outShape,S.dtype)},n.prototype.conv2dWithIm2Row=function(t,r,o,i,a,s){var u=o.filterWidth,c=o.filterHeight,l=o.inChannels,f=o.outWidth,h=o.outHeight,d=o.dataFormat==="channelsLast",p=u*c*l,v=h*f,m=[p,v],g=t.squeeze([0]),b=r.reshape([1,p,-1]),w=new Q2(m,g.shape,o),y=this.compileAndRun(w,[g]).reshape([1,m[0],m[1]]),x=i!=null,_=s!=null,S=a?ba(a,!0):null,I=new Su(y.shape,[1,v,o.outChannels],!0,!1,x,S,_),C=[y,b];i&&C.push(i),_&&C.push(s);var E=this.compileAndRun(I,C);return d?E.reshape([1,h,f,o.outChannels]):E.reshape([1,o.outChannels,h,f])},n.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(K().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=a!=null,l=u!=null,f=s?ba(s,!1):null,h=new Zh(i,c,f,l),d=[r,o];return a&&d.push(a),u&&d.push(u),this.compileAndRun(h,d)},n.prototype.conv2d=function(t,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,o);if(K().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,o);var i=new Zh(o);return this.compileAndRun(i,[t,r])},n.prototype.conv2dDerInput=function(t,r,o){var i=new d2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv2dDerFilter=function(t,r,o){var i=new h2(o);return this.compileAndRun(i,[t,r])},n.prototype.fusedDepthwiseConv2D=function(t){var r,o=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,f=u?ba(u,l):null,h=[o,i],d=s!=null,p=c!=null;return d&&h.push(s),p&&h.push(c),l?(r=new td(a,d,f,p),this.compileAndRun(r,h)):(r=new ed(a,d,f,p),this.compileAndRun(r,h))},n.prototype.depthwiseConv2D=function(t,r,o){var i;return K().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new td(o),this.compileAndRun(i,[t,r])):(i=new ed(o),this.compileAndRun(i,[t,r]))},n.prototype.depthwiseConv2DDerInput=function(t,r,o){var i=new g2(o);return this.compileAndRun(i,[t,r])},n.prototype.depthwiseConv2DDerFilter=function(t,r,o){var i=new m2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3d=function(t,r,o){var i=new y2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3dDerInput=function(t,r,o){var i=new v2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3dDerFilter=function(t,r,o){var i=new p2(o);return this.compileAndRun(i,[t,r])},n.prototype.maxPool=function(t,r){var o=new Iu(r,"max",!1);return this.compileAndRun(o,[t])},n.prototype.avgPool=function(t,r){var o=new Iu(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.maxPoolBackprop=function(t,r,o,i){var a=new Iu(i,"max",!0),s=this.compileAndRun(a,[r]),u=new tC(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(t,r,o){var i=new t2(o);return this.compileAndRun(i,[t],r.dtype)},n.prototype.cast=function(t,r){return nm(t,r,this)},n.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},n.prototype.avgPool3d=function(t,r){var o=new ku(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.avgPool3dBackprop=function(t,r,o){var i=new n2(o);return this.compileAndRun(i,[t],r.dtype)},n.prototype.maxPool3d=function(t,r){var o=new ku(r,"max",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.maxPool3dBackprop=function(t,r,o,i){var a=new ku(i,"max",!0),s=this.compileAndRun(a,[r]),u=new nC(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(t,r){var o=this.texData.get(t.dataId);if(o.isPacked&&!va(t.shape,r)&&(o.texture===null||!va(o.shape,r))){var i=this.packedReshape(t,r);return M.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return Ec(t,r)},n.prototype.resizeBilinear=function(t,r,o,i){var a=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hC(t.shape,r,o,i):new fC(t.shape,r,o,i);return this.compileAndRun(a,[t],"float32")},n.prototype.resizeBilinearBackprop=function(t,r,o){var i=new lC(t,r,o);return this.compileAndRun(i,[t])},n.prototype.resizeNearestNeighbor=function(t,r,o,i){var a=new pC(t.shape,r,o,i);return this.compileAndRun(a,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,r,o){var i=new dC(t,r,o);return this.compileAndRun(i,[t])},n.prototype.multinomial=function(t,r,o,i){var a=r?t:vr(t),s=a.shape[0],u=a.shape[1],c=new rC(s,u,o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(t,r,o,i){var a=new oC(t.size,r,o,i);return this.compileAndRun(a,[t])},n.prototype.diag=function(t){var r=new E2(t.size);return this.compileAndRun(r,[t])},n.prototype.nonMaxSuppression=function(t,r,o,i,a){return Ka("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),vl(t.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(t,r,o,i,a,s){var u=new b2(t.shape,r.shape,i,a,s);return this.compileAndRun(u,[t,r,o],"float32")},n.prototype.depthToSpace=function(t,r,o){k(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var i=t.shape[0],a=o==="NHWC"?t.shape[1]:t.shape[2],s=o==="NHWC"?t.shape[2]:t.shape[3],u=o==="NHWC"?t.shape[3]:t.shape[1],c=a*r,l=s*r,f=u/(r*r),h=new C2(o==="NHWC"?[i,c,l,f]:[i,f,c,l],r,o);return this.compileAndRun(h,[t])},n.prototype.split=function(t,r,o){return im(t,r,o)},n.prototype.scatterND=function(t,r,o){var i=Za(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=[l/u,u],h=t.reshape([s,a]),d=r.reshape([s,u]);if(l===0)return Ec(Ct([]),o);var p=ae(0),v=new id(s,a,h.rank,d.rank,c,f);return this.compileAndRun(v,[d,h,p]).reshape(o)},n.prototype.sparseToDense=function(t,r,o,i){var a=Za(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.strides,l=a.outputSize,f=new id(u,s,t.rank,r.rank,c,[l,1]);return this.compileAndRun(f,[r,t,i]).reshape(o)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,r){var o=this.texData.get(t.dataId),i=new rd(A2,t.shape,r),a=new rd(T2,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=Xv(t,r),s=a[0],u=a[1],c=a[2],l=a[3],f=r.reshape([u,i]),h=t.reshape([t.size/c,c]),d=new P2(i,l,[u,c]);return this.compileAndRun(d,[h,f]).reshape(s)},n.prototype.fill=function(t,r,o){if((o=o||Yi(r))==="string"){var i=Ha(o,ve(t));return i.fill(r),M.makeTensor(i,t,o,this)}var a=new D2(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.linspace=function(t,r,o){return rm(t,r,o)},n.prototype.makeTensorInfo=function(t,r){var o=this.write(null,t,r);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:r}},n.prototype.makeOutput=function(t,r){var o=this.makeTensorInfo(t,r).dataId;return M.makeTensorFromDataId(o,t,r,this)},n.prototype.unpackTensor=function(t){var r=new BC(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},n.prototype.packTensor=function(t){var r=new iC(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},n.prototype.packedReshape=function(t,r){var o=[qa(t.shape)].concat(ja(t.shape)),i={dtype:t.dtype,shape:o,dataId:t.dataId},a=[qa(r)].concat(ja(r)),s=new cC(a,o),u=this.runWebGLProgram(s,[i],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(t){var r,o=this.texData.get(t),i=o.isPacked,a=o.shape,s=o.dtype,u=_u(a);return r=i?new _2(u):new w2(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(t,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,o),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===Ui.DENSE){var l=Ii(t.outputShape);c.texShape=l.map((function(w){return 2*w}))}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),ve(u.shape)===0)return c.values=Vi(u.dtype,0),u;var f=[],h=r.map((function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var y=s.texData.get(w.dataId);if(y.texture==null){if(!t.packedInputs&&ve(w.shape)<=K().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:y.values};t.packedInputs&&(y.isPacked=!0,y.shape=w.shape)}else if(!!y.isPacked!=!!t.packedInputs)w=y.isPacked?s.unpackTensor(w):s.packTensor(w),f.push(w),y=s.texData.get(w.dataId);else if(y.isPacked&&!va(y.shape,w.shape)){var x=w,_=w.shape;w.shape=y.shape,w=s.packedReshape(w,_),f.push(w),y=s.texData.get(w.dataId),x.shape=_}return s.uploadToGPU(w.dataId),{shape:w.shape,texData:y,isUniform:!1}}));this.uploadToGPU(u.dataId);var d,p={shape:u.shape,texData:c,isUniform:!1},v=(function(w,y,x){var _="";y.concat(x).forEach((function(C){var E=C.texData!=null&&C.texData.slice!=null&&C.texData.slice.flatOffset>0,N=C.isUniform?"uniform":C.texData.texShape;_+=C.shape+"_"+N+"_"+E}));var S=w.userCode,I=w.constructor.name;return I+="_"+_+"_"+S})(t,h,p),m=this.getAndSaveBinary(v,(function(){return(function(w,y,x,_){var S=y.userCode,I=x.map((function(W,X){var Q={logicalShape:W.shape,texShape:W.isUniform?null:W.texData.texShape,isUniform:W.isUniform,isPacked:!W.isUniform&&W.texData.isPacked,flatOffset:null};return W.texData!=null&&W.texData.slice!=null&&W.texData.slice.flatOffset>0&&(Q.flatOffset=W.texData.slice.flatOffset),{name:y.variableNames[X],shapeInfo:Q}})),C=I.map((function(W){return W.shapeInfo})),E={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},N=X_(I,E,S,y.packedInputs),T=w.createProgram(N),B=null,F=w.getUniformLocation(T,"NAN",!1);K().getNumber("WEBGL_VERSION")===1&&(B=w.getUniformLocation(T,"INFINITY",!1));for(var L={},q=0;q<y.variableNames.length;q++){var U=y.variableNames[q];L[U]=w.getUniformLocation(T,U,!1),L["offset"+U]=w.getUniformLocation(T,"offset"+U,!1)}return{program:y,source:N,webGLProgram:T,uniformLocations:L,inShapeInfos:C,outShapeInfo:E,infLoc:B,nanLoc:F}})(s.gpgpu,t,h,p)})),g=this.activeTimers!=null;if(g&&(d=this.startTimer()),(function(w,y,x,_,S){od(y.inShapeInfos,x),od([y.outShapeInfo],[_]);var I=_.texData.texture,C=_.texData.texShape;_.texData.isPacked?w.setOutputPackedMatrixTexture(I,C[0],C[1]):w.setOutputMatrixTexture(I,C[0],C[1]),w.setProgram(y.webGLProgram),K().getNumber("WEBGL_VERSION")===1&&y.infLoc!==null&&w.gl.uniform1f(y.infLoc,1/0),y.nanLoc!==null&&w.gl.uniform1f(y.nanLoc,NaN),x.forEach((function(E,N){var T=y.program.variableNames[N],B=y.uniformLocations[T],F=y.uniformLocations["offset"+T];if(B!=null)if(E.isUniform)if(ve(E.shape)<2)w.gl.uniform1f(B,E.uniformValues[0]);else{var L=E.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),w.gl.uniform1fv(B,L)}else E.texData.slice!=null&&F!=null&&w.gl.uniform1i(F,E.texData.slice.flatOffset),w.setInputMatrixTexture(E.texData.texture,B,N)})),S?.(w,y.webGLProgram),w.executeProgram()})(this.gpgpu,m,h,p,i),f.forEach((function(w){return s.disposeData(w.dataId)})),g&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)})),!K().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(t,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(t,r,o,i,a);return M.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var t=this;this.disposed||(K().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=le((function(){if(!K().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=K().getBool("DEBUG");K().set("DEBUG",!1);var o=t.abs(ae(1e-8)).dataSync()[0];if(K().set("DEBUG",r),o>0)return 32}return 16}))),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.values,u=o.texture,c=o.usage,l=o.isPacked;if(u==null){var f,h=this.activeTimers!=null;h&&(f=Ln());var d=o.texShape;if(d==null&&(d=qw(i,l),o.texShape=d),s!=null){var p=_u(i),v=void 0,m=d[1],g=d[0],b=s instanceof Uint8Array;l?(m=(r=Ji(d[0],d[1]))[0],g=r[1],v=new k2(p,[g,m],b)):v=new I2(p,[g,m],b);var w=this.makeTensorInfo([g,m],a);this.texData.get(w.dataId).usage=b?nn.PIXELS:nn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);var y=this.runWebGLProgram(v,[w],a,null,!0),x=this.texData.get(y.dataId);o.texture=x.texture,o.texShape=x.texShape,o.isPacked=x.isPacked,o.usage=x.usage,this.disposeData(w.dataId),this.texData.delete(y.dataId),o.values=null,h&&(this.uploadWaitMs+=Ln()-f)}else{var _=this.acquireTexture(d,c,a,l);o.texture=_}}},n.prototype.convertAndCacheOnCPU=function(t,r){var o=this.texData.get(t),i=o.dtype;return this.releaseGPUData(t),r!=null&&(o.values=(function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)})(r,i)),o.values},n.prototype.acquireTexture=function(t,r,o,i){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},n.prototype.computeBytes=function(t,r){return t[0]*t[1]*Dv(r)},n})(em);Lv()&&M.registerBackend("webgl",(function(){return new WC}),2);var VC=P({square_:function(e){var n=R(e,"x","square"),t=[n];return M.runKernelFunc((function(r,o){return o([n]),r.square(n)}),{x:n},null,"Square",{},t,[])}}),Gi="SquaredDifference",bm=P({squaredDifference_:function(e,n){var t,r=R(e,"a","squaredDifference"),o=R(n,"b","squaredDifference");t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return M.runKernelFunc((function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c}),i,(function(s,u){var c=u[0],l=u[1],f=ae(2);return{a:function(){return s.mul(c.sub(l).mul(f))},b:function(){return s.mul(l.sub(c).mul(f))}}}),Gi,{},a,[])}}),zC=P({abs_:function(e){var n=R(e,"x","abs");return n.dtype==="complex64"?M.runKernelFunc((function(t){return t.complexAbs(n)}),{$x:n}):M.runKernelFunc((function(t,r){var o=t.abs(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.toFloat().step(-1))}}}),"Abs")}}),UC=P({acos_:function(e){var n=R(e,"x","acos");return M.runKernelFunc((function(t,r){var o=t.acos(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(ae(1).sub(o.toFloat().square()).sqrt()).neg()}}}))}}),HC=P({acosh_:function(e){var n=R(e,"x","acosh");return M.runKernelFunc((function(t,r){var o=t.acosh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}}))}}),GC=P({asin_:function(e){var n=R(e,"x","asin");return M.runKernelFunc((function(t,r){var o=t.asin(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(ae(1).sub(o.toFloat().square()).sqrt())}}}))}}),qC=P({asinh_:function(e){var n=R(e,"x","asinh");return M.runKernelFunc((function(t,r){var o=t.asinh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(ae(1).add(o.toFloat().square()).sqrt())}}}))}}),jC=P({atan_:function(e){var n=R(e,"x","atan");return M.runKernelFunc((function(t,r){var o=t.atan(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}}))}}),KC=P({atanh_:function(e){var n=R(e,"x","atanh");return M.runKernelFunc((function(t,r){var o=t.atanh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(ae(1).sub(o.toFloat().square()))}}}))}}),$C=P({ceil_:function(e){var n=R(e,"x","ceil");return M.runKernelFunc((function(t){return t.ceil(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),wl=P({clipByValue_:function(e,n,t){var r=R(e,"x","clipByValue");k(n<=t,(function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+t+")."}));var o=[r],i={min:n,max:t};return M.runKernelFunc((function(a,s){var u=a.clip(r,n,t);return s([r]),u}),{x:r},(function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(t)),Be(a))}}}),"ClipByValue",i,o)}}),XC=P({cos_:function(e){var n=R(e,"x","cos"),t=[n];return M.runKernelFunc((function(r,o){var i=r.cos(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),YC=P({cosh_:function(e){var n=R(e,"x","cosh");return M.runKernelFunc((function(t,r){var o=t.cosh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}}))}}),QC=P({erf_:function(e){var n=R(e,"x","erf");return k(n.dtype==="int32"||n.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),n.dtype==="int32"&&(n=n.toFloat()),M.runKernelFunc((function(t,r){var o=t.erf(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Sc=P({exp_:function(e){var n=R(e,"x","exp");return M.runKernelFunc((function(t,r){var o=t.exp(n);return r([o]),o}),{x:n},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),JC=P({expm1_:function(e){var n=R(e,"x","expm1");return M.runKernelFunc((function(t,r){var o=t.expm1(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.exp())}}}))}}),ZC=P({floor_:function(e){var n=R(e,"x","floor");return M.runKernelFunc((function(t){return t.floor(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),eE=P({log_:function(e){var n=R(e,"x","log"),t=[n];return M.runKernelFunc((function(r,o){var i=r.log(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}}),"Log",{},t)}}),tE=P({log1p_:function(e){var n=R(e,"x","log1p");return M.runKernelFunc((function(t,r){var o=t.log1p(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.add(1))}}}))}}),nE=P({logSigmoid_:function(e){var n=R(e,"x","logSigmoid");return M.runKernelFunc((function(t,r){var o=t.softplus(n.neg()).neg();return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}}))}}),rs=P({neg_:function(e){var n=R(e,"x","neg"),t=[n];return M.runKernelFunc((function(r){return r.neg(n)}),{x:n},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),rE=P({reciprocal_:function(e){var n=R(e,"x","reciprocal");return M.runKernelFunc((function(t,r){var o=t.reciprocal(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.square().neg())}}}))}}),oE=P({round_:function(e){var n=R(e,"x","round");return M.runKernelFunc((function(t){return t.round(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),xm=P({rsqrt_:function(e){var n=R(e,"x","rsqrt"),t=[n];return M.runKernelFunc((function(r,o){var i=r.rsqrt(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),wm=P({sigmoid_:function(e){var n=R(e,"x","sigmoid");return M.runKernelFunc((function(t,r){var o=t.sigmoid(n);return r([o]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.mul(ae(1).sub(o)))}}}),"Sigmoid")}}),iE=P({sign_:function(e){var n=R(e,"x","sign");return M.runKernelFunc((function(t){return t.sign(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),aE=P({isNaN_:function(e){var n=R(e,"x","isNaN");return M.runKernelFunc((function(t){return t.isNaN(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),sE=P({isInf_:function(e){var n=R(e,"x","isInf");return M.runKernelFunc((function(t){return t.isInf(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),uE=P({isFinite_:function(e){var n=R(e,"x","isFinite");return M.runKernelFunc((function(t){return t.isFinite(n)}),{$x:n},(function(t){return{$x:function(){return Be(t)}}}))}}),cE=P({sin_:function(e){var n=R(e,"x","sin"),t=[n];return M.runKernelFunc((function(r,o){var i=r.sin(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),lE=P({sinh_:function(e){var n=R(e,"x","sinh");return M.runKernelFunc((function(t,r){var o=t.sinh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}}))}}),fE=P({softplus_:function(e){var n=R(e,"x","softplus");return M.runKernelFunc((function(t,r){var o=t.softplus(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.sigmoid())}}}))}}),hE=P({sqrt_:function(e){var n=R(e,"x","sqrt");return M.runKernelFunc((function(t,r){var o=t.sqrt(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}}))}}),dE=P({step_:function(e,n){n===void 0&&(n=0);var t=R(e,"x","step");return M.runKernelFunc((function(r){return r.step(t,n)}),{$x:t},(function(r){return{$x:function(){return Be(r)}}}))}}),pE=P({tan_:function(e){var n=R(e,"x","tan");return M.runKernelFunc((function(t,r){var o=t.tan(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.cos().square())}}}))}}),vE=P({tanh_:function(e){var n=R(e,"x","tanh");return M.runKernelFunc((function(t,r){var o=t.tanh(n);return r([o]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return ae(1).sub(o.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function _m(e,n,t,r,o,i){var a,s,u=R(e,"x","batchNorm"),c=R(n,"mean","batchNorm"),l=R(t,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),k(u.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),k(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),k(l.rank===2||l.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),a!=null&&k(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),s!=null&&k(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),ea(u,c,l,s,a,i)}function Cm(e,n,t,r,o,i){var a,s,u=R(e,"x","batchNorm"),c=R(n,"mean","batchNorm"),l=R(t,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),k(u.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),k(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),k(l.rank===3||l.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),a!=null&&k(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),s!=null&&k(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),ea(u,c,l,s,a,i)}function Em(e,n,t,r,o,i){var a,s,u=R(e,"x","batchNorm"),c=R(n,"mean","batchNorm"),l=R(t,"variance","batchNorm");return o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),k(u.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),k(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),k(l.rank===4||l.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),a!=null&&k(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),s!=null&&k(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),ea(u,c,l,s,a,i)}function ea(e,n,t,r,o,i){i==null&&(i=.001);var a,s,u,c=R(e,"x","batchNorm"),l=R(n,"mean","batchNorm"),f=R(t,"variance","batchNorm");o!=null&&(a=R(o,"scale","batchNorm")),r!=null&&(s=R(r,"offset","batchNorm")),k(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),k(s==null||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),k(a==null||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var h=[c,l,f,a];return M.runKernelFunc((function(d,p){var v=d.batchNormalization(u,xa(l),xa(f),i,xa(a),xa(s));return p([c,l,f,a]),v}),{x:c,mean:l,variance:f,scale:a,offset:s},(function(d,p){var v=p,m=v[0],g=v[1],b=v[2],w=v[3],y=w??ae(1),x=ft(g.shape,u.shape),_=[];if(g.rank===1){for(var S=0;S<u.shape.length-1;++S)_.push(u.shape[S]);_.push(1)}var I=m.sub(g),C=d.mul(y),E=xm(b.add(ae(i))),N=E.mul(E).mul(E).mul(ae(-.5));return{x:function(){return g.rank===1?d.mul(Ko(E.as4D(1,1,1,g.shape[0]),_)).mul(y).reshape(m.shape):d.mul(E).mul(y).reshape(m.shape)},mean:function(){var T=E.mul(ae(-1)).mul(C);return g.rank===1&&(T=T.sum(x)),T.reshape(g.shape)},variance:function(){var T=N.mul(I).mul(C);return g.rank===1&&(T=T.sum(x)),T.reshape(g.shape)},scale:function(){var T=I.mul(E),B=d.mul(T);return g.rank===1&&(B=B.sum(x)),B.reshape(g.shape)},offset:function(){var T=d;return g.rank===1&&(T=T.sum(x)),T.reshape(g.shape)}}}),"BatchNormalization",{varianceEpsilon:i},h).reshape(c.shape)}function xa(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Ts(){Wv("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var mE=P({batchNormalization2d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),Ts(),_m(e,n,t,i,o,r)}}),gE=P({batchNormalization3d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),Ts(),Cm(e,n,t,i,o,r)}}),yE=P({batchNormalization4d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),Ts(),Em(e,n,t,i,o,r)}}),bE=P({batchNormalization_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),Ts(),ea(e,n,t,i,o,r)}}),Rm=P({batchNorm_:ea}),xE=P({batchNorm2d_:_m}),wE=P({batchNorm3d_:Cm}),_E=P({batchNorm4d_:Em}),Ds=P({logicalAnd_:function(e,n){var t=R(e,"a","logicalAnd","bool"),r=R(n,"b","logicalAnd","bool");return Oe(t.shape,r.shape),M.runKernelFunc((function(o){return o.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),CE=P({logicalNot_:function(e){var n=R(e,"x","logicalNot","bool");return M.runKernelFunc((function(t){return t.logicalNot(n)}),{$x:n})}}),Sm=P({logicalOr_:function(e,n){var t=R(e,"a","logicalOr","bool"),r=R(n,"b","logicalOr","bool");return Oe(t.shape,r.shape),M.runKernelFunc((function(o){return o.logicalOr(t,r)}),{$a:t,$b:r})}}),EE=P({logicalXor_:function(e,n){var t=R(e,"a","logicalXor","bool"),r=R(n,"b","logicalXor","bool");return Oe(t.shape,r.shape),Sm(e,n).logicalAnd(Ds(e,n).logicalNot())}}),lo=P({where_:function(e,n,t){var r=R(n,"a","where"),o=R(t,"b","where"),i=R(e,"condition","where","bool");return He(r.shape,o.shape,"Error in where: "),i.rank===1?k(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):He(i.shape,o.shape,"Error in where: "),M.runKernelFunc((function(a,s){var u=a.select(i,r,o);return s([i]),u}),{$condition:i,$a:r,$b:o},(function(a,s){var u=s[0];return{$condition:function(){return Be(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}}))}}),Im=function(e){return he(this,void 0,void 0,(function(){var n,t,r;return de(this,(function(o){switch(o.label){case 0:return[4,(n=R(e,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),r=gl(n.shape,t),e!==n&&n.dispose(),[2,r]}}))}))},Me=P({add_:function(e,n){var t,r=R(e,"a","add"),o=R(n,"b","add");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a){return a.add(r,o)}),{a:r,b:o},(function(a){return{a:function(){var s=a,u=ft(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=ft(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}}),"Add")}}),RE=P({addN_:function(e){k(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),k(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var n=e.map((function(o,i){return R(o,"tensors"+i,"addN")})),t=n[0];n.forEach((function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),n.forEach((function(o){if(!gt(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=n;return M.runKernelFunc((function(o){return o.addN(n)}),r,(function(o){var i={};return n.forEach((function(a,s){i[s]=function(){return o.clone()}})),i}),"AddN")}}),SE=P({addStrict_:function(e,n){var t=R(e,"a","addStrict"),r=R(n,"b","addStrict");return He(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),IE=P({atan2_:function(e,n){var t,r=R(e,"a","atan2"),o=R(n,"b","atan2");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a,s){var u=a.atan2(r,o);return s([r,o]),u}),{$a:r,$b:o},(function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Me(u.square(),c.square()),f=a.mul(c.div(l)),h=ft(u.shape,i);return h.length>0&&(f=f.sum(h)),f.reshape(u.shape)},$b:function(){var l=Me(u.square(),c.square()),f=rs(a.mul(u.div(l))),h=ft(c.shape,i);return h.length>0&&(f=f.sum(h)),f.reshape(c.shape)}}}))}}),wn=P({div_:function(e,n){var t,r=R(e,"a","div"),o=R(n,"b","div");if(t=et(r,o),r=t[0],o=t[1],r.dtype==="int32"&&o.dtype==="int32")return km(r,o);var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a,s){var u=a.realDivide(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),f=ft(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=ft(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var h=c.square();return l.div(h.toFloat()).neg()}}}),"Div")}}),kE=P({divNoNan_:function(e,n){var t,r=R(e,"a","div"),o=R(n,"b","div");r=(t=et(r,o))[0],o=t[1];var i=wn(r,o),a=Be(i),s=o.equal(a);return lo(s,a,i)}}),AE=P({divStrict_:function(e,n){var t=R(e,"a","div"),r=R(n,"b","div");return He(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),km=P({floorDiv_:function(e,n){var t,r=R(e,"a","floorDiv"),o=R(n,"b","floorDiv");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),f=ft(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=ft(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var h=c.square();return l.div(h.toFloat()).neg()}}}),"FloorDiv")}}),_l=P({maximum_:function(e,n){var t,r=R(e,"a","maximum"),o=R(n,"b","maximum");return t=et(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Oe(r.shape,o.shape),M.runKernelFunc((function(i,a){var s=i.maximum(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}}),"Maximum")}}),TE=P({maximumStrict_:function(e,n){var t=R(e,"a","maximumStrict"),r=R(n,"b","maximumStrict");return He(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),Am=P({minimum_:function(e,n){var t,r=R(e,"a","minimum"),o=R(n,"b","minimum");return t=et(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Oe(r.shape,o.shape),M.runKernelFunc((function(i,a){var s=i.minimum(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}}),"Minimum")}}),DE=P({minimumStrict_:function(e,n){var t=R(e,"a","minimumStrict"),r=R(n,"b","minimumStrict");return He(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),NE=P({mod_:function(e,n){var t,r=R(e,"a","mod"),o=R(n,"b","mod");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a,s){var u=a.mod(r,o);return s([r,o]),u}),{$a:r,$b:o},(function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=ft(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),f=ft(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}}))}}),PE=P({modStrict_:function(e,n){var t=R(e,"a","modStrict"),r=R(n,"b","modStrict");return He(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Bt=P({mul_:function(e,n){var t,r=R(e,"a","mul"),o=R(n,"b","mul");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a,s){var u=a.multiply(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),f=ft(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=ft(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}}),"Mul")}}),FE=P({mulStrict_:function(e,n){var t=R(e,"a","mul"),r=R(n,"b","mul");return He(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),os=P({pow_:function(e,n){var t,r=R(e,"base","pow"),o=R(n,"exp","pow");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape),a=[r,o];return M.runKernelFunc((function(s,u){var c=s.pow(r,o);return u([r,o,c]),c}),{a:r,b:o},(function(s,u){var c=u[0],l=u[1],f=u[2];return{a:function(){var h=l.toFloat(),d=s.mul(h.mul(c.pow(h.sub(ae(1))))),p=ft(c.shape,i);return p.length>0&&(d=d.sum(p)),d.reshape(c.shape)},b:function(){var h=c.greater(0),d=c.log().where(h,Be(c)),p=s.mul(f.mul(d)),v=ft(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)}}}),"Pow",{},a,[!0])}}),ME=P({powStrict_:function(e,n){return He(e.shape,n.shape,"Error in powStrict: "),e.pow(n)}}),OE=P({squaredDifferenceStrict_:function(e,n){var t=R(e,"a","squaredDifferenceStrict"),r=R(n,"b","squaredDifferenceStrict");return He(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),ht=P({sub_:function(e,n){var t,r=R(e,"a","sub"),o=R(n,"b","sub");t=et(r,o),r=t[0],o=t[1];var i=Oe(r.shape,o.shape);return M.runKernelFunc((function(a){return a.subtract(r,o)}),{a:r,b:o},(function(a){return{a:function(){var s=a,u=ft(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=ft(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}}),"Sub")}}),BE=P({subStrict_:function(e,n){var t=R(e,"a","subStrict"),r=R(n,"b","subStrict");return He(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Tm=P({equal_:function(e,n){var t,r=R(e,"a","equal"),o=R(n,"b","equal");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i){return i.equal(r,o)}),{$a:r,$b:o})}}),LE=P({equalStrict_:function(e,n){var t=R(e,"a","equalStrict"),r=R(n,"b","equalStrict");return He(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),WE=P({greater_:function(e,n){var t,r=R(e,"a","greater"),o=R(n,"b","greater");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i){return i.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Dm=P({greaterEqual_:function(e,n){var t,r=R(e,"a","greaterEqual"),o=R(n,"b","greaterEqual");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return Be(s)},b:function(){return Be(u)}}}),"GreaterEqual")}}),VE=P({greaterEqualStrict_:function(e,n){var t=R(e,"a","greaterEqualStrict"),r=R(n,"b","greaterEqualStrict");return He(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),zE=P({greaterStrict_:function(e,n){var t=R(e,"a","greaterStrict"),r=R(n,"b","greaterStrict");return He(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),UE=P({less_:function(e,n){var t,r=R(e,"a","less"),o=R(n,"b","less");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i){return i.less(r,o)}),{a:r,b:o},null,"Less")}}),HE=P({lessEqual_:function(e,n){var t,r=R(e,"a","lessEqual"),o=R(n,"b","lessEqual");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s}),{a:r,b:o},null,"LessEqual")}}),GE=P({lessEqualStrict_:function(e,n){var t=R(e,"a","lessEqualStrict"),r=R(n,"b","lessEqualStrict");return He(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),qE=P({lessStrict_:function(e,n){var t=R(e,"a","lessStrict"),r=R(n,"b","lessStrict");return He(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),jE=P({notEqual_:function(e,n){var t,r=R(e,"a","notEqual"),o=R(n,"b","notEqual");return t=et(r,o),r=t[0],o=t[1],Oe(r.shape,o.shape),M.runKernelFunc((function(i){return i.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),KE=P({notEqualStrict_:function(e,n){var t=R(e,"a","notEqualStrict"),r=R(n,"b","notEqualStrict");return He(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function pd(e,n){for(var t=[],r=e;r<n;++r)t.push(r);return t}function vd(e){for(var n=[],t=0;t<e.length;++t)for(var r=0;r<e[t].length;++r)n.push(e[t][r]);return n}var Cl=P({gather_:function(e,n,t){t===void 0&&(t=0);var r=R(e,"x","gather"),o=R(n,"indices","gather","int32");t=dt(t,r.shape)[0];var i=(function(a,s,u){for(var c=a.shape[u],l=[],f=1,h=1,d=0;d<u;d++)l.push(a.shape[d]),f*=a.shape[d];for(d=0;d<s.rank;d++)l.push(s.shape[d]);for(d=u+1;d<a.rank;d++)l.push(a.shape[d]),h*=a.shape[d];return{batchSize:f,sliceSize:h,dimSize:c,outputShape:l}})(r,o,t);return M.runKernelFunc((function(a,s){var u=a.gather(r,o.flatten(),t);return s([o]),u}),{x:r,indices:o},(function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,f=c.slice(0,t),h=f.length,d=c.slice(t,c.length).slice(1),p=d.length,v=pd(0,h),m=pd(h+1,h+1+p),g=vd([f,[l],d]),b=a.reshape(g),w=u.reshape([l]),y=vd([[h],v,m]),x=b.transpose(y),_=Nm(x,w,r.shape[t]),S=cl(y);return _=_.transpose(S)},indices:function(){return u}}}),"Gather",{axis:t}).reshape(i.outputShape)}}),Nm=P({unsortedSegmentSum_:function(e,n,t){var r=R(e,"x","unsortedSegmentSum"),o=R(n,"segmentIds","unsortedSegmentSum","int32");return k(rt(t),(function(){return"numSegments must be of dtype int"})),M.runKernelFunc((function(i,a){var s=i.unsortedSegmentSum(r,o,t);return a([o]),s}),{$x:r},(function(i,a){var s=a[0];return{$x:function(){return(function(u,c){for(var l=_l(c,Be(c)),f=Cl(u,l),h=Dm(c,ae(0,"int32")),d=f.rank-h.rank,p=0;p<d;++p)h=fn(h,p+1);h=Ds(h,si(f.shape,"bool"));var v=Be(f);return lo(h,f,v)})(i,s)}}}))}}),$E=function(e,n,t){return he(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,h,d,p,v;return de(this,(function(m){switch(m.label){case 0:for(r=R(e,"tensor","boolMask"),o=R(n,"mask","boolMask","bool"),i=t??0,a=o.rank,s=r.shape,k(a>0,(function(){return"mask cannot be scalar"})),He(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),f=r.reshape(l),h=o.reshape([-1]),[4,Im(h)];case 1:return d=m.sent(),p=d.squeeze([1]),v=Cl(f,p,i),e!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}}))}))};function Pm(e,n,t,r,o,i,a){i===void 0&&(i="NHWC"),k(e.length===n.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"}));var s=e,u=n,c=!1;n.rank===3&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,e[0],e[1],e[2]]),k(s.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),k(u.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),k(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];k(l===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."})),k(f===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+t.shape[3]+"."})),a!=null&&k(rt(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var h=pl(i),d=mo(s,t.shape,r,1,o,a,!1,h),p=M.runKernelFunc((function(v,m){var g=v.conv2dDerInput(u,t,d);return m([t,u]),g}),{dy4D:u,filter:t},(function(v,m){var g=m[0],b=m[1];return{dy4D:function(){return yn(v,g,r,o,i,1,a)},filter:function(){return El(v,b,g.shape,r,o,i,a)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Tu(e){var n=(function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i})(e),t=n[0],r=n[1],o=n[2];return t===1&&r===1&&o===1}function Fm(e,n,t,r,o){k(e.length===n.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"}));var i=e,a=n,s=!1;n.rank===4&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=a.shape[4];k(i.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),k(a.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),k(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),k(u===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."})),k(c===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."}));var l=ts(i,t.shape,r,1,o),f=M.runKernelFunc((function(h){return h.conv3dDerInput(a,t,l)}),{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var XE=P({conv1d_:function(e,n,t,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=R(e,"x","conv1d"),u=R(n,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),k(c.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),k(u.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),a!=null&&k(rt(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."})),k(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),k(Qt(t,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"})),k(o==="NWC",(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),d=yn(h,f,[1,t],r,"NHWC",[1,i],a);return l?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),yn=P({conv2d_:function(e,n,t,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=R(e,"x","conv2d"),u=R(n,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),k(c.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),k(u.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),a!=null&&k(rt(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f=o==="NHWC"?c.shape[3]:c.shape[1];k(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),k(Qt(t,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}));var h=pl(o),d=mo(c.shape,u.shape,t,i,r,a,!1,h),p=[u,c],v=M.runKernelFunc((function(m,g){var b=m.conv2d(c,u,d);return g([u,c]),b}),{x:c,filter:u},(function(m,g){var b=g,w=b[0],y=b[1];return k(ii(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return Mm(y.shape,m,w,t,r,o)},filter:function(){return El(y,m,w.shape,t,r,o)}}}),"Conv2D",d,p);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),YE=P({conv3d_:function(e,n,t,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=R(e,"x","conv3d"),s=R(n,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),k(u.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),k(s.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),k(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),k((function(h,d){return Tu(h)||Tu(d)})(t,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),k(o==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=ts(u.shape,s.shape,t,i,r),f=M.runKernelFunc((function(h,d){var p=h.conv3d(u,s,l);return d([u,s]),p}),{x:u,$filter:s},(function(h,d){k(Tu(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var p=d[0],v=d[1];return{x:function(){return Fm(p.shape,h,v,t,r)},$filter:function(){return(function(m,g,b,w,y){var x=m;m.rank===4&&(x=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var _=g;_.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),k(x.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."})),k(_.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."})),k(b.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."})),k(x.shape[4]===b[3],(function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+b[3]+"."})),k(_.shape[4]===b[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+b[4]+")."}));var S=ts(x.shape,b,w,1,y);return M.runKernelFunc((function(I){return I.conv3dDerFilter(x,_,S)}),{x5D:x,dy5D:_})})(p,h,v.shape,t,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),El=P({conv2dDerFilter_:function(e,n,t,r,o,i,a){i===void 0&&(i="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=n;u.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),k(s.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),k(u.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),k(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];k(c===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."})),k(l===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."})),a!=null&&k(rt(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var f=pl(i),h=mo(s.shape,t,r,1,o,a,!1,f);return M.runKernelFunc((function(d){return d.conv2dDerFilter(s,u,h)}),{x4D:s,dy4D:u})}}),Mm=P({conv2dDerInput_:Pm}),Ns=P({depthwiseConv2d_:function(e,n,t,r,o,i,a){i===void 0&&(i=[1,1]);var s=R(e,"x","depthwiseConv2d"),u=R(n,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),k(c.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),k(u.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),k(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),i==null&&(i=[1,1]),k(Qt(t,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),a!=null&&k(rt(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f=mo(c.shape,u.shape,t,i,r,a,!0),h=[c,u],d=M.runKernelFunc((function(p,v){var m=p.depthwiseConv2D(c,u,f);return v([c,u]),m}),{x:c,filter:u},(function(p,v){k(ii(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var m=v[0],g=v[1];return{x:function(){return Om(m.shape,p,g,f)},filter:function(){return Bm(m,p,g.shape,f)}}}),"DepthwiseConv2dNative",f,h);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Om=P({depthwiseConv2dDerInput_:function(e,n,t,r){var o=n,i=!1;n.rank===3&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=M.runKernelFunc((function(s){return s.depthwiseConv2DDerInput(o,t,r)}),{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),Bm=P({depthwiseConv2dDerFilter_:function(e,n,t,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=n;return i.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),M.runKernelFunc((function(a){return a.depthwiseConv2DDerFilter(o,i,r)}),{x4D:o,dy4D:i})}}),Rl=P({separableConv2d_:function(e,n,t,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=R(e,"x","separableConv2d"),u=R(n,"depthwiseFilter","separableConv2d"),c=R(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");k(l.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),k(u.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),k(c.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),k(c.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),k(c.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var h=u.shape[2],d=u.shape[3];k(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*d+", but got "+c.shape[2]+"."}));var p=Ns(l,u,r,o,a,i),v=yn(p,c,1,"valid",a);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),QE=P({conv2dTranspose_:function(e,n,t,r,o,i){return Pm(t,R(e,"x","conv2dTranspose"),R(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),JE=P({conv3dTranspose_:function(e,n,t,r,o){return Fm(t,R(e,"x","conv3dTranspose"),R(n,"filter","conv3dTranspose"),r,o)}}),Ps=P({matMul_:function(e,n,t,r){var o;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=R(e,"a","matMul"),a=R(n,"b","matMul");o=et(i,a),i=o[0],a=o[1];var s=t?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),h=a.shape.slice(0,-2),d=ve(f),p=ve(h);k(i.rank>=2&&a.rank>=2&&i.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."})),k(gt(f,h),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+h+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."})),k(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var v=i.shape.slice(0,-2).concat([c,l]),m=t?i.as3D(d,s,c):i.as3D(d,c,s),g=r?a.as3D(p,l,u):a.as3D(p,u,l),b={transposeA:t,transposeB:r};return M.runKernelFunc((function(w,y){var x=w.batchMatMul(m,g,t,r);return y([m,g]),x}),{a:m,b:g},(function(w,y){var x=y,_=x[0],S=x[1];return t||r?!t&&r?{a:function(){return w.matMul(S,!1,!1)},b:function(){return w.matMul(_,!0,!1)}}:t&&!r?{a:function(){return S.matMul(w,!1,!0)},b:function(){return _.matMul(w,!1,!1)}}:{a:function(){return S.matMul(w,!0,!0)},b:function(){return w.matMul(_,!0,!0)}}:{a:function(){return w.matMul(S,!1,!0)},b:function(){return _.matMul(w,!0,!1)}}}),"BatchMatMul",b).reshape(v)}}),ZE=P({dot_:function(e,n){var t=R(e,"t1","dot"),r=R(n,"t2","dot");k(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var o=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];return k(o===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),eR=P({outerProduct_:function(e,n){var t=R(e,"v1","outerProduct"),r=R(n,"v2","outerProduct");return k(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),ta=P({reverse_:function(e,n){var t=R(e,"x","reverse");if(t.rank===0)return t.clone();var r=dt(n,t.shape);return M.runKernelFunc((function(o){return o.reverse(t,r)}),{$x:t},(function(o){return{$x:function(){return o.reverse(r)}}})).reshapeAs(t)}}),tR=P({reverse1d_:function(e){var n=R(e,"x","reverse");return k(n.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."})),ta(n,0)}}),nR=P({reverse2d_:function(e,n){var t=R(e,"x","reverse");return k(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),ta(t,n)}}),rR=P({reverse3d_:function(e,n){var t=R(e,"x","reverse");return k(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),ta(t,n)}}),oR=P({reverse4d_:function(e,n){var t=R(e,"x","reverse");return k(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),ta(t,n)}});function Lm(e,n,t,r,o,i){var a=R(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),k(s.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),k(Qt(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),i!=null&&k(rt(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Hi(s.shape,n,t,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))return a.clone();var l=[s],f=M.runKernelFunc((function(h,d){var p=h.maxPool(s,c);return d([s,p]),p}),{x:s},(function(h,d){var p=d[0],v=d[1];return{x:function(){return(function(m,g,b,w,y,x,_,S){var I=R(m,"dy","maxPoolBackprop"),C=R(g,"input","maxPoolBackprop"),E=R(b,"output","maxPoolBackprop");k(C.rank===I.rank,(function(){return"Rank of input ("+C.rank+") does not match rank of dy ("+I.rank+")"})),k(Qt(y,x),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+x+"'"})),k(I.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."})),k(C.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+C.rank+"."}));var N=Hi(C.shape,w,y,x,_,S);return M.runKernelFunc((function(T){return T.maxPoolBackprop(I,C,E,N)}),{$dy:I,$input:C})})(h,p,v,n,t,r,o)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Wm(e,n,t,r,o,i){var a=R(e,"x","avgPool","float32");k(Qt(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),k(s.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),i!=null&&k(rt(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Hi(s.shape,n,t,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&gt(c.inShape,c.outShape))return a.clone();var l=M.runKernelFunc((function(f){return f.avgPool(s,c)}),{x:s},(function(f){return{x:function(){return(function(h,d,p,v,m,g){var b=R(h,"dy","avgPoolBackprop"),w=R(d,"input","avgPoolBackprop");k(w.rank===b.rank,(function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+b.rank+")"})),k(Qt(v,m),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"}));var y=w,x=b,_=!1;w.rank===3&&(_=!0,y=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),x=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),k(x.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."})),k(y.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+y.rank+"."}));var S=Hi(y.shape,p,v,m,g),I=M.runKernelFunc((function(C){return C.avgPoolBackprop(x,y,S)}),{dy4D:x,input4D:y});return _?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I})(f,s,n,t,r,o)}}}),"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var mt=P({maxPool_:function(e,n,t,r,o){return Lm(e,n,t,1,r,o)}}),na=P({avgPool_:function(e,n,t,r,o){return Wm(e,n,t,1,r,o)}}),iR=P({pool_:function(e,n,t,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=R(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),k(Qt(i,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}));var c,l=Hi(s.shape,n,i,o,r),f=[l.dilationHeight,l.dilationWidth];c=r==="same"?(function(y,x){var _=y.map((function(C,E){return C+(C-1)*(x[E]-1)})).map((function(C){return C-1})),S=_.map((function(C){return Math.floor(C/2)})),I=_.map((function(C,E){return C-S[E]}));return _.map((function(C,E){return[S[E],I[E]]}))})([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var h=f[0]===1&&f[1]===1,d=(function(y,x,_){var S=_.map((function(F){return F[0]})),I=_.map((function(F){return F[1]})),C=y.concat(S,I),E=x.map((function(F,L){return(F-C[L]%F)%F})),N=I.map((function(F,L){return F+E[L]})),T=x.map((function(F,L){return[S[L],N[L]]})),B=x.map((function(F,L){return[0,E[L]]}));return[T,B]})([l.inHeight,l.inWidth],f,c),p=d[0],v=d[1],m=h?r:"valid",g=h?s:qv(s,f,p),b=(t==="avg"?function(){return Wm(g,n,i,1,m)}:function(){return Lm(g,n,i,1,m)})(),w=h?b:Uv(b,f,v);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),aR=P({maxPool3d_:function(e,n,t,r,o,i,a){i===void 0&&(i="NDHWC");var s=R(e,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),k(u.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),k(i==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),k(Qt(t,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),o!=null&&k(rt(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=es(u.shape,n,t,a,r,o,i),f=M.runKernelFunc((function(h,d){var p=h.maxPool3d(u,l);return d([u,p]),p}),{x:u},(function(h,d){var p=d[0],v=d[1];return{x:function(){return(function(m,g,b,w,y,x,_,S){var I=R(m,"dy","maxPool3dBackprop"),C=R(g,"input","maxPool3dBackprop"),E=R(b,"output","maxPool3dBackprop"),N=I,T=C,B=E,F=!1;C.rank===4&&(F=!0,N=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),T=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),B=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),k(N.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."})),k(T.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."})),k(B.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."})),x==null&&(x=[1,1,1]),k(Qt(y,x),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+x+"'"})),S!=null&&k(rt(_),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."}));var L=es(T.shape,w,y,x,_,S),q=M.runKernelFunc((function(U){return U.maxPool3dBackprop(N,T,B,L)}),{dy5D:N,input5D:T});return F?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q})(h,p,v,n,t,a,r,o)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),sR=P({avgPool3d_:function(e,n,t,r,o,i,a){i===void 0&&(i="NDHWC");var s=R(e,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),k(u.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),k(i==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),k(Qt(t,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),o!=null&&k(rt(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=es(u.shape,n,t,a,r,o,i),f=M.runKernelFunc((function(h){return h.avgPool3d(u,l)}),{x:u},(function(h){return{x:function(){return(function(d,p,v,m,g,b,w){var y=R(d,"dy","avgPool3dBackprop"),x=R(p,"input","avgPool3dBackprop"),_=y,S=x,I=!1;x.rank===4&&(I=!0,_=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),S=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),k(_.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."})),k(S.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."})),g==null&&(g=[1,1,1]),k(Qt(m,g),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"})),w!=null&&k(rt(b),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+b+"."}));var C=es(S.shape,v,m,g,b,w),E=M.runKernelFunc((function(N){return N.avgPool3dBackprop(_,S,C)}),{dy5D:_,input5D:S});return I?E.as4D(E.shape[1],E.shape[2],E.shape[3],E.shape[4]):E})(h,u,n,t,a,r,o)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),jn=P({slice_:function(e,n,t){var r,o,i=R(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof n=="number"?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach((function(u){k(u!==-1,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=t==null?new Array(i.rank).fill(-1):typeof t=="number"?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map((function(u,c){return u>=0?u:(k(u===-1,(function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."})),i.shape[c]-r[c])})),M_(i,r,o);var a=i.shape,s={begin:r,size:o};return M.runKernelFunc((function(u){return u.slice(i,r,o)}),{x:i},(function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}}),"Slice",s)}}),uR=P({slice1d_:function(e,n,t){var r=R(e,"x","slice1d");return k(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),jn(r,[n],[t])}}),cR=P({slice2d_:function(e,n,t){var r=R(e,"x","slice2d");return k(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),jn(r,n,t)}}),Vm=P({slice3d_:function(e,n,t){var r=R(e,"x","slice3d");return k(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),jn(r,n,t)}}),lR=P({slice4d_:function(e,n,t){var r=R(e,"x","slice4d");return k(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),jn(r,n,t)}});function zm(e,n,t,r,o){return n.rank<t.rank&&(n=n.reshape(Yt(n.shape,r))),e.rank<t.rank&&(e=e.reshape(Yt(e.shape,r))),{x:function(){var i=e.mul(t.equal(n).cast(e.dtype));return o==null?i:i.transpose(o)}}}var fR=P({all_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","all","bool"),o=dt(n,r.shape),i=o,a=Xn(i,r.rank);a!=null&&(r=r.transpose(a),i=Yn(i.length,r.rank));var s=M.runKernelFunc((function(c){return c.all(r,i)}),{$x:r});if(t){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),hR=P({any_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","any","bool"),o=dt(n,r.shape),i=o,a=Xn(i,r.rank);a!=null&&(r=r.transpose(a),i=Yn(i.length,r.rank));var s=M.runKernelFunc((function(c){return c.any(r,i)}),{$x:r});if(t){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),dR=P({argMax_:function(e,n){n===void 0&&(n=0);var t=R(e,"x","argMax");n==null&&(n=0);var r=dt(n,t.shape),o=Xn(r,t.rank);o!=null&&(t=t.transpose(o),r=Yn(r.length,t.rank));var i={axis:r[0]},a=[t];return M.runKernelFunc((function(s,u){var c=s.argMax(t,r[0]);return u([t]),c}),{x:t},(function(s,u){var c=u[0];return{x:function(){return Be(c)}}}),"ArgMax",i,a)}}),pR=P({argMin_:function(e,n){n===void 0&&(n=0);var t=R(e,"x","argMin");n==null&&(n=0);var r=dt(n,t.shape),o=Xn(r,t.rank);return o!=null&&(t=t.transpose(o),r=Yn(r.length,t.rank)),M.runKernelFunc((function(i,a){var s=i.argMin(t,r[0]);return a([t]),s}),{$x:t},(function(i,a){var s=a[0];return{$x:function(){return Be(s)}}}))}}),vR=P({logSumExp_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","logSumExp"),o=dt(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(t){var u=Yt(s.shape,o);return s.reshape(u)}return s}}),Fs=P({max_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","max"),o=r,i=dt(n,r.shape),a=i,s=Xn(a,r.rank);s!=null&&(r=r.transpose(s),a=Yn(a.length,r.rank));var u=[r],c=M.runKernelFunc((function(f,h){var d=f.max(r,a);return h([o,d]),d}),{x:r},(function(f,h){return zm(f,h[1],h[0],i,s)}),"Max",{axes:a},u,[!0]);if(t){var l=Yt(c.shape,i);c=c.reshape(l)}return c}}),mR=P({mean_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","mean"),o=dt(n,r.shape),i=ve(kt(r.shape,o)[1]);return As((function(a){var s=ae(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,t),gradFunc:function(u){var c=a.shape.slice();return o.forEach((function(l){c[l]=1})),u.reshape(c).mul(si(a.shape,"float32")).div(i)}}}))(r)}}),gR=P({min_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","min"),o=r,i=dt(n,r.shape),a=i,s=Xn(a,r.rank);s!=null&&(r=r.transpose(s),a=Yn(a.length,r.rank));var u=[r],c=M.runKernelFunc((function(f,h){var d=f.min(r,a);return h([o,d]),d}),{x:r},(function(f,h){return zm(f,h[1],h[0],i,s)}),"Min",{axes:a},u,[!0]);if(t){var l=Yt(c.shape,i);c=c.reshape(l)}return c}}),yR=P({moments_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=dt(n,(e=R(e,"x","moments")).shape),o=e.mean(r,t),i=o.shape;t||(i=Yt(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,t)}}}),Um=P({sum_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=dt(n,r.shape);return As((function(i){var a=Xn(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=Yn(s.length,i.rank));var c=function(d){var p=i.shape.slice();return o.forEach((function(v){p[v]=1})),d.reshape(p).mul(si(i.shape,"float32"))},l={axes:s},f=M.runKernelFunc((function(d){return d.sum(u,s)}),{x:u},(function(d){return{x:function(){return c(d)}}}),"Sum",l);if(t){var h=Yt(f.shape,o);f=f.reshape(h)}return{value:f,gradFunc:c}}))(r)}}),bR=P({prod_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=R(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=dt(n,r.shape),i=Xn(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=Yn(a.length,r.rank));var u=M.runKernelFunc((function(l){return l.prod(s,a)}),{permutedX:s});if(t){var c=Yt(u.shape,o);u=u.reshape(c)}return u}}),Hm=P({elu_:function(e){var n=R(e,"x","elu");return M.runKernelFunc((function(t,r){var o=t.elu(n);return r([o]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return M.runKernelFunc((function(i){return i.eluDer(t,o)}),{dy:t,y:o})}}}))}}),xR=P({leakyRelu_:function(e,n){n===void 0&&(n=.2);var t=R(e,"x","leakyRelu");return _l(ae(n).mul(t),t)}}),Gm=P({prelu_:function(e,n){var t=R(e,"x","prelu"),r=R(n,"alpha","prelu");return M.runKernelFunc((function(o,i){var a=o.prelu(t,r);return i([t,r]),a}),{x:t,alpha:r},(function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return lo(u,o,o.mul(s))},alpha:function(){var c=lo(u,Be(o),o.mul(a)),l=ft(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}}),"Prelu")}}),Ze=P({relu_:function(e){var n=R(e,"x","relu");return n.dtype==="bool"?n.toInt():M.runKernelFunc((function(t,r){var o=t.relu(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mulStrict(o.step().toFloat())}}}),"Relu")}}),qm=P({relu6_:function(e){var n=R(e,"x","relu6");return n.dtype==="bool"?n.toInt():M.runKernelFunc((function(t,r){var o=t.relu6(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return t.mulStrict(i.toFloat())}}}),"Relu6")}}),wR=P({selu_:function(e){var n=R(e,"x","selu");return M.runKernelFunc((function(t,r){var o=t.selu(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){var i=o.greater(ae(0)),a=ae(bl),s=ae(xl),u=t.mul(s),c=t.mul(a).mul(o.toFloat().exp());return lo(i,u,c)}}}))}}),Br=P({transpose_:function(e,n){var t=R(e,"x","transpose");if(n==null&&(n=t.shape.map((function(o,i){return i})).reverse()),k(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."})),n.forEach((function(o){k(o>=0&&o<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n}))})),t.rank<=1)return t.clone();var r={perm:n};return M.runKernelFunc((function(o){return o.transpose(t,n)}),{x:t},(function(o){var i=cl(n);return{x:function(){return o.transpose(i)}}}),"Transpose",r)}}),_R=P({localResponseNormalization_:function(e,n,t,r,o){n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=R(e,"x","localResponseNormalization");k(i.rank===4||i.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."})),k(rt(n),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."}));var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=M.runKernelFunc((function(c,l){var f=c.localResponseNormalization4D(a,n,t,r,o);return l([a,f]),f}),{x4D:a},(function(c,l){var f=l[0],h=l[1];return{x4D:function(){return M.runKernelFunc((function(d){return d.LRNGrad(c,f,h,n,t,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jm=P({norm_:function(e,n,t,r){n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var o=(function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(ae(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)})(e=R(e,"x","norm"),n,t),i=o.shape;if(r){var a=dt(t,e.shape);i=Yt(o.shape,a)}return o.reshape(i)}}),CR=P({basicLSTMCell_:function(e,n,t,r,o,i){var a=R(e,"forgetBias","basicLSTMCell"),s=R(n,"lstmKernel","basicLSTMCell"),u=R(t,"lstmBias","basicLSTMCell"),c=R(r,"data","basicLSTMCell"),l=R(o,"c","basicLSTMCell"),f=R(i,"h","basicLSTMCell"),h=c.concat(f,1).matMul(s).add(u),d=h.shape[0],p=h.shape[1]/4,v=[d,p],m=h.slice([0,0],v),g=h.slice([0,p],v),b=h.slice([0,2*p],v),w=h.slice([0,3*p],v),y=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),x=y.tanh().mulStrict(w.sigmoid());return[y,x]}}),ER=P({multiRNNCell_:function(e,n,t,r){for(var o=R(n,"data","multiRNNCell"),i=$a(t,"c","multiRNNCell"),a=$a(r,"h","multiRNNCell"),s=o,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],h=[];for(c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}}),RR=P({movingAverage_:function(e,n,t,r,o){o===void 0&&(o=!0);var i=R(e,"v","movingAverage"),a=R(n,"x","movingAverage"),s=R(t,"decay","movingAverage");_w(i,a),k(gt(i.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=ae(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){k(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var f=R(r,"step","movingAverage");l=l.div(u.sub(os(s,f)))}return i.add(l)}}),SR=P({stridedSlice_:function(e,n,t,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(n.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=R(e,"x","stridedSlice"),l=$h(s),f=c.shape.slice();l.forEach((function(m){n[m]=0,t[m]=1,f.splice(m,0,1)})),c=c.reshape(f);for(var h=0;h<c.rank;h++)n[h]=O_(o,n,r,c.shape,h),t[h]=B_(i,t,r,c.shape,h),r[h]=r[h]||1;var d=$h(u);d.forEach((function(m){t[m]=n[m]+1,r[m]=1}));var p=dl(n,t,r),v=p.filter((function(m,g){return d.indexOf(g)===-1}));return r.every((function(m){return m===1}))?jn(c,n,p).reshape(v):M.runKernelFunc((function(m){return m.stridedSlice(c,n,t,r)}),{$x:c}).reshape(v)}}),IR=P({topk_:function(e,n,t){n===void 0&&(n=1),t===void 0&&(t=!0);var r=R(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=M.runKernelFunc((function(a){return a.topk(r,n,t)}),{$x:r});return{values:i[0],indices:i[1]}}}),kR=P({scatterND_:function(e,n,t){var r=R(e,"indices","scatterND","int32"),o=R(n,"updates","scatterND");return F_(o,r,t),M.runKernelFunc((function(i){return i.scatterND(r,o,t)}),{indices:r,updates:o},null,"ScatterNd",{shape:t})}}),Sl=P({fft_:function(e){k(e.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return M.runKernelFunc((function(o){return o.fft(r)}),{input:e}).reshape(e.shape)}}),is=P({ifft_:function(e){k(e.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return M.runKernelFunc((function(o){return o.ifft(r)}),{input:e}).reshape(e.shape)}}),Il=P({rfft_:function(e,n){k(e.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var t,r=e.shape[e.shape.length-1],o=e.size/r;if(n!=null&&n<r){var i=e.shape.map((function(g){return 0})),a=e.shape.map((function(g){return g}));a[e.shape.length-1]=n,t=e.slice(i,a),r=n}else if(n!=null&&n>r){var s=e.shape.map((function(g){return g}));s[e.shape.length-1]=n-r,t=e.concat($e(s),e.shape.length-1),r=n}else t=e;var u=t.zerosLike(),c=wt(t,u).as2D(o,r),l=Sl(c),f=Math.floor(r/2)+1,h=dn(l),d=Vn(l),p=h.split([f,r-f],h.shape.length-1),v=d.split([f,r-f],d.shape.length-1),m=t.shape.slice();return m[t.shape.length-1]=f,wt(p[0],v[0]).reshape(m)}}),Km=P({irfft_:function(e){var n=e.shape[e.shape.length-1],t=e.size/n;if(n<=2){var r=e.as2D(t,n),o=is(r);return dn(o)}var i=[t,2*(n-1)],a=dn(e).as2D(t,n),s=Vn(e).as2D(t,n),u=a.slice([0,1],[t,n-2]).reverse(1),c=s.slice([0,1],[t,n-2]).reverse(1).mul(ae(-1)),l=a.concat(u,1),f=s.concat(c,1);return r=wt(l,f).as2D(i[0],i[1]),o=is(r),dn(o)}}),AR=Object.freeze({fft:Sl,ifft:is,rfft:Il,irfft:Km}),TR=P({sparseToDense_:function(e,n,t,r){r===void 0&&(r=0);var o=R(e,"sparseIndices","sparseToDense","int32"),i=R(n,"sparseValues","sparseToDense"),a=R(r,"defaultValue","sparseToDense",i.dtype);return(function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var f=s.rank>0?s.shape[0]:1,h=s.rank>1?s.shape[1]:1;if(c.length!==h)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+h+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==f))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+f+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(o,i,t,a),M.runKernelFunc((function(s){return s.sparseToDense(o,i,t,a)}),{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),DR=P({gatherND_:function(e,n){var t=R(n,"indices","gatherND","int32"),r=R(e,"x","gatherND");return M.runKernelFunc((function(o){return o.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),NR=P({diag_:function(e){var n=R(e,"x","diag").flatten(),t=e.shape.concat(e.shape);return M.runKernelFunc((function(r){return r.diag(n)}),{$x:n}).reshape(t)}}),PR=P({dropout_:function(e,n,t,r){var o=R(e,"x","dropout");if(k(o.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),k(n>=0&&n<1,(function(){return"rate must be a float in the range [0, 1), but got "+n+"."})),n===0)return e instanceof Je?o.clone():o;var i=(function(u,c){if(c==null)return u.shape.slice();if(gt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],f=0;f<u.shape.length;f++)c[f]==null&&u.shape[f]!=null?l.push(u.shape[f]):l.push(c[f]);return l}return c})(o,t),a=1-n,s=Gv(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function $m(e,n,t){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=n-t*Math.cos(a)}return it(o,"float32")}var kl=P({hannWindow_:function(e){return $m(e,.5,.5)}}),Xm=P({hammingWindow_:function(e){return $m(e,.54,.46)}}),Al=P({frame_:function(e,n,t,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+n<=e.size;)a.push(jn(e,i,n)),i+=t;if(r)for(;i<e.size;){var s=i+n-e.size,u=ct([jn(e,i,n-s),qn([s],o)]);a.push(u),i+=t}return a.length===0?Dr([],[0,n]):ct(a).as2D(a.length,n)}}),Ym=P({stft_:function(e,n,t,r,o){var i;o===void 0&&(o=kl),r==null&&(i=n,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Al(e,n,t),s=Bt(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(Il(s.slice([c,0],[1,n]),r));return ct(u)}}),FR=Object.freeze({hannWindow:kl,hammingWindow:Xm,frame:Al,stft:Ym}),Mt,MR=function(e,n,t){return t===void 0&&(t=1),he(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,h,d,p,v,m;return de(this,(function(g){switch(g.label){case 0:return r=R(e,"predictions","inTopK"),o=R(n,"targets","inTopK"),k(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),k(r.rank-1===o.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank})),He(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],k(t>0&&t<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+t})),[4,r.data()];case 1:return a=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[a.length/i,i],l=u[1],f=Vi("bool",c=u[0]),h=0;h<c;h++){for(d=h*l,p=a.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort((function(b,w){return w.value-b.value})),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return e!==r&&r.dispose(),n!==o&&o.dispose(),[2,Ct(f,o.shape,"bool")]}}))}))};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mt||(Mt={}));var OR=P({absoluteDifference_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","absoluteDifference"),i=R(n,"predictions","absoluteDifference"),a=null;t!=null&&(a=R(t,"weights","absoluteDifference")),He(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return mr(s,a,r)}}),mr=P({computeWeightedLoss_:function(e,n,t){t===void 0&&(t=Mt.SUM_BY_NONZERO_WEIGHTS);var r=R(e,"losses","computeWeightedLoss"),o=null;n!=null&&(o=R(n,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(t===Mt.NONE)return i;if(t===Mt.SUM)return i.sum();if(t===Mt.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(ae(a)):s}if(t===Mt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(ae(r.size));var u=o.mul(si(r.shape)).notEqual(ae(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+t)}}),BR=P({cosineDistance_:function(e,n,t,r,o){o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","cosineDistance"),a=R(n,"predictions","cosineDistance"),s=null;r!=null&&(s=R(r,"weights","cosineDistance")),He(i.shape,a.shape,"Error in cosineDistance: ");var u=ae(1).sub(i.mul(a).sum(t,!0));return mr(u,s,o)}}),LR=P({hingeLoss_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","hingeLoss"),i=R(n,"predictions","hingeLoss"),a=null;t!=null&&(a=R(t,"weights","hingeLoss")),He(o.shape,i.shape,"Error in hingeLoss: ");var s=ae(1);o=ae(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return mr(u,a,r)}}),WR=P({huberLoss_:function(e,n,t,r,o){r===void 0&&(r=1),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","huberLoss"),a=R(n,"predictions","huberLoss"),s=null;t!=null&&(s=R(t,"weights","huberLoss")),He(i.shape,a.shape,"Error in huberLoss: ");var u=ae(r),c=a.sub(i).abs(),l=Am(c,u),f=c.sub(l),h=ae(.5).mul(l.square()).add(u.mul(f));return mr(h,s,o)}}),VR=P({logLoss_:function(e,n,t,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"labels","logLoss"),a=R(n,"predictions","logLoss"),s=null;t!=null&&(s=R(t,"weights","logLoss")),He(i.shape,a.shape,"Error in logLoss: ");var u=ae(1),c=ae(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return mr(l,s,o)}}),zR=P({meanSquaredError_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=R(e,"labels","meanSquaredError"),i=R(n,"predictions","meanSquaredError"),a=null;t!=null&&(a=R(t,"weights","meanSquaredError")),He(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return mr(s,a,r)}}),UR=P({sigmoidCrossEntropy_:function(e,n,t,r,o){r===void 0&&(r=0),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"multiClassLabels","sigmoidCrossEntropy"),a=R(n,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=R(t,"weights","sigmoidCrossEntropy")),He(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ae(r),c=ae(1),l=ae(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var f=(function(h,d){var p=R(h,"labels","sigmoidCrossEntropyWithLogits"),v=R(d,"logits","sigmoidCrossEntropyWithLogits");He(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=v.relu(),g=v.mul(p),b=v.abs().neg().exp().log1p();return m.sub(g).add(b)})(i,a);return mr(f,s,o)}}),HR=P({softmaxCrossEntropy_:function(e,n,t,r,o){r===void 0&&(r=0),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=R(e,"onehotLabels","softmaxCrossEntropy"),a=R(n,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=R(t,"weights","softmaxCrossEntropy")),He(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ae(r),c=ae(1),l=ae(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var f=(function(h,d,p){if(p===void 0&&(p=-1),p===-1&&(p=d.rank-1),p!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+p);return As((function(v,m,g){var b=m.logSumExp([p],!0),w=m.toFloat().sub(b);return g([v,w]),{value:w.mul(v).neg().sum([p]),gradFunc:function(y,x){var _=x[0],S=x[1],I=Yt(y.shape,[p]);return[y.reshape(I).mul(_.toFloat().sub(S.exp())),y.reshape(I).mul(S.exp().sub(_.toFloat()))]}}}))(h,d)})(i,a);return mr(f,s,o)}}),GR=Object.freeze({get Reduction(){return Mt},absoluteDifference:OR,computeWeightedLoss:mr,cosineDistance:BR,hingeLoss:LR,huberLoss:WR,logLoss:VR,meanSquaredError:zR,sigmoidCrossEntropy:UR,softmaxCrossEntropy:HR});function md(e,n){return n===void 0&&(n=!1),M.tidy((function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var t=e.shape[0],r=e.shape[1],o=Hv(t),i=e.clone(),a=Dr([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,c=function(f){var h,d=i,p=s,v=o;h=M.tidy((function(){var m=i.slice([f,f],[t-f,1]),g=m.norm(),b=i.slice([f,f],[1,1]),w=Dr([[-1]]).where(b.greater(0),Dr([[1]])),y=b.sub(w.mul(g)),x=m.div(y);s=x.shape[0]===1?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var _=w.matMul(y).div(g).neg(),S=i.slice([f,0],[t-f,r]),I=_.mul(s);if(f===0)i=S.sub(I.matMul(s.transpose().matMul(S)));else{var C=S.sub(I.matMul(s.transpose().matMul(S)));i=i.slice([0,0],[f,r]).concat(C,0)}var E=o.slice([0,f],[t,o.shape[1]-f]);if(f===0)o=E.sub(E.matMul(s).matMul(I.transpose()));else{var N=E.sub(E.matMul(s).matMul(I.transpose()));o=o.slice([0,0],[t,f]).concat(N,1)}return[s,i,o]})),s=h[0],i=h[1],o=h[2],Xt([d,p,v])},l=0;l<u;++l)c(l);return!n&&t>r&&(o=o.slice([0,0],[t,r]),i=i.slice([0,0],[r,r])),[o,i]}))}var qR=P({bandPart_:function(e,n,t){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=R(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),t<0&&(t=s);var u=Xa(0,a,1,"int32").reshape([-1,1]),c=Xa(0,s,1,"int32"),l=ht(u,c),f=Ds(l.lessEqual(ae(+n,"int32")),l.greaterEqual(ae(-t,"int32"))),h=$e([a,s],r.dtype);return an(lt(r.reshape([-1,a,s])).map((function(d){return lo(f,d,h)}))).reshape(o)}}),jR=P({gramSchmidt_:function(e){var n;if(Array.isArray(e)){n=!1,k(e!=null&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=e[0].shape[0],r=function(u){k(e[u].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+t+")"}))},o=1;o<e.length;++o)r(o)}else n=!0,e=fl(e,e.shape[0],0).map((function(u){return jv(u,[0])}));k(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var i=[],a=e,s=function(u){i.push(M.tidy((function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var f=Um(i[l].mulStrict(c)).mul(i[l]);c=c.sub(f)}return c.div(jm(c,"euclidean"))})))};for(o=0;o<e.length;++o)s(o);return n?an(i,0):i}}),KR=P({qr_:function(e,n){if(n===void 0&&(n=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return md(e,n);var t=e.shape.slice(0,e.shape.length-2).reduce((function(a,s){return a*s})),r=lt(e.reshape([t,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach((function(a){var s=md(a,n),u=s[0],c=s[1];o.push(u),i.push(c)})),[an(o,0).reshape(e.shape),an(i,0).reshape(e.shape)]}}),$R=Object.freeze({bandPart:qR,gramSchmidt:jR,qr:KR});function Ms(e,n,t,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=e.shape[0];return t=Math.min(t,a),k(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),k(e.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),k(e.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),k(n.rank===1,(function(){return"scores must be a 1D tensor"})),k(n.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]})),k(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var XR=P({resizeBilinear_:function(e,n,t){t===void 0&&(t=!1);var r=R(e,"images","resizeBilinear");k(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),k(n.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."}));var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=M.runKernelFunc((function(c,l){return l([o]),c.resizeBilinear(o,a,s,t)}),{x:o},(function(c,l){return{x:function(){return M.runKernelFunc((function(f){return f.resizeBilinearBackprop(c,l[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),YR=P({resizeNearestNeighbor_:function(e,n,t){t===void 0&&(t=!1);var r=R(e,"images","resizeNearestNeighbor");k(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),k(n.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."})),k(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=M.runKernelFunc((function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,t)}),{batchImages:o},(function(c,l){return{batchImages:function(){return M.runKernelFunc((function(f){return f.resizeNearestNeighborBackprop(c,l[0],t)}),{})}}}));return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),QR=P({nonMaxSuppression_:function(e,n,t,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=R(e,"boxes","nonMaxSuppression"),a=R(n,"scores","nonMaxSuppression"),s=Ms(i,a,t,r,o);t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:o};return M.runKernelFunc((function(c){return c.nonMaxSuppression(i,a,t,r,o)}),{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),JR=function(e,n,t,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),he(this,void 0,void 0,(function(){var i,a,s,u,c,l,f;return de(this,(function(h){switch(h.label){case 0:return i=R(e,"boxes","nonMaxSuppressionAsync"),a=R(n,"scores","nonMaxSuppressionAsync"),s=Ms(i,a,t,r,o),t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=vl(c,l,t,r,o),i!==e&&i.dispose(),a!==n&&a.dispose(),[2,f]}}))}))},ZR=P({nonMaxSuppressionWithScore_:function(e,n,t,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=R(e,"boxes","nonMaxSuppression"),s=R(n,"scores","nonMaxSuppression"),u=Ms(a,s,t,r,o,i),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=M.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),eS=function(e,n,t,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),he(this,void 0,void 0,(function(){var a,s,u,c,l,f,h;return de(this,(function(d){switch(d.label){case 0:return a=R(e,"boxes","nonMaxSuppressionAsync"),s=R(n,"scores","nonMaxSuppressionAsync"),u=Ms(a,s,t,r,o,i),t=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=d.sent(),l=c[0],f=c[1],h=ml(l,f,t,r,o,i),a!==e&&a.dispose(),s!==n&&s.dispose(),[2,h]}}))}))},tS=P({cropAndResize_:function(e,n,t,r,o,i){var a=R(e,"image","cropAndResize"),s=R(n,"boxes","cropAndResize","float32"),u=R(t,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return k(a.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),k(s.rank===2&&s.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),k(u.rank===1&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),k(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),k(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),k(o==="bilinear"||o==="nearest",(function(){return"method must be bilinear or nearest, but was "+o})),M.runKernelFunc((function(l,f){return l.cropAndResize(a,s,u,r,o,i)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Tl=Object.freeze({resizeBilinear:XR,resizeNearestNeighbor:YR,nonMaxSuppression:QR,nonMaxSuppressionAsync:JR,nonMaxSuppressionWithScore:ZR,nonMaxSuppressionWithScoreAsync:eS,cropAndResize:tS}),Dl=function(e,n){return!(e>0)||n==="linear"},Nl=function(e,n,t){if(t==null||t==="linear")return e;if(t==="relu")return e.mul(n.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},Pl=function(e,n){var t=n,r=ft(e.shape,n.shape);return r.length>0&&(t=t.sum(r)),t.reshape(e.shape)},Fl=function(e,n,t){if(n==="linear")return e;if(n==="relu")return Ze(e);if(n==="elu")return Hm(e);if(n==="relu6")return qm(e);if(n==="prelu")return Gm(e,t);throw new Error("Unknown fused activation "+n+".")},nS=P({fusedMatMul_:function(e){var n,t=e.a,r=e.b,o=e.transposeA,i=o!==void 0&&o,a=e.transposeB,s=a!==void 0&&a,u=e.bias,c=e.activation,l=c===void 0?"linear":c,f=e.preluActivationWeights;if(Dl(M.state.gradientDepth,l)===!1){var h=Ps(t,r,i,s);return u!=null&&(h=Me(h,u)),Fl(h,l,f)}var d=R(t,"a","fused matMul"),p=R(r,"b","fused matMul");n=et(d,p),d=n[0],p=n[1];var v=i?d.shape[d.rank-2]:d.shape[d.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=i?d.shape[d.rank-1]:d.shape[d.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],w=d.shape.slice(0,-2),y=p.shape.slice(0,-2),x=ve(w),_=ve(y);k(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."})),k(gt(w,y),(function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+y+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."})),k(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."}));var S,I,C=d.shape.slice(0,-2).concat([g,b]),E=i?d.as3D(x,v,g):d.as3D(x,g,v),N=s?p.as3D(_,b,m):p.as3D(_,m,b);u!=null&&Oe(C,(S=et(S=R(u,"bias","fused matMul"),d)[0]).shape),f!=null&&(I=R(f,"prelu weights","fused matMul"));var T={a:E,b:N};u!=null&&(T.bias=S),f!=null&&(T.preluActivationWeights=I);var B=[E,N];return M.runKernelFunc((function(F,L){var q=F.fusedBatchMatMul({a:E,b:N,transposeA:i,transposeB:s,bias:S,activation:l,preluActivationWeights:I});return L([E,N,q]),q}),T,(function(F,L){var q=L[0],U=L[1],W=L[2],X=Nl(F,W,l),Q={};return u!=null&&(Q={bias:function(){return Pl(S,X)}}),Object.assign(i||s?!i&&s?{a:function(){return X.matMul(U,!1,!1)},b:function(){return X.matMul(q,!0,!1)}}:i&&!s?{a:function(){return U.matMul(X,!1,!0)},b:function(){return q.matMul(X,!1,!1)}}:{a:function(){return U.matMul(X,!0,!0)},b:function(){return X.matMul(q,!0,!0)}}:{a:function(){return X.matMul(U,!1,!0)},b:function(){return q.matMul(X,!0,!1)}},Q)}),"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},B,[!0]).reshape(C)}}),rS=P({fusedConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,h=f===void 0?"linear":f,d=e.preluActivationWeights;if(h=h||"linear",Dl(M.state.gradientDepth,h)===!1){var p=yn(n,t,r,o,a,u,c);return l!=null&&(p=Me(p,l)),Fl(p,h,d)}var v=R(n,"x","conv2d"),m=R(t,"filter","conv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),k(g.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),k(m.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),c!=null&&k(rt(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),k(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),k(Qt(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),k(a==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var w,y,x=mo(g.shape,m.shape,r,u,o,c);l!=null&&(w=et(w=R(l,"bias","fused conv2d"),v)[0],Oe(x.outShape,w.shape)),d!=null&&(y=R(d,"prelu weights","fused conv2d"));var _={x:g,filter:m};l!=null&&(_.bias=w),d!=null&&(_.preluActivationWeights=y);var S=[m,g],I=M.runKernelFunc((function(C,E){var N=C.fusedConv2d({input:g,filter:m,convInfo:x,bias:w,activation:h,preluActivationWeights:y});return E([m,g,N]),N}),_,(function(C,E){var N=E,T=N[0],B=N[1],F=N[2],L=Nl(C,F,h);k(ii(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var q={};return l!=null&&(q={bias:function(){return Pl(w,L)}}),Object.assign({x:function(){return Mm(B.shape,L,T,r,o)},filter:function(){return El(B,L,T.shape,r,o)}},q)}),"FusedConv2D",{convInfo:x,activation:h},S,[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),oS=P({fusedDepthwiseConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,h=f===void 0?"linear":f,d=e.preluActivationWeights;if(Dl(M.state.gradientDepth,h)===!1){var p=Ns(n,t,r,o,a,u,c);return l!=null&&(p=Me(p,l)),Fl(p,h,d)}var v=R(n,"x","depthwiseConv2d"),m=R(t,"filter","depthwiseConv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),k(g.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),k(m.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),k(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),u==null&&(u=[1,1]),k(Qt(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),c!=null&&k(rt(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var w,y,x=mo(g.shape,m.shape,r,u,o,c,!0);l!=null&&(w=et(w=R(l,"bias","fused conv2d"),v)[0],Oe(x.outShape,w.shape)),d!=null&&(y=R(d,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:m};l!=null&&(_.bias=w),d!=null&&(_.preluActivationWeights=y);var S=[m,g],I=M.runKernelFunc((function(C,E){var N=C.fusedDepthwiseConv2D({input:g,filter:m,convInfo:x,bias:w,activation:h,preluActivationWeights:y});return E([m,g,N]),N}),_,(function(C,E){k(ii(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var N=E[0],T=E[1],B=E[2],F=Nl(C,B,h),L={};return l!=null&&(L={bias:function(){return Pl(w,F)}}),Object.assign({x:function(){return Om(T.shape,F,N,x)},filter:function(){return Bm(T,F,N.shape,x)}},L)}),"FusedDepthwiseConv2D",{convInfo:x,activation:h},S,[!0]);return b?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),iS=Object.freeze({matMul:nS,conv2d:rS,depthwiseConv2d:oS}),aS=Object.freeze({image:Tl,linalg:$R,losses:GR,spectral:AR,fused:iS,signal:FR,square:VC,squaredDifference:bm,conv1d:XE,conv2d:yn,conv3d:YE,depthwiseConv2d:Ns,separableConv2d:Rl,conv2dTranspose:QE,conv3dTranspose:JE,op:P,batchNormalization2d:mE,batchNormalization3d:gE,batchNormalization4d:yE,batchNormalization:bE,batchNorm:Rm,batchNorm2d:xE,batchNorm3d:wE,batchNorm4d:_E,booleanMaskAsync:$E,complex:wt,real:dn,imag:Vn,concat:ct,concat1d:i_,concat2d:a_,concat3d:s_,concat4d:u_,split:fl,matMul:Ps,dot:ZE,outerProduct:eR,reverse:ta,reverse1d:tR,reverse2d:nR,reverse3d:rR,reverse4d:oR,maxPool:mt,avgPool:na,pool:iR,maxPool3d:aR,avgPool3d:sR,slice:jn,slice1d:uR,slice2d:cR,slice3d:Vm,slice4d:lR,abs:zC,acos:UC,acosh:HC,asin:GC,asinh:qC,atan:jC,atanh:KC,ceil:$C,clipByValue:wl,cos:XC,cosh:YC,erf:QC,exp:Sc,expm1:JC,floor:ZC,log:eE,log1p:tE,logSigmoid:nE,neg:rs,reciprocal:rE,round:oE,rsqrt:xm,sigmoid:wm,sign:iE,isNaN:aE,isInf:sE,isFinite:uE,sin:cE,sinh:lE,softplus:fE,sqrt:hE,step:dE,tan:pE,tanh:vE,all:fR,any:hR,argMax:dR,argMin:pR,logSumExp:vR,max:Fs,mean:mR,min:gR,moments:yR,sum:Um,prod:bR,equal:Tm,equalStrict:LE,greater:WE,greaterEqual:Dm,greaterEqualStrict:VE,greaterStrict:zE,less:UE,lessEqual:HE,lessEqualStrict:GE,lessStrict:qE,notEqual:jE,notEqualStrict:KE,add:Me,addN:RE,addStrict:SE,atan2:IE,div:wn,divNoNan:kE,divStrict:AE,floorDiv:km,maximum:_l,maximumStrict:TE,minimum:Am,minimumStrict:DE,mod:NE,modStrict:PE,mul:Bt,mulStrict:FE,pow:os,powStrict:ME,squaredDifferenceStrict:OE,sub:ht,subStrict:BE,elu:Hm,leakyRelu:xR,prelu:Gm,relu:Ze,relu6:qm,selu:wR,logicalAnd:Ds,logicalNot:CE,logicalOr:Sm,logicalXor:EE,where:lo,whereAsync:Im,buffer:Te,print:g_,batchToSpaceND:Uv,broadcastTo:y_,cast:b_,clone:x_,cumsum:w_,depthToSpace:__,expandDims:fn,eye:Hv,multinomial:C_,oneHot:_c,pad:vo,pad1d:E_,pad2d:R_,pad3d:S_,pad4d:I_,rand:k_,randomNormal:A_,randomGamma:T_,randomUniform:Gv,reshape:_n,spaceToBatchND:qv,squeeze:jv,stack:an,tile:Ko,truncatedNormal:D_,unstack:lt,setdiff1dAsync:N_,fill:qn,linspace:o_,ones:si,range:Xa,scalar:ae,tensor:Ct,tensor1d:it,tensor2d:Dr,tensor3d:ll,tensor4d:jt,tensor5d:t_,tensor6d:n_,variable:r_,zeros:$e,onesLike:zv,zerosLike:Be,transpose:Br,softmax:vr,logSoftmax:W_,localResponseNormalization:_R,norm:jm,gather:Cl,unsortedSegmentSum:Nm,basicLSTMCell:CR,multiRNNCell:ER,movingAverage:RR,stridedSlice:SR,topk:IR,scatterND:kR,fft:Sl,ifft:is,rfft:Il,irfft:Km,sparseToDense:TR,gatherND:DR,diag:NR,dropout:PR,hannWindow:kl,hammingWindow:Xm,frame:Al,stft:Ym,inTopKAsync:MR});function Y(e,n){Array.isArray(e)||(e=[e]),e.forEach((function(t){t!=null&&k(t.dtype!=="complex64",(function(){return n+" does not support complex64 tensors."}))}))}function Du(e,n,t,r){if(t==="linear")return e.linear(n);if(t==="relu")return e.relu(n);if(t==="elu")return e.elu(n);if(t==="relu6")return e.relu6(n);if(t==="prelu")return e.prelu(n,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var sS=(function(e){function n(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Zv(t,M),t}return An(n,e),n.prototype.write=function(t,r,o){this.firstUse&&(this.firstUse=!1,K().get("IS_NODE")&&Ka(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:t,dtype:o}),i},n.prototype.move=function(t,r,o,i){this.data.set(t,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){return[2,this.readSync(t)]}))}))},n.prototype.readSync=function(t){var r=this.data.get(t),o=r.dtype,i=r.complexTensors;return o==="complex64"?Rc(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(t).values},n.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),o=r;if(t.dtype==="string")try{o=r.map((function(i){return Ga(i)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(t.shape,t.dtype,o)},n.prototype.makeOutput=function(t,r,o){var i=this.write(t,r,o);return M.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return he(this,void 0,void 0,(function(){var r;return de(this,(function(o){return r=Ln(),t(),[2,{kernelMs:Ln()-r}]}))}))},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,r){var o=this.makeOutput(null,t.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:M.keep(t.clone()),imag:M.keep(r.clone())},o},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,o){if(Y(t,"slice"),Qv(t.shape,r,o)){var i=Jv(r,t.strides),a=ve(o);return Ct(this.readSync(t.dataId).subarray(i,i+a),o,t.dtype)}for(var s=Te(o,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c).map((function(f,h){return f+r[h]}));s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(t,r,o,i){Y(t,"stridedSlice");var a=dl(r,o,i);if(a.some((function(d){return d===0})))return Ct([],a);for(var s=Te(a,t.dtype),u=this.bufferSync(t),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),f=new Array(l.length),h=0;h<f.length;h++)f[h]=l[h]*i[h]+r[h];s.set.apply(s,[u.get.apply(u,f)].concat(l))}return s.toTensor()},n.prototype.diag=function(t){for(var r=this.readSync(t.dataId),o=Te([t.size,t.size],t.dtype),i=o.values,a=0;a<r.length;a++)i[a*t.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},n.prototype.reverse=function(t,r){Y(t,"reverse");for(var o=Te(t.shape,t.dtype),i=this.bufferSync(t),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach((function(f){return l[f]=t.shape[f]-1-l[f]})),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(t,r){var o=this;if(t[0].dtype==="complex64"){var i=t.map((function(d){return dn(d)})),a=t.map((function(d){return Vn(d)}));return wt(this.concat(i,r),this.concat(a,r))}var s=t.map((function(d){var p=ve(d.shape.slice(r));return d.as2D(-1,p)})),u=oi(s.map((function(d){return d.shape})),1),c=Te(u,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach((function(d){c.set(o.readSync(d.dataId),l),l+=d.size}))}else{var f=0;s.forEach((function(d){for(var p=o.readSync(d.dataId),v=0,m=0;m<d.shape[0];++m)for(var g=m*u[1]+f,b=0;b<d.shape[1];++b)c[g+b]=p[v++];f+=d.shape[1]}))}var h=oi(t.map((function(d){return d.shape})),r);return Ct(c,h,t[0].dtype)},n.prototype.neg=function(t){return Y(t,"neg"),this.multiply(ae(-1),t)},n.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o+a,imag:i+s}})):this.broadcastedBinaryOp(t,r,_t(t.dtype,r.dtype),(function(o,i){return o+i}))},n.prototype.addN=function(t){var r=this;Y(t,"addN");for(var o=t.map((function(l){return r.readSync(l.dataId)})),i=Te(t[0].shape,t[0].dtype),a=i.values,s=0;s<t.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(t,r){var o=dt([r],t.shape),i=this.max(t,o),a=Yt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o-a,imag:i-s}})):this.broadcastedBinaryOp(t,r,_t(t.dtype,r.dtype),(function(o,i){return o-i}))},n.prototype.pow=function(t,r){return Y([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.pow(o,i)}))},n.prototype.batchMatMul=function(t,r,o,i){Y([t,r],"matMul");for(var a=o?t.shape[1]:t.shape[2],s=o?t.shape[2]:t.shape[1],u=i?r.shape[1]:r.shape[2],c=t.shape[0],l=this.readSync(t.dataId),f=this.readSync(r.dataId),h=o?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],d=h[0],p=h[1],v=h[2],m=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=m[0],b=m[1],w=m[2],y=s*u,x=Te([c,s,u],t.dtype),_=x.values,S=this.blockSize,I=0;I<c;I++)for(var C=0;C<s;C+=S)for(var E=0;E<u;E+=S)for(var N=0;N<a;N+=S)for(var T=Math.min(C+S,s),B=Math.min(E+S,u),F=Math.min(N+S,a),L=C;L<T;L++)for(var q=E;q<B;q++){for(var U=0,W=N;W<F;W++)U+=l[I*d+L*p+W*v]*f[W*g+q*b+I*w];_[I*y+(L*u+q)]+=U}return x.toTensor()},n.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=this.batchMatMul(r,o,i,a);return s&&(l=this.add(l,s)),u&&(l=Du(this,l,u,c)),l},n.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}})):this.broadcastedBinaryOp(t,r,_t(t.dtype,r.dtype),(function(o,i){return o*i}))},n.prototype.realDivide=function(t,r){return Y([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(o,i){return o/i}))},n.prototype.floorDiv=function(t,r){return Y([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(o,i){return Math.floor(o/i)}))},n.prototype.sum=function(t,r){Y(t,"sum"),Zt("sum",r,t.rank);for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,_t(t.dtype,"int32")),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=0,p=0;p<u;++p)d+=l[h+p];c[f]=d}return s},n.prototype.prod=function(t,r){Y(t,"sum");for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,_t(t.dtype,"int32")),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=1,p=0;p<u;++p)d*=l[h+p];c[f]=d}return s},n.prototype.unsortedSegmentSum=function(t,r,o){Y(t,"unsortedSegmentSum");for(var i=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=ae(s,"int32"),c=Tm(u,r).asType("float32").mul(t).sum(0);i.push(c)}return an(i)},n.prototype.argMin=function(t,r){Y(t,"argMin");var o=[r];Zt("argMin",o,t.rank);for(var i=kt(t.shape,o),a=i[0],s=i[1],u=$e(a,"int32"),c=ve(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*c,p=f[d],v=0,m=0;m<c;++m){var g=f[d+m];g<p&&(p=g,v=m)}l[h]=v}return u},n.prototype.argMax=function(t,r){Y(t,"argMax");var o=[r];Zt("argMax",o,t.rank);for(var i=kt(t.shape,o),a=i[0],s=i[1],u=$e(a,"int32"),c=ve(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),h=0;h<l.length;++h){for(var d=h*c,p=f[d],v=0,m=0;m<c;++m){var g=f[d+m];g>p&&(p=g,v=m)}l[h]=v}return u},n.prototype.cumsum=function(t,r,o,i){if(Y(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=_t(t.dtype,"int32"),s=$e(t.shape,a),u=this.readSync(s.dataId),c=this.readSync(t.dataId),l=t.shape[t.rank-1],f=i?function(m,g){return m+l-g-1}:function(m,g){return m+g},h=0;h<c.length;h+=l)for(var d=0;d<l;d++){var p=f(h,d);if(d===0)u[p]=o?0:c[p];else{var v=f(h,d-1);u[p]=o?c[v]+u[v]:c[p]+u[v]}}return s},n.prototype.equal=function(t,r){return Y([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o===i?1:0}))},n.prototype.notEqual=function(t,r){return Y([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o!==i?1:0}))},n.prototype.less=function(t,r){return Y([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o<i?1:0}))},n.prototype.lessEqual=function(t,r){return Y([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o<=i?1:0}))},n.prototype.greater=function(t,r){return Y([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o>i?1:0}))},n.prototype.greaterEqual=function(t,r){return Y([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o>=i?1:0}))},n.prototype.logicalNot=function(t){Y(t,"logicalNot");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,t.shape,"bool")},n.prototype.logicalAnd=function(t,r){return Y([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o&&i}))},n.prototype.logicalOr=function(t,r){return Y([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o||i}))},n.prototype.select=function(t,r,o){Y([t,r,o],"select");for(var i=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=$e(r.shape,_t(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,f=t.rank===0||t.rank>1||r.rank===1?1:ve(r.shape.slice(1)),h=0;h<i.length;h++)for(var d=0;d<f;d++)i[h]===1?c[l++]=a[h]:c[l++]=s[h];return u},n.prototype.where=function(t){Y([t],"where");var r=this.readSync(t.dataId);return gl(t.shape,r)},n.prototype.topk=function(t,r,o){return Y(t,"topk"),sm(this.readSync(t.dataId),t.shape,t.dtype,r)},n.prototype.min=function(t,r){Y(t,"min"),Zt("min",r,t.rank);for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,t.dtype),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=l[h],p=0;p<u;++p){var v=l[h+p];v<d&&(d=v)}c[f]=d}return s},n.prototype.minimum=function(t,r){return Y([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.min(o,i)}))},n.prototype.mod=function(t,r){return Y([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i}))},n.prototype.max=function(t,r){Y(t,"max"),Zt("max",r,t.rank);for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,t.dtype),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=l[h],p=0;p<u;++p){var v=l[h+p];v>d&&(d=v)}c[f]=d}return s},n.prototype.maximum=function(t,r){return Y([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.max(o,i)}))},n.prototype.all=function(t,r){Y(t,"all"),Zt("all",r,t.rank);for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,t.dtype),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=l[h],p=0;p<u;++p){var v=l[h+p];d=d&&v}c[f]=d}return s},n.prototype.any=function(t,r){Y(t,"any"),Zt("any",r,t.rank);for(var o=kt(t.shape,r),i=o[0],a=o[1],s=$e(i,t.dtype),u=ve(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var h=f*u,d=l[h],p=0;p<u;++p){var v=l[h+p];d=d||v}c[f]=d}return s},n.prototype.squaredDifference=function(t,r){return Y([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){var a=o-i;return a*a}))},n.prototype.ceil=function(t){Y(t,"ceil");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.floor=function(t){Y(t,"floor");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.sign=function(t){Y(t,"x");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,t.shape,"float32")},n.prototype.isNaN=function(t){Y(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.isInf=function(t){Y(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.isFinite=function(t){Y(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.round=function(t){Y(t,"round");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,t.shape,"float32")},n.prototype.exp=function(t){Y(t,"exp");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.expm1=function(t){Y(t,"expm1");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.log=function(t){Y(t,"log");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.log1p=function(t){Y(t,"log1p");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.sqrt=function(t){Y(t,"sqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.rsqrt=function(t){Y(t,"rsqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.reciprocal=function(t){Y(t,"reciprocal");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,t.shape,"float32")},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){Y(t,"relu");for(var r=$e(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(t){Y(t,"relu");for(var r=$e(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(t,r){return Y([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return o<0?i*o:o}))},n.prototype.elu=function(t){Y(t,"elu");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},n.prototype.eluDer=function(t,r){Y([t,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(t){Y(t,"selu");for(var r=bl,o=xl,i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,t.shape,"float32")},n.prototype.clip=function(t,r,o){Y(t,"clip");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,t.shape,"float32")},n.prototype.abs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<t.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},n.prototype.int=function(t){Y(t,"int");for(var r=new Int32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,t.shape,"int32")},n.prototype.sigmoid=function(t){Y(t,"sigmoid");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,t.shape,"float32")},n.prototype.softplus=function(t){Y(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]),l=void 0;l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,t.shape,"float32")},n.prototype.sin=function(t){Y(t,"sin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cos=function(t){Y(t,"cos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tan=function(t){Y(t,"tan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asin=function(t){Y(t,"asin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acos=function(t){Y(t,"acos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan=function(t){Y(t,"atan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan2=function(t,r){return Y([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.atan2(o,i)}))},n.prototype.sinh=function(t){Y(t,"sinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cosh=function(t){Y(t,"cosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tanh=function(t){Y(t,"tanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=uw(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asinh=function(t){Y(t,"asinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acosh=function(t){Y(t,"acosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atanh=function(t){Y(t,"atanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.erf=function(t){Y(t,"erf");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},n.prototype.step=function(t,r){r===void 0&&(r=0),Y(t,"step");for(var o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,t.shape,"float32")},n.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.conv2d(r,o,i);return a&&(c=this.add(c,a)),s&&(c=Du(this,c,s,u)),c},n.prototype.conv2d=function(t,r,o){Y([t,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f=o.dataFormat==="channelsLast",h=Te(o.outShape,t.dtype),d=t.strides[0],p=f?t.strides[1]:t.strides[2],v=f?t.strides[2]:1,m=f?1:t.strides[1],g=h.strides[0],b=f?h.strides[1]:h.strides[2],w=f?h.strides[2]:1,y=f?1:h.strides[1],x=this.readSync(t.dataId),_=this.readSync(r.dataId),S=h.values,I=0;I<o.batchSize;++I)for(var C=I*d,E=I*g,N=0;N<o.outHeight;++N)for(var T=E+N*b,B=N*o.strideHeight-l,F=0;F<i;F++){var L=B+F*s;if(!(L<0||L>=o.inHeight))for(var q=F*r.strides[0],U=C+L*p,W=0;W<o.outWidth;++W)for(var X=T+W*w,Q=W*o.strideWidth-c,oe=0;oe<a;oe++){var ue=Q+oe*u;if(!(ue<0||ue>=o.inWidth))for(var me=U+ue*v,ke=q+oe*r.strides[1],Se=0;Se<o.inChannels;++Se){for(var Ce=x[me+Se*m],z=0;z<o.outChannels;++z)S[X+z*y]+=Ce*_[ke+z];ke+=o.outChannels}}}return h.toTensor()},n.prototype.conv3d=function(t,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,f=o.padInfo.front,h=o.padInfo.left,d=o.padInfo.top,p=Te(o.outShape,t.dtype),v=this.readSync(t.dataId),m=this.readSync(r.dataId),g=p.values,b=0;b<o.batchSize;++b)for(var w=b*t.strides[0],y=b*p.strides[0],x=0;x<o.outDepth;++x)for(var _=y+x*p.strides[1],S=x*o.strideDepth-f,I=0;I<i;I++){var C=S+I*u;if(!(C<0||C>=o.inDepth))for(var E=I*r.strides[0],N=w+C*t.strides[1],T=0;T<o.outHeight;++T)for(var B=_+T*p.strides[2],F=T*o.strideHeight-d,L=0;L<a;L++){var q=F+L*c;if(!(q<0||q>=o.inHeight))for(var U=E+L*r.strides[1],W=N+q*t.strides[2],X=0;X<o.outWidth;++X)for(var Q=B+X*o.outChannels,oe=X*o.strideWidth-h,ue=0;ue<s;ue++){var me=oe+ue*l;if(!(me<0||me>=o.inWidth))for(var ke=U+ue*r.strides[2],Se=W+me*o.inChannels,Ce=ke,z=0;z<o.inChannels;++z){for(var ee=v[Se+z],Z=0;Z<o.outChannels;++Z)g[Q+Z]+=ee*m[Ce+Z];Ce+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(t,r,o){Y([t,r],"conv2dDerInput");for(var i=Te(o.inShape,"float32"),a=i.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],f=c[1],h=c[2],d=o.batchSize,p=o.filterHeight,v=o.filterWidth,m=o.inChannels,g=o.inHeight,b=o.inWidth,w=o.outChannels,y=o.outHeight,x=o.outWidth,_=o.strideHeight,S=o.strideWidth,I=o.dataFormat,C=p-1-o.padInfo.top,E=v-1-o.padInfo.left,N=I==="channelsLast",T=i.strides[0],B=N?i.strides[1]:i.strides[2],F=N?i.strides[2]:1,L=N?1:i.strides[1],q=t.strides[0],U=N?t.strides[1]:t.strides[2],W=N?t.strides[2]:1,X=N?1:t.strides[1],Q=0;Q<d;++Q)for(var oe=0;oe<m;++oe)for(var ue=0;ue<g;++ue)for(var me=ue-C,ke=Math.max(0,Math.ceil(me/_)),Se=Math.min(y,(p+me)/_),Ce=0;Ce<b;++Ce){for(var z=Ce-E,ee=Math.max(0,Math.ceil(z/S)),Z=Math.min(x,(v+z)/S),se=0,ce=ke;ce<Se;++ce)for(var A=ce*_-me,D=ee;D<Z;++D)for(var O=q*Q+U*ce+W*D,G=l*(p-1-A)+f*(v-1-(D*S-z))+h*oe,j=0;j<w;++j)se+=s[O+X*j]*u[G+j];a[T*Q+B*ue+F*Ce+L*oe]=se}return i.toTensor()},n.prototype.conv3dDerInput=function(t,r,o){for(var i=Te(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=s[3],h=this.readSync(t.dataId),d=t.strides,p=d[0],v=d[1],m=d[2],g=d[3],b=this.readSync(r.dataId),w=r.strides,y=w[0],x=w[1],_=w[2],S=w[3],I=o.batchSize,C=o.filterDepth,E=o.filterHeight,N=o.filterWidth,T=o.inChannels,B=o.inDepth,F=o.inHeight,L=o.inWidth,q=o.outChannels,U=o.outDepth,W=o.outHeight,X=o.outWidth,Q=o.strideDepth,oe=o.strideHeight,ue=o.strideWidth,me=C-1-o.padInfo.front,ke=E-1-o.padInfo.top,Se=N-1-o.padInfo.left,Ce=0;Ce<I;++Ce)for(var z=0;z<T;++z)for(var ee=0;ee<B;++ee)for(var Z=ee-me,se=Math.max(0,Math.ceil(Z/Q)),ce=Math.min(U,(C+Z)/Q),A=0;A<F;++A)for(var D=A-ke,O=Math.max(0,Math.ceil(D/oe)),G=Math.min(W,(E+D)/oe),j=0;j<L;++j){for(var $=j-Se,re=Math.max(0,Math.ceil($/ue)),te=Math.min(X,(N+$)/ue),ne=0,J=se;J<ce;++J)for(var xe=J*Q-Z,ie=O;ie<G;++ie)for(var we=ie*oe-D,_e=re;_e<te;++_e)for(var Fe=p*Ce+v*J+m*ie+g*_e,Le=y*(C-1-xe)+x*(E-1-we)+_*(N-1-(_e*ue-$))+S*z,Pe=0;Pe<q;++Pe)ne+=h[Fe+Pe]*b[Le+Pe];a[u*Ce+c*ee+l*A+f*j+z]=ne}return i.toTensor()},n.prototype.conv2dDerFilter=function(t,r,o){Y([t,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dataFormat==="channelsLast",l=Te(o.filterShape,"float32"),f=o.padInfo.left,h=o.padInfo.top,d=this.bufferSync(t),p=this.bufferSync(r),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((h-v)/i)),g=Math.min(o.outHeight,(o.inHeight+h-v)/i),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((f-b)/a)),y=Math.min(o.outWidth,(o.inWidth+f-b)/a),x=0;x<o.inChannels;++x)for(var _=0;_<o.outChannels;++_){for(var S=0,I=0;I<o.batchSize;++I)for(var C=m;C<g;++C)for(var E=v+C*i-h,N=w;N<y;++N){var T=b+N*a-f;S+=c?d.get(I,E,T,x)*p.get(I,C,N,_):d.get(I,x,E,T)*p.get(I,_,C,N)}l.set(S,v,b,x,_)}return l.toTensor()},n.prototype.conv3dDerFilter=function(t,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=Te(o.filterShape,"float32"),h=f.values,d=f.strides,p=d[0],v=d[1],m=d[2],g=d[3],b=this.readSync(r.dataId),w=r.strides,y=w[0],x=w[1],_=w[2],S=w[3],I=this.readSync(t.dataId),C=t.strides,E=C[0],N=C[1],T=C[2],B=C[3],F=o.padInfo.front,L=o.padInfo.left,q=o.padInfo.top,U=0;U<u;++U)for(var W=Math.max(0,Math.ceil((F-U)/i)),X=Math.min(o.outDepth,(o.inDepth+F-U)/i),Q=U*p,oe=0;oe<c;++oe)for(var ue=Math.max(0,Math.ceil((q-oe)/a)),me=Math.min(o.outHeight,(o.inHeight+q-oe)/a),ke=oe*v+Q,Se=0;Se<l;++Se)for(var Ce=Math.max(0,Math.ceil((L-Se)/s)),z=Math.min(o.outWidth,(o.inWidth+L-Se)/s),ee=Se*m+ke,Z=0;Z<o.inChannels;++Z)for(var se=Z*g+ee,ce=0;ce<o.outChannels;++ce){for(var A=0,D=0;D<o.batchSize;++D)for(var O=D*E,G=D*y,j=W;j<X;++j)for(var $=(U+j*i-F)*N+O,re=j*x+G,te=ue;te<me;++te)for(var ne=(oe+te*a-q)*T+$,J=te*_+re,xe=Ce;xe<z;++xe){var ie=xe*S+J;A+=I[(Se+xe*s-L)*B+ne+Z]*b[ie+ce]}h[se+ce]=A}return f.toTensor()},n.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(r,o,i);return a&&(c=this.add(c,a)),s&&(c=Du(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(t,r,o){Y([t,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f=o.outChannels/o.inChannels,h=Te(o.outShape,t.dtype),d=this.readSync(t.dataId),p=this.readSync(r.dataId),v=h.values,m=0;m<o.batchSize;++m)for(var g=m*t.strides[0],b=m*h.strides[0],w=0;w<o.outHeight;++w)for(var y=b+w*h.strides[1],x=w*o.strideHeight-c,_=0;_<i;++_){var S=x+_*s;if(!(S<0||S>=o.inHeight))for(var I=_*r.strides[0],C=g+S*t.strides[1],E=0;E<o.outWidth;++E)for(var N=y+E*h.strides[2],T=E*o.strideWidth-l,B=0;B<a;++B){var F=T+B*u;if(!(F<0||F>=o.inWidth))for(var L=I+B*r.strides[1],q=C+F*o.inChannels,U=N,W=L,X=0;X<o.inChannels;++X){for(var Q=d[q+X],oe=0;oe<f;++oe)v[U+oe]+=Q*p[W+oe];U+=f,W+=f}}}return h.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,r,o){Y([t,r],"depthwiseConv2DDerInput");for(var i=Te(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=this.readSync(t.dataId),h=t.strides,d=h[0],p=h[1],v=h[2],m=this.readSync(r.dataId),g=r.strides,b=g[0],w=g[1],y=g[2],x=o.batchSize,_=o.filterHeight,S=o.filterWidth,I=o.inChannels,C=o.inHeight,E=o.inWidth,N=o.outChannels,T=o.outHeight,B=o.outWidth,F=o.strideHeight,L=o.strideWidth,q=_-1-o.padInfo.top,U=S-1-o.padInfo.left,W=N/I,X=0;X<x;++X)for(var Q=0;Q<I;++Q)for(var oe=0;oe<C;++oe)for(var ue=oe-q,me=Math.max(0,Math.ceil(ue/F)),ke=Math.min(T,(_+ue)/F),Se=0;Se<E;++Se){for(var Ce=Se-U,z=Math.max(0,Math.ceil(Ce/L)),ee=Math.min(B,(S+Ce)/L),Z=0,se=me;se<ke;++se)for(var ce=se*F-ue,A=z;A<ee;++A)for(var D=d*X+p*se+v*A,O=b*(_-1-ce)+w*(S-1-(A*L-Ce))+y*Q,G=0;G<W;++G)Z+=f[D+(Q*W+G)]*m[O+G];a[u*X+c*oe+l*Se+Q]=Z}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,r,o){Y([t,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Te(o.filterShape,"float32"),l=o.padInfo.left,f=o.padInfo.top,h=o.outChannels/o.inChannels,d=this.bufferSync(t),p=this.bufferSync(r),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((f-v)/i)),g=Math.min(o.outHeight,(o.inHeight+f-v)/i),b=0;b<u;++b)for(var w=Math.max(0,Math.ceil((l-b)/a)),y=Math.min(o.outWidth,(o.inWidth+l-b)/a),x=0;x<o.outChannels;++x){for(var _=Math.trunc(x/h),S=x%h,I=0,C=0;C<o.batchSize;++C)for(var E=m;E<g;++E)for(var N=v+E*i-f,T=w;T<y;++T){var B=b+T*a-l;I+=d.get(C,N,B,_)*p.get(C,E,T,x)}c.set(I,v,b,_,S)}return c.toTensor()},n.prototype.tile=function(t,r){return Y(t,"tile"),am(this.bufferSync(t),r)},n.prototype.pad=function(t,r,o){Y(t,"pad");var i=r.map((function(h,d){return h[0]+t.shape[d]+h[1]})),a=r.map((function(h){return h[0]})),s=this.bufferSync(t),u=Te(i,t.dtype);o!==0&&u.values.fill(o);for(var c=0;c<t.size;c++){var l=s.indexToLoc(c),f=l.map((function(h,d){return h+a[d]}));u.set.apply(u,[s.get.apply(s,l)].concat(f))}return u.toTensor()},n.prototype.transpose=function(t,r){Y(t,"transpose");for(var o=new Array(t.rank),i=0;i<o.length;i++)o[i]=t.shape[r[i]];var a=this.readSync(t.dataId),s=Te(o,t.dtype),u=this.bufferSync(t);for(i=0;i<t.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),f=0;f<l.length;f++)l[f]=c[r[f]];var h=s.locToIndex(l);s.values[h]=a[i]}return s.toTensor()},n.prototype.gather=function(t,r,o){Y([t,r],"gather");var i=t.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Te(i,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c),f=l.slice();f[o]=a[l[o]];var h=u.locToIndex(f);s.values[c]=u.values[h]}return s.toTensor()},n.prototype.batchToSpaceND=function(t,r,o){Y([t],"batchToSpaceND");var i=r.reduce((function(f,h){return f*h})),a=Ya(t.shape,r,i),s=Qa(a.length,r.length),u=Ja(t.shape,r,i),c=Kv(o,r.length),l=$v(u,o,r.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(t,r,o){Y([t],"spaceToBatchND");var i=r.reduce((function(h,d){return h*d})),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=Ya(u.shape,r,i,!1),l=Qa(c.length,r.length,!1),f=Ja(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(f)},n.prototype.pool=function(t,r,o){Y(t,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,d=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),v=Te(r.outShape,t.dtype),m=v.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],w=r.outShape[3],y=0;y<r.batchSize;++y)for(var x=y*g,_=y*t.strides[0],S=0;S<r.inChannels;++S)for(var I=0;I<r.outHeight;++I)for(var C=I*i-f,E=Math.max(0,C),N=Math.min(r.inHeight,c+C),T=x+I*b,B=0;B<r.outWidth;++B){for(var F=B*a-h,L=Math.max(0,F),q=Math.min(r.inWidth,l+F),U=d,W=0,X=0,Q=E;Q<N;Q+=s){for(var oe=_+Q*t.strides[1],ue=L;ue<q;ue+=u){var me=p[oe+ue*t.strides[2]+S];o==="max"&&me>U?U=me:o==="avg"&&(W+=me,X++)}if(isNaN(U))break}m[T+B*w+S]=o==="avg"?W/X:U}return v.toTensor()},n.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},n.prototype.maxPoolPositions=function(t,r){for(var o=Te(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,d=this.bufferSync(t),p=0;p<r.batchSize;++p)for(var v=0;v<r.inChannels;++v)for(var m=0;m<r.outHeight;++m){for(var g=m*i-f,b=g;b<0;)b+=s;for(var w=Math.min(r.inHeight,c+g),y=0;y<r.outWidth;++y){for(var x=y*a-h,_=x;_<0;)_+=u;for(var S=Math.min(r.inWidth,l+x),I=Number.NEGATIVE_INFINITY,C=-1,E=b;E<w;E+=s)for(var N=E-g,T=_;T<S;T+=u){var B=T-x,F=d.get(p,E,T,v);F>I&&(I=F,C=N*l+B)}o.set(C,p,m,y,v)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(t,r,o,i){Y([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,f=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=h-1-i.padInfo.left,p=f-1-i.padInfo.top,v=Te(r.shape,"float32"),m=this.bufferSync(a),g=this.bufferSync(t),b=0;b<i.batchSize;++b)for(var w=0;w<i.inChannels;++w)for(var y=0;y<i.inHeight;++y)for(var x=0;x<i.inWidth;++x){for(var _=y-p,S=x-d,I=0,C=0;C<f;C+=c){var E=(_+C)/s;if(!(E<0||E>=i.outHeight||Math.floor(E)!==E))for(var N=0;N<h;N+=l){var T=(S+N)/u;if(!(T<0||T>=i.outWidth||Math.floor(T)!==T)){var B=f*h-1-m.get(b,E,T,w)===C*h+N?1:0;B!==0&&(I+=g.get(b,E,T,w)*B)}}}v.set(I,b,y,x,w)}return v.toTensor()},n.prototype.avgPoolBackprop=function(t,r,o){Y([t,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,f=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=h-1-o.padInfo.left,p=f-1-o.padInfo.top,v=Te(r.shape,"float32"),m=1/(s*u),g=this.bufferSync(t),b=0;b<o.batchSize;++b)for(var w=0;w<o.inChannels;++w)for(var y=0;y<o.inHeight;++y)for(var x=0;x<o.inWidth;++x){for(var _=y-p,S=x-d,I=0,C=0;C<f;C+=c){var E=(_+C)/i;if(!(E<0||E>=o.outHeight||Math.floor(E)!==E))for(var N=0;N<h;N+=l){var T=(S+N)/a;T<0||T>=o.outWidth||Math.floor(T)!==T||(I+=g.get(b,E,T,w))}}v.set(I*m,b,y,x,w)}return v.toTensor()},n.prototype.pool3d=function(t,r,o){Y(t,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,m=r.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),w=Te(r.outShape,t.dtype),y=w.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],I=r.outShape[4],C=0;C<r.batchSize;++C)for(var E=C*x,N=C*t.strides[0],T=0;T<r.inChannels;++T)for(var B=0;B<r.outDepth;++B){for(var F=B*i-p,L=F;L<0;)L+=u;for(var q=Math.min(r.inDepth,f+F),U=E+B*_,W=0;W<r.outHeight;++W){for(var X=W*a-v,Q=X;Q<0;)Q+=c;for(var oe=Math.min(r.inHeight,h+X),ue=U+W*S,me=0;me<r.outWidth;++me){for(var ke=me*s-m,Se=ke;Se<0;)Se+=l;for(var Ce=Math.min(r.inWidth,d+ke),z=ue+me*I,ee=g,Z=0,se=0,ce=L;ce<q;ce+=u){for(var A=N+ce*t.strides[1],D=Q;D<oe;D+=c){for(var O=A+D*t.strides[2],G=Se;G<Ce;G+=l){var j=b[O+G*t.strides[3]+T];if(o==="max"&&j>ee?ee=j:o==="avg"&&(Z+=j,se++),isNaN(ee))break}if(isNaN(ee))break}if(isNaN(ee))break}y[z+T]=o==="avg"?Z/se:ee}}}return w.toTensor()},n.prototype.avgPool3d=function(t,r){return Y(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(t,r,o){Y([t,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=o.dilationDepth,h=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=p-1-o.padInfo.front,b=m-1-o.padInfo.left,w=v-1-o.padInfo.top,y=Te(r.shape,"float32"),x=1/(u*c*l),_=this.bufferSync(t),S=0;S<o.batchSize;++S)for(var I=0;I<o.inChannels;++I)for(var C=0;C<o.inDepth;++C)for(var E=0;E<o.inHeight;++E)for(var N=0;N<o.inWidth;++N){for(var T=C-g,B=E-w,F=N-b,L=0,q=0;q<p;q+=f){var U=(T+q)/i;if(!(U<0||U>=o.outDepth||Math.floor(U)!==U))for(var W=0;W<v;W+=h){var X=(B+W)/a;if(!(X<0||X>=o.outHeight||Math.floor(X)!==X))for(var Q=0;Q<m;Q+=d){var oe=(F+Q)/s;oe<0||oe>=o.outWidth||Math.floor(oe)!==oe||(L+=_.get(S,U,X,oe,I))}}}y.set(L*x,S,C,E,N,I)}return y.toTensor()},n.prototype.maxPool3d=function(t,r){return Y(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(t,r){for(var o=Te(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,m=r.padInfo.left,g=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var y=0;y<r.outDepth;++y){for(var x=y*i-p,_=x;_<0;)_+=u;for(var S=Math.min(r.inDepth,f+x),I=0;I<r.outHeight;++I){for(var C=I*a-v,E=C;E<0;)E+=c;for(var N=Math.min(r.inHeight,h+C),T=0;T<r.outWidth;++T){for(var B=T*s-m,F=B;F<0;)F+=l;for(var L=Math.min(r.inWidth,d+B),q=Number.NEGATIVE_INFINITY,U=-1,W=_;W<S;W+=u)for(var X=W-x,Q=E;Q<N;Q+=c)for(var oe=Q-C,ue=F;ue<L;ue+=l){var me=ue-B,ke=g.get(b,W,Q,ue,w);ke>=q&&(q=ke,U=X*h*d+oe*h+me)}o.set(U,b,y,I,T,w)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(t,r,o,i){Y([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,f=i.dilationHeight,h=i.dilationWidth,d=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,m=d-1-i.padInfo.front,g=v-1-i.padInfo.left,b=p-1-i.padInfo.top,w=Te(r.shape,"float32"),y=this.bufferSync(a),x=this.bufferSync(t),_=0;_<i.batchSize;++_)for(var S=0;S<i.inChannels;++S)for(var I=0;I<i.inDepth;++I)for(var C=0;C<i.inHeight;++C)for(var E=0;E<i.inWidth;++E){for(var N=I-m,T=C-b,B=E-g,F=0,L=0;L<d;L+=l){var q=(N+L)/s;if(!(q<0||q>=i.outDepth||Math.floor(q)!==q))for(var U=0;U<p;U+=f){var W=(T+U)/u;if(!(W<0||W>=i.outHeight||Math.floor(W)!==W))for(var X=0;X<v;X+=h){var Q=(B+X)/c;if(!(Q<0||Q>=i.outWidth||Math.floor(Q)!==Q)){var oe=d*p*v-1-y.get(_,q,W,Q,S)===L*p*v+U*v+X?1:0;oe!==0&&(F+=x.get(_,q,W,Q,S)*oe)}}}}w.set(F,_,I,C,E,S)}return w.toTensor()},n.prototype.cast=function(t,r){return nm(t,r,this)},n.prototype.reshape=function(t,r){return Ec(t,r)},n.prototype.avgPool=function(t,r){return Y(t,"avgPool"),this.pool(t,r,"avg").toFloat()},n.prototype.resizeBilinear=function(t,r,o,i){Y(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),h=new Float32Array(ve([s,r,o,l])),d=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=0,m=d[0]/p[0],g=d[1]/p[1],b=0;b<s;b++)for(var w=0;w<r;w++)for(var y=m*w,x=Math.floor(y),_=y-x,S=Math.min(u-1,Math.ceil(y)),I=b*t.strides[0]+x*t.strides[1],C=b*t.strides[0]+S*t.strides[1],E=0;E<o;E++)for(var N=g*E,T=Math.floor(N),B=N-T,F=Math.min(c-1,Math.ceil(N)),L=I+T*t.strides[2],q=C+T*t.strides[2],U=I+F*t.strides[2],W=C+F*t.strides[2],X=0;X<l;X++){var Q=f[L+X],oe=f[q+X],ue=Q+(f[U+X]-Q)*B,me=ue+(oe+(f[W+X]-oe)*B-ue)*_;h[v++]=me}return Ct(h,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(t,r,o){Y([t,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],h=l[2],d=new Float32Array(a*s*u*c),p=[o&&f>1?s-1:s,o&&h>1?u-1:u],v=[o&&f>1?f-1:f,o&&h>1?h-1:h],m=p[0]/v[0],g=p[1]/v[1],b=this.readSync(t.dataId),w=0,y=0;y<a;y++)for(var x=y*r.strides[0],_=0;_<f;_++)for(var S=_*m,I=Math.floor(S),C=Math.min(Math.ceil(S),s-1),E=x+I*r.strides[1],N=x+C*r.strides[1],T=S-I,B=1-T,F=0;F<h;F++)for(var L=F*g,q=Math.floor(L),U=Math.min(Math.ceil(L),u-1),W=L-q,X=1-W,Q=E+q*r.strides[2],oe=E+U*r.strides[2],ue=N+q*r.strides[2],me=N+U*r.strides[2],ke=B*X,Se=B*W,Ce=T*X,z=T*W,ee=0;ee<c;ee++){var Z=b[w++];d[Q+ee]+=Z*ke,d[oe+ee]+=Z*Se,d[ue+ee]+=Z*Ce,d[me+ee]+=Z*z}return jt(d,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(t,r,o,i){Y(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),h=new Float32Array(s*r*o*l),d=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=d[0]/p[0],m=d[1]/p[1],g=0,b=0;b<s;b++)for(var w=b*t.strides[0],y=0;y<r;y++)for(var x=v*y,_=w+Math.min(u-1,i?Math.round(x):Math.floor(x))*t.strides[1],S=0;S<o;S++)for(var I=m*S,C=_+Math.min(c-1,i?Math.round(I):Math.floor(I))*t.strides[2],E=0;E<l;E++){var N=f[C+E];h[g++]=N}return Ct(h,[s,r,o,l],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,r,o){Y([t,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],h=l[2],d=new Float32Array(a*s*u*c),p=this.readSync(t.dataId),v=[o&&f>1?s-1:s,o&&h>1?u-1:u],m=[o&&f>1?f-1:f,o&&h>1?h-1:h],g=v[0]/m[0],b=v[1]/m[1],w=1/g,y=1/b,x=2*Math.ceil(w)+2,_=2*Math.ceil(y)+2,S=0;S<a;S++)for(var I=S*r.strides[0],C=0;C<s;C++)for(var E=I+C*r.strides[1],N=Math.floor(C*w),T=Math.floor(N-x/2),B=0;B<u;B++)for(var F=E+B*r.strides[2],L=Math.floor(B*y),q=Math.floor(L-_/2),U=0;U<c;U++){for(var W=0,X=0;X<x;X++){var Q=X+T;if(!(Q<0||Q>=f)){var oe=I+Q*t.strides[1],ue=Q*g;if(C===Math.min(s-1,o?Math.round(ue):Math.floor(ue)))for(var me=0;me<_;me++){var ke=me+q;if(!(ke<0||ke>=h)){var Se=oe+ke*t.strides[2],Ce=ke*b;B===Math.min(u-1,o?Math.round(Ce):Math.floor(Ce))&&(W+=p[Se+U])}}}}d[F+U]=W}return jt(d,r.shape,r.dtype)},n.prototype.batchNormalization=function(t,r,o,i,a,s){Y([t,r,o,a,s],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),f=a?this.readSync(a.dataId):new Float32Array([1]),h=s?this.readSync(s.dataId):new Float32Array([0]),d=new Float32Array(u.length),p=h.length,v=f.length,m=l.length,g=c.length,b=0,w=0,y=0,x=0,_=0;_<u.length;++_)d[_]=h[b++]+(u[_]-c[w++])*f[y++]/Math.sqrt(l[x++]+i),b>=p&&(b=0),w>=g&&(w=0),y>=v&&(y=0),x>=m&&(x=0);return jt(d,t.shape)},n.prototype.localResponseNormalization4D=function(t,r,o,i,a){Y(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,c=this.readSync(t.dataId),l=t.size,f=new Float32Array(l);function h(m){for(var g=m%s,b=m-g+Math.max(0,g-r),w=m-g+Math.min(g+r,u),y=0;b<=w;b++){var x=c[b];y+=x*x}return y}for(var d=0;d<l;d++){var p=h(d),v=c[d]*Math.pow(o+i*p,-a);f[d]=v}return jt(f,t.shape)},n.prototype.LRNGrad=function(t,r,o,i,a,s,u){Y(t,"LRNGrad");for(var c=t.shape[3],l=this.readSync(t.dataId),f=this.readSync(r.dataId),h=this.readSync(o.dataId),d=new Float32Array(t.size),p=t.size,v=0;v<p;v++){for(var m=v%c,g=v-m+Math.max(0,m-i),b=v-m+Math.min(c,m+i+1),w=0,y=g;y<b;y++)w+=Math.pow(f[y],2);for(w=s*w+a,y=g;y<b;y++){var x=-2*s*u*f[y]*h[v]/w;v===y&&(x+=Math.pow(w,-u)),x*=l[v],d[y]+=x}}return jt(d,t.shape)},n.prototype.multinomial=function(t,r,o,i){Y(t,"multinomial");for(var a=r?t:vr(t),s=a.shape[0],u=a.shape[1],c=$e([s,o],"int32"),l=this.readSync(c.dataId),f=this.readSync(a.dataId),h=0;h<s;++h){var d=h*u,p=new Float32Array(u-1);p[0]=f[d];for(var v=1;v<p.length;++v)p[v]=p[v-1]+f[d+v];for(var m=ks(i.toString()),g=h*o,b=0;b<o;++b){var w=m();l[g+b]=p.length;for(var y=0;y<p.length;y++)if(w<p[y]){l[g+b]=y;break}}}return c},n.prototype.oneHot=function(t,r,o,i){Y(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(i);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Dr(a,[t.size,r],"int32")},n.prototype.nonMaxSuppression=function(t,r,o,i,a){return Y(t,"nonMaxSuppression"),vl(this.readSync(t.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,r){for(var o=t.shape[0],i=t.shape[1],a=Te(t.shape,"float32"),s=Te(t.shape,"float32"),u=dn(t).as2D(o,i),c=Vn(t).as2D(o,i),l=0;l<o;l++)for(var f=u.slice([l,0],[1,i]),h=c.slice([l,0],[1,i]),d=wt(f,h),p=this.readSync(this.fftImpl(d,r).dataId),v=0;v<i;v++){var m=Xh(p,v);a.values[l*i+v]=m.real,s.values[l*i+v]=m.imag}return wt(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(t,r){var o=t.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(t.shape[0],t.shape[1]);return r&&(a=wt(dn(a).div(ae(i)),Vn(a).div(ae(i)))),a}var s=this.readSync(t.dataId),u=(function(c){for(var l=new Float32Array(c.length/2),f=new Float32Array(c.length/2),h=0;h<c.length;h+=2)l[h/2]=c[h],f[h/2]=c[h+1];return{real:l,imag:f}})(this.fourierTransformByMatmul(s,i,r));return wt(u.real,u.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,r,o){if(r===1)return t;var i=this.readSync(t.dataId),a=r/2,s=(function(g){for(var b=Math.ceil(g.length/4),w=new Float32Array(b),y=new Float32Array(b),x=0;x<g.length;x+=4)w[Math.floor(x/4)]=g[x],y[Math.floor(x/4)]=g[x+1];return{real:w,imag:y}})(i),u=wt(s.real,s.imag).as1D(),c=(function(g){for(var b=Math.floor(g.length/4),w=new Float32Array(b),y=new Float32Array(b),x=2;x<g.length;x+=4)w[Math.floor(x/4)]=g[x],y[Math.floor(x/4)]=g[x+1];return{real:w,imag:y}})(i),l=wt(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var f=(function(g,b){for(var w=new Float32Array(g/2),y=new Float32Array(g/2),x=0;x<Math.ceil(g/2);x++){var _=(b?2:-2)*Math.PI*(x/g);w[x]=Math.cos(_),y[x]=Math.sin(_)}return{real:w,imag:y}})(r,o),h=wt(f.real,f.imag).mul(l),d=u.add(h),p=u.sub(h),v=dn(d).concat(dn(p)),m=Vn(d).concat(Vn(p));return wt(v,m).as1D()},n.prototype.fourierTransformByMatmul=function(t,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=z_(a*c,r,o),f=Xh(t,c);s+=f.real*l.real-f.imag*l.imag,u+=f.real*l.imag+f.imag*l.real}o&&(s/=r,u/=r),V_(i,s,u,a)}return i},n.prototype.depthToSpace=function(t,r,o){k(o==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o})),k(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var i=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],c=a*r,l=s*r,f=u/(r*r),h=this.readSync(t.dataId),d=new Float32Array(i*c*l*f),p=0,v=0;v<i;++v)for(var m=0;m<c;++m)for(var g=Math.floor(m/r),b=m%r,w=0;w<l;++w)for(var y=Math.floor(w/r),x=(b*r+w%r)*f,_=0;_<f;++_){var S=_+x+u*(y+s*(g+a*v));d[p++]=h[S]}return jt(d,[i,c,l,f])},n.prototype.broadcastedBinaryOp=function(t,r,o,i){var a=Oe(t.shape,r.shape),s=Te(a,o),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=kr(t.shape,a),f=kr(r.shape,a),h=s.values;if(l.length+f.length===0)for(var d=0;d<h.length;++d)h[d]=i(u[d%u.length],c[d%c.length]);else{var p=this.bufferSync(t),v=this.bufferSync(r),m=function(g){var b=s.indexToLoc(g),w=b.slice(-t.rank);l.forEach((function(S){return w[S]=0}));var y=p.locToIndex(w),x=b.slice(-r.rank);f.forEach((function(S){return x[S]=0}));var _=v.locToIndex(x);h[g]=i(u[y],c[_])};for(d=0;d<h.length;++d)m(d)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,r,o){var i=Oe(t.shape,r.shape),a=Te(i,"float32"),s=Te(i,"float32"),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=kr(t.shape,i),f=kr(r.shape,i),h=a.values,d=s.values;if(l.length+f.length===0)for(var p=0;p<h.length;p++){var v=p%u.length,m=p%c.length,g=o(u[2*v],u[2*v+1],c[2*m],c[2*m+1]);h[p]=g.real,d[p]=g.imag}else{var b=this.bufferSync(this.data.get(t.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),y=function(x){var _=a.indexToLoc(x),S=_.slice(-t.rank);l.forEach((function(T){return S[T]=0}));var I=b.locToIndex(S),C=_.slice(-r.rank);f.forEach((function(T){return C[T]=0}));var E=w.locToIndex(C),N=o(u[2*I],u[2*I+1],c[2*E],c[2*E+1]);h[x]=N.real,d[x]=N.imag};for(p=0;p<h.length;p++)y(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(t,r,o){return im(t,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(t,r,o,i,a,s){for(var u=t.shape,c=u[0],l=u[1],f=u[2],h=u[3],d=r.shape[0],p=i[0],v=i[1],m=Te([d,p,v,h],"float32"),g=this.readSync(r.dataId),b=this.readSync(o.dataId),w=this.readSync(t.dataId),y=t.strides,x=m.strides,_=0;_<d;_++){var S=4*_,I=g[S],C=g[S+1],E=g[S+2],N=g[S+3],T=b[_];if(!(T>=c))for(var B=p>1?(E-I)*(l-1)/(p-1):0,F=v>1?(N-C)*(f-1)/(v-1):0,L=0;L<p;L++){var q=p>1?I*(l-1)+L*B:.5*(I+E)*(l-1);if(q<0||q>l-1)for(var U=0;U<v;U++)for(var W=0;W<h;W++){var X=W+U*x[2]+L*x[1]+_*x[0];m.values[X]=s}else if(a==="bilinear"){var Q=Math.floor(q),oe=Math.ceil(q),ue=q-Q;for(U=0;U<v;U++)if((ce=v>1?C*(f-1)+U*F:.5*(C+N)*(f-1))<0||ce>f-1)for(W=0;W<h;W++)X=W+U*x[2]+L*x[1]+_*x[0],m.values[X]=s;else{var me=Math.floor(ce),ke=Math.ceil(ce),Se=ce-me;for(W=0;W<h;W++){var Ce=w[X=W+me*y[2]+Q*y[1]+T*y[0]],z=w[X=W+ke*y[2]+Q*y[1]+T*y[0]],ee=w[X=W+me*y[2]+oe*y[1]+T*y[0]],Z=Ce+(z-Ce)*Se,se=ee+(w[X=W+ke*y[2]+oe*y[1]+T*y[0]]-ee)*Se;X=W+U*x[2]+L*x[1]+_*x[0],m.values[X]=Z+(se-Z)*ue}}}else for(U=0;U<v;++U){var ce;if((ce=v>1?C*(f-1)+U*F:.5*(C+N)*(f-1))<0||ce>f-1)for(W=0;W<h;W++)X=W+U*x[2]+L*x[1]+_*x[0],m.values[X]=s;else{var A=Math.round(ce),D=Math.round(q);for(W=0;W<h;W++){var O=W+A*y[2]+D*y[1]+T*y[0],G=W+U*x[2]+L*x[1]+_*x[0];m.values[G]=w[O]}}}}}return m.toTensor()},n.prototype.sparseToDense=function(t,r,o,i){var a=Za(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,l=a.strides,f=a.outputSize;return this.scatter(t,r,o,f,c,u,s,l,i,!1)},n.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=Xv(t,r),s=a[0],u=a[1],c=a[2],l=a[3];if(u===0)return Ct([],s,t.dtype);for(var f=new zi([u,c],t.dtype),h=this.readSync(r.dataId),d=this.readSync(t.dataId),p=0;p<u;p++){for(var v=[],m=0,g=0;g<i;g++){var b=h[p*i+g];m+=b*l[g],v.push(b)}if(m<0||m>=t.size/c)throw new Error("Invalid indices: "+v+" does not index into "+t.shape);for(var w=0;w<c;w++)f.values[p*c+w]=d[m*c+w]}return f.toTensor().reshape(s)},n.prototype.scatterND=function(t,r,o){var i=Za(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=ae(0);return this.scatter(t,r,o,l,u,s,a,c,f,!0)},n.prototype.fill=function(t,r,o){var i=Ha(o=o||Yi(r),ve(t));return i.fill(r),M.makeTensor(i,t,o,this)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var r=Ha(t.dtype,ve(t.shape));return this.makeOutput(r,t.shape,t.dtype)},n.prototype.linspace=function(t,r,o){return rm(t,r,o)},n.prototype.scatter=function(t,r,o,i,a,s,u,c,l,f){var h=[i/a,a],d=this.readSync(t.dataId),p=this.readSync(r.dataId);if(i===0)return Ct([],o,r.dtype);var v=new zi(h,r.dtype);v.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var g=[],b=0,w=0;w<u;w++){var y=d[m*u+w];g.push(y),b+=y*c[w]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+g+" does not index into "+o);for(var x=0;x<a;x++)f?v.values[b*a+x]+=p[m*a+x]:v.values[b*a+x]=r.rank===0?p[0]:p[m*a+x]}return v.toTensor().reshape(o)},n})(em);M.registerBackend("cpu",(function(){return new sS}),1);for(var Nu=0,gd=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,h=t;Y(i,"NonMaxSuppressionWithScore");var d=ml(h.data.get(i.dataId).values,h.data.get(a.dataId).values,u,c,l,f);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,o=t;Y(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Gi,backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,o=r.a,i=r.b,a=t;Y([o,i],Gi);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=(function(h,d,p,v,m,g){var b=Oe(h,d),w=b.length,y=Gn(b),x=Vi(m,ve(b)),_=h.length,S=d.length,I=Gn(h),C=Gn(d),E=kr(h,b),N=kr(d,b);if(E.length+N.length===0)for(var T=0;T<x.length;++T)x[T]=g(p[T%p.length],v[T%v.length]);else{var B=function(F){var L=gw(F,w,y),q=L.slice(-_);E.forEach((function(Q){return q[Q]=0}));var U=Vh(q,_,I),W=L.slice(-S);N.forEach((function(Q){return W[Q]=0}));var X=Vh(W,S,C);x[F]=g(p[U],v[X])};for(T=0;T<x.length;++T)B(T)}return[x,b]})(o.shape,i.shape,s,u,o.dtype,(function(h,d){var p=h-d;return p*p})),l=c[0],f=c[1];return{dataId:a.write(l,f,o.dtype),shape:f,dtype:o.dtype}}}];Nu<gd.length;Nu++)kv(gd[Nu]);var So,uS=function(e){this.variableNames=["A"];var n=Ft(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},cS=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Ft(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(var Pu=0,yd=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,o=n.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],f=[l,c],h=[l,c,i];(s||a)&&(So==null&&(So=document.createElement("canvas").getContext("2d")),So.canvas.width=c,So.canvas.height=l,So.drawImage(o,0,0,c,l),o=So.canvas);var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=nn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),o);var p=K().getBool("WEBGL_PACK")?new cS(h):new uS(h),v=t.runWebGLProgram(p,[d],"int32");return t.disposeData(d.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs;Ka("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,h=t,d=ml(h.readSync(i.dataId),h.readSync(a.dataId),u,c,l,f);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,o=t,i=new Ne(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Gi,backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,o=r.a,i=r.b,a=t,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr("return (a - b) * (a - b);",o.shape,i.shape):new tt("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Pu<yd.length;Pu++)kv(yd[Pu]);for(var Fu=0,bd=[{kernelName:"Square",gradFunc:function(e,n){var t=n[0];return{x:function(){return e.mul(t.toFloat().mul(2))}}}},{kernelName:Gi,gradFunc:function(e,n){var t=n[0],r=n[1],o=ae(2);return{a:function(){return Bt(e,Bt(o,ht(t,r)))},b:function(){return Bt(e,Bt(o,ht(r,t)))}}}}];Fu<bd.length;Fu++)aw(bd[Fu]);var lS=(function(){function e(){}return e.prototype.fetch=function(n,t){return fetch(n,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},e})();K().get("IS_BROWSER")&&K().setPlatform("browser",new lS);var Mu,fS=function(){return require("node-fetch")},hS=(function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(n,t){return K().global.fetch!=null?K().global.fetch(n,t):(Mu==null&&(Mu=fS()),Mu(n,t))},e.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return n.length===0?"":new this.util.TextDecoder(t).decode(n)},e})();K().get("IS_NODE")&&K().setPlatform("node",new hS);var Ic={float32:4,int32:4,uint16:2,uint8:1,bool:1},as=4;function Qm(e,n){for(var t={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,f=ve(l),h=void 0;if("quantization"in s){var d=s.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Ic[d.dtype],v=e.slice(r,r+f*p),m=d.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(c==="float32")h=Float32Array.from(m,(function(_){return _*d.scale+d.min}));else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);h=Int32Array.from(m,(function(_){return Math.round(_*d.scale+d.min)}))}r+=f*p}else if(c==="string"){var g=ve(s.shape);h=[];for(var b=0;b<g;b++){var w=new Uint32Array(e.slice(r,r+as))[0];r+=as;var y=new Uint8Array(e.slice(r,r+w));h.push(y),r+=w}}else{var x=Ic[c];if(v=e.slice(r,r+f*x),c==="float32")h=new Float32Array(v);else if(c==="int32")h=new Int32Array(v);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);h=new Uint8Array(v)}r+=f*x}t[u]=Ct(h,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return t}function dS(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var n=0,t=[];e.forEach((function(i){if(n+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)}));var r=new Uint8Array(n),o=0;return t.forEach((function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength})),r.buffer}var kc=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xd(e){return kc?Buffer.byteLength(e):new Blob([e]).size}function Ml(e){var n=0;e.forEach((function(o){n+=o.byteLength}));var t=new Uint8Array(n),r=0;return e.forEach((function(o){t.set(new Uint8Array(o),r),r+=o.byteLength})),t.buffer}function wd(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var n=e.split("/");return n[n.length-1]}function ra(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:xd(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:xd(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var rn=(function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(n){e.getInstance().saveRouters.push(n)},e.registerLoadRouter=function(n){e.getInstance().loadRouters.push(n)},e.getSaveHandlers=function(n){return e.getHandlers(n,"save")},e.getLoadHandlers=function(n,t){return e.getHandlers(n,"load",t)},e.getHandlers=function(n,t,r){var o=[];return(t==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(i){var a=i(n,r);a!==null&&o.push(a)})),o},e})(),Xo="://",Nr=(function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(n,t){k(n!=null,(function(){return"scheme must not be undefined or null."})),n.endsWith(Xo)&&(n=n.slice(0,n.indexOf(Xo))),k(n.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();k(r.managers[n]==null,(function(){return"A model store manager is already registered for scheme '"+n+"'."})),r.managers[n]=t},e.getManager=function(n){var t=this.getInstance().managers[n];if(t==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e})();function ka(e){if(e.indexOf(Xo)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Nr.getSchemes().join(","));return{scheme:e.split(Xo)[0],path:e.split(Xo)[1]}}function _d(e,n,t){return t===void 0&&(t=!1),he(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f;return de(this,(function(h){switch(h.label){case 0:return k(e!==n,(function(){return"Old path and new path are the same: '"+e+"'"})),k((r=rn.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),k(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),o=r[0],k((i=rn.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+n+"."})),k(i.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."})),a=i[0],s=ka(e).scheme,u=ka(e).path,c=s===ka(e).scheme,[4,o.load()];case 1:return l=h.sent(),t&&c?[4,Nr.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,a.save(l)];case 4:return f=h.sent(),!t||c?[3,6]:[4,Nr.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}}))}))}var oo="models_store",Ar="model_info_store";function Jm(){if(!K().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,n=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function Ac(e){var n=e.result;n.createObjectStore(oo,{keyPath:"modelPath"}),n.createObjectStore(Ar,{keyPath:"modelPath"})}var Yo=(function(){function e(n){if(this.indexedDB=Jm(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return e.prototype.save=function(n){return he(this,void 0,void 0,(function(){return de(this,(function(t){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]}))}))},e.prototype.load=function(){return he(this,void 0,void 0,(function(){return de(this,(function(n){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(n,t){var r=this;return new Promise((function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Ac(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(oo,"readonly"),c=u.objectStore(oo).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,f=ra(t),h=s.transaction(Ar,"readwrite"),d=h.objectStore(Ar),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:f});p.onsuccess=function(){var v=(l=s.transaction(oo,"readwrite")).objectStore(oo).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});v.onsuccess=function(){return o({modelArtifactsInfo:f})},v.onerror=function(m){var g=(d=h.objectStore(Ar)).delete(r.modelPath);g.onsuccess=function(){return s.close(),i(v.error)},g.onerror=function(b){return s.close(),i(v.error)}}},p.onerror=function(v){return s.close(),i(p.error)},h.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}}))},e.URL_SCHEME="indexeddb://",e})(),Cd=function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Yo.URL_SCHEME)?(n=e.slice(Yo.URL_SCHEME.length),new Yo(n)):null;var n};rn.registerSaveRouter(Cd),rn.registerLoadRouter(Cd);var pS=(function(){function e(){this.indexedDB=Jm()}return e.prototype.listModels=function(){return he(this,void 0,void 0,(function(){var n=this;return de(this,(function(t){return[2,new Promise((function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Ac(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Ar,"readonly"),u=s.objectStore(Ar).getAll();u.onsuccess=function(){for(var c={},l=0,f=u.result;l<f.length;l++){var h=f[l];c[h.modelPath]=h.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}}))]}))}))},e.prototype.removeModel=function(n){return he(this,void 0,void 0,(function(){var t=this;return de(this,(function(r){var o;return n=(o=n).startsWith(Yo.URL_SCHEME)?o.slice(Yo.URL_SCHEME.length):o,[2,new Promise((function(i,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Ac(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Ar,"readwrite"),f=l.objectStore(Ar),h=f.get(n);h.onsuccess=function(){if(h.result==null)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var d=f.delete(n),p=function(){var v=(u=c.transaction(oo,"readwrite")).objectStore(oo).delete(n);v.onsuccess=function(){return i(h.result.modelArtifactsInfo)},v.onerror=function(m){return a(h.error)}};d.onsuccess=p,d.onerror=function(v){return p(),c.close(),a(h.error)}},h.onerror=function(d){return c.close(),a(h.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}}))]}))}))},e})();if(K().getBool("IS_BROWSER"))try{Nr.registerManager(Yo.URL_SCHEME,new pS)}catch{}var ur="/",Mo="tensorflowjs_models",Zm="info",vS="model_topology",mS="weight_specs",gS="weight_data",yS="model_metadata";function eg(e){return{info:[Mo,e,Zm].join(ur),topology:[Mo,e,vS].join(ur),weightSpecs:[Mo,e,mS].join(ur),weightData:[Mo,e,gS].join(ur),modelMetadata:[Mo,e,yS].join(ur)}}function bS(e){var n=e.split(ur);if(n.length<3)throw new Error("Invalid key format: "+e);return n.slice(1,n.length-1).join(ur)}var Qo=(function(){function e(n){if(!K().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=eg(this.modelPath)}return e.prototype.save=function(n){return he(this,void 0,void 0,(function(){var t,r,o;return de(this,(function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=ra(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(a){if(kc)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)})(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return he(this,void 0,void 0,(function(){var n,t,r,o,i,a,s;return de(this,(function(u){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(c){if(kc){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var f=atob(c),h=new Uint8Array(f.length),d=0;d<f.length;++d)h.set([f.charCodeAt(d)],d);return h.buffer})(s),[2,t]}))}))},e.URL_SCHEME="localstorage://",e})(),Ed=function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Qo.URL_SCHEME)?(n=e.slice(Qo.URL_SCHEME.length),new Qo(n)):null;var n};rn.registerSaveRouter(Ed),rn.registerLoadRouter(Ed);var xS=(function(){function e(){k(K().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),k(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return he(this,void 0,void 0,(function(){var n,t,r,o,i,a;return de(this,(function(s){for(n={},t=Mo+ur,r=ur+Zm,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(t)&&i.endsWith(r)&&(a=bS(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]}))}))},e.prototype.removeModel=function(n){return he(this,void 0,void 0,(function(){var t,r;return de(this,(function(o){var i;if(n=(i=n).startsWith(Qo.URL_SCHEME)?i.slice(Qo.URL_SCHEME.length):i,t=eg(n),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},e})();if(K().getBool("IS_BROWSER"))try{Nr.registerManager(Qo.URL_SCHEME,new xS)}catch{}var wS="model",_S=".json",CS=".weights.bin";function Rd(e){return new Promise((function(n){return setTimeout(n)})).then(e)}var Ou=(function(){function e(n){if(!K().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(e.URL_SCHEME)&&(n=n.slice(e.URL_SCHEME.length)),n!=null&&n.length!==0||(n=wS),this.modelTopologyFileName=n+_S,this.weightDataFileName=n+CS}return e.prototype.save=function(n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s;return de(this,(function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Rd((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return u.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,Rd((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:ra(n)}]}}))}))},e.URL_SCHEME="downloads://",e})(),ES=(function(){function e(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return e.prototype.load=function(){return he(this,void 0,void 0,(function(){var n,t,r=this;return de(this,(function(o){return n=this.files[0],t=this.files.slice(1),[2,new Promise((function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){t.length===0&&i({modelTopology:l});var f=c.weightsManifest;if(f!=null){var h;try{h=r.checkManifestAndWeightFiles(f,t)}catch(m){return void a(m)}var d=[],p=[],v=[];f.forEach((function(m){m.paths.forEach((function(g){p.push(g),v.push(null)})),d.push.apply(d,m.weights)})),f.forEach((function(m){m.paths.forEach((function(g){var b=new FileReader;b.onload=function(w){var y=w.target.result,x=p.indexOf(g);v[x]=y,v.indexOf(null)===-1&&i({modelTopology:l,weightSpecs:d,weightData:Ml(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(w){return a("Failed to weights data from file of path '"+g+"'.")},b.readAsArrayBuffer(h[g])}))}))}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(n,t){for(var r=[],o=t.map((function(u){return wd(u.name)})),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach((function(u){var c=wd(u);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),o.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=t[o.indexOf(c)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},e})();function Sd(e,n,t,r){(function(i){k(i!=null&&Array.isArray(i)&&i.length>0,(function(){return"promises must be a none empty array"}))})(e),(function(i,a){k(i>=0&&i<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i})),k(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a})),k(a>=i,(function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a}))})(t=t??0,r=r??1);var o=0;return Promise.all(e.map((function(i){return i.then((function(a){var s=t+ ++o/e.length*(r-t);return n(s),a})),i})))}function tg(e,n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l;return de(this,(function(f){switch(f.label){case 0:return n==null&&(n={}),t=n.fetchFunc==null?K().platform.fetch:n.fetchFunc,r=e.map((function(h){return t(h,n.requestInit,{isBinary:!0})})),o=0,i=.5,n.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=f.sent(),[3,4];case 2:return[4,Sd(r,n.onProgress,o,i)];case 3:a=f.sent(),f.label=4;case 4:return s=a.map((function(h){return h.arrayBuffer()})),u=.5,c=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,Sd(s,n.onProgress,u,c)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}}))}))}function Id(e){var n=this;return function(t,r,o){return r===void 0&&(r=""),he(n,void 0,void 0,(function(){var i,a,s,u,c,l,f,h,d,p;return de(this,(function(v){switch(v.label){case 0:if(i=t.map((function(){return!1})),a={},s=o!=null?o.map((function(){return!1})):[],u=[],t.forEach((function(m,g){var b=0;m.weights.forEach((function(w){var y="quantization"in w?w.quantization.dtype:w.dtype,x=Ic[y]*ve(w.shape),_=function(){i[g]=!0,a[g]==null&&(a[g]=[]),a[g].push({manifestEntry:w,groupOffset:b,sizeBytes:x})};o!=null?o.forEach((function(S,I){S===w.name&&(_(),s[I]=!0)})):_(),u.push(w.name),b+=x}))})),!s.every((function(m){return m})))throw c=o.filter((function(m,g){return!s[g]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=i.reduce((function(m,g,b){return g&&m.push(b),m}),[]),f=[],l.forEach((function(m){t[m].paths.forEach((function(g){var b=r+(r.endsWith("/")?"":"/")+g;f.push(b)}))})),[4,e(f)];case 1:return h=v.sent(),d={},p=0,l.forEach((function(m){for(var g=t[m].paths.length,b=0,w=0;w<g;w++)b+=h[p+w].byteLength;for(var y=new ArrayBuffer(b),x=new Uint8Array(y),_=0,S=0;S<g;S++){var I=new Uint8Array(h[p+S]);x.set(I,_),_+=I.byteLength}a[m].forEach((function(C){var E=Qm(y.slice(C.groupOffset,C.groupOffset+C.sizeBytes),[C.manifestEntry]);for(var N in E)d[N]=E[N]})),p+=g})),[2,d]}}))}))}}rn.registerSaveRouter((function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ou.URL_SCHEME)?(function(n){return n===void 0&&(n="model"),new Ou(n)})(e.slice(Ou.URL_SCHEME.length)):null}));var ng=(function(){function e(n,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(k(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=K().platform.fetch,k(n!=null&&n.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(n)&&k(n.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."})),this.path=n,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(n){return he(this,void 0,void 0,(function(){var t,r,o,i;return de(this,(function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),n.weightData!=null&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:ra(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return he(this,void 0,void 0,(function(){var n,t,r,o,i,a,s,u,c,l,f,h;return de(this,(function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,n.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:h=d.sent(),l=h[0],f=h[1],d.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}}))}))},e.prototype.loadWeights=function(n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f,h;return de(this,(function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(p){var v=p.lastIndexOf("/"),m=p.lastIndexOf("?"),g=p.substring(0,v),b=m>v?p.substring(m):"";return[g+"/",b]})(t),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return f=[],n.forEach((function(p){p.paths.forEach((function(v){f.push(a+v+i)}))})),[4,tg(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[s,Ml(h)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e})();function Tc(e){return e.match(ng.URL_SCHEME_REGEX)!=null}var kd=function(e,n){return typeof fetch>"u"?null:(Array.isArray(e)?e.every((function(t){return Tc(t)})):Tc(e))?Dc(e,{onProgress:n}):null};function Dc(e,n){return new ng(e,n)}rn.registerSaveRouter(kd),rn.registerLoadRouter(kd);var Bu=(function(){function e(n){this.modelArtifacts=n}return e.prototype.load=function(){return he(this,void 0,void 0,(function(){return de(this,(function(n){return[2,this.modelArtifacts]}))}))},e})(),RS=(function(){function e(n){this.saveHandler=n}return e.prototype.save=function(n){return he(this,void 0,void 0,(function(){return de(this,(function(t){return[2,this.saveHandler(n)]}))}))},e})(),rg=Object.freeze({browserFiles:function(e){return new ES(e)},browserHTTPRequest:function(e,n){return Dc(e,n)},concatenateArrayBuffers:Ml,decodeWeights:Qm,encodeWeights:function(e,n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s=this;return de(this,(function(u){switch(u.label){case 0:for(t=[],r=[],o=Array.isArray(e)?e.map((function(c){return c.name})):Object.keys(e),i=function(c){var l=o[c],f=Array.isArray(e)?e[c].tensor:e[l];if(f.dtype!=="float32"&&f.dtype!=="int32"&&f.dtype!=="bool"&&f.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+f.dtype);var h={name:l,shape:f.shape,dtype:f.dtype};if(f.dtype==="string"){var d=new Promise((function(p){return he(s,void 0,void 0,(function(){var v,m,g,b,w,y,x;return de(this,(function(_){switch(_.label){case 0:return[4,f.bytes()];case 1:for(v=_.sent(),m=v.reduce((function(S,I){return S+I.length}),0)+as*v.length,g=new Uint8Array(m),b=0,w=0;w<v.length;w++)y=v[w],x=new Uint8Array(new Uint32Array([y.length]).buffer),g.set(x,b),b+=as,g.set(y,b),b+=y.length;return p(g),[2]}}))}))}));r.push(d)}else r.push(f.data());n!=null&&(h.group=n),t.push(h)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:dS(u.sent()),specs:t}]}}))}))},fromMemory:function(e,n,t,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new Bu(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bu({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bu({modelTopology:e,weightSpecs:n,weightData:t,trainingConfig:r}))},getLoadHandlers:function(e,n){return rn.getLoadHandlers(e,n)},getModelArtifactsInfoForJSON:ra,getSaveHandlers:function(e){return rn.getSaveHandlers(e)},http:Dc,isHTTPScheme:Tc,loadWeights:function(e,n,t,r){return n===void 0&&(n=""),he(this,void 0,void 0,(function(){return de(this,(function(o){return[2,Id((function(i){return tg(i,{requestInit:r})}))(e,n,t)]}))}))},registerLoadRouter:function(e){return rn.registerLoadRouter(e)},registerSaveRouter:function(e){return rn.registerSaveRouter(e)},weightsLoaderFactory:Id,withSaveHandler:function(e){return new RS(e)},copyModel:function(e,n){return he(this,void 0,void 0,(function(){return de(this,(function(t){return[2,_d(e,n,!1)]}))}))},listModels:function(){return he(this,void 0,void 0,(function(){var e,n,t,r,o,i,a;return de(this,(function(s){switch(s.label){case 0:e=Nr.getSchemes(),n={},t=0,r=e,s.label=1;case 1:return t<r.length?(o=r[t],[4,Nr.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())n[o+Xo+a]=i[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,n]}}))}))},moveModel:function(e,n){return he(this,void 0,void 0,(function(){return de(this,(function(t){return[2,_d(e,n,!0)]}))}))},removeModel:function(e){return he(this,void 0,void 0,(function(){var n;return de(this,(function(t){return n=ka(e),[2,Nr.getManager(n.scheme).removeModel(n.path)]}))}))}}),Io;P({confusionMatrix_:function(e,n,t){var r=R(e,"labels","confusionMatrix"),o=R(n,"predictions","confusionMatrix");k(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),k(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),k(o.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),k(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),k(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var i=_c(r.asType("int32"),t),a=_c(o.asType("int32"),t);return i.transpose().matMul(a).asType("int32")}});var SS=P({fromPixels_:function(e,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Iv("FromPixels",M.backendName)!=null)return M.runKernel("FromPixels",{pixels:e},{numChannels:n});var s,u,c=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(a?s=e.getContext("2d").getImageData(0,0,l,f).data:r||t?s=e.data:(i||o)&&(Io==null&&(Io=document.createElement("canvas").getContext("2d")),Io.canvas.width=l,Io.canvas.height=f,Io.drawImage(e,0,0,l,f),s=Io.getImageData(0,0,l,f).data),n===4)u=new Int32Array(s);else{var h=l*f;u=new Int32Array(h*n);for(var d=0;d<h;d++)for(var p=0;p<n;++p)u[d*n+p]=s[4*d+p]}return ll(u,[f,l,n],"int32")}}),Ol=Object.freeze({toPixels:function(e,n){return he(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f,h,d,p,v,m,g,b,w,y,x,_,S,I;return de(this,(function(C){switch(C.label){case 0:if(t=R(e,"img","toPixels"),e instanceof Je||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),o=r[0],i=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=C.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=C.sent(),f=l[0],h=l[1],d=f[0],p=h[0],u.dispose(),c.dispose(),t.dtype==="float32"){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(v=t.dtype==="float32"?255:1,m=new Uint8ClampedArray(i*o*4),g=0;g<o*i;++g)b=void 0,w=void 0,y=void 0,x=void 0,a===1?(b=s[g]*v,w=s[g]*v,y=s[g]*v,x=255):a===3?(b=s[3*g]*v,w=s[3*g+1]*v,y=s[3*g+2]*v,x=255):a===4&&(b=s[4*g]*v,w=s[4*g+1]*v,y=s[4*g+2]*v,x=s[4*g+3]*v),m[(_=4*g)+0]=Math.round(b),m[_+1]=Math.round(w),m[_+2]=Math.round(y),m[_+3]=Math.round(x);return n!=null&&(n.width=i,n.height=o,S=n.getContext("2d"),I=new ImageData(m,i,o),S.putImageData(I,0,0)),t!==e&&t.dispose(),[2,m]}}))}))},fromPixels:SS}),IS=(function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(n,t){return new n(t)},e})(),kS=(function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(n){e.getMap().classNameMap[n.className]=[n,n.fromConfig]},e})();function go(e){k(e.className!=null,(function(){return"Class being registered does not have the static className property defined."})),k(typeof e.className=="string",(function(){return"className is required to be a string, but got type "+typeof e.className})),k(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),kS.register(e)}var yo=(function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return An(n,e),n.prototype.minimize=function(t,r,o){r===void 0&&(r=!1);var i=this.computeGradients(t,o),a=i.value,s=i.grads;if(o!=null){var u=o.map((function(c){return{name:c.name,tensor:s[c.name]}}));this.applyGradients(u)}else this.applyGradients(s);return Xt(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(t,r){return L_(t,r)},n.prototype.dispose=function(){this.iterations_!=null&&Xt(this.iterations_)},n.prototype.saveIterations=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ae(this.iterations_,"int32")}]}))}))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},n.prototype.extractIterations=function(t){return he(this,void 0,void 0,(function(){var r;return de(this,(function(o){switch(o.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,t.slice(1)]}}))}))},n})(IS);Object.defineProperty(yo,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var AS=(function(e){function n(t,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=M.backend.epsilon()),i}return An(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=M.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:le((function(){return Be(a).variable(!1)}))}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:le((function(){return Be(a).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;le((function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),f=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),h=c.mul(r.rho).add(f.square().mul(1-r.rho));u.assign(l),c.assign(h);var d=f.mul(-r.learningRate).add(a);a.assign(d)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Xt(this.accumulatedGrads.map((function(t){return t.variable}))),Xt(this.accumulatedUpdates.map((function(t){return t.variable}))))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){var t;return de(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){var r;return de(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n})(yo);go(AS);var TS=(function(e){function n(t,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return An(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=M.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:le((function(){return qn(a.shape,r.initialAccumulatorValue).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedGrads[i].variable;le((function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(M.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&Xt(this.accumulatedGrads.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n})(yo);go(TS);var DS=(function(e){function n(t,r,o,i){i===void 0&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],le((function(){a.accBeta1=ae(r).variable(),a.accBeta2=ae(o).variable()})),i==null&&(a.epsilon=M.backend.epsilon()),a}return An(n,e),n.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t);le((function(){var i=ht(1,r.accBeta1),a=ht(1,r.accBeta2);o.forEach((function(s,u){var c=M.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:le((function(){return Be(c).variable(!1)}))}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:le((function(){return Be(c).variable(!1)}))});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var f=r.accumulatedFirstMoment[u].variable,h=r.accumulatedSecondMoment[u].variable,d=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=h.mul(r.beta2).add(l.square().mul(1-r.beta2)),v=d.div(i),m=p.div(a);f.assign(d),h.assign(p);var g=v.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(g)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Xt(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&Xt(this.accumulatedSecondMoment.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){var t;return de(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){var r,o=this;return de(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),le((function(){o.accBeta1.assign(os(o.beta1,o.iterations_+1)),o.accBeta2.assign(os(o.beta2,o.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n})(yo);go(DS);var NS=(function(e){function n(t,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],le((function(){s.iteration=ae(0).variable(),s.accBeta1=ae(r).variable()})),i==null&&(s.epsilon=M.backend.epsilon()),s}return An(n,e),n.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t);le((function(){var i=ht(1,r.accBeta1),a=wn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach((function(s,u){var c=M.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Be(c).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Be(c).variable(!1)});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var f=r.accumulatedFirstMoment[u].variable,h=r.accumulatedWeightedInfNorm[u].variable,d=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=h.mul(r.beta2),v=l.abs(),m=p.maximum(v);f.assign(d),h.assign(m);var g=a.div(i).mul(d.div(m.add(r.epsilon))).add(c);c.assign(g)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Xt(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&Xt(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n})(yo);go(NS);var og=(function(e){function n(t){var r=e.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return An(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=Array.isArray(t)?t[i].tensor:t[o];if(a!=null){var s=M.registeredVariables[o];le((function(){var u=r.c.mul(a).add(s);s.assign(u)}))}})),this.incrementIterations()},n.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Jw(ae(-t))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(t,r){return new t(r.learningRate)},n.className="SGD",n})(yo);go(og);var PS=(function(e){function n(t,r,o){o===void 0&&(o=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=ae(i.momentum),i}return An(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=M.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:le((function(){return Be(a).variable(!1)}))});var s=r.accumulations[i].variable,u=Array.isArray(t)?t[i].tensor:t[o];u!=null&&le((function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)}))})),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Xt(this.accumulations.map((function(t){return t.variable})))},n.prototype.setMomentum=function(t){this.momentum=t},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){return de(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){return de(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n})(og);go(PS);var FS=(function(e){function n(t,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=M.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return An(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=M.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:le((function(){return Be(a).variable(!1)}))}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:le((function(){return Be(a).variable(!1)}))}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:le((function(){return Be(a).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;le((function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var f=r.accumulatedMeanGrads[i].variable,h=f.mul(r.decay).add(s.mul(1-r.decay)),d=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(h.square().add(r.epsilon)).sqrt()));u.assign(l),f.assign(h),c.assign(d);var p=a.sub(d);a.assign(p)}else{var v=u.mul(r.decay).add(s.square().mul(1-r.decay));d=c.mul(r.momentum).add(s.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),c.assign(d),p=a.sub(d),a.assign(p)}}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Xt(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&Xt(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&Xt(this.accumulatedMoments.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return he(this,void 0,void 0,(function(){var t;return de(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return he(this,void 0,void 0,(function(){var r;return de(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}))),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n})(yo);go(FS);Je.prototype.squaredDifference=function(e){return bm(this,e)},H=aS;var Nc=function(e,n){return Nc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},Nc(e,n)};function Ae(e,n){Nc(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var Dt=function(){return Dt=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Dt.apply(this,arguments)};function ye(e,n,t,r){function o(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((r=r.apply(e,[])).next())})}function be(e,n){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=n.call(e,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ai(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;for(var r=Array(e),o=0,n=0;n<t;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Jo=(function(){function e(n,t){if(!ao(n)||!ao(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:t}));this._width=n,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e})();function Os(e,n){return e instanceof Je&&e.shape.length===n}function MS(e){return Os(e,2)}function Bs(e){return Os(e,3)}function Pr(e){return Os(e,4)}function OS(e){return e%1!==0}function Ad(e){return e%2===0}function BS(e,n){n===void 0&&(n=2);var t=Math.pow(10,n);return Math.floor(e*t)/t}function Td(e){return e&&e.width&&e.height}function LS(e,n){var t=e.width,r=e.height,o=n/Math.max(r,t);return new Jo(Math.round(t*o),Math.round(r*o))}function Bl(e){return e.reduce(function(n,t){return n.add(t)},new Ve(0,0)).div(new Ve(e.length,e.length))}function qi(e,n,t){return Array(e).fill(0).map(function(r,o){return n+o*t})}function ao(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function Dd(e){return ao(e)&&0<=e&&e<=1}var Ve=(function(){function e(n,t){this._x=n,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(n){return new e(this.x+n.x,this.y+n.y)},e.prototype.sub=function(n){return new e(this.x-n.x,this.y-n.y)},e.prototype.mul=function(n){return new e(this.x*n.x,this.y*n.y)},e.prototype.div=function(n){return new e(this.x/n.x,this.y/n.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e})(),Lr=(function(){function e(n,t){t===void 0&&(t=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(ao),i=[r.x,r.y,r.width,r.height].every(ao);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",t),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(ao)},e.assertIsValidBox=function(n,t,r){if(r===void 0&&(r=!1),!e.isRect(n))throw new Error(t+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(t+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Ve(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Ve(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Ve(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Ve(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=n[0],r=n[1],o=n[2],i=n[3];return new e({x:t,y:r,width:o,height:i})},e.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=n[0],r=n[1],o=n[2],i=n[3];return new e({x:t,y:r,width:o,height:i})},e.prototype.toSquare=function(){var n=this,t=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(t-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:t,y:r,width:o,height:i})},e.prototype.rescale=function(n){var t=Td(n)?n.width:n,r=Td(n)?n.height:n;return new e({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},e.prototype.pad=function(n,t){var r=[this.x-n/2,this.y-t/2,this.width+n,this.height+t],o=r[0],i=r[1],a=r[2],s=r[3];return new e({x:o,y:i,width:a,height:s})},e.prototype.clipAtImageBorders=function(n,t){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,f=s-c,h=Math.min(l,n-u),d=Math.min(f,t-c);return new e({x:u,y:c,width:h,height:d}).floor()},e.prototype.shift=function(n,t){var r=this,o=r.width,i=r.height,a=this.x+n,s=this.y+t;return new e({x:a,y:s,width:o,height:i})},e.prototype.padAtBorders=function(n,t){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,c=this.left,l=this.top,f=this.right,h=this.bottom;return f>t&&(s=-f+t+r,f=t),h>n&&(u=-h+n+o,h=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:a,edy:u,dx:i,edx:s,y:l,ey:h,x:c,ex:f,w:r,h:o}},e.prototype.calibrate=function(n){return new e({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},e})(),Ls=(function(e){Ae(n,e);function n(t,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{left:t,top:r,right:o,bottom:i},a)||this}return n})(Lr),ig=(function(){function e(n,t,r,o,i){this._imageDims=new Jo(i.width,i.height),this._score=n,this._classScore=t,this._className=r,this._box=new Lr(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Lr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:t})},e})(),Qn=(function(e){Ae(n,e);function n(t,r,o){return e.call(this,t,t,"",r,o)||this}return n.prototype.forSize=function(t,r){var o=e.prototype.forSize.call(this,t,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new n(i,a,s)},n})(ig);function WS(e,n,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(e.right,n.right)-Math.max(e.left,n.left)),o=Math.max(0,Math.min(e.bottom,n.bottom)-Math.max(e.top,n.top)),i=r*o;return t?i/(e.area+n.area-i):i/Math.min(e.area,n.area)}function VS(e){var n=e.map(function(s){return s.x}),t=e.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=t.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new Ls(r,o,i,a)}function ji(e,n,t,r){r===void 0&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++){var f=u[l],h=e[s],d=e[f];c.push(WS(h,d,r))}o=o.filter(function(p,v){return c[v]<=t})};o.length>0;)a();return i}function oa(e,n){return le(function(){var t=n[0],r=n[1],o=n[2],i=qn(Ai(e.shape.slice(0,3),[1]),t),a=qn(Ai(e.shape.slice(0,3),[1]),r),s=qn(Ai(e.shape.slice(0,3),[1]),o),u=ct([i,a,s],3);return ht(e,u)})}function zS(e,n){return n===void 0&&(n=!1),le(function(){var t=e.shape.slice(1),r=t[0],o=t[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(d){var p=e.shape.slice();return p[s]=d,qn(p,0)},c=u(a),l=i-c.shape[s],f=n&&l?u(l):null,h=[f,e,c].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return ct(h,s)})}function Lu(e){return 1/(1+Math.exp(-e))}var Ll=(function(e){Ae(n,e);function n(t,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{x:t,y:r,width:o,height:i},a)||this}return n})(Lr),US=.5,HS=.43,GS=.45,ss=(function(){function e(n,t,r){r===void 0&&(r=new Ve(0,0));var o=t.width,i=t.height;this._imgDims=new Jo(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new Ve(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Ve(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(t){return t.sub(n._shift).div(new Ve(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new this.constructor(this.relativePositions,{width:n,height:t})},e.prototype.shiftBy=function(n,t){return new this.constructor(this.relativePositions,this._imgDims,new Ve(n,t))},e.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},e.prototype.align=function(n,t){if(t===void 0&&(t={}),n){var r=n instanceof Qn?n.box.floor():new Lr(n);return this.shiftBy(r.x,r.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[0],r=n[1],o=n[2],i=function(f){return o.sub(f).magnitude()},a=(i(t)+i(r))/2,s=Math.floor(a/GS),u=Bl(n),c=Math.floor(Math.max(0,u.x-US*s)),l=Math.floor(Math.max(0,u.y-HS*s));return new Ll(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},e.prototype.alignMinBbox=function(n){var t=VS(this.positions);return t.pad(t.width*n,t.height*n)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e})(),qS=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Bl([t[3],t[4]])]},n})(ss),jS=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Bl)},n})(ss),Nd=(function(){function e(n,t){this._label=n,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+BS(this.distance)+")":"")},e})(),Pd=(function(e){Ae(n,e);function n(t,r){var o=e.call(this,t)||this;return o._label=r,o}return n.assertIsValidLabeledBox=function(t,r){if(Lr.assertIsValidBox(t,r),!ao(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n})(Lr),yi=(function(){function e(n,t){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},e.fromJSON=function(n){var t=n.descriptors.map(function(r){return new Float32Array(r)});return new e(n.label,t)},e})();(function(e){Ae(n,e);function n(t,r,o,i){var a=e.call(this,t,r)||this;return a._score=o,a._classScore=i,a}return n.assertIsValidPredictedBox=function(t,r){if(Pd.assertIsValidLabeledBox(t,r),!Dd(t.score)||!Dd(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n})(Pd);function KS(e){return e.detection instanceof Qn}function Wl(e,n){var t={detection:n};return Object.assign({},e,t)}function ag(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:n}}function sg(e){var n="";if(!e)try{e=require("fs")}catch(r){n=r.toString()}var t=e?function(r){return new Promise(function(o,i){e.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:t}}function ug(){var e=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,t=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=sg();return Dt({Canvas:e||(function(){function a(){}return a})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function a(){}return a})(),Image:n||(function(){function a(){}return a})(),ImageData:global.ImageData||(function(){function a(){}return a})(),Video:global.HTMLVideoElement||(function(){function a(){}return a})(),createCanvasElement:t,createImageElement:r,fetch:o},i)}function cg(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function lg(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var st;function $S(){if(!st)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return st}function Pc(e){st=e}function Vl(){cg()&&Pc(ag()),lg()&&Pc(ug())}function XS(e){if(st||Vl(),!st)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=e.Canvas,t=n===void 0?st.Canvas:n,r=e.Image,o=r===void 0?st.Image:r;st.Canvas=t,st.Image=o,st.createCanvasElement=e.createCanvasElement||(function(){return new t}),st.createImageElement=e.createImageElement||(function(){return new o}),st.ImageData=e.ImageData||st.ImageData,st.Video=e.Video||st.Video,st.fetch=e.fetch||st.fetch,st.readFile=e.readFile||st.readFile}var Vt={getEnv:$S,setEnv:Pc,initialize:Vl,createBrowserEnv:ag,createFileSystem:sg,createNodejsEnv:ug,monkeyPatch:XS,isBrowser:cg,isNodejs:lg};Vl();function fg(e){return!Vt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function fo(e){var n=Vt.getEnv(),t=n.Canvas,r=n.CanvasRenderingContext2D;if(e instanceof r)return e;var o=fg(e);if(!(o instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var Fd;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Fd||(Fd={}));function hg(e){var n=Vt.getEnv(),t=n.Image,r=n.Video;return e instanceof t&&e.complete||e instanceof r&&e.readyState>=3}function YS(e){return new Promise(function(n,t){if(e instanceof Vt.getEnv().Canvas||hg(e))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function dg(e){var n=Vt.getEnv(),t=n.Image,r=n.Video;return e instanceof t?new Jo(e.naturalWidth,e.naturalHeight):e instanceof r?new Jo(e.videoWidth,e.videoHeight):new Jo(e.width,e.height)}function Ws(e){var n=e.width,t=e.height,r=Vt.getEnv().createCanvasElement,o=r();return o.width=n,o.height=t,o}function zl(e,n){var t=Vt.getEnv().ImageData;if(!(e instanceof t)&&!hg(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=dg(e),o=r.width,i=r.height,a=Ws({width:o,height:i});return e instanceof t?fo(a).putImageData(e,0,0):fo(a).drawImage(e,0,0,o,i),a}function QS(e,n){return ye(this,void 0,void 0,function(){var t,r,o,i,a,s;return be(this,function(u){switch(u.label){case 0:return t=Vt.getEnv().createCanvasElement(),r=e.shape.slice(Pr(e)?1:0),o=r[0],i=r[1],a=r[2],s=le(function(){return e.as3D(o,i,a).toInt()}),[4,Ol.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function Md(e){var n=Vt.getEnv(),t=n.Image,r=n.Canvas,o=n.Video;return e instanceof t||e instanceof r||e instanceof o}function JS(e,n,t){t===void 0&&(t=!1);var r=Vt.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=dg(e),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Ws({width:n,height:n}),f=e instanceof i?e:zl(e),h=Math.abs(u-c)/2,d=t&&u<c?h:0,p=t&&c<u?h:0;return fo(l).drawImage(f,d,p,u,c),l}var us=(function(){function e(n,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=t,this._batchSize=n.length,n.forEach(function(o,i){if(Bs(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(Pr(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Vt.getEnv().Canvas?o:zl(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var n=this;return qi(this.batchSize,0,1).map(function(t,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},e.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},e.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},e.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},e.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(n),r=this.getInputHeight(n);return LS({width:t,height:r},this.inputSize)},e.prototype.toBatchTensor=function(n,t){var r=this;return t===void 0&&(t=!0),this._inputSize=n,le(function(){var o=qi(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Je){var u=Pr(s)?s:s.expandDims();return u=zS(u,t),(u.shape[1]!==n||u.shape[2]!==n)&&(u=Tl.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof Vt.getEnv().Canvas)return Ol.fromPixels(JS(s,n,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=an(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3);return i})},e})();function bt(e){return ye(this,void 0,void 0,function(){var n,t,r;return be(this,function(o){switch(o.label){case 0:if(e instanceof us)return[2,e];if(n=Array.isArray(e)?e:[e],!n.length)throw new Error("toNetInput - empty array passed as input");return t=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=n.map(fg),r.forEach(function(i,a){if(!Md(i)&&!Bs(i)&&!Pr(i))throw typeof n[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Pr(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return Md(i)&&YS(i)}))];case 1:return o.sent(),[2,new us(r,Array.isArray(e))]}})})}function Ul(e,n){return ye(this,void 0,void 0,function(){var t,r,o,i,a,s,u;return be(this,function(c){switch(c.label){case 0:return t=Vt.getEnv().Canvas,r=e,e instanceof t?[3,5]:[4,bt(e)];case 1:if(o=c.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof t?(a=i,[3,4]):[3,2];case 2:return[4,QS(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=fo(r),u=n.map(function(l){return l instanceof Qn?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(l){var f=l.x,h=l.y,d=l.width,p=l.height,v=Ws({width:d,height:p});return fo(v).putImageData(s.getImageData(f,h,d,p),0,0),v})]}})})}function Hl(e,n){return ye(this,void 0,void 0,function(){return be(this,function(t){if(!Bs(e)&&!Pr(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Pr(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,le(function(){var r=e.shape.slice(Pr(e)?1:0),o=r[0],i=r[1],a=r[2],s=n.map(function(c){return c instanceof Qn?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}),u=s.map(function(c){var l=c.x,f=c.y,h=c.width,d=c.height;return Vm(e.as3D(o,i,a),[f,l,0],[d,h,a])});return u})]})})}function ZS(e,n){return ye(this,void 0,void 0,function(){var t,r;return be(this,function(o){switch(o.label){case 0:return t=Vt.getEnv().fetch,[4,t(e,n)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function eI(e){return ye(this,void 0,void 0,function(){return be(this,function(n){switch(n.label){case 0:return[4,ZS(e)];case 1:return[2,n.sent().json()]}})})}function pg(e,n){var t=n+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:t};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),i=e.endsWith(".json")?o[o.length-1]:t,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function tI(e,n){return ye(this,void 0,void 0,function(){var t,r,o,i;return be(this,function(a){switch(a.label){case 0:return t=pg(e,n),r=t.manifestUri,o=t.modelBaseUri,[4,eI(r)];case 1:return i=a.sent(),[2,rg.loadWeights(i,o)]}})})}var gr=(function(){function e(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(n){var t=this.traversePropertyPath(n),r=t.obj,o=t.objProp;return r[o]},e.prototype.reassignParamFromPath=function(n,t){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=t},e.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof ri})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof ri)})},e.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(t){var r=t.path,o=t.tensor;n.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(t){var r=t.path,o=t.tensor,i=Ct(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(t){if(n&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var t=n.tensor;return Array.from(t.dataSync())}).reduce(function(n,t){return n.concat(t)}))},e.prototype.load=function(n){return ye(this,void 0,void 0,function(){return be(this,function(t){switch(t.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(n){return ye(this,void 0,void 0,function(){var t;return be(this,function(r){switch(r.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,tI(n,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(n){return ye(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,f;return be(this,function(h){switch(h.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Vt.getEnv().readFile,r=pg(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(d){return Promise.all(d.map(function(p){return t(p).then(function(v){return v.buffer})}))},s=rg.weightsLoaderFactory(a),l=(c=JSON).parse,[4,t(o)];case 1:return u=l.apply(c,[h.sent().toString()]),[4,s(u,i)];case 2:return f=h.sent(),this.loadFromWeightMap(f),[2]}})})},e.prototype.loadFromWeightMap=function(n){var t=this.extractParamsFromWeigthMap(n),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(n){var t=this.extractParams(n),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=t.obj,o=t.objProp;if(!r||!o||!(r[o]instanceof Je))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},e})();function on(e,n,t){return le(function(){var r=Rl(e,n.depthwise_filter,n.pointwise_filter,t,"same");return r=Me(r,n.bias),r})}function Wu(e,n,t){return t===void 0&&(t=!1),le(function(){var r=Ze(t?Me(yn(e,n.conv0.filters,[2,2],"same"),n.conv0.bias):on(e,n.conv0,[2,2])),o=on(r,n.conv1,[1,1]),i=Ze(Me(r,o)),a=on(i,n.conv2,[1,1]);return Ze(Me(r,Me(o,a)))})}function wa(e,n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),le(function(){var o=Ze(t?Me(yn(e,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):on(e,n.conv0,r?[2,2]:[1,1])),i=on(o,n.conv1,[1,1]),a=Ze(Me(o,i)),s=on(a,n.conv2,[1,1]),u=Ze(Me(o,Me(i,s))),c=on(u,n.conv3,[1,1]);return Ze(Me(o,Me(i,Me(s,c))))})}function Rn(e,n,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),le(function(){var o=Me(yn(e,n.filters,[1,1],t),n.bias);return r?Ze(o):o})}function yr(e,n){Object.keys(e).forEach(function(t){n.some(function(r){return r.originalPath===t})||e[t].dispose()})}function Vs(e,n){return function(t,r,o,i){var a=jt(e(t*r*o*o),[o,o,t,r]),s=it(e(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function Gl(e,n){return function(t,r,o){var i=Dr(e(t*r),[t,r]),a=it(e(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var vg=(function(){function e(n,t,r){this.depthwise_filter=n,this.pointwise_filter=t,this.bias=r}return e})();function ql(e,n){return function(t,r,o){var i=jt(e(9*t),[3,3,t,1]),a=jt(e(t*r),[1,1,t,r]),s=it(e(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new vg(i,a,s)}}function jl(e){return function(n){var t=e(n+"/depthwise_filter",4),r=e(n+"/pointwise_filter",4),o=e(n+"/bias",1);return new vg(t,r,o)}}function zr(e,n){return function(t,r,o){var i=e[t];if(!Os(i,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:t,paramPath:o||t}),i}}function br(e){var n=e;function t(o){var i=n.slice(0,o);return n=n.slice(o),i}function r(){return n}return{extractWeights:t,getRemainingWeights:r}}function mg(e,n){var t=Vs(e,n),r=ql(e,n);function o(a,s,u,c){c===void 0&&(c=!1);var l=c?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),f=r(s,s,u+"/conv1"),h=r(s,s,u+"/conv2");return{conv0:l,conv1:f,conv2:h}}function i(a,s,u,c){c===void 0&&(c=!1);var l=o(a,s,u,c),f=l.conv0,h=l.conv1,d=l.conv2,p=r(s,s,u+"/conv3");return{conv0:f,conv1:h,conv2:d,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function nI(e){var n=[],t=br(e),r=t.extractWeights,o=t.getRemainingWeights,i=mg(r,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}function gg(e){return function(n){var t=e(n+"/filters",4),r=e(n+"/bias",1);return{filters:t,bias:r}}}function yg(e,n){var t=zr(e,n),r=gg(t),o=jl(t);function i(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),f=o(s+"/conv2");return{conv0:c,conv1:l,conv2:f}}function a(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),f=o(s+"/conv2"),h=o(s+"/conv3");return{conv0:c,conv1:l,conv2:f,conv3:h}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function rI(e){var n=[],t=yg(e,n).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return yr(e,n),{params:r,paramMappings:n}}var bg=(function(e){Ae(n,e);function n(){return e.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return le(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=oa(o,i).div(ae(255)),s=wa(a,r.dense0,!0);return s=wa(s,r.dense1),s=wa(s,r.dense2),s=wa(s,r.dense3),s=na(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(t){return rI(t)},n.prototype.extractParams=function(t){return nI(t)},n})(gr);function zn(e,n){return le(function(){return Me(Ps(e,n.weights),n.bias)})}function oI(e,n,t){var r=[],o=br(e),i=o.extractWeights,a=o.getRemainingWeights,s=Gl(i,r),u=s(n,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function iI(e){var n=[],t=zr(e,n);function r(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return yr(e,n),{params:o,paramMappings:n}}function xg(e){var n={},t={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?t:n;o[r]=e[r]}),{featureExtractorMap:n,classifierMap:t}}var wg=(function(e){Ae(n,e);function n(t,r){var o=e.call(this,t)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return le(function(){var i=t instanceof us?r.faceFeatureExtractor.forwardInput(t):t;return zn(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(t){return oI(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(t){var r=xg(t),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),iI(i)},n.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=t.slice(0,t.length-i),s=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n})(gr),Od=["neutral","happy","sad","angry","fearful","disgusted","surprised"],aI=(function(){function e(n){var t=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);Od.forEach(function(r,o){t[r]=n[o]})}return e.prototype.asSortedArray=function(){var n=this;return Od.map(function(t){return{expression:t,probability:n[t]}}).sort(function(t,r){return r.probability-t.probability})},e})(),sI=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new bg),e.call(this,"FaceExpressionNet",t)||this}return n.prototype.forwardInput=function(t){var r=this;return le(function(){return vr(r.runNet(t))})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(t){return ye(this,void 0,void 0,function(){var r,o,i,a,s=this;return be(this,function(u){switch(u.label){case 0:return[4,bt(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(lt(o).map(function(c){return ye(s,void 0,void 0,function(){var l;return be(this,function(f){switch(f.label){case 0:return[4,c.data()];case 1:return l=f.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new aI(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n})(wg);function _g(e,n){var t={expressions:n};return Object.assign({},e,t)}function uI(e){return KS(e)&&e.landmarks instanceof ss&&e.unshiftedLandmarks instanceof ss&&e.alignedRect instanceof Qn}function Kl(e,n){var t=e.detection.box,r=n.shiftBy(t.x,t.y),o=r.align(),i=e.detection.imageDims,a=new Qn(e.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:n,alignedRect:a};return Object.assign({},e,s)}function cI(e,n){var t=Vs(e,n),r=ql(e,n);function o(a,s,u){var c=r(a,s,u+"/separable_conv0"),l=r(s,s,u+"/separable_conv1"),f=t(a,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:f}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),c=r(a,a,s+"/separable_conv1"),l=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function lI(e,n){var t=[],r=br(e),o=r.extractWeights,i=r.getRemainingWeights,a=cI(o,t),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,f=s(3,32,3,"entry_flow/conv_in"),h=c(32,64,"entry_flow/reduction_block_0"),d=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:f,reduction_block_0:h,reduction_block_1:d},v={};qi(n,0,1).forEach(function(w){v["main_block_"+w]=l(128,"middle_flow/main_block_"+w)});var m=c(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),b={reduction_block:m,separable_conv:g};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:v,exit_flow:b}}}function fI(e,n){var t=zr(e,n),r=gg(t),o=jl(t);function i(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function a(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function hI(e,n){var t=[],r=fI(e,t),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),c=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),f={conv_in:u,reduction_block_0:c,reduction_block_1:l},h={};qi(n,0,1).forEach(function(m){h["main_block_"+m]=s("middle_flow/main_block_"+m)});var d=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),v={reduction_block:d,separable_conv:p};return yr(e,t),{params:{entry_flow:f,middle_flow:h,exit_flow:v},paramMappings:t}}function Cg(e,n,t){return Me(yn(e,n.filters,t,"same"),n.bias)}function Vu(e,n,t){t===void 0&&(t=!0);var r=t?Ze(e):e;return r=on(r,n.separable_conv0,[1,1]),r=on(Ze(r),n.separable_conv1,[1,1]),r=mt(r,[3,3],[2,2],"same"),r=Me(r,Cg(e,n.expansion_conv,[2,2])),r}function dI(e,n){var t=on(Ze(e),n.separable_conv0,[1,1]);return t=on(Ze(t),n.separable_conv1,[1,1]),t=on(Ze(t),n.separable_conv2,[1,1]),t=Me(t,e),t}var pI=(function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return n.prototype.forwardInput=function(t){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return le(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=oa(i,a).div(ae(256)),u=Ze(Cg(s,o.entry_flow.conv_in,[2,2]));return u=Vu(u,o.entry_flow.reduction_block_0,!1),u=Vu(u,o.entry_flow.reduction_block_1),qi(r._numMainBlocks,0,1).forEach(function(c){u=dI(u,o.middle_flow["main_block_"+c])}),u=Vu(u,o.exit_flow.reduction_block),u=Ze(on(u,o.exit_flow.separable_conv,[1,1])),u})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(t){return hI(t,this._numMainBlocks)},n.prototype.extractParams=function(t){return lI(t,this._numMainBlocks)},n})(gr);function vI(e){var n=[],t=br(e),r=t.extractWeights,o=t.getRemainingWeights,i=Gl(r,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}function mI(e){var n=[],t=zr(e,n);function r(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return yr(e,n),{params:o,paramMappings:n}}var cs;(function(e){e.FEMALE="female",e.MALE="male"})(cs||(cs={}));var gI=(function(e){Ae(n,e);function n(t){t===void 0&&(t=new pI(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return le(function(){var i=t instanceof us?r.faceFeatureExtractor.forwardInput(t):t,a=na(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=zn(a,o.fc.age).as1D(),u=zn(a,o.fc.gender);return{age:s,gender:u}})},n.prototype.forwardInput=function(t){var r=this;return le(function(){var o=r.runNet(t),i=o.age,a=o.gender;return{age:i,gender:vr(a)}})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(t){return ye(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return be(this,function(l){switch(l.label){case 0:return[4,bt(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=lt(o.age),a=lt(o.gender),s=i.map(function(f,h){return{ageTensor:f,genderTensor:a[h]}}),[4,Promise.all(s.map(function(f){var h=f.ageTensor,d=f.genderTensor;return ye(c,void 0,void 0,function(){var p,v,m,g,b;return be(this,function(w){switch(w.label){case 0:return[4,h.data()];case 1:return p=w.sent()[0],[4,d.data()];case 2:return v=w.sent()[0],m=v>.5,g=m?cs.MALE:cs.FEMALE,b=m?v:1-v,h.dispose(),d.dispose(),[2,{age:p,gender:g,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(t){return vI(t)},n.prototype.extractParamsFromWeigthMap=function(t){var r=xg(t),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),mI(i)},n.prototype.extractParams=function(t){var r=1539,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n})(gr),Eg=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.postProcess=function(t,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return le(function(){var s=function(h,d){return an([qn([68],h),qn([68],d)],1).as2D(1,136).as1D()},u=function(h,d){var p=i[h],v=p.width,m=p.height;return d(v,m)?Math.abs(v-m)/2:0},c=function(h){return u(h,function(d,p){return d<p})},l=function(h){return u(h,function(d,p){return p<d})},f=t.mul(qn([a,136],r)).sub(an(Array.from(Array(a),function(h,d){return s(c(d),l(d))}))).div(an(Array.from(Array(a),function(h,d){return s(i[d].width,i[d].height)})));return f})},n.prototype.forwardInput=function(t){var r=this;return le(function(){var o=r.runNet(t);return r.postProcess(o,t.inputSize,t.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(t){return ye(this,void 0,void 0,function(){var r,o,i,a=this;return be(this,function(s){switch(s.label){case 0:return[4,bt(t)];case 1:return r=s.sent(),o=le(function(){return lt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return ye(a,void 0,void 0,function(){var l,f,h,d,p;return be(this,function(v){switch(v.label){case 0:return h=(f=Array).from,[4,u.data()];case 1:return l=h.apply(f,[v.sent()]),d=l.filter(function(m,g){return Ad(g)}),p=l.filter(function(m,g){return!Ad(g)}),[2,new jS(Array(68).fill(0).map(function(m,g){return new Ve(d[g],p[g])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n})(wg),Rg=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new bg),e.call(this,"FaceLandmark68Net",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n})(Eg);function yI(e){var n=[],t=yg(e,n).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return yr(e,n),{params:r,paramMappings:n}}function bI(e){var n=[],t=br(e),r=t.extractWeights,o=t.getRemainingWeights,i=mg(r,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}var xI=(function(e){Ae(n,e);function n(){return e.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return le(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=oa(o,i).div(ae(255)),s=Wu(a,r.dense0,!0);return s=Wu(s,r.dense1),s=Wu(s,r.dense2),s=na(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(t){return yI(t)},n.prototype.extractParams=function(t){return bI(t)},n})(gr),wI=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new xI),e.call(this,"FaceLandmark68TinyNet",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n})(Eg);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(Rg);function _I(e,n){return Me(Bt(e,n.weights),n.biases)}function $l(e,n,t,r,o){o===void 0&&(o="same");var i=n.conv,a=i.filters,s=i.bias,u=yn(e,a,t,o);return u=Me(u,s),u=_I(u,n.scale),r?Ze(u):u}function CI(e,n){return $l(e,n,[1,1],!0)}function Sg(e,n){return $l(e,n,[1,1],!1)}function Ig(e,n){return $l(e,n,[2,2],!0,"valid")}function EI(e,n){function t(s,u,c){var l=e(s),f=l.length/(u*c*c);if(OS(f))throw new Error("depth has to be an integer: "+f+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return le(function(){return Br(jt(l,[u,f,c,c]),[2,3,1,0])})}function r(s,u,c,l){var f=t(s,u,c),h=it(e(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:f,bias:h}}function o(s,u){var c=it(e(s)),l=it(e(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function i(s,u,c,l){var f=r(s,u,c,l+"/conv"),h=o(u,l+"/scale");return{conv:f,scale:h}}function a(s,u,c,l,f){f===void 0&&(f=!1);var h=i((f?.5:1)*s,u,c,l+"/conv1"),d=i(s,u,c,l+"/conv2");return{conv1:h,conv2:d}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function RI(e){var n=br(e),t=n.extractWeights,r=n.getRemainingWeights,o=[],i=EI(t,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),S=le(function(){return Br(Dr(t(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var I={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:h,conv64_1:d,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:b,conv256_down:w,conv256_1:y,conv256_2:x,conv256_down_out:_,fc:S};return{params:I,paramMappings:o}}function SI(e,n){var t=zr(e,n);function r(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),c=r(a);return{conv:{filters:s,bias:u},scale:c}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function II(e){var n=[],t=SI(e,n),r=t.extractConvLayerParams,o=t.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),f=o("conv64_2"),h=o("conv64_3"),d=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),b=o("conv256_2"),w=o("conv256_down_out"),y=e.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!MS(y))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:h,conv128_down:d,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:b,conv256_down_out:w,fc:y};return yr(e,n),{params:x,paramMappings:n}}function Fn(e,n){var t=CI(e,n.conv1);return t=Sg(t,n.conv2),t=Me(t,e),t=Ze(t),t}function _a(e,n){var t=Ig(e,n.conv1);t=Sg(t,n.conv2);var r=na(e,2,2,"valid"),o=$e(r.shape),i=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=Ai(t.shape);s[1]=1;var u=$e(s);t=ct([t,u],1);var c=Ai(t.shape);c[2]=1;var l=$e(c);t=ct([t,l],2)}return r=i?ct([r,o],3):r,t=Me(r,t),t=Ze(t),t}var kI=(function(e){Ae(n,e);function n(){return e.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return le(function(){var o=t.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=oa(o,i).div(ae(256)),s=Ig(a,r.conv32_down);s=mt(s,3,2,"valid"),s=Fn(s,r.conv32_1),s=Fn(s,r.conv32_2),s=Fn(s,r.conv32_3),s=_a(s,r.conv64_down),s=Fn(s,r.conv64_1),s=Fn(s,r.conv64_2),s=Fn(s,r.conv64_3),s=_a(s,r.conv128_down),s=Fn(s,r.conv128_1),s=Fn(s,r.conv128_2),s=_a(s,r.conv256_down),s=Fn(s,r.conv256_1),s=Fn(s,r.conv256_2),s=_a(s,r.conv256_down_out);var u=s.mean([1,2]),c=Ps(u,r.fc);return c})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(t){return ye(this,void 0,void 0,function(){var r,o,i,a=this;return be(this,function(s){switch(s.label){case 0:return[4,bt(t)];case 1:return r=s.sent(),o=le(function(){return lt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(t){return II(t)},n.prototype.extractParams=function(t){return RI(t)},n})(gr);function kg(e,n){var t={descriptor:n};return Object.assign({},e,t)}function Ag(e,n){var t={age:n};return Object.assign({},e,t)}function Tg(e,n,t){var r={gender:n,genderProbability:t};return Object.assign({},e,r)}var Dg=(function(){function e(n){var t=n===void 0?{}:n,r=t.minFaceSize,o=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e})();function AI(e,n){function t(u,c){var l=jt(e(9*u),[3,3,u,1]),f=it(e(u)),h=it(e(u)),d=it(e(u)),p=it(e(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:f,batch_norm_offset:h,batch_norm_mean:d,batch_norm_variance:p}}function r(u,c,l,f,h){var d=jt(e(u*c*l*l),[l,l,u,c]),p=it(e(c));return n.push({paramPath:f+"/filters"},{paramPath:f+"/"+(h?"batch_norm_offset":"bias")}),{filters:d,bias:p}}function o(u,c,l,f){var h=r(u,c,l,f,!0),d=h.filters,p=h.bias;return{filters:d,batch_norm_offset:p}}function i(u,c,l){var f=t(u,l+"/depthwise_conv"),h=o(u,c,1,l+"/pointwise_conv");return{depthwise_conv:f,pointwise_conv:h}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),c=i(32,64,"mobilenetv1/conv_1"),l=i(64,128,"mobilenetv1/conv_2"),f=i(128,128,"mobilenetv1/conv_3"),h=i(128,256,"mobilenetv1/conv_4"),d=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),v=i(512,512,"mobilenetv1/conv_7"),m=i(512,512,"mobilenetv1/conv_8"),g=i(512,512,"mobilenetv1/conv_9"),b=i(512,512,"mobilenetv1/conv_10"),w=i(512,512,"mobilenetv1/conv_11"),y=i(512,1024,"mobilenetv1/conv_12"),x=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:f,conv_4:h,conv_5:d,conv_6:p,conv_7:v,conv_8:m,conv_9:g,conv_10:b,conv_11:w,conv_12:y,conv_13:x}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),c=o(256,512,3,"prediction_layer/conv_1"),l=o(512,128,1,"prediction_layer/conv_2"),f=o(128,256,3,"prediction_layer/conv_3"),h=o(256,128,1,"prediction_layer/conv_4"),d=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),v=o(64,128,3,"prediction_layer/conv_7"),m=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),y=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),x=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),I=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),E=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),T={box_encoding_predictor:m,class_predictor:g},B={box_encoding_predictor:b,class_predictor:w},F={box_encoding_predictor:y,class_predictor:x},L={box_encoding_predictor:_,class_predictor:S},q={box_encoding_predictor:I,class_predictor:C},U={box_encoding_predictor:E,class_predictor:N};return{conv_0:u,conv_1:c,conv_2:l,conv_3:f,conv_4:h,conv_5:d,conv_6:p,conv_7:v,box_predictor_0:T,box_predictor_1:B,box_predictor_2:F,box_predictor_3:L,box_predictor_4:q,box_predictor_5:U}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function TI(e){var n=[],t=br(e),r=t.extractWeights,o=t.getRemainingWeights,i=AI(r,n),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l=ll(r(5118*4),[1,5118,4]),f={extra_dim:l};if(n.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:f},paramMappings:n}}function DI(e,n){var t=zr(e,n);function r(c,l,f){var h=t(c+"/Conv2d_"+l+"_pointwise/weights",4,f+"/filters"),d=t(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,f+"/batch_norm_offset");return{filters:h,batch_norm_offset:d}}function o(c){var l="mobilenetv1/conv_"+c,f="MobilenetV1/Conv2d_"+c+"_depthwise",h=l+"/depthwise_conv",d=l+"/pointwise_conv",p=t(f+"/depthwise_weights",4,h+"/filters"),v=t(f+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),m=t(f+"/BatchNorm/beta",1,h+"/batch_norm_offset"),g=t(f+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),b=t(f+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:b},pointwise_conv:r("MobilenetV1",c,d)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(c,l){var f=t(c+"/weights",4,l+"/filters"),h=t(c+"/biases",1,l+"/bias");return{filters:f,bias:h}}function s(c){var l=a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),f=a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:f}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function NI(e){var n=[],t=DI(e,n),r=t.extractMobilenetV1Params,o=t.extractPredictionLayerParams,i=e["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Bs(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return yr(e,n),{params:a,paramMappings:n}}function On(e,n,t){return le(function(){var r=yn(e,n.filters,t,"same");return r=Me(r,n.batch_norm_offset),wl(r,0,6)})}var PI=.0010000000474974513;function FI(e,n,t){return le(function(){var r=Ns(e,n.filters,t,"same");return r=Rm(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,PI),wl(r,0,6)})}function MI(e){return[2,4,6,12].some(function(n){return n===e})?[2,2]:[1,1]}function OI(e,n){return le(function(){var t=null,r=On(e,n.conv_0,[2,2]),o=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(o.forEach(function(i,a){var s=a+1,u=MI(s);r=FI(r,i.depthwise_conv,u),r=On(r,i.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function BI(e,n,t,r,o){var i=e.shape[0],a=Math.min(t,i),s=n.map(function(l,f){return{score:l,boxIndex:f}}).filter(function(l){return l.score>o}).sort(function(l,f){return f.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var f=l.score,h=c.length-1;h>=0;--h){var d=LI(e,l.boxIndex,c[h]);if(d!==0&&(l.score*=u(d),l.score<=o))break}f===l.score&&c.push(l.boxIndex)}}),c}function LI(e,n,t){var r=e.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),l=Math.max(r[t][0],r[t][2]),f=Math.max(r[t][1],r[t][3]),h=(a-o)*(s-i),d=(l-u)*(f-c);if(h<=0||d<=0)return 0;var p=Math.max(o,u),v=Math.max(i,c),m=Math.min(a,l),g=Math.min(s,f),b=Math.max(m-p,0)*Math.max(g-v,0);return b/(h+d-b)}function WI(e){var n=lt(Br(e,[1,0])),t=[ht(n[2],n[0]),ht(n[3],n[1])],r=[Me(n[0],wn(t[0],ae(2))),Me(n[1],wn(t[1],ae(2)))];return{sizes:t,centers:r}}function VI(e,n){var t=WI(e),r=t.sizes,o=t.centers,i=lt(Br(n,[1,0])),a=wn(Bt(Sc(wn(i[2],ae(5))),r[0]),ae(2)),s=Me(Bt(wn(i[0],ae(10)),r[0]),o[0]),u=wn(Bt(Sc(wn(i[3],ae(5))),r[1]),ae(2)),c=Me(Bt(wn(i[1],ae(10)),r[1]),o[1]);return Br(an([ht(s,a),ht(c,u),Me(s,a),Me(c,u)]),[1,0])}function zI(e,n,t){return le(function(){var r=e.shape[0],o=VI(_n(Ko(t.extra_dim,[r,1,1]),[-1,4]),_n(e,[-1,4]));o=_n(o,[r,o.shape[0]/r,4]);var i=wm(jn(n,[0,0,1],[-1,-1,-1])),a=jn(i,[0,0,0],[-1,-1,1]);a=_n(a,[r,a.shape[1]]);var s=lt(o),u=lt(a);return{boxes:s,scores:u}})}function ko(e,n){return le(function(){var t=e.shape[0],r=_n(Rn(e,n.box_encoding_predictor),[t,-1,1,4]),o=_n(Rn(e,n.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function UI(e,n,t){return le(function(){var r=On(e,t.conv_0,[1,1]),o=On(r,t.conv_1,[2,2]),i=On(o,t.conv_2,[1,1]),a=On(i,t.conv_3,[2,2]),s=On(a,t.conv_4,[1,1]),u=On(s,t.conv_5,[2,2]),c=On(u,t.conv_6,[1,1]),l=On(c,t.conv_7,[2,2]),f=ko(n,t.box_predictor_0),h=ko(e,t.box_predictor_1),d=ko(o,t.box_predictor_2),p=ko(a,t.box_predictor_3),v=ko(u,t.box_predictor_4),m=ko(l,t.box_predictor_5),g=ct([f.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),b=ct([f.classPrediction,h.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1);return{boxPredictions:g,classPredictions:b}})}var zs=(function(){function e(n){var t=n===void 0?{}:n,r=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e})(),Ng=(function(e){Ae(n,e);function n(){return e.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return le(function(){var o=t.toBatchTensor(512,!1).toFloat(),i=ht(Bt(o,ae(.007843137718737125)),ae(1)),a=OI(i,r.mobilenetv1),s=UI(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return zI(u,c,r.output_layer)})},n.prototype.forward=function(t){return ye(this,void 0,void 0,function(){var r;return be(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,bt(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ye(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,h,d,p,v,m,g,b,w,y,x,_,S,I;return be(this,function(C){switch(C.label){case 0:return o=new zs(r),i=o.maxResults,a=o.minConfidence,[4,bt(t)];case 1:for(s=C.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,f=c[0],h=l[0],d=1;d<c.length;d++)c[d].dispose(),l[d].dispose();return m=(v=Array).from,[4,h.data()];case 2:return p=m.apply(v,[C.sent()]),g=.5,b=BI(f,p,i,g,a),w=s.getReshapedInputDimensions(0),y=s.inputSize,x=y/w.width,_=y/w.height,S=f.arraySync(),I=b.map(function(E){var N=[Math.max(0,S[E][0]),Math.min(1,S[E][2])].map(function(U){return U*_}),T=N[0],B=N[1],F=[Math.max(0,S[E][1]),Math.min(1,S[E][3])].map(function(U){return U*x}),L=F[0],q=F[1];return new Qn(p[E],new Ll(L,T,q-L,B-T),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),f.dispose(),h.dispose(),[2,I]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(t){return NI(t)},n.prototype.extractParams=function(t){return TI(t)},n})(gr);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(Ng);var HI=.4,GI=[new Ve(.738768,.874946),new Ve(2.42204,2.65704),new Ve(4.30971,7.04493),new Ve(10.246,4.59428),new Ve(12.6868,11.8741)],qI=[new Ve(1.603231,2.094468),new Ve(6.041143,7.080126),new Ve(2.882459,3.518061),new Ve(4.266906,5.178857),new Ve(9.041765,10.66308)],jI=[117.001,114.697,97.404],KI="tiny_yolov2_model",$I="tiny_yolov2_separable_conv_model",Ca=function(e){return typeof e=="number"};function XI(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Ca(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(n){return n||{}}).every(function(n){return Ca(n.x)&&Ca(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Ca)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function Xl(e){return le(function(){var n=Bt(e,ae(.10000000149011612));return Me(Ze(ht(e,n)),n)})}function _r(e,n){return le(function(){var t=vo(e,[[0,0],[1,1],[1,1],[0,0]]);return t=yn(t,n.conv.filters,[1,1],"valid"),t=ht(t,n.bn.sub),t=Bt(t,n.bn.truediv),t=Me(t,n.conv.bias),Xl(t)})}function Cr(e,n){return le(function(){var t=vo(e,[[0,0],[1,1],[1,1],[0,0]]);return t=Rl(t,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),t=Me(t,n.bias),Xl(t)})}function YI(e,n){var t=Vs(e,n);function r(a,s){var u=it(e(a)),c=it(e(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function o(a,s,u){var c=t(a,s,3,u+"/conv"),l=r(s,u+"/bn");return{conv:c,bn:l}}var i=ql(e,n);return{extractConvParams:t,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function QI(e,n,t,r){var o=br(e),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=YI(i,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams,h;if(n.withSeparableConvs){var d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],b=r[5],w=r[6],y=r[7],x=r[8],_=n.isFirstLayerConv2d?c(d,p,3,"conv0"):f(d,p,"conv0"),S=f(p,v,"conv1"),I=f(v,m,"conv2"),C=f(m,g,"conv3"),E=f(g,b,"conv4"),N=f(b,w,"conv5"),T=y?f(w,y,"conv6"):void 0,B=x?f(y,x,"conv7"):void 0,F=c(x||y||w,5*t,1,"conv8");h={conv0:_,conv1:S,conv2:I,conv3:C,conv4:E,conv5:N,conv6:T,conv7:B,conv8:F}}else{var d=r[0],p=r[1],v=r[2],m=r[3],g=r[4],b=r[5],w=r[6],y=r[7],x=r[8],_=l(d,p,"conv0"),S=l(p,v,"conv1"),I=l(v,m,"conv2"),C=l(m,g,"conv3"),E=l(g,b,"conv4"),N=l(b,w,"conv5"),T=l(w,y,"conv6"),B=l(y,x,"conv7"),F=c(x,5*t,1,"conv8");h={conv0:_,conv1:S,conv2:I,conv3:C,conv4:E,conv5:N,conv6:T,conv7:B,conv8:F}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:h,paramMappings:s}}function JI(e,n){var t=zr(e,n);function r(s){var u=t(s+"/sub",1),c=t(s+"/truediv",1);return{sub:u,truediv:c}}function o(s){var u=t(s+"/filters",4),c=t(s+"/bias",1);return{filters:u,bias:c}}function i(s){var u=o(s+"/conv"),c=r(s+"/bn");return{conv:u,bn:c}}var a=jl(t);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function ZI(e,n){var t=[],r=JI(e,t),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return yr(e,t),{params:s,paramMappings:t}}var Bd;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Bd||(Bd={}));var Yl=(function(){function e(n){var t=n===void 0?{}:n,r=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e})(),Pg=(function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyYolov2")||this;return XI(t),r._config=t,r}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(t,r){var o=_r(t,r.conv0);return o=mt(o,[2,2],[2,2],"same"),o=_r(o,r.conv1),o=mt(o,[2,2],[2,2],"same"),o=_r(o,r.conv2),o=mt(o,[2,2],[2,2],"same"),o=_r(o,r.conv3),o=mt(o,[2,2],[2,2],"same"),o=_r(o,r.conv4),o=mt(o,[2,2],[2,2],"same"),o=_r(o,r.conv5),o=mt(o,[2,2],[1,1],"same"),o=_r(o,r.conv6),o=_r(o,r.conv7),Rn(o,r.conv8,"valid",!1)},n.prototype.runMobilenet=function(t,r){var o=this.config.isFirstLayerConv2d?Xl(Rn(t,r.conv0,"valid",!1)):Cr(t,r.conv0);return o=mt(o,[2,2],[2,2],"same"),o=Cr(o,r.conv1),o=mt(o,[2,2],[2,2],"same"),o=Cr(o,r.conv2),o=mt(o,[2,2],[2,2],"same"),o=Cr(o,r.conv3),o=mt(o,[2,2],[2,2],"same"),o=Cr(o,r.conv4),o=mt(o,[2,2],[2,2],"same"),o=Cr(o,r.conv5),o=mt(o,[2,2],[1,1],"same"),o=r.conv6?Cr(o,r.conv6):o,o=r.conv7?Cr(o,r.conv7):o,Rn(o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(t,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return le(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?oa(a,o.config.meanRgb):a,a=a.div(ae(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(t,r){return ye(this,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,bt(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(t,r){return r===void 0&&(r={}),ye(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,h,d,p,v,m,g,b=this;return be(this,function(w){switch(w.label){case 0:return o=new Yl(r),i=o.inputSize,a=o.scoreThreshold,[4,bt(t)];case 1:return s=w.sent(),[4,this.forwardInput(s,i)];case 2:return u=w.sent(),c=le(function(){return lt(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return f=w.sent(),u.dispose(),c.dispose(),h=f.map(function(y){return y.box}),d=f.map(function(y){return y.score}),p=f.map(function(y){return y.classScore}),v=f.map(function(y){return b.config.classes[y.label]}),m=ji(h.map(function(y){return y.rescale(i)}),d,this.config.iouThreshold,!0),g=m.map(function(y){return new ig(d[y],p[y],v[y],h[y],l)}),[2,g]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(t){return ZI(t,this.config)},n.prototype.extractParams=function(t){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return QI(t,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(t,r,o){return ye(this,void 0,void 0,function(){var i,a,s,u,c,l,f,h,d,p,v,m,g,b,w,y,x,_,S,I,C,E,N,T,B,F,L,q,U,W=this;return be(this,function(X){switch(X.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=t.shape[1],f=this.config.anchors.length,h=le(function(){var Q=t.reshape([l,l,f,W.boxEncodingSize]),oe=Q.slice([0,0,0,0],[l,l,f,4]),ue=Q.slice([0,0,0,4],[l,l,f,1]),me=W.withClassScores?vr(Q.slice([0,0,0,5],[l,l,f,W.config.classes.length]),3):ae(0);return[oe,ue,me]}),d=h[0],p=h[1],v=h[2],m=[],[4,p.array()];case 1:return g=X.sent(),[4,d.array()];case 2:b=X.sent(),w=0,X.label=3;case 3:if(!(w<l))return[3,12];y=0,X.label=4;case 4:if(!(y<l))return[3,11];x=0,X.label=5;case 5:return x<f?(_=Lu(g[w][y][x][0]),!o||_>o?(S=(y+Lu(b[w][y][x][0]))/l*u,I=(w+Lu(b[w][y][x][1]))/l*c,C=Math.exp(b[w][y][x][2])*this.config.anchors[x].x/l*u,E=Math.exp(b[w][y][x][3])*this.config.anchors[x].y/l*c,N=S-C/2,T=I-E/2,B={row:w,col:y,anchor:x},this.withClassScores?[4,this.extractPredictedClass(v,B)]:[3,7]):[3,9]):[3,10];case 6:return U=X.sent(),[3,8];case 7:U={classScore:1,label:0},X.label=8;case 8:F=U,L=F.classScore,q=F.label,m.push(Dt({box:new Ls(N,T,N+C,T+E),score:_,classScore:_*L,label:q},B)),X.label=9;case 9:return x++,[3,5];case 10:return y++,[3,4];case 11:return w++,[3,3];case 12:return d.dispose(),p.dispose(),v.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(t,r){return ye(this,void 0,void 0,function(){var o,i,a,s;return be(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n})(gr),ek=(function(e){Ae(n,e);function n(t){t===void 0&&(t=!0);var r=this,o=Object.assign({},{withSeparableConvs:t,iouThreshold:HI,classes:["face"]},t?{anchors:qI,meanRgb:jI}:{anchors:GI,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return ye(this,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?$I:KI},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n})(Pg),Fg=(function(e){Ae(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return n})(Yl),ia=(function(){function e(){}return e.prototype.then=function(n){return ye(this,void 0,void 0,function(){var t;return be(this,function(r){switch(r.label){case 0:return t=n,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return ye(this,void 0,void 0,function(){return be(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},e})();function Us(e,n,t,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),ye(this,void 0,void 0,function(){var i,a,s,u,c;return be(this,function(l){switch(l.label){case 0:return i=e.map(function(f){return uI(f)?o(f):f.detection}),s=r,s?[3,5]:n instanceof Je?[4,Hl(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Ul(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return a=s,[4,t(a)];case 6:return c=l.sent(),a.forEach(function(f){return f instanceof Je&&f.dispose()}),[2,c]}})})}function Ql(e,n,t,r,o){return ye(this,void 0,void 0,function(){var i=this;return be(this,function(a){return[2,Us([e],n,function(s){return ye(i,void 0,void 0,function(){return be(this,function(u){return[2,t(s[0])]})})},r,o)]})})}function tk(e){return le(function(){return an(lt(e,3).reverse(),3)})}var Ea=2,ls=12;function nk(e,n){var t=Vs(e,n),r=Gl(e,n);function o(c,l){var f=it(e(c));return n.push({paramPath:l}),f}function i(c,l,f){f===void 0&&(f=!1);var h=t(c[0],c[1],3,l+"/conv1"),d=o(c[1],l+"/prelu1_alpha"),p=t(c[1],c[2],3,l+"/conv2"),v=o(c[2],l+"/prelu2_alpha"),m=t(c[2],c[3],f?2:3,l+"/conv3"),g=o(c[3],l+"/prelu3_alpha");return{conv1:h,prelu1_alpha:d,conv2:p,prelu2_alpha:v,conv3:m,prelu3_alpha:g}}function a(){var c=i([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),f=t(32,4,1,"pnet/conv4_2");return Dt(Dt({},c),{conv4_1:l,conv4_2:f})}function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),f=o(128,"rnet/prelu4_alpha"),h=r(128,2,"rnet/fc2_1"),d=r(128,4,"rnet/fc2_2");return Dt(Dt({},c),{fc1:l,prelu4_alpha:f,fc2_1:h,fc2_2:d})}function u(){var c=i([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),f=o(128,"onet/prelu4_alpha"),h=r(1152,256,"onet/fc1"),d=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return Dt(Dt({},c),{conv4:l,prelu4_alpha:f,fc1:h,prelu5_alpha:d,fc2_1:p,fc2_2:v,fc2_3:m})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function rk(e){var n=br(e),t=n.extractWeights,r=n.getRemainingWeights,o=[],i=nk(t,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),f=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:o}}function ok(e,n){var t=zr(e,n);function r(l){var f=t(l+"/weights",4,l+"/filters"),h=t(l+"/bias",1);return{filters:f,bias:h}}function o(l){var f=t(l+"/weights",2),h=t(l+"/bias",1);return{weights:f,bias:h}}function i(l){return t(l,1)}function a(l){var f=r(l+"/conv1"),h=i(l+"/prelu1_alpha"),d=r(l+"/conv2"),p=i(l+"/prelu2_alpha"),v=r(l+"/conv3"),m=i(l+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:d,prelu2_alpha:p,conv3:v,prelu3_alpha:m}}function s(){var l=a("pnet"),f=r("pnet/conv4_1"),h=r("pnet/conv4_2");return Dt(Dt({},l),{conv4_1:f,conv4_2:h})}function u(){var l=a("rnet"),f=o("rnet/fc1"),h=i("rnet/prelu4_alpha"),d=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Dt(Dt({},l),{fc1:f,prelu4_alpha:h,fc2_1:d,fc2_2:p})}function c(){var l=a("onet"),f=r("onet/conv4"),h=i("onet/prelu4_alpha"),d=o("onet/fc1"),p=i("onet/prelu5_alpha"),v=o("onet/fc2_1"),m=o("onet/fc2_2"),g=o("onet/fc2_3");return Dt(Dt({},l),{conv4:f,prelu4_alpha:h,fc1:d,prelu5_alpha:p,fc2_1:v,fc2_2:m,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function ik(e){var n=[],t=ok(e,n),r=t.extractPNetParams,o=t.extractRNetParams,i=t.extractONetParams,a=r(),s=o(),u=i();return yr(e,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}function Fc(e,n){var t=n[0],r=n[1];return{height:Math.floor(t*e),width:Math.floor(r*e)}}function ak(e,n,t){for(var r=t[0],o=t[1],i=ls/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s=s*n,u+=1;return a}var Jl=(function(e){Ae(n,e);function n(t,r,o,i){return e.call(this,{left:t,top:r,right:o,bottom:i},!0)||this}return n})(Lr);function Mg(e){return le(function(){return Bt(ht(e,ae(127.5)),ae(.0078125))})}function Zo(e,n){return le(function(){return Me(Ze(e),Bt(n,rs(Ze(rs(e)))))})}function Zl(e,n,t){return t===void 0&&(t=!1),le(function(){var r=Rn(e,n.conv1,"valid");return r=Zo(r,n.prelu1_alpha),r=mt(r,t?[2,2]:[3,3],[2,2],"same"),r=Rn(r,n.conv2,"valid"),r=Zo(r,n.prelu2_alpha),r=t?r:mt(r,[3,3],[2,2],"valid"),r=Rn(r,n.conv3,"valid"),r=Zo(r,n.prelu3_alpha),r})}function sk(e,n){return le(function(){var t=Zl(e,n,!0),r=Rn(t,n.conv4_1,"valid"),o=fn(Fs(r,3),3),i=vr(ht(r,o),3),a=Rn(t,n.conv4_2,"valid");return{prob:i,regions:a}})}function uk(e,n){return le(function(){var t=Fc(n,e.shape.slice(1)),r=t.height,o=t.width,i=Tl.resizeBilinear(e,[r,o]),a=Mg(i);return Br(a,[0,2,1,3])})}function ck(e,n,t,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new Ve(s,a));var u=o.map(function(c){var l=new Ls(Math.round((c.y*Ea+1)/t),Math.round((c.x*Ea+1)/t),Math.round((c.y*Ea+ls)/t),Math.round((c.x*Ea+ls)/t)),f=i[c.y][c.x],h=n.arraySync(),d=new Jl(h[c.y][c.x][0],h[c.y][c.x][1],h[c.y][c.x][2],h[c.y][c.x][3]);return{cell:l,score:f,region:d}});return u}function lk(e,n,t,r,o){o.stage1=[];var i=n.map(function(h){return le(function(){var d={scale:h},p=uk(e,h),v=Date.now(),m=sk(p,r),g=m.prob,b=m.regions;d.pnet=Date.now()-v;var w=lt(lt(g,3)[1])[0],y=lt(b)[0];return{scoresTensor:w,regionsTensor:y,scale:h,statsForScale:d}})}),a=i.map(function(h){var d=h.scoresTensor,p=h.regionsTensor,v=h.scale,m=h.statsForScale,g=ck(d,p,v,t);if(d.dispose(),p.dispose(),!g.length)return o.stage1.push(m),[];var b=Date.now(),w=ji(g.map(function(y){return y.cell}),g.map(function(y){return y.score}),.5);return m.nms=Date.now()-b,m.numBoxes=w.length,o.stage1.push(m),w.map(function(y){return g[y]})}),s=a.reduce(function(h,d){return h.concat(d)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),f=ji(s.map(function(h){return h.cell}),s.map(function(h){return h.score}),.7);o.stage1_nms=Date.now()-l,c=f.map(function(h){return s[h].score}),u=f.map(function(h){return s[h]}).map(function(h){var d=h.cell,p=h.region;return new Ls(d.left+p.left*d.width,d.top+p.top*d.height,d.right+p.right*d.width,d.bottom+p.bottom*d.height).toSquare().round()})}return{boxes:u,scores:c}}function Og(e,n,t){var r=t.width,o=t.height;return ye(this,void 0,void 0,function(){var i,a,s,u=this;return be(this,function(c){switch(c.label){case 0:return i=fo(e),[4,Promise.all(n.map(function(l){return ye(u,void 0,void 0,function(){var f,h,d,p,v,m,g,b;return be(this,function(w){return f=l.padAtBorders(e.height,e.width),h=f.y,d=f.ey,p=f.x,v=f.ex,m=p-1,g=h-1,b=i.getImageData(m,g,v-m,d-g),[2,Vt.isNodejs()?zl(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=Ws({width:r,height:o}),h=fo(f);h.drawImage(l,0,0,r,o);for(var d=h.getImageData(0,0,r,o).data,p=[],v=0;v<d.length;v+=4)p.push(d[v+2]),p.push(d[v+1]),p.push(d[v]);s.push(p)}),[2,s.map(function(l){var f=le(function(){var h=Br(jt(l,[1,r,o,3]),[0,2,1,3]).toFloat();return Mg(h)});return f})]}})})}function fk(e,n){return le(function(){var t=Zl(e,n),r=_n(t,[t.shape[0],n.fc1.weights.shape[0]]),o=zn(r,n.fc1),i=Zo(o,n.prelu4_alpha),a=zn(i,n.fc2_1),s=fn(Fs(a,1),1),u=vr(ht(a,s),1),c=zn(i,n.fc2_2),l=lt(u,1)[1];return{scores:l,regions:c}})}function hk(e,n,t,r,o){return ye(this,void 0,void 0,function(){var i,a,s,u,c,l,f,h,d,p,v,m,g,b;return be(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,Og(e,n,{width:24,height:24})];case 1:return a=w.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(y){var x=fk(y,r);return y.dispose(),x}),o.stage2_rnet=Date.now()-i,u=s.length>1?ct(s.map(function(y){return y.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[w.sent()]),u.dispose(),h=c.map(function(y,x){return{score:y,idx:x}}).filter(function(y){return y.score>t}).map(function(y){var x=y.idx;return x}),d=h.map(function(y){return n[y]}),p=h.map(function(y){return c[y]}),v=[],m=[],d.length>0&&(i=Date.now(),g=ji(d,p,.7),o.stage2_nms=Date.now()-i,b=g.map(function(y){var x=s[h[y]].regions.arraySync();return new Jl(x[0][0],x[0][1],x[0][2],x[0][3])}),m=g.map(function(y){return p[y]}),v=g.map(function(y,x){return d[y].calibrate(b[x])})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function dk(e,n){return le(function(){var t=Zl(e,n);t=mt(t,[2,2],[2,2],"same"),t=Rn(t,n.conv4,"valid"),t=Zo(t,n.prelu4_alpha);var r=_n(t,[t.shape[0],n.fc1.weights.shape[0]]),o=zn(r,n.fc1),i=Zo(o,n.prelu5_alpha),a=zn(i,n.fc2_1),s=fn(Fs(a,1),1),u=vr(ht(a,s),1),c=zn(i,n.fc2_2),l=zn(i,n.fc2_3),f=lt(u,1)[1];return{scores:f,regions:c,points:l}})}function pk(e,n,t,r,o){return ye(this,void 0,void 0,function(){var i,a,s,u,c,l,f,h,d,p,v,m,g,b,w;return be(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,Og(e,n,{width:48,height:48})];case 1:return a=y.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(x){var _=dk(x,r);return x.dispose(),_}),o.stage3_onet=Date.now()-i,u=s.length>1?ct(s.map(function(x){return x.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[y.sent()]),u.dispose(),h=c.map(function(x,_){return{score:x,idx:_}}).filter(function(x){return x.score>t}).map(function(x){var _=x.idx;return _}),d=h.map(function(x){var _=s[x].regions.arraySync();return new Jl(_[0][0],_[0][1],_[0][2],_[0][3])}),p=h.map(function(x,_){return n[x].calibrate(d[_])}),v=h.map(function(x){return c[x]}),m=[],g=[],b=[],p.length>0&&(i=Date.now(),w=ji(p,v,.7,!1),o.stage3_nms=Date.now()-i,m=w.map(function(x){return p[x]}),g=w.map(function(x){return v[x]}),b=w.map(function(x,_){return Array(5).fill(0).map(function(S,I){var C=s[x].points.arraySync();return new Ve(C[0][I]*(m[_].width+1)+m[_].left,C[0][I+5]*(m[_].height+1)+m[_].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:m,scores:g,points:b}]}})})}var vk=(function(e){Ae(n,e);function n(){return e.call(this,"Mtcnn")||this}return n.prototype.load=function(t){return ye(this,void 0,void 0,function(){return be(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},n.prototype.loadFromDisk=function(t){return ye(this,void 0,void 0,function(){return be(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},n.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ye(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,h,d,p,v,m,g,b,w,y,x,_,S,I;return be(this,function(C){switch(C.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=t.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=le(function(){return tk(fn(Ol.fromPixels(i)).toFloat())}),c=function(E){return u.dispose(),a.total=Date.now()-s,E},l=u.shape.slice(1),f=l[0],h=l[1],d=new Dg(r),p=d.minFaceSize,v=d.scaleFactor,m=d.maxNumScales,g=d.scoreThresholds,b=d.scaleSteps,w=(b||ak(p,v,[f,h])).filter(function(E){var N=Fc(E,[f,h]);return Math.min(N.width,N.height)>ls}).slice(0,m),a.scales=w,a.pyramid=w.map(function(E){return Fc(E,[f,h])}),y=Date.now(),[4,lk(u,w,g[0],o.pnet,a)];case 1:return x=C.sent(),a.total_stage1=Date.now()-y,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,y=Date.now(),[4,hk(i,x.boxes,g[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=C.sent(),a.total_stage2=Date.now()-y,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,y=Date.now(),[4,pk(i,_.boxes,g[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return S=C.sent(),a.total_stage3=Date.now()-y,I=S.boxes.map(function(E,N){return Kl(Wl({},new Qn(S.scores[N],new Ll(E.left/h,E.top/f,E.width/h,E.height/f),{height:f,width:h})),new qS(S.points[N].map(function(T){return T.sub(new Ve(E.left,E.top)).div(new Ve(E.width,E.height))}),{width:E.width,height:E.height}))}),[2,c({results:I,stats:a})]}})})},n.prototype.forward=function(t,r){return r===void 0&&(r={}),ye(this,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,bt(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ye(this,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,bt(t)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(t){return ik(t)},n.prototype.extractParams=function(t){return rk(t)},n})(gr),mk=.4,gk=[new Ve(1.603231,2.094468),new Ve(6.041143,7.080126),new Ve(2.882459,3.518061),new Ve(4.266906,5.178857),new Ve(9.041765,10.66308)],yk=[117.001,114.697,97.404],bk=(function(e){Ae(n,e);function n(){var t=this,r={withSeparableConvs:!0,iouThreshold:mk,classes:["face"],anchors:gk,meanRgb:yk,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=e.call(this,r)||this,t}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return ye(this,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Qn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n})(Pg),Lt={ssdMobilenetv1:new Ng,tinyFaceDetector:new bk,tinyYolov2:new ek,mtcnn:new vk,faceLandmark68Net:new Rg,faceLandmark68TinyNet:new wI,faceRecognitionNet:new kI,faceExpressionNet:new sI,ageGenderNet:new gI},Bg=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return n})(ia),ef=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o=this;return be(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Us(t,this.input,function(a){return ye(o,void 0,void 0,function(){return be(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Lt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){return _g(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new of(this,this.input)},n})(Bg),tf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r;return be(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,Ql(t,this.input,function(i){return Lt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,_g(t,r)]}})})},n.prototype.withAgeAndGender=function(){return new af(this,this.input)},n})(Bg),nf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new sf(this,this.input)},n.prototype.withFaceDescriptors=function(){return new cf(this,this.input)},n})(ef),rf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new uf(this,this.input)},n.prototype.withFaceDescriptor=function(){return new lf(this,this.input)},n})(tf),Lg=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return n})(ia),of=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o=this;return be(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,Us(t,this.input,function(a){return ye(o,void 0,void 0,function(){return be(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Lt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){var u=r[s],c=u.age,l=u.gender,f=u.genderProbability;return Ag(Tg(a,l,f),c)})]}})})},n.prototype.withFaceExpressions=function(){return new ef(this,this.input)},n})(Lg),af=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o,i,a;return be(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,Ql(t,this.input,function(u){return Lt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,Ag(Tg(t,i,a),o)]}})})},n.prototype.withFaceExpressions=function(){return new tf(this,this.input)},n})(Lg),sf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new nf(this,this.input)},n.prototype.withFaceDescriptors=function(){return new cf(this,this.input)},n})(of),uf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new rf(this,this.input)},n.prototype.withFaceDescriptor=function(){return new lf(this,this.input)},n})(af),Wg=(function(e){Ae(n,e);function n(t,r){var o=e.call(this)||this;return o.parentTask=t,o.input=r,o}return n})(ia),cf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r;return be(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,Us(t,this.input,function(i){return Promise.all(i.map(function(a){return Lt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return kg(t[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new nf(this,this.input)},n.prototype.withAgeAndGender=function(){return new sf(this,this.input)},n})(Wg),lf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r;return be(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,Ql(t,this.input,function(i){return Lt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,kg(t,r)]}})})},n.prototype.withFaceExpressions=function(){return new rf(this,this.input)},n.prototype.withAgeAndGender=function(){return new uf(this,this.input)},n})(Wg),Vg=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Lt.faceLandmark68TinyNet:Lt.faceLandmark68Net},enumerable:!0,configurable:!0}),n})(ia),xk=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o,i,a,s=this;return be(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(c){return c.detection}),this.input instanceof Je?[4,Hl(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,Ul(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof Je&&c.dispose()}),[2,t.map(function(c,l){return Kl(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new nf(this,this.input)},n.prototype.withAgeAndGender=function(){return new sf(this,this.input)},n.prototype.withFaceDescriptors=function(){return new cf(this,this.input)},n})(Vg),wk=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o,i,a;return be(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof Je?[4,Hl(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,Ul(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof Je&&u.dispose()}),[2,Kl(t,a)]}})})},n.prototype.withFaceExpressions=function(){return new rf(this,this.input)},n.prototype.withAgeAndGender=function(){return new uf(this,this.input)},n.prototype.withFaceDescriptor=function(){return new lf(this,this.input)},n})(Vg),zg=(function(e){Ae(n,e);function n(t,r){r===void 0&&(r=new zs);var o=e.call(this)||this;return o.input=t,o.options=r,o}return n})(ia),_k=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r,o,i;return be(this,function(a){switch(a.label){case 0:return t=this,r=t.input,o=t.options,o instanceof Dg?[4,Lt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof Fg?function(s){return Lt.tinyFaceDetector.locateFaces(s,o)}:o instanceof zs?function(s){return Lt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof Yl?function(s){return Lt.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ye(t,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return Wl({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new xk(this.runAndExtendWithFaceDetections(),this.input,t)},n.prototype.withFaceExpressions=function(){return new ef(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new of(this.runAndExtendWithFaceDetections(),this.input)},n})(zg),Ck=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ye(this,void 0,void 0,function(){var t,r;return be(this,function(o){switch(o.label){case 0:return[4,new _k(this.input,this.options)];case 1:return t=o.sent(),r=t[0],t.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ye(t,void 0,void 0,function(){var o;return be(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?Wl({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new wk(this.runAndExtendWithFaceDetection(),this.input,t)},n.prototype.withFaceExpressions=function(){return new tf(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new af(this.runAndExtendWithFaceDetection(),this.input)},n})(zg);function Ek(e,n){return n===void 0&&(n=new zs),new Ck(e,n)}function Rk(e,n){if(e.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(e),r=Array.from(n);return Math.sqrt(t.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}var Sk=(function(){function e(n,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof yi)return a;if(a instanceof Float32Array)return new yi(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new yi(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(n,t){return t.map(function(r){return Rk(r,n)}).reduce(function(r,o){return r+o},0)/(t.length||1)},e.prototype.matchDescriptor=function(n){var t=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new Nd(i,t.computeMeanDistance(n,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(n){var t=this.matchDescriptor(n);return t.distance<this.distanceThreshold?t:new Nd("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},e.fromJSON=function(n){var t=n.labeledDescriptors.map(function(r){return yi.fromJSON(r)});return new e(t,n.distanceThreshold)},e})();function Ug(){let e=null;return{setVideoElement:a=>{e=a},loadModels:async()=>{const a="/models";await Lt.tinyFaceDetector.loadFromUri(a),await Lt.ssdMobilenetv1.loadFromUri(a),await Lt.faceLandmark68Net.loadFromUri(a),await Lt.faceRecognitionNet.loadFromUri(a),console.log("Modelos cargados correctamente")},startCamera:async()=>{if(!e){console.error(" No se encontr el elemento <video>");return}const a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});e.srcObject=a,await e.play()},getFaceDescriptor:async()=>{if(!e)return null;const a=await Ek(e,new Fg).withFaceLandmarks().withFaceDescriptor();return a?a.descriptor:null},createFaceMatcher:a=>{const s=a.map(u=>new yi(u.nombre,[new Float32Array(u.descriptor)]));return new Sk(s)}}}const Ik={class:"fondo column justify-center items-center"},kk={class:"contenido row justify-center items-center"},Ak={class:"column justify-center items-center q-gutter-lg"},Tk={class:"container"},Dk={key:0},Nk={key:1},Pk={key:0},Fk={key:1},Mk={key:0,class:"loading-text"},Ok={class:"column justify-center items-center q-gutter-md"},Bk={key:0},Lk={class:"asistencia-table"},Wk={key:1,class:"no-asistencia"},Vk={key:0,class:"modal"},zk={__name:"Registro",setup(e){function n(){const y=new Date,x=y.getFullYear(),_=String(y.getMonth()+1).padStart(2,"0"),S=String(y.getDate()).padStart(2,"0");return`${x}-${_}-${S}`}const t=Xe(null),r=Xe(""),o=Xe(""),i=Xe(!1),a=Xe(""),s=Xe(!1),u=$t(JSON.parse(localStorage.getItem("estudiantes")||"[]")),c=$t(JSON.parse(localStorage.getItem("asistencia")||"[]")),l=pe(()=>{const y=n();return c.filter(x=>x.fecha===y)}),{setVideoElement:f,loadModels:h,startCamera:d,getFaceDescriptor:p,createFaceMatcher:v}=Ug(),m=async()=>{if(!r.value||!o.value)return alert("Ingresa nombre y documento primero");i.value=!0,a.value="registro";try{if(u.find(_=>_.documento===o.value))return alert("Este documento ya est registrado");const x=await p();if(!x)return alert("No se detect el rostro");u.push({nombre:r.value,documento:o.value,descriptor:Array.from(x)}),localStorage.setItem("estudiantes",JSON.stringify(u)),alert(`Estudiante ${r.value} registrado correctamente`),r.value="",o.value=""}catch(y){console.error(y),alert("Error al registrar")}finally{i.value=!1,a.value=""}},g=async()=>{s.value=!0,await so(),setTimeout(()=>{w()},800)},b=()=>{s.value=!1},w=async()=>{if(u.length===0){alert("No hay estudiantes registrados"),b();return}i.value=!0,a.value="asistencia";try{const y=await p();if(!y){alert("No se detect rostro"),b();return}const _=v(u).findBestMatch(y);if(_.label==="unknown"){alert("Rostro no reconocido"),b();return}const S=u.find(E=>E.nombre===_.label),I=n();c.find(E=>E.documento===S.documento&&E.fecha===I)?alert(`${S.nombre} ya registr asistencia hoy`):(c.push({nombre:S.nombre,documento:S.documento,fecha:I}),localStorage.setItem("asistencia",JSON.stringify(c)),alert(`Asistencia registrada para ${S.nombre}`))}catch(y){console.error(y),alert("Error marcando asistencia")}finally{i.value=!1,a.value="",b()}};return Mr(async()=>{await so(),f(t.value),await h(),await d()}),(y,x)=>(Ye(),ut("div",Ik,[x[11]||(x[11]=fe("div",{class:"blur-overlay"},null,-1)),fe("div",kk,[fe("div",null,[fe("div",Ak,[x[4]||(x[4]=fe("div",null,[fe("h3",null,"Centro de Asistencia Estudiantil")],-1)),fe("div",Tk,[fe("video",{ref_key:"video",ref:t,width:"320",height:"240",autoplay:"",muted:""},null,512)]),fe("div",null,[Pa(fe("input",{"onUpdate:modelValue":x[0]||(x[0]=_=>r.value=_),placeholder:"Nombre del estudiante"},null,512),[[ec,r.value]])]),fe("div",null,[Pa(fe("input",{"onUpdate:modelValue":x[1]||(x[1]=_=>o.value=_),placeholder:"Documento del estudiante"},null,512),[[ec,o.value]])]),fe("div",null,[Qe(za,{onClick:m,disabled:i.value},{default:bn(()=>[i.value&&a.value==="registro"?(Ye(),ut("span",Dk,[...x[2]||(x[2]=[fe("i",{class:"spinner"},null,-1),Go(" Registrando... ",-1)])])):(Ye(),ut("span",Nk,"Registro"))]),_:1},8,["disabled"])]),fe("div",null,[Qe(za,{onClick:g,disabled:i.value},{default:bn(()=>[i.value&&a.value==="asistencia"?(Ye(),ut("span",Pk,[...x[3]||(x[3]=[fe("i",{class:"spinner"},null,-1),Go(" Marcando... ",-1)])])):(Ye(),ut("span",Fk,"Marcar Asistencia"))]),_:1},8,["disabled"])])]),i.value&&a.value===""?(Ye(),ut("div",Mk,"  Procesando, por favor espera... ")):Ri("",!0)]),fe("div",Ok,[x[8]||(x[8]=fe("div",null,[fe("h3",null,"Asistencia del da")],-1)),l.value.length?(Ye(),ut("div",Bk,[fe("table",Lk,[x[6]||(x[6]=fe("thead",null,[fe("tr",null,[fe("th",null,"#"),fe("th",null,"Nombre"),fe("th",null,"Documento"),fe("th",null,"Fecha"),fe("th",null,"Estado")])],-1)),fe("tbody",null,[(Ye(!0),ut(Tt,null,Ku(l.value,(_,S)=>(Ye(),ut("tr",{key:_.documento},[fe("td",null,xn(S+1),1),fe("td",null,xn(_.nombre),1),fe("td",null,xn(_.documento),1),fe("td",null,xn(_.fecha),1),x[5]||(x[5]=fe("td",null," Presente",-1))]))),128))])])])):(Ye(),ut("div",Wk,[...x[7]||(x[7]=[fe("p",null," No hay registros de asistencia hoy.",-1)])]))]),s.value?(Ye(),ut("div",Vk,[fe("div",{class:"modal-content"},[x[9]||(x[9]=fe("h3",null,"Marcando asistencia...",-1)),x[10]||(x[10]=fe("p",null,"Acerca tu rostro a la cmara",-1)),fe("button",{onClick:b,class:"btn-cancel"},"Cancelar")])])):Ri("",!0)])]))}},Ld=Symbol.for("constructDateFrom");function Hg(e,n){return typeof e=="function"?e(n):e&&typeof e=="object"&&Ld in e?e[Ld](n):e instanceof Date?new e.constructor(n):new Date(n)}function Uk(e,n){return Hg(e,e)}function Hk(e,n){const t=Uk(e),r=t.getFullYear(),o=t.getMonth(),i=Hg(t,0);return i.setFullYear(r,o+1,0),i.setHours(0,0,0,0),i.getDate()}const Gk={class:"fondo row justify-center items-center"},qk={class:"consulta-container contenido column justify-center items-center q-gutter-xl"},jk={key:0,class:"calendario-container"},Kk={class:"calendario"},$k={class:"dias-semana"},Xk={class:"dias-mes"},Yk={key:1,class:"mensaje"},Qk={key:2,class:"modal"},Jk={class:"modal-content"},Zk={__name:"Consulta",setup(e){const n=Xe(""),t=Xe(null),r=Xe([]),o=Xe(""),i=Xe(!1),a=Xe(null),s=new Date,u=s.getFullYear(),c=s.getMonth(),l=s.toLocaleString("es-ES",{month:"long"}),f=["Lun","Mar","Mi","Jue","Vie","Sb","Dom"],h=Array.from({length:Hk(s)},(I,C)=>C+1),d=$t(JSON.parse(localStorage.getItem("estudiantes")||"[]")),p=$t(JSON.parse(localStorage.getItem("asistencia")||"[]")),{setVideoElement:v,loadModels:m,startCamera:g,getFaceDescriptor:b,createFaceMatcher:w}=Ug(),y=()=>{o.value="",t.value=null,r.value=[];const I=d.find(E=>E.documento===n.value);if(!I){o.value="No se encontr ningn estudiante con ese documento.";return}t.value=I;const C=p.filter(E=>{const N=new Date(E.fecha+"T00:00");return E.documento===I.documento&&N.getMonth()===c&&N.getFullYear()===u});r.value=C.map(E=>new Date(E.fecha+"T00:00").getDate())},x=async()=>{i.value=!0,o.value="",await so(),v(a.value),await m(),await g(),setTimeout(()=>{S()},1e3)},_=()=>{i.value=!1},S=async()=>{try{const I=await b();if(!I){o.value="No se detect rostro.";return}const E=w(d).findBestMatch(I);if(E.label==="unknown"){o.value="Rostro no reconocido.";return}const N=d.find(B=>B.nombre===E.label);t.value=N;const T=p.filter(B=>{const F=new Date(B.fecha+"T00:00");return B.documento===N.documento&&F.getMonth()===c&&F.getFullYear()===u});r.value=T.map(B=>new Date(B.fecha+"T00:00").getDate())}catch{o.value="Ocurri un error al reconocer el rostro."}};return(I,C)=>(Ye(),ut("div",Gk,[C[3]||(C[3]=fe("div",{class:"blur-overlay"},null,-1)),fe("div",qk,[C[2]||(C[2]=fe("div",{class:"titulo"},[fe("h1",null,"Consulta de Asistencia")],-1)),fe("div",null,[Pa(fe("input",{"onUpdate:modelValue":C[0]||(C[0]=E=>n.value=E),placeholder:"Ingresa el documento del estudiante"},null,512),[[ec,n.value]])]),fe("div",{class:"botones row justify-center items-center q-gutter-xl"},[fe("div",null,[fe("button",{onClick:y},"Buscar")]),fe("div",null,[fe("button",{onClick:x},"Reconocimiento Facial")])]),t.value?(Ye(),ut("div",jk,[fe("h3",null,"Asistencia de "+xn(t.value.nombre),1),fe("p",null,xn(En(l))+" "+xn(En(u)),1),fe("div",Kk,[fe("div",$k,[(Ye(),ut(Tt,null,Ku(f,E=>fe("span",{key:E},xn(E),1)),64))]),fe("div",Xk,[(Ye(!0),ut(Tt,null,Ku(En(h),(E,N)=>(Ye(),ut("span",{key:N,class:ms({asistio:r.value.includes(E)})},xn(E),3))),128))])])])):Ri("",!0),o.value?(Ye(),ut("div",Yk,[fe("p",null,xn(o.value),1)])):Ri("",!0),i.value?(Ye(),ut("div",Qk,[fe("div",Jk,[C[1]||(C[1]=fe("h3",null,"Acerca tu rostro a la cmara",-1)),fe("video",{ref_key:"video",ref:a,autoplay:"",muted:"",width:"320",height:"240"},null,512),fe("div",{style:{"margin-top":"10px"}},[fe("button",{onClick:_,class:"btn-cancel"},"Cancelar")])])])):Ri("",!0)])]))}},eA=tl(Zk,[["__scopeId","data-v-2a30a9cc"]]),tA=[{path:"/",component:nw},{path:"/registro",component:zk},{path:"/consulta",component:eA}],nA=Q1({history:A1(),routes:tA}),rA={isoName:"es",nativeName:"Espaol",label:{clear:"Borrar",ok:"OK",cancel:"Cancelar",close:"Cerrar",set:"Establecer",select:"Seleccionar",reset:"Restablecer",remove:"Eliminar",update:"Actualizar",create:"Crear",search:"Buscar",filter:"Filtrar",refresh:"Actualizar",expand:e=>e?`Expandir "${e}"`:"Expandir",collapse:e=>e?`Ocultar "${e}"`:"Colapsar"},date:{days:"Domingo_Lunes_Martes_Mircoles_Jueves_Viernes_Sbado".split("_"),daysShort:"Dom_Lun_Mar_Mi_Jue_Vie_Sb".split("_"),months:"Enero_Febrero_Marzo_Abril_Mayo_Junio_Julio_Agosto_Septiembre_Octubre_Noviembre_Diciembre".split("_"),monthsShort:"Ene_Feb_Mar_Abr_May_Jun_Jul_Ago_Sep_Oct_Nov_Dic".split("_"),firstDayOfWeek:1,format24h:!0,pluralDay:"das",prevMonth:"Mes anterior",nextMonth:"Mes siguiente",prevYear:"Ao anterior",nextYear:"Ao siguiente",today:"Hoy",prevRangeYears:e=>`Anterior ${e} aos`,nextRangeYears:e=>`Siguiente ${e} aos`},table:{noData:"Sin datos disponibles",noResults:"No se han encontrado resultados",loading:"Cargando...",selectedRecords:e=>e>1?e+" filas seleccionadas.":(e===0?"Sin":"1")+" fila seleccionada.",recordsPerPage:"Filas por pgina:",allRows:"Todas",pagination:(e,n,t)=>e+"-"+n+" de "+t,columns:"Columnas"},pagination:{first:"Primera pgina",prev:"Pgina anterior",next:"Prxima pgina",last:"ltima pgina"},editor:{url:"URL",bold:"Negrita",italic:"Cursiva",strikethrough:"Tachada",underline:"Subrayada",unorderedList:"Lista Desordenada",orderedList:"Lista Ordenada",subscript:"Subndice",superscript:"Superndice",hyperlink:"Hipervnculo",toggleFullscreen:"Alternar pantalla completa",quote:"Cita",left:"Alineacin izquierda",center:"Alineacin centro",right:"Alineacin derecha",justify:"Justificar alineacin",print:"Imprimir",outdent:"Disminuir indentacin",indent:"Aumentar indentacin",removeFormat:"Eliminar formato",formatting:"Formato",fontSize:"Tamao de Fuente",align:"Alinear",hr:"Insertar lnea horizontal",undo:"Deshacer",redo:"Rehacer",heading1:"Encabezado 1",heading2:"Encabezado 2",heading3:"Encabezado 3",heading4:"Encabezado 4",heading5:"Encabezado 5",heading6:"Encabezado 6",paragraph:"Prrafo",code:"Cdigo",size1:"Muy pequeo",size2:"Pequeo",size3:"Normal",size4:"Mediano",size5:"Grande",size6:"Muy grande",size7:"Mximo",defaultFont:"Fuente por defecto",viewSource:"Ver fuente"},tree:{noNodes:"No hay nodos disponibles",noResults:"No se encontraron los nodos correspondientes"}},ff=Xp(mb);ff.use(nA);ff.use(Kb,{plugins:{},lang:rA,iconSet:"material-icons"});ff.mount("#app");
